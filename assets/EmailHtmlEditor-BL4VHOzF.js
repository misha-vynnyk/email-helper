var nt=Object.defineProperty;var lt=(r,e,t)=>e in r?nt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var E=(r,e,t)=>lt(r,typeof e!="symbol"?e+"":e,t);import{r as M,o as ct,p as ut,q as dt,_ as gt,s as Se,t as De,v as Ve,w as it,j as a,x as U,y as ht,c as xe,B as m,n as P,z as ze,D as _e,I as Ce,e as Ge,f as Ie,P as pt,W as Ue,T as x,d as ue,G as fe,H as z,L as ft,C as mt,J as bt,K as xt,M as de,N as ee,Q as ge,A as be,U as V,X as Re,Y as yt,F as Be,k as We,Z as Xe,$ as B,g as Pe,h as Et,a0 as At,a1 as vt,a2 as Tt,a3 as St,a4 as _t,a5 as Ct,a6 as It,a7 as Rt,i as Lt,a8 as wt,a9 as jt,aa as Mt,ab as $t,ac as Ze,ad as Le,ae as we,af as Ht,ag as Ye,m as Ke,ah as je,ai as Ot,aj as kt,ak as Ft,u as Nt,al as Pt,am as Dt,an as Me,ao as Vt,ap as zt,aq as Gt,ar as Ut}from"./index-5DTLPcCG.js";const rt=r=>{const e=M.useRef({});return M.useEffect(()=>{e.current=r}),e.current};function Bt(r){const{badgeContent:e,invisible:t=!1,max:i=99,showZero:s=!1}=r,n=rt({badgeContent:e,max:i});let o=t;t===!1&&e===0&&!s&&(o=!0);const{badgeContent:l,max:c=i}=o?n:r,d=l&&Number(l)>c?`${c}+`:l;return{badgeContent:l,invisible:o,max:c,displayValue:d}}function Wt(r){return ut("MuiBadge",r)}const X=ct("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),Xt=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],$e=10,He=4,Zt=r=>{const{color:e,anchorOrigin:t,invisible:i,overlap:s,variant:n,classes:o={}}=r,l={root:["root"],badge:["badge",n,i&&"invisible",`anchorOrigin${U(t.vertical)}${U(t.horizontal)}`,`anchorOrigin${U(t.vertical)}${U(t.horizontal)}${U(s)}`,`overlap${U(s)}`,e!=="default"&&`color${U(e)}`]};return ht(l,Wt,o)},Yt=it("span",{name:"MuiBadge",slot:"Root",overridesResolver:(r,e)=>e.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Kt=it("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(r,e)=>{const{ownerState:t}=r;return[e.badge,e[t.variant],e[`anchorOrigin${U(t.anchorOrigin.vertical)}${U(t.anchorOrigin.horizontal)}${U(t.overlap)}`],t.color!=="default"&&e[`color${U(t.color)}`],t.invisible&&e.invisible]}})(({theme:r})=>{var e;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:r.typography.fontFamily,fontWeight:r.typography.fontWeightMedium,fontSize:r.typography.pxToRem(12),minWidth:$e*2,lineHeight:1,padding:"0 6px",height:$e*2,borderRadius:$e,zIndex:1,transition:r.transitions.create("transform",{easing:r.transitions.easing.easeInOut,duration:r.transitions.duration.enteringScreen}),variants:[...Object.keys(((e=r.vars)!=null?e:r).palette).filter(t=>{var i,s;return((i=r.vars)!=null?i:r).palette[t].main&&((s=r.vars)!=null?s:r).palette[t].contrastText}).map(t=>({props:{color:t},style:{backgroundColor:(r.vars||r).palette[t].main,color:(r.vars||r).palette[t].contrastText}})),{props:{variant:"dot"},style:{borderRadius:He,height:He*2,minWidth:He*2,padding:0}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${X.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${X.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${X.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${X.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${X.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${X.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${X.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${X.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:r.transitions.create("transform",{easing:r.transitions.easing.easeInOut,duration:r.transitions.duration.leavingScreen})}}]}}),qe=M.forwardRef(function(e,t){var i,s,n,o,l,c;const d=dt({props:e,name:"MuiBadge"}),{anchorOrigin:h={vertical:"top",horizontal:"right"},className:b,component:S,components:R={},componentsProps:I={},children:y,overlap:v="rectangular",color:$="default",invisible:D=!1,max:F=99,badgeContent:N,slots:W,slotProps:O,showZero:re=!1,variant:te="standard"}=d,ye=gt(d,Xt),{badgeContent:ae,invisible:Ee,max:oe,displayValue:Ae}=Bt({max:F,invisible:D,badgeContent:N,showZero:re}),ve=rt({anchorOrigin:h,color:$,overlap:v,variant:te,badgeContent:N}),ne=Ee||ae==null&&te!=="dot",{color:G=$,overlap:se=v,anchorOrigin:Te=h,variant:le=te}=ne?ve:d,ce=le!=="dot"?Ae:void 0,q=Se({},d,{badgeContent:ae,invisible:ne,max:oe,displayValue:ce,showZero:re,anchorOrigin:Te,color:G,overlap:se,variant:le}),p=Zt(q),g=(i=(s=W==null?void 0:W.root)!=null?s:R.Root)!=null?i:Yt,f=(n=(o=W==null?void 0:W.badge)!=null?o:R.Badge)!=null?n:Kt,j=(l=O==null?void 0:O.root)!=null?l:I.root,T=(c=O==null?void 0:O.badge)!=null?c:I.badge,Z=De({elementType:g,externalSlotProps:j,externalForwardedProps:ye,additionalProps:{ref:t,as:S},ownerState:q,className:Ve(j==null?void 0:j.className,p.root,b)}),ot=De({elementType:f,externalSlotProps:T,ownerState:q,className:Ve(p.badge,T==null?void 0:T.className)});return a.jsxs(g,Se({},Z,{children:[y,a.jsx(f,Se({},ot,{children:ce}))]}))}),Qe=xe(a.jsx("path",{d:"M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m9 7h-6v13h-2v-6h-2v6H9V9H3V7h18z"}),"Accessibility"),ie=xe(a.jsx("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"}),"AutoFixHigh"),me=xe(a.jsx("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z"}),"BugReport"),Je=xe(a.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList"),A={DEFAULT_IMAGE_WIDTH:600,DEFAULT_IMAGE_HEIGHT:400,DEFAULT_ALT_TEXT:"Image",MAX_TABLES:50,MAX_TABLE_NESTING:5,MAX_AUTOFIX_ITERATIONS:10,MAX_STYLE_MERGE_ITERATIONS:3,MAX_FILE_SIZE_KB:102,MAX_HTML_SIZE_KB:130,MAX_HTML_SIZE_BYTES:133120,REGEX_CACHE_SIZE:100,AST_CACHE_SIZE:50,TRAVERSAL_CACHE_SIZE:50,CACHE_TTL_MS:5*60*1e3,CACHE_CLEANUP_INTERVAL_MS:10*60*1e3,DEFAULT_LINK_STYLES:"color:#0000ff; text-decoration:none;",DEFAULT_IMAGE_STYLES:"display:block",HEADING_FONT_SIZES:{h1:32,h2:24,h3:20,h4:18,h5:16,h6:14},TARGET_CLIENTS:{outlook:!0,gmail:!0,applemail:!0,thunderbird:!1,mobile:!0}},_={MAX_PARSER_ITERATIONS:1e3,MAX_PARSER_DEPTH:100,MAX_PARSER_SAFETY_COUNTER:1e4,MAX_VALIDATION_RESULTS:1e3,MAX_TRAVERSAL_RESULTS:1e3,MAX_AUTOFIX_ITERATIONS:50,MAX_AUTOFIX_MULTIPLE_ITERATIONS:25,MAX_HTML_SIZE_INCREASE_MULTIPLIER:3,MAX_AUTOFIX_PASSES:3,CACHE_CLEANUP_PERCENTAGE:.3,CACHE_CLEANUP_PERCENTAGE_REDUCED:.2,CACHE_CLEANUP_THRESHOLD:.8,CACHE_CLEANUP_PERCENTAGE_LARGE:.4,MAX_FIX_HISTORY_SIZE:100,MAX_FIX_HISTORY_AGE_MS:30*60*1e3,MAX_CUSTOM_RULES_SIZE:100,MAX_STRING_BATCHER_OPERATIONS:50,SLOW_VALIDATION_THRESHOLD_MS:1e3,SLOW_AUTOFIX_THRESHOLD_MS:2e3,MAX_HEADING_LEVELS:6,MAX_RECENT_FIXES_TRACKED:10},Q={MAX_SCORE:100,MAX_PENALTY:100,ERROR_PENALTY:20,WARNING_PENALTY:10,INFO_PENALTY:5},k={REGEX_ACCESS_COUNT_WEIGHT:.3,REGEX_AGE_WEIGHT:.7,AST_ACCESS_COUNT_WEIGHT:.4,AST_AGE_WEIGHT:.6,TRAVERSAL_ACCESS_COUNT_WEIGHT:.2,TRAVERSAL_AGE_WEIGHT:.5,TRAVERSAL_SIZE_WEIGHT:.3},et={STYLE_ATTRIBUTE:/style="([^"]*)"/gi,WIDTH_100_PERCENT:/width:\s*100%/gi,EMPTY_HREF:/href\s*=\s*["']?\s*["']?/gi,MALFORMED_SRC:/\bs\s+rc=/gi,MALFORMED_HREF_NO_EQUALS:/\s+href\s+([^"\s>]+)/gi,MALFORMED_HREF_WITH_QUOTES:/\s+href\s+"([^"]*)"([^>]*)/gi,DEFAULT_HREF_VALUE:"urlhere"},qt={TEN_MINUTES_MS:10*60*1e3},C={HTML_TOO_LARGE:"HTML is too large for validation",HTML_TOO_LARGE_FOR_AUTOFIX:"HTML too large for autofix",VALIDATION_FAILED:"Validation failed",AUTOFIX_FAILED:"Autofix failed",RULE_NOT_FOUND:"Rule not found",INVALID_HTML_INPUT:"Invalid HTML input: must be a non-empty string",INVALID_RULE_NAME:"Rule name is required",INVALID_SEVERITY:"Invalid severity level. Must be error, warning, or info",INVALID_CONFIG:"Invalid configuration provided",VALIDATOR_DISPOSED:"EmailHTMLValidator has been disposed and cannot be used"},J={SLOW_OPERATION_PREFIX:"Slow operation detected",CACHE_CLEANUP_PREFIX:"Cache cleanup completed",STATISTICS_RESET_PREFIX:"Statistics reset",DISPOSAL_PREFIX:"disposed successfully",GARBAGE_COLLECTION_PREFIX:"Garbage collection triggered"};class u{static get(e,t="gi"){const i=`${e}|${t}`;if(this.cache.has(i)){const s=this.accessCount.get(i)||0;this.accessCount.set(i,s+1),this.lastAccess.set(i,Date.now())}else{this.cache.size>=this.maxSize&&this.performCleanup();try{const s=new RegExp(e,t);this.cache.set(i,s),this.accessCount.set(i,1),this.lastAccess.set(i,Date.now()),this.precompiledPatterns.has(e)||this.precompiledPatterns.add(e)}catch(s){console.warn(`Invalid regex pattern: ${e}`,s),this.cache.set(i,new RegExp("(?:)",t)),this.accessCount.set(i,1),this.lastAccess.set(i,Date.now())}}return this.cleanupTimer||(this.cleanupTimer=setTimeout(()=>{this.performCleanup(),this.cleanupTimer=void 0},A.CACHE_CLEANUP_INTERVAL_MS)),this.cache.get(i)}static performCleanup(){if(this.cache.size<=this.maxSize*_.CACHE_CLEANUP_THRESHOLD)return;const e=Array.from(this.cache.entries()).map(([i,s])=>({key:i,regex:s,accessCount:this.accessCount.get(i)||0,lastAccess:this.lastAccess.get(i)||0,age:Date.now()-(this.lastAccess.get(i)||0)}));e.sort((i,s)=>{const n=i.accessCount*k.REGEX_ACCESS_COUNT_WEIGHT+i.age/1e3*k.REGEX_AGE_WEIGHT,o=s.accessCount*k.REGEX_ACCESS_COUNT_WEIGHT+s.age/1e3*k.REGEX_AGE_WEIGHT;return n-o});const t=Math.floor(this.cache.size*_.CACHE_CLEANUP_PERCENTAGE);for(let i=0;i<t&&i<e.length;i++){const s=e[i];this.cache.delete(s.key),this.accessCount.delete(s.key),this.lastAccess.delete(s.key)}}static clear(){this.cache.clear(),this.accessCount.clear(),this.lastAccess.clear(),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0)}static size(){return this.cache.size}static getStats(){const e=Math.min(...Array.from(this.lastAccess.values()));return{size:this.cache.size,maxSize:this.maxSize,accessCount:Array.from(this.accessCount.values()).reduce((t,i)=>t+i,0),oldestEntry:e===1/0?0:e}}}E(u,"cache",new Map),E(u,"maxSize",A.REGEX_CACHE_SIZE),E(u,"precompiledPatterns",new Set),E(u,"accessCount",new Map),E(u,"lastAccess",new Map),E(u,"cleanupTimer");class K{static get(e){const t=this.hashCode(e),i=this.cache.get(t);if(i){if(Date.now()-i.timestamp>this.ttl){this.cache.delete(t);return}return i.accessCount++,this.cleanupTimer||(this.cleanupTimer=setTimeout(()=>{this.clearExpired(),this.cleanupTimer=void 0},A.CACHE_CLEANUP_INTERVAL_MS)),i.ast}}static set(e,t){const i=this.hashCode(e);this.cache.size>=this.maxSize&&this.performCleanup(),this.cache.set(i,{ast:t,timestamp:Date.now(),accessCount:1})}static clear(){this.cache.clear(),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0)}static size(){return this.cache.size}static clearExpired(){const e=Date.now();let t=0;const i=[];for(const[s,n]of this.cache.entries())e-n.timestamp>this.ttl&&i.push(s);for(const s of i)this.cache.delete(s),t++;return this.cache.size>this.maxSize*_.CACHE_CLEANUP_THRESHOLD&&this.performCleanup(),t}static performCleanup(){if(this.cache.size<=this.maxSize*_.CACHE_CLEANUP_THRESHOLD)return;const e=Array.from(this.cache.entries()).map(([i,s])=>({key:i,...s,age:Date.now()-s.timestamp}));e.sort((i,s)=>{const n=i.accessCount*k.AST_ACCESS_COUNT_WEIGHT+i.age/1e3*k.AST_AGE_WEIGHT,o=s.accessCount*k.AST_ACCESS_COUNT_WEIGHT+s.age/1e3*k.AST_AGE_WEIGHT;return n-o});const t=Math.floor(this.cache.size*_.CACHE_CLEANUP_PERCENTAGE);for(let i=0;i<t&&i<e.length;i++)this.cache.delete(e[i].key)}static hashCode(e){if(e.length===0)return"0";let t=0;for(let i=0;i<e.length;i++){const s=e.charCodeAt(i);t=(t<<5)-t+s,t=t&t}return`${Math.abs(t)}_${e.length}`}static getStats(){const e=Math.min(...Array.from(this.cache.values()).map(t=>t.timestamp));return{size:this.cache.size,maxSize:this.maxSize,ttl:this.ttl,oldestEntry:e===1/0?0:e}}}E(K,"cache",new Map),E(K,"maxSize",A.AST_CACHE_SIZE),E(K,"ttl",A.CACHE_TTL_MS),E(K,"cleanupTimer");class Oe{constructor(){E(this,"operations",[]);E(this,"maxOperations",_.MAX_STRING_BATCHER_OPERATIONS)}add(e,t){return this.operations.length>=this.maxOperations&&this.execute(""),this.operations.push({pattern:e,replacement:t}),this}execute(e){let t=e;try{for(const i of this.operations)t=t.replace(i.pattern,i.replacement)}catch(i){return console.warn("StringBatcher execution error:",i),e}finally{this.clear()}return t}clear(){this.operations=[]}getOperationCount(){return this.operations.length}}class Fe{constructor(e){E(this,"html");E(this,"position");E(this,"line");E(this,"column");this.html=e,this.position=0,this.line=1,this.column=1}parse(){const e=[],t=_.MAX_PARSER_ITERATIONS;let i=0;try{for(;this.position<this.html.length&&i<t;){i++;const s=this.parseNode();if(s&&e.push(s),this.position>=this.html.length)break;if(i>=t){console.warn("HTML parser reached max iterations, stopping to prevent infinite loop");break}}}catch(s){console.warn("HTML parser error:",s)}return e}parseNode(){return this.skipWhitespace(),this.position>=this.html.length?null:this.html[this.position]==="<"?this.html.substr(this.position,4)==="<!--"?this.parseComment():this.parseElement():this.parseText()}parseElement(){const e=this.line,t=this.column;if(this.html[this.position]!=="<")return null;if(this.advance(),this.html[this.position]==="/")return this.advance(),this.parseTagName()&&this.html[this.position]===">"&&this.advance(),null;const s=this.parseTagName();if(!s)return null;const n=this.parseAttributes(),o=this.html[this.position]==="/";o&&this.advance(),this.html[this.position]===">"&&this.advance();const l={type:"element",tagName:s.toLowerCase(),attributes:n,line:e,column:t,children:[]};return!o&&!this.isSelfClosingTag(s)&&(l.children=this.parseChildren(s)),l}parseTagName(){let e="";for(;this.position<this.html.length&&/[a-zA-Z0-9]/.test(this.html[this.position]);)e+=this.html[this.position],this.advance();return e}parseAttributes(){const e={};let t=0;for(;this.position<this.html.length&&this.html[this.position]!==">"&&this.html[this.position]!=="/";){const i=this.position;if(this.skipWhitespace(),this.position>=this.html.length||this.html[this.position]===">"||this.html[this.position]==="/")break;const s=this.parseAttribute();if(s&&(e[s.name]=s.value),this.position===i&&this.advance(),t++,t>_.MAX_PARSER_SAFETY_COUNTER)break}return e}parseAttribute(){const e=this.parseAttributeName();if(!e)return null;if(this.skipWhitespace(),this.position>=this.html.length)return{name:e,value:""};if(this.html[this.position]!=="=")return{name:e,value:""};this.advance(),this.skipWhitespace();const t=this.parseAttributeValue();return{name:e,value:t}}parseAttributeName(){let e="";for(;this.position<this.html.length&&/[a-zA-Z0-9\-_:]/.test(this.html[this.position]);)e+=this.html[this.position],this.advance();return e}parseAttributeValue(){if(this.position>=this.html.length)return"";const e=this.html[this.position];if(e==='"'||e==="'"){this.advance();let i="";for(;this.position<this.html.length&&this.html[this.position]!==e;)i+=this.html[this.position],this.advance();return this.position<this.html.length&&this.html[this.position]===e&&this.advance(),i}let t="";for(;this.position<this.html.length&&!/[\s>]/.test(this.html[this.position]);)t+=this.html[this.position],this.advance();return t}parseChildren(e){const t=[],i=_.MAX_PARSER_DEPTH;let s=0;const n=this.position;for(;this.position<this.html.length&&s<i;){if(s++,this.position===n&&s>1&&this.advance(),this.html.substr(this.position,2+e.length+1)===`</${e}>`){this.position+=2+e.length+1,this.updatePosition();break}const o=this.parseNode();if(o)t.push(o);else{this.position<this.html.length&&this.advance();break}if(this.position>=this.html.length)break}return t}parseText(){const e=this.line,t=this.column;let i="";for(;this.position<this.html.length&&this.html[this.position]!=="<";)i+=this.html[this.position],this.advance();return{type:"text",content:i.trim(),line:e,column:t}}parseComment(){const e=this.line,t=this.column;this.position+=4;let i="";for(;this.position<this.html.length&&this.html.substr(this.position,3)!=="-->";)i+=this.html[this.position],this.advance();return this.position<this.html.length&&this.html.substr(this.position,3)==="-->"&&(this.position+=3,this.updatePosition()),{type:"comment",content:i,line:e,column:t}}isSelfClosingTag(e){return["br","img","hr","area","base","col","input"].includes(e.toLowerCase())}skipWhitespace(){for(;this.position<this.html.length&&/\s/.test(this.html[this.position]);)this.advance()}advance(){this.position>=this.html.length||(this.html[this.position]===`
`?(this.line++,this.column=1):this.column++,this.position++)}updatePosition(){for(let e=0;e<3&&this.position-3+e>=0;e++)this.html[this.position-3+e]===`
`?(this.line++,this.column=1):this.column++}}function Y(r,e){if(Array.isArray(r))for(const t of r)t&&(e(t),t.children&&Array.isArray(t.children)&&t.children.length>0&&Y(t.children,e))}function he(r,e){if(!Array.isArray(r)||!e)return[];const t=[];return Y(r,i=>{i.type==="element"&&i.tagName===e.toLowerCase()&&t.push(i)}),t}const H={TAG_OPENING:r=>`<${r}(?:\\s[^>]*)?>`,TAG_CLOSING:r=>`</${r}>`,TAG_SELF_CLOSING:r=>`<${r}(?:\\s[^>]*)?/>`,TAG_WITH_CONTENT:r=>`<${r}(?:\\s[^>]*)?>[\\s\\S]*?</${r}>`,ATTRIBUTE_STYLE_DUPLICATE:'style="([^"]*)"([^>]*?)style="([^"]*)"',ATTRIBUTE_EMPTY_HREF:`href\\s*=\\s*(?:"\\s*"|'\\s*'|\\s*)`,ATTRIBUTE_TARGET_WRONG:`target\\s*=\\s*(?:"(?:_self|_parent|_top)"|'(?:_self|_parent|_top)')`,ATTRIBUTE_MALFORMED_SRC:"\\bs\\s+rc=",ATTRIBUTE_MISSING_SPACE:'="([^"]*)"([a-zA-Z]+=)',IMG_MALFORMED_ATTR_SPACING:'(<img[^>]*?)([a-zA-Z0-9_.-]+")([a-zA-Z]+=)',IMG_SELF_CLOSING_WRONG:"<img\\s*([^>]*?)></img>",IMG_MISSING_ALT:"<img(?![^>]*\\salt=)[^>]*>",IMG_MISSING_WIDTH:"<img(?![^>]*\\swidth=)[^>]*>",IMG_MISSING_HEIGHT:"<img(?![^>]*\\sheight=)[^>]*>",LINK_EMPTY_HREF:`<a[^>]*href\\s*=\\s*(?:"\\s*"|'\\s*'|\\s*)[^>]*>`,LINK_NO_TARGET:`<a[^>]*href\\s*=\\s*(?:"[^"]+"|'[^']+')[^>]*(?!target\\s*=)[^>]*>`,LINK_NO_STYLE:`<a[^>]*href\\s*=\\s*(?:"[^"]+"|'[^']+')[^>]*(?!style\\s*=)[^>]*>`,TABLE_NESTED_EXCESSIVE:"<table([^>]*)><tr><td([^>]*)><table([^>]*)><tr><td([^>]*)>",TABLE_NESTED_CLOSING:"</td></tr></table></td></tr></table>",TABLE_EMPTY:"<table[^>]*><tr><td[^>]*>\\s*</td></tr></table>",TABLE_SINGLE_SPAN_WRAPPER:"<table[^>]*><tr><td[^>]*>(\\s*<span[^>]*>[^<]+</span>\\s*)</td></tr></table>",STYLE_WIDTH_PERCENTAGE:'style="([^"]*?)width:\\s*100%([^"]*?)"',EMPTY_SPAN:"<span[^>]*>\\s*</span>",EMPTY_SPAN_WHITESPACE:"<span[^>]*>[\\s\\t\\n\\r]*</span>",EXTRA_SPACES_IN_TAG:"\\s+>",EXTRA_SPACES_MULTIPLE:"\\s{2,}",UNSAFE_ATTRIBUTE:r=>`\\s${r}\\s*=\\s*(?:"[^"]*"|'[^']*')`},Ne={GLOBAL_CASE_INSENSITIVE:"gi",GLOBAL_CASE_INSENSITIVE_MULTILINE:"gim",GLOBAL_CASE_INSENSITIVE_DOTALL:"gis",CASE_INSENSITIVE:"i",GLOBAL:"g"},Qt=["table","tbody","thead","tfoot","tr","td","th","img","a","span","strong","b","em","i","u","br","center","font","big","small","sup","sub","ul","ol","li","blockquote","pre"],pe=["div","p","h1","h2","h3","h4","h5","h6","section","article","aside","nav","header","footer","main","figure","figcaption","canvas","svg","video","audio","iframe","embed","object","script","form","input","button","textarea","select","option","fieldset","legend","label"],Jt={table:['cellpadding="0"','cellspacing="0"','border="0"'],img:["alt",'style="display:block"'],a:['target="_blank"'],td:['valign="top"']},L={isValidHtml:r=>!!(r&&typeof r=="string"),createValidationResult:(r,e,t,i,s,n,o)=>({rule:r,severity:e,message:t,suggestion:i,autoFixAvailable:!0,category:s,line:n,column:o}),hasPattern:(r,e,t=Ne.GLOBAL_CASE_INSENSITIVE)=>{if(!L.isValidHtml(r))return!1;try{const i=t.replace("g","");return u.get(e,i).test(r)}catch{return!1}},findPatternMatches:(r,e,t=Ne.GLOBAL_CASE_INSENSITIVE)=>{const i=[];if(!L.isValidHtml(r))return i;try{const s=t.includes("g")?t:`${t}g`,n=u.get(e,s);for(const o of r.matchAll(n))i.push(o)}catch{}return i},checkForbiddenTagsAST:(r,e,t,i)=>{if(!r||!Array.isArray(e))return;const s=n=>{for(const o of n)o.type==="element"&&o.tagName&&e.includes(o.tagName)&&i(o,o.tagName),o.children&&Array.isArray(o.children)&&s(o.children)};s(r)},checkForbiddenTagsRegex:(r,e,t,i)=>{!L.isValidHtml(r)||!Array.isArray(e)||e.forEach(s=>{const n=H.TAG_OPENING(s);L.findPatternMatches(r,n).length>0&&i(s)})}},es={replaceTagsWithSpans:(r,e)=>{if(!L.isValidHtml(r))return r;let t=r;try{Object.entries(e).forEach(([i,s])=>{const n=`<${i}((?:\\s[^>]*)?)>`,o=H.TAG_CLOSING(i),l=Object.entries(s).map(([c,d])=>{switch(c){case"fontSize":return`font-size: ${d}px`;case"fontWeight":return`font-weight: ${d}`;case"display":return`display: ${d}`;default:return`${c}: ${d}`}}).join("; ");t=t.replace(u.get(n,"gi"),(c,d)=>{const h=d.match(/style\s*=\s*["']([^"']*)["']/i);let b=l;if(h){const S=h[1].replace(/;\s*$/,""),R={};S.split(";").forEach(I=>{const[y,v]=I.split(":").map($=>$.trim());y&&v&&(R[y]=v)}),l.split(";").forEach(I=>{const[y,v]=I.split(":").map($=>$.trim());y&&v&&(R[y]=v)}),b=Object.entries(R).map(([I,y])=>`${I}: ${y}`).join("; "),d=d.replace(/\s*style\s*=\s*["'][^"']*["']/gi,"")}return`<span${d} style="${b};">`}),t=t.replace(u.get(o,"gi"),"</span>")})}catch{}return t},replaceBlockElementsWithTables:(r,e)=>{if(!L.isValidHtml(r))return r;let t=r;try{Array.isArray(e)&&e.forEach(i=>{const s=H.TAG_OPENING(i),n=H.TAG_CLOSING(i);t=t.replace(u.get(s),'<table cellpadding="0" cellspacing="0" border="0"$1><tr><td valign="top">'),t=t.replace(u.get(n),"</td></tr></table>")})}catch{}return t},removeDangerousTags:(r,e)=>{if(!L.isValidHtml(r))return r;let t=r;try{Array.isArray(e)&&e.forEach(i=>{const s=H.TAG_WITH_CONTENT(i),n=H.TAG_SELF_CLOSING(i);t=t.replace(u.get(s,Ne.GLOBAL_CASE_INSENSITIVE_DOTALL),""),t=t.replace(u.get(n),"")})}catch{}return t},cleanupTableNesting:(r,e=10)=>{if(!L.isValidHtml(r))return r;let t=r;try{let i,s=0;do i=t,t=t.replace(u.get(H.TABLE_NESTED_EXCESSIVE),"<table$1><tr><td$2>"),t=t.replace(u.get(H.TABLE_NESTED_CLOSING),"</td></tr></table>"),s++;while(i!==t&&s<e);t=t.replace(u.get(H.TABLE_EMPTY),""),t=t.replace(u.get(H.TABLE_SINGLE_SPAN_WRAPPER),"$1")}catch{}return t},mergeDuplicateStyles:(r,e=3)=>{if(!L.isValidHtml(r))return r;let t=r;try{let i,s=0;do i=t,t=t.replace(u.get(H.ATTRIBUTE_STYLE_DUPLICATE),(n,o,l,c)=>{var y;const d=o.split(";").filter(v=>v.trim()),h=c.split(";").filter(v=>v.trim()),b=[...d,...h],S=[],R=new Set;for(const v of b.reverse()){const $=(y=v.split(":")[0])==null?void 0:y.trim();$&&!R.has($)&&(R.add($),S.unshift(v.trim()))}return`style="${S.join("; ")}"${l}`}),s++;while(i!==t&&s<e)}catch{}return t},removeEmptyElements:r=>{if(!L.isValidHtml(r))return r;let e=r;try{e=e.replace(u.get(H.EMPTY_SPAN),""),e=e.replace(u.get(H.EMPTY_SPAN_WHITESPACE),"")}catch{}return e}},ts={h1:32,h2:24,h3:20,h4:18,h5:16,h6:14},w={"forbidden-tags":{name:"forbidden-tags",displayName:"Forbidden HTML Tags (Legacy)",description:"Legacy rule - replaced by specific rules (heading-tags, paragraph-tags, etc.)",severity:"error",enabled:!1,configurable:!0,category:"structure",config:{allowedTags:Qt,forbiddenTags:pe},check:(r,e={})=>{const t=[];if(!r||typeof r!="string")return t;try{const s=new Fe(r).parse(),n=e.forbiddenTags||pe;Y(s,o=>{o.type==="element"&&o.tagName&&Array.isArray(n)&&n.includes(o.tagName)&&t.push({rule:"forbidden-tags",severity:"error",message:`Tag "${o.tagName}" is not email-safe`,line:o.line,column:o.column,suggestion:ke(o.tagName),autoFixAvailable:!0,category:"structure"})})}catch{const s=e.forbiddenTags||pe;Array.isArray(s)&&s.forEach(n=>{const o=u.get(`<${n}(?:\\s[^>]*)?>`,"gi"),l=r.match(o);l&&l.forEach(()=>{t.push({rule:"forbidden-tags",severity:"error",message:`Tag "${n}" is not email-safe`,suggestion:ke(n),autoFixAvailable:!0,category:"structure"})})})}return t},checkWithAST:(r,e,t={})=>{const i=[];if(!r||typeof r!="string"||!e)return i;try{const s=t.forbiddenTags||pe;Y(e,n=>{n.type==="element"&&n.tagName&&Array.isArray(s)&&s.includes(n.tagName)&&i.push({rule:"forbidden-tags",severity:"error",message:`Tag "${n.tagName}" is not email-safe`,line:n.line,column:n.column,suggestion:ke(n.tagName),autoFixAvailable:!0,category:"structure"})})}catch{return w["forbidden-tags"].check(r,t)}return i},autofix:r=>{if(!r||typeof r!="string")return r;let e=r;try{for(let o=1;o<=_.MAX_HEADING_LEVELS;o++){const l=u.get(`<h${o}([^>]*)>`),c=u.get(`</h${o}>`);e=e.replace(l,`<span$1 style="font-weight: bold; font-size: ${ss(o)}px;">`),e=e.replace(c,"</span>")}e=e.replace(u.get("<p([^>]*)>"),"<span$1>"),e=e.replace(u.get("</p>"),"</span>");const t=["div","section","article","nav","header","footer","main","aside","figure","figcaption"],i=(e.match(/<table/g)||[]).length,s=A.MAX_TABLES;i<s&&t.forEach(o=>{const l=u.get(`<${o}((?:\\s[^>]*)?)>`),c=u.get(`</${o}>`);e=e.replace(l,'<table cellpadding="0" cellspacing="0" border="0"$1><tr><td valign="top">'),e=e.replace(c,"</td></tr></table>")}),["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"].forEach(o=>{const l=u.get(`<${o}(?:\\s[^>]*)?>(?:[\\s\\S]*?)</${o}>`,"gi");e=e.replace(l,"");const c=u.get(`<${o}(?:\\s[^>]*)?/>`,"gi");e=e.replace(c,"")});for(let o=0;o<A.MAX_STYLE_MERGE_ITERATIONS;o++){const l=e;if(e=e.replace(u.get('style="([^"]*?)"([^>]*?)style="([^"]*?)"'),(c,d,h,b)=>{var D;const S=d.split(";").filter(F=>F.trim()),R=b.split(";").filter(F=>F.trim()),I=[...S,...R],y=[],v=new Set;for(const F of I){const N=(D=F.split(":")[0])==null?void 0:D.trim();N&&!v.has(N)&&(v.add(N),y.push(F.trim()))}return`style="${y.join("; ")}"${h}`}),l===e)break}for(let o=0;o<A.MAX_AUTOFIX_ITERATIONS;o++){const l=e;if(e=e.replace(u.get("<table([^>]*?)><tr><td([^>]*?)><table([^>]*?)><tr><td([^>]*?)>"),"<table$1><tr><td$2>"),e=e.replace(u.get("<\\/td><\\/tr><\\/table><\\/td><\\/tr><\\/table>"),"</td></tr></table>"),l===e)break}e=e.replace(u.get("<table[^>]*><tr><td[^>]*>\\s*<\\/td><\\/tr><\\/table>"),""),e=e.replace(u.get("<table[^>]*><tr><td[^>]*>(\\s*<span[^>]*>[^<]+<\\/span>\\s*)<\\/td><\\/tr><\\/table>"),"$1"),e=e.replace(u.get("<span[^>]*>\\s*<\\/span>"),""),e=e.replace(u.get("<span[^>]*>[\\s\\t\\n\\r]*<\\/span>"),""),e=e.replace(u.get("\\bs\\s+rc="),"src="),e=e.replace(u.get("\\bS\\s+RC="),"src="),e=e.replace(u.get('="([^"]*)"([a-zA-Z]+=)'),'="$1" $2'),e=e.replace(u.get('(<img[^>]*?)([a-zA-Z0-9_.-]+")([a-zA-Z]+=)'),"$1$2 $3")}catch{}return e=e.replace(u.get("\\bs\\s+rc="),"src="),e=e.replace(u.get("\\bS\\s+RC="),"src="),e}},"email-safe-tags":{name:"email-safe-tags",displayName:"Email-Safe Tag Format",description:"Ensures tags are formatted correctly for email clients",severity:"error",enabled:!0,configurable:!1,category:"structure",check:r=>{const e=[];if(!r||typeof r!="string")return e;try{["br","hr"].forEach(s=>{const n=u.get(`<${s}\\s*[^>]*><\\/${s}>`),o=r.match(n);o&&o.forEach(()=>{e.push({rule:"email-safe-tags",severity:"error",message:`Tag "${s}" should not have closing tag in emails`,suggestion:`Replace <${s}></${s}> with <${s}>`,autoFixAvailable:!0,category:"structure"})});const l=u.get(`<${s}\\s*[^>]*\\/>`),c=r.match(l);c&&c.forEach(()=>{e.push({rule:"email-safe-tags",severity:"error",message:`Tag "${s}" should be open tag in emails, not self-closing`,suggestion:`Replace <${s}/> with <${s}>`,autoFixAvailable:!0,category:"structure"})})}),["img"].forEach(s=>{const n=u.get(`<${s}\\s*[^>]*><\\/${s}>`),o=r.match(n);o&&o.forEach(()=>{e.push({rule:"email-safe-tags",severity:"error",message:`Tag "${s}" should be self-closing`,suggestion:`Replace <${s}></${s}> with <${s} />`,autoFixAvailable:!0,category:"structure"})})})}catch{}return e},autofix:r=>{if(!r||typeof r!="string")return r;try{const e=new Oe;return e.add(u.get("<br\\s*[^>]*><\\/br>"),"<br>").add(u.get("<br\\s*[^>]*\\/>"),"<br>").add(u.get("<hr\\s*[^>]*><\\/hr>"),"<hr>").add(u.get("<hr\\s*[^>]*\\/>"),"<hr>").add(u.get("<img\\s*([^>]*?)><\\/img>"),"<img $1 />").add(u.get("<br\\/\\s*\\/>"),"<br>").add(u.get("<br\\s*\\/\\s*\\/>"),"<br>").add(u.get("<hr\\/\\s*\\/>"),"<hr>").add(u.get("<hr\\s*\\/\\s*\\/>"),"<hr>").add(u.get("(<img[^>]*?)\\s*\\/\\s*([^>]*?)>"),"$1$2 />").add(u.get(`(<img[^>]*?)([^"'])\\s*\\/\\s*([^>]*?)>`),"$1$2$3 />").add(u.get("<img([^>]*?)([^/])\\s*\\/\\s*\\/\\s*>"),"<img$1$2 />").add(u.get("(<img[^>]*?)\\s+\\/>","g"),"$1 />").add(u.get("(<img[^>]*?)([a-zA-Z])([a-zA-Z]+=)"),"$1$2 $3").add(u.get("\\s+(style|alt|src|class|width|height)=")," $1=").add(u.get(`=\\s*([^"'\\s>]+)`),'="$1"').add(u.get("\\s+>","gi"),">").add(u.get("<\\s+","gi"),"<").add(u.get("\\bs\\s+rc="),"src=").add(u.get("\\bS\\s+RC="),"src="),e.execute(r)}catch{return r}}},"table-attributes":{name:"table-attributes",displayName:"Required Table Attributes",description:"Ensures tables have required email-safe attributes",severity:"error",enabled:!0,configurable:!0,category:"structure",config:{requiredAttributes:Jt},check:r=>{const e=[];if(!r||typeof r!="string")return e;try{const i=new Fe(r).parse();he(i,"table").forEach(o=>{const l=o.attributes||{};(!l.cellpadding||l.cellpadding!=="0")&&e.push({rule:"table-attributes",severity:"error",message:'Table should have cellpadding="0"',line:o.line,column:o.column,suggestion:'Add cellpadding="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!l.cellspacing||l.cellspacing!=="0")&&e.push({rule:"table-attributes",severity:"error",message:'Table should have cellspacing="0"',line:o.line,column:o.column,suggestion:'Add cellspacing="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!l.border||l.border!=="0")&&e.push({rule:"table-attributes",severity:"error",message:'Table should have border="0"',line:o.line,column:o.column,suggestion:'Add border="0" to table tag',autoFixAvailable:!0,category:"structure"})}),he(i,"img").forEach(o=>{const l=o.attributes||{};l.alt||e.push({rule:"table-attributes",severity:"error",message:"Image must have alt attribute",line:o.line,column:o.column,suggestion:'Add alt="" to img tag',autoFixAvailable:!0,category:"accessibility"}),l.width||e.push({rule:"table-attributes",severity:"error",message:"Image must have width attribute",line:o.line,column:o.column,suggestion:`Add width="${A.DEFAULT_IMAGE_WIDTH}" to img tag`,autoFixAvailable:!0,category:"structure"}),l.height||e.push({rule:"table-attributes",severity:"error",message:"Image must have height attribute",line:o.line,column:o.column,suggestion:`Add height="${A.DEFAULT_IMAGE_HEIGHT}" to img tag`,autoFixAvailable:!0,category:"structure"}),(!l.style||!l.style.includes("display:block"))&&e.push({rule:"table-attributes",severity:"error",message:'Image must have style="display:block"',line:o.line,column:o.column,suggestion:'Add style="display:block" to img tag',autoFixAvailable:!0,category:"structure"})})}catch{e.push({rule:"table-attributes",severity:"warning",message:"Unable to parse HTML for detailed checking",suggestion:'Check table attributes manually: cellpadding="0" cellspacing="0" border="0"',autoFixAvailable:!1,category:"structure"})}return e},checkWithAST:(r,e,t,i)=>{const s=[];if(!r||typeof r!="string"||!e)return s;try{((i==null?void 0:i.findNodesByTag("table"))||he(e,"table")).forEach(l=>{const c=l.attributes||{};(!c.cellpadding||c.cellpadding!=="0")&&s.push({rule:"table-attributes",severity:"error",message:'Table should have cellpadding="0"',line:l.line,column:l.column,suggestion:'Add cellpadding="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!c.cellspacing||c.cellspacing!=="0")&&s.push({rule:"table-attributes",severity:"error",message:'Table should have cellspacing="0"',line:l.line,column:l.column,suggestion:'Add cellspacing="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!c.border||c.border!=="0")&&s.push({rule:"table-attributes",severity:"error",message:'Table should have border="0"',line:l.line,column:l.column,suggestion:'Add border="0" to table tag',autoFixAvailable:!0,category:"structure"})}),((i==null?void 0:i.findNodesByTag("img"))||he(e,"img")).forEach(l=>{const c=l.attributes||{};c.alt||s.push({rule:"table-attributes",severity:"error",message:"Image must have alt attribute",line:l.line,column:l.column,suggestion:'Add alt="" to img tag',autoFixAvailable:!0,category:"accessibility"}),c.width||s.push({rule:"table-attributes",severity:"error",message:"Image must have width attribute",line:l.line,column:l.column,suggestion:`Add width="${A.DEFAULT_IMAGE_WIDTH}" to img tag`,autoFixAvailable:!0,category:"structure"}),c.height||s.push({rule:"table-attributes",severity:"error",message:"Image must have height attribute",line:l.line,column:l.column,suggestion:`Add height="${A.DEFAULT_IMAGE_WIDTH}" to img tag`,autoFixAvailable:!0,category:"structure"}),(!c.style||!c.style.includes("display:block"))&&s.push({rule:"table-attributes",severity:"error",message:'Image must have style="display:block"',line:l.line,column:l.column,suggestion:'Add style="display:block" to img tag',autoFixAvailable:!0,category:"structure"})})}catch{return w["table-attributes"].check(r)}return s},autofix:r=>{if(!r||typeof r!="string")return r;let e=r;try{e=e.replace(/<table([^>]*?)>/gi,(t,i)=>{let s=i;return s=s.replace(/cellpadding="[^"]*"/gi,'cellpadding="0"'),s=s.replace(/cellspacing="[^"]*"/gi,'cellspacing="0"'),s=s.replace(/border="[^"]*"/gi,'border="0"'),s.includes("cellpadding=")||(s+=' cellpadding="0"'),s.includes("cellspacing=")||(s+=' cellspacing="0"'),s.includes("border=")||(s+=' border="0"'),`<table${s}>`}),e=e.replace(/<td([^>]*?)>/gi,(t,i)=>{let s=i;return s=s.replace(/valign="(middle|bottom|baseline)"/gi,'valign="top"'),s.includes("valign=")||(s+=' valign="top"'),`<td${s}>`}),e=e.replace(/<img([^>]*?)(\s*\/?\s*)>/gi,(t,i)=>{let s=i;return s.includes("width=")||(s+=` width="${A.DEFAULT_IMAGE_WIDTH}"`),s.includes("height=")||(s+=` height="${A.DEFAULT_IMAGE_HEIGHT}"`),s.includes("width: 100%")&&!s.includes("max-width:")&&(s=s.replace(/style="([^"]*?)width:\s*100%([^"]*?)"/gi,(n,o,l)=>{const c=o.trim(),d=l.trim(),h=c&&!c.endsWith(";")?"; ":"",b=d&&!d.startsWith(";")?"; ":"";return`style="${c}${h}max-width:100%${b}${d}"`})),s.includes("style=")?s.includes("display:block")||(s=s.replace(/style="([^"]*?)"/gi,(n,o)=>{const l=o.trim(),c=l&&!l.endsWith(";")?"; ":"";return`style="${l}${c}display:block"`})):s+=' style="display:block"',`<img${s} />`})}catch{}return e}},"email-safe-links":{name:"email-safe-links",displayName:"Email-Safe Links",description:"Ensures links are formatted correctly for email clients",severity:"error",enabled:!0,configurable:!1,category:"structure",check:r=>{const e=[];if(!r||typeof r!="string")return e;try{const t=/<a[^>]*href\s*=\s*["']?\s*["']?[^>]*>/gi;for(const o of r.matchAll(t))(o[0].includes('href=""')||o[0].includes("href=''"))&&e.push({rule:"email-safe-links",severity:"error",message:"Link has empty href attribute",suggestion:"Remove empty links or provide valid href",autoFixAvailable:!0,category:"structure"});const i=/<a[^>]*target\s*=\s*["'](_self|_parent|_top)["'][^>]*>/gi;for(const o of r.matchAll(i))e.push({rule:"email-safe-links",severity:"warning",message:`Link target "${o[1]}" doesn't work in most email clients`,suggestion:'Use target="_blank" for all email links',autoFixAvailable:!0,category:"compatibility"});const s=/<a[^>]*href\s*=\s*["'][^"']*["'][^>]*(?!target\s*=)[^>]*>/gi;for(const o of r.matchAll(s))o[0].includes("target=")||e.push({rule:"email-safe-links",severity:"warning",message:'Link should have target="_blank" in emails',suggestion:'Add target="_blank" to all email links',autoFixAvailable:!0,category:"best-practice"});const n=/<a[^>]*href\s*=\s*["'][^"']*["'][^>]*(?!style\s*=)[^>]*>/gi;for(const o of r.matchAll(n))o[0].includes("style=")||e.push({rule:"email-safe-links",severity:"warning",message:"Link should have inline styles for email compatibility",suggestion:'Add style="color:#0000ff; text-decoration:none;" to links',autoFixAvailable:!0,category:"best-practice"})}catch{}return e},autofix:r=>{if(!r||typeof r!="string")return r;let e=r;try{e=e.replace(/<a\b([^>]*?)href\s*=\s*["']?\s*["']?([^>]*?)>/gi,(t,i,s)=>t.includes('href=""')||t.includes("href=''")||t.includes("href= ")?`<a${i} href="${et.DEFAULT_HREF_VALUE}"${s}>`:t),e=e.replace(/<a\b([^>]*?)target\s*=\s*["'](_self|_parent|_top)["']([^>]*?)>/gi,'<a$1target="_blank"$3>'),e=e.replace(/<a\b([^>]*)>/gi,(t,i)=>{let s=i;return s=s.replace(/\s+href\s+([^"\s>]+)/gi,' href="$1"'),s=s.replace(/\s+href\s+"([^"]*)"([^>]*)/gi,' href="$1"$2'),s.includes("href=")||(s+=` href="${et.DEFAULT_HREF_VALUE}"`),s.includes("target=")||(s+=' target="_blank"'),s.includes("style=")?s.includes("text-decoration:")||(s=s.replace(/style="([^"]*?)"/gi,(n,o)=>{const l=o.trim(),c=l&&!l.endsWith(";")?"; ":"";return`style="${l}${c}text-decoration:none"`})):s+=' style="color:#0000ff; text-decoration:none;"',`<a${s}>`})}catch{}return e}},"email-unsafe-attributes":{name:"email-unsafe-attributes",displayName:"Email-Unsafe Attributes",description:"Removes attributes that don't work or are dangerous in emails",severity:"warning",enabled:!0,configurable:!1,category:"compatibility",check:r=>{const e=[];if(!r||typeof r!="string")return e;try{["id","class","onclick","onload","onmouseover","contenteditable","draggable","data-\\w+"].forEach(i=>{u.get(`\\s${i}\\s*=\\s*["'][^"']*["']`).test(r)&&e.push({rule:"email-unsafe-attributes",severity:"warning",message:`Attribute "${i}" may not work in email clients`,suggestion:"Remove or replace with inline styles",autoFixAvailable:!0,category:"compatibility"})})}catch{}return e},autofix:r=>{if(!r||typeof r!="string")return r;try{const e=new Oe;return["id","class","onclick","onload","onmouseover","onmouseout","onfocus","onblur","contenteditable","draggable","spellcheck","tabindex","accesskey","data-[\\w-]+","aria-[\\w-]+"].forEach(i=>{e.add(u.get(`\\s${i}\\s*=\\s*["'][^"']*["']`),"")}),e.add(u.get("\\s+>","g"),">").add(u.get("\\s{2,}","g")," "),e.execute(r)}catch{return r}}},"heading-tags":{name:"heading-tags",displayName:"Heading Tags Replacement",description:"Replaces h1-h6 tags with styled spans for email compatibility",severity:"error",enabled:!0,configurable:!1,category:"structure",check:r=>{const e=[];if(!L.isValidHtml(r))return e;try{for(let t=1;t<=_.MAX_HEADING_LEVELS;t++){const i=H.TAG_OPENING(`h${t}`);L.findPatternMatches(r,i).forEach(()=>{e.push(L.createValidationResult("heading-tags","error",`Heading tag h${t} is not email-safe`,`Replace h${t} with styled span`,"structure"))})}}catch{}return e},checkWithAST:(r,e)=>{const t=[];if(!L.isValidHtml(r)||!e)return t;try{const i=["h1","h2","h3","h4","h5","h6"];L.checkForbiddenTagsAST(e,i,"heading-tags",s=>{t.push(L.createValidationResult("heading-tags","error",`Heading tag ${s.tagName} is not email-safe`,`Replace ${s.tagName} with styled span`,"structure",s.line,s.column))})}catch{return w["heading-tags"].check(r)}return t},autofix:r=>{if(!L.isValidHtml(r))return r;try{const e=Object.fromEntries(Object.entries(ts).map(([t,i])=>[t,{fontSize:i,fontWeight:"bold"}]));return es.replaceTagsWithSpans(r,e)}catch{return r}}},"paragraph-tags":{name:"paragraph-tags",displayName:"Paragraph Tags Replacement",description:"Replaces p tags with spans for email compatibility",severity:"error",enabled:!0,configurable:!1,category:"structure",check:r=>{const e=[];if(!L.isValidHtml(r))return e;try{const t=H.TAG_OPENING("p");L.findPatternMatches(r,t).forEach(()=>{e.push(L.createValidationResult("paragraph-tags","error","Paragraph tag is not email-safe","Replace p with span","structure"))})}catch{}return e},checkWithAST:(r,e)=>{const t=[];if(!r||typeof r!="string"||!e)return t;try{Y(e,i=>{i.type==="element"&&i.tagName==="p"&&t.push({rule:"paragraph-tags",severity:"error",message:"Paragraph tag is not email-safe",line:i.line,column:i.column,suggestion:"Replace p with span",autoFixAvailable:!0,category:"structure"})})}catch{return w["paragraph-tags"].check(r)}return t},autofix:r=>{if(!r||typeof r!="string")return r;let e=r;try{e=e.replace(u.get("<p([^>]*)>"),"<span$1>"),e=e.replace(u.get("</p>"),"</span>")}catch{}return e}},"block-element-tags":{name:"block-element-tags",displayName:"Block Element Tags Replacement",description:"Replaces block elements (div, section, etc.) with table structure for email compatibility",severity:"error",enabled:!0,configurable:!0,category:"structure",config:{blockTags:["div","section","article","nav","header","footer","main","aside","figure","figcaption"]},check:(r,e={})=>{const t=[];if(!r||typeof r!="string")return t;try{const i=e.blockTags||["div","section","article","nav","header","footer","main","aside","figure","figcaption"];Array.isArray(i)&&i.forEach(s=>{const n=u.get(`<${s}(?:\\s[^>]*)?>`,"gi"),o=r.match(n);o&&o.forEach(()=>{t.push({rule:"block-element-tags",severity:"error",message:`Block element "${s}" is not email-safe`,suggestion:`Replace ${s} with table structure`,autoFixAvailable:!0,category:"structure"})})})}catch{}return t},checkWithAST:(r,e,t={})=>{const i=[];if(!r||typeof r!="string"||!e)return i;try{const s=t.blockTags||["div","section","article","nav","header","footer","main","aside","figure","figcaption"];Y(e,n=>{n.type==="element"&&n.tagName&&Array.isArray(s)&&s.includes(n.tagName)&&i.push({rule:"block-element-tags",severity:"error",message:`Block element "${n.tagName}" is not email-safe`,line:n.line,column:n.column,suggestion:`Replace ${n.tagName} with table structure`,autoFixAvailable:!0,category:"structure"})})}catch{return w["block-element-tags"].check(r,t)}return i},autofix:(r,e={})=>{if(!r||typeof r!="string")return r;let t=r;try{const i=e.blockTags||["div","section","article","nav","header","footer","main","aside","figure","figcaption"];if(Array.isArray(i)){const s=(t.match(/<table/g)||[]).length,n=A.MAX_TABLES;s<n&&i.forEach(o=>{const l=u.get(`<${o}([^>]*)>`),c=u.get(`</${o}>`);t=t.replace(l,'<table cellpadding="0" cellspacing="0" border="0"$1><tr><td valign="top">'),t=t.replace(c,"</td></tr></table>")})}}catch{}return t}},"dangerous-tags":{name:"dangerous-tags",displayName:"Dangerous Tags Removal",description:"Removes dangerous/unsupported tags (script, style, form, etc.) completely",severity:"error",enabled:!0,configurable:!0,category:"structure",config:{dangerousTags:["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"]},check:(r,e={})=>{const t=[];if(!r||typeof r!="string")return t;try{const i=e.dangerousTags||["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"];Array.isArray(i)&&i.forEach(s=>{const n=u.get(`<${s}(?:\\s[^>]*)?>`,"gi"),o=r.match(n);o&&o.forEach(()=>{t.push({rule:"dangerous-tags",severity:"error",message:`Dangerous tag "${s}" should be removed`,suggestion:`Remove ${s} tag completely`,autoFixAvailable:!0,category:"structure"})})})}catch{}return t},checkWithAST:(r,e,t={})=>{const i=[];if(!r||typeof r!="string"||!e)return i;try{const s=t.dangerousTags||["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"];Y(e,n=>{n.type==="element"&&n.tagName&&Array.isArray(s)&&s.includes(n.tagName)&&i.push({rule:"dangerous-tags",severity:"error",message:`Dangerous tag "${n.tagName}" should be removed`,line:n.line,column:n.column,suggestion:`Remove ${n.tagName} tag completely`,autoFixAvailable:!0,category:"structure"})})}catch{return w["dangerous-tags"].check(r,t)}return i},autofix:(r,e={})=>{if(!r||typeof r!="string")return r;let t=r;try{const i=e.dangerousTags||["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"];Array.isArray(i)&&i.forEach(s=>{const n=u.get(`<${s}(?:\\s[^>]*)?>(?:[\\s\\S]*?)</${s}>`,"gi");t=t.replace(n,"");const o=u.get(`<${s}(?:\\s[^>]*)?/>`,"gi");t=t.replace(o,"")})}catch{}return t}},"duplicate-styles":{name:"duplicate-styles",displayName:"Duplicate Style Attributes Cleanup",description:"Merges duplicate style attributes in HTML elements",severity:"warning",enabled:!0,configurable:!1,category:"best-practice",check:r=>{const e=[];if(!r||typeof r!="string")return e;try{u.get('style="([^"]*?)"([^>]*?)style="([^"]*?)"').test(r)&&e.push({rule:"duplicate-styles",severity:"warning",message:"Duplicate style attributes found",suggestion:"Merge duplicate style attributes",autoFixAvailable:!0,category:"best-practice"})}catch{}return e},autofix:r=>{if(!r||typeof r!="string")return r;let e=r;try{for(let t=0;t<A.MAX_STYLE_MERGE_ITERATIONS;t++){const i=e;if(e=e.replace(u.get('style="([^"]*?)"([^>]*?)style="([^"]*?)"'),(s,n,o,l)=>{var I;const c=n.split(";").filter(y=>y.trim()),d=l.split(";").filter(y=>y.trim()),h=[...c,...d],b=[],S=new Set;for(const y of h.reverse()){const v=(I=y.split(":")[0])==null?void 0:I.trim();v&&!S.has(v)&&(S.add(v),b.unshift(y.trim()))}return`style="${b.join("; ")}"${o}`}),i===e)break}}catch{}return e}},"table-nesting-cleanup":{name:"table-nesting-cleanup",displayName:"Table Nesting Cleanup",description:"Reduces excessive table nesting for better email rendering",severity:"warning",enabled:!0,configurable:!0,category:"structure",config:{maxIterations:A.MAX_AUTOFIX_ITERATIONS},check:r=>{const e=[];if(!r||typeof r!="string")return e;try{u.get("<table([^>]*?)><tr><td([^>]*?)><table([^>]*?)><tr><td([^>]*?)>").test(r)&&e.push({rule:"table-nesting-cleanup",severity:"warning",message:"Excessive table nesting detected",suggestion:"Reduce table nesting for better email compatibility",autoFixAvailable:!0,category:"structure"})}catch{}return e},autofix:(r,e={})=>{if(!r||typeof r!="string")return r;let t=r;try{const i=typeof e.maxIterations=="number"?e.maxIterations:A.MAX_AUTOFIX_ITERATIONS;for(let s=0;s<i;s++){const n=t;if(t=t.replace(u.get("<table([^>]*?)><tr><td([^>]*?)><table([^>]*?)><tr><td([^>]*?)>"),"<table$1><tr><td$2>"),t=t.replace(u.get("<\\/td><\\/tr><\\/table><\\/td><\\/tr><\\/table>"),"</td></tr></table>"),n===t)break}t=t.replace(u.get("<table[^>]*><tr><td[^>]*>\\s*<\\/td><\\/tr><\\/table>"),""),t=t.replace(u.get("<table[^>]*><tr><td[^>]*>(\\s*<span[^>]*>[^<]+<\\/span>\\s*)<\\/td><\\/tr><\\/table>"),"$1")}catch{}return t}},"empty-elements-cleanup":{name:"empty-elements-cleanup",displayName:"Empty Elements Cleanup",description:"Removes empty and whitespace-only elements",severity:"info",enabled:!0,configurable:!1,category:"best-practice",check:r=>{const e=[];if(!r||typeof r!="string")return e;try{u.get("<span[^>]*>\\s*<\\/span>").test(r)&&e.push({rule:"empty-elements-cleanup",severity:"info",message:"Empty elements found",suggestion:"Remove empty and whitespace-only elements",autoFixAvailable:!0,category:"best-practice"})}catch{}return e},autofix:r=>{if(!r||typeof r!="string")return r;let e=r;try{e=e.replace(u.get("<span[^>]*>\\s*<\\/span>"),""),e=e.replace(u.get("<span[^>]*>[\\s\\t\\n\\r]*<\\/span>"),"")}catch{}return e}},"malformed-attributes":{name:"malformed-attributes",displayName:"Malformed Attributes Fix",description:'Fixes malformed attributes like "s rc" to "src"',severity:"error",enabled:!0,configurable:!1,category:"structure",check:r=>{const e=[];if(!r||typeof r!="string")return e;try{u.get("\\bs\\s+rc=").test(r)&&e.push({rule:"malformed-attributes",severity:"error",message:'Malformed "s rc" attribute found',suggestion:'Fix "s rc" to "src"',autoFixAvailable:!0,category:"structure"}),u.get('="([^"]*)"([a-zA-Z]+=)').test(r)&&e.push({rule:"malformed-attributes",severity:"error",message:"Missing spaces between attributes",suggestion:"Add spaces between attributes",autoFixAvailable:!0,category:"structure"})}catch{}return e},autofix:r=>{if(!r||typeof r!="string")return r;let e=r;try{const t=new Oe;t.add(u.get("\\bs\\s+rc="),"src=").add(u.get("\\bS\\s+RC="),"src=").add(u.get('="([^"]*)"([a-zA-Z]+=)'),'="$1" $2').add(u.get('(<img[^>]*?)([a-zA-Z0-9_.-]+")([a-zA-Z]+=)'),"$1$2 $3"),e=t.execute(e)}catch{}return e}},"image-alt-attributes":{name:"image-alt-attributes",displayName:"Image Alt Attributes",description:"Ensures all images have meaningful alt attributes for accessibility",severity:"warning",enabled:!0,configurable:!1,category:"accessibility",check:r=>{const e=[],t=r.match(/<img(?![^>]*\salt\s*=\s*["'][^"']+["'])[^>]*>/gi);t&&t.forEach(()=>{e.push({rule:"image-alt-attributes",severity:"error",message:"Image missing meaningful alt attribute for accessibility",line:0,column:0})});const i=r.match(/<img[^>]*alt\s*=\s*["']?\s*["'][^>]*>/gi);return i&&i.forEach(()=>{e.push({rule:"image-alt-attributes",severity:"warning",message:"Image has empty alt attribute - should be descriptive",line:0,column:0})}),e},autofix:r=>{if(!r||typeof r!="string")return r;let e=r;try{e=e.replace(/<img([^>]*?)(\s*\/?\s*)>/gi,(t,i)=>{var l;let s=i;const n=i.match(/src\s*=\s*["']([^"']+)["']/i);let o=A.DEFAULT_ALT_TEXT;if(n){const c=(l=n[1].split("/").pop())==null?void 0:l.split(".")[0];c&&(o=c.replace(/[_-]/g," ").replace(/\b\w/g,d=>d.toUpperCase()))}return s=s.replace(/\s*alt\s*=\s*["'][^"']*["']/gi,""),s+=` alt="${o}"`,`<img${s} />`})}catch{}return e}}};function ke(r){return{div:"Use <table><tr><td>content</td></tr></table>",p:"Use <span>content</span>",h1:`Use <span style="font-weight:bold; font-size:${A.HEADING_FONT_SIZES.h1}px;">content</span>`,h2:`Use <span style="font-weight:bold; font-size:${A.HEADING_FONT_SIZES.h2}px;">content</span>`,h3:`Use <span style="font-weight:bold; font-size:${A.HEADING_FONT_SIZES.h3}px;">content</span>`,h4:`Use <span style="font-weight:bold; font-size:${A.HEADING_FONT_SIZES.h4}px;">content</span>`,h5:`Use <span style="font-weight:bold; font-size:${A.HEADING_FONT_SIZES.h5}px;">content</span>`,h6:`Use <span style="font-weight:bold; font-size:${A.HEADING_FONT_SIZES.h6}px;">content</span>`,section:"Use <table><tr><td>content</td></tr></table>",article:"Use <table><tr><td>content</td></tr></table>",nav:"Use <table><tr><td>content</td></tr></table>",header:"Use <table><tr><td>content</td></tr></table>",footer:"Use <table><tr><td>content</td></tr></table>",main:"Use <table><tr><td>content</td></tr></table>",aside:"Use <table><tr><td>content</td></tr></table>",figure:"Use <table><tr><td>content</td></tr></table>",figcaption:"Use <table><tr><td>content</td></tr></table>",script:"Remove - not supported in emails",style:"Use inline styles instead",form:"Remove - forms not supported in emails",input:"Remove - interactive elements not supported",button:"Use <a> link styled as button",textarea:"Remove - not supported in emails",select:"Remove - not supported in emails",option:"Remove - not supported in emails",fieldset:"Remove - not supported in emails",legend:"Remove - not supported in emails",label:"Remove - not supported in emails",video:"Use static image or GIF instead",audio:"Remove - not supported in emails",canvas:"Use static image instead",svg:"Use PNG/JPG image instead",iframe:"Remove - not supported in emails",embed:"Remove - not supported in emails",object:"Remove - not supported in emails"}[r]||"Replace with email-safe alternative"}function ss(r){return A.HEADING_FONT_SIZES[`h${r}`]||16}class tt{constructor(e){E(this,"config");E(this,"customRules",new Map);E(this,"fixHistory",new Map);E(this,"maxFixHistorySize",_.MAX_FIX_HISTORY_SIZE);E(this,"cleanupTimer");this.config=e,this.startCleanupTimer()}startCleanupTimer(){this.cleanupTimer&&clearTimeout(this.cleanupTimer),this.cleanupTimer=setTimeout(()=>{this.performCleanup(),this.startCleanupTimer()},qt.TEN_MINUTES_MS)}performCleanup(){const e=Date.now(),t=_.MAX_FIX_HISTORY_AGE_MS;let i=0;for(const[s,n]of this.fixHistory.entries())e-n.timestamp>t&&(this.fixHistory.delete(s),i++);if(this.fixHistory.size>this.maxFixHistorySize){const s=Array.from(this.fixHistory.entries()).sort((o,l)=>o[1].timestamp-l[1].timestamp),n=Math.floor(this.fixHistory.size*_.CACHE_CLEANUP_PERCENTAGE);for(let o=0;o<n&&o<s.length;o++)this.fixHistory.delete(s[o][0]),i++}i>0&&console.log(`AutofixEngine cleanup completed. Cleared ${i} history entries`,{},"AutofixEngine")}autoFix(e){if(!e||typeof e!="string")return{html:"",fixed:[]};if(e.length>this.config.maxHtmlSize){const o=Math.round(this.config.maxHtmlSize/1024),l=Math.round(e.length/1024);return console.warn(`${C.HTML_TOO_LARGE_FOR_AUTOFIX} (${l}KB > ${o}KB), skipping to prevent freezing`,{size:e.length,limit:this.config.maxHtmlSize},"AutofixEngine"),{html:e,fixed:[]}}let t=e;const i=[],s=_.MAX_AUTOFIX_PASSES;let n=0;try{const o=["dangerous-tags","heading-tags","paragraph-tags","block-element-tags","email-safe-tags","malformed-attributes","email-safe-links","image-alt-attributes","table-attributes","email-unsafe-attributes","duplicate-styles","table-nesting-cleanup","empty-elements-cleanup"];for(let l=0;l<s;l++){let c=0;const d=t;for(const S of o){const{html:R,fixed:I}=this.applySingleFix(t,S);if(I&&(t=R,i.includes(S)||i.push(S),c++,n++,t.length>e.length*_.MAX_HTML_SIZE_INCREASE_MULTIPLIER)){console.warn(`HTML size increased too much during autofix, stopping pass ${l+1}`,{originalSize:e.length,newSize:t.length,pass:l+1},"AutofixEngine");break}}const h=this.applyRemainingFixes(t,o,i,_.MAX_AUTOFIX_ITERATIONS);h.iterations>0&&(t=h.html,c+=h.iterations,n+=h.iterations);const b=this.applyCustomFixes(t,i,_.MAX_AUTOFIX_ITERATIONS);if(b.iterations>0&&(t=b.html,c+=b.iterations,n+=b.iterations),console.log(`Pass ${l+1}: Applied ${c} fixes`,{pass:l+1,changes:c},"AutofixEngine"),c===0||t===d){console.log(`No more changes after pass ${l+1}, stopping`,{totalPasses:l+1},"AutofixEngine");break}}return this.recordFixHistory(e,i,n,!0),i.length>0?console.log(`Auto-fix completed with ${n} total changes. Fixed ${i.length} rule types: ${i.join(", ")}`,{totalChanges:n,fixedRules:i},"AutofixEngine"):console.log("No auto-fixes were applied",{},"AutofixEngine"),{html:t,fixed:i}}catch(o){return console.error("Critical auto-fix error",o,"AutofixEngine"),this.recordFixHistory(e,i,n,!1),{html:e,fixed:[]}}}applySingleFix(e,t){const i=w[t],s=this.config.rules[t];if(!(s?s.enabled:i.enabled)||!i.autofix)return{html:e,fixed:!1};try{const o=e,l=i.autofix(e);return o!==l?this.isValidHTMLStructure(l)?{html:l,fixed:!0}:(console.warn(`Fix for rule ${t} produced invalid HTML, reverting`,{},"AutofixEngine"),{html:e,fixed:!1}):{html:e,fixed:!1}}catch(o){return console.error(`Error applying auto-fix for rule ${t}`,o,"AutofixEngine"),{html:e,fixed:!1}}}applyOrderedFixes(e,t,i,s){let n=e,o=0;for(const l of t){if(o>=s)break;const{html:c,fixed:d}=this.applySingleFix(n,l);d&&(n=c,i.push(l),o++,console.log(`Applied auto-fix for rule: ${l}`,{},"AutofixEngine"))}return{html:n,iterations:o}}applyRemainingFixes(e,t,i,s){let n=e,o=0;const l=[];for(const[h,b]of Object.entries(w))if(!t.includes(h)&&b.autofix){const S=this.config.rules[h];(S?S.enabled:b.enabled)&&l.push(h)}let c=!0,d=0;for(;c&&d<3&&o<s;){c=!1,d++;for(const h of l){if(o>=s)break;try{const b=n,{html:S,fixed:R}=this.applySingleFix(n,h);R&&b!==S&&(n=S,i.includes(h)||i.push(h),o++,c=!0,console.log(`Applied remaining auto-fix for rule: ${h} (pass ${d})`,{pass:d,rule:h},"AutofixEngine"))}catch(b){console.error(`Error applying remaining auto-fix for rule ${h}`,b,"AutofixEngine")}}c&&console.log(`Remaining fixes pass ${d} completed with changes`,{pass:d,iterations:o},"AutofixEngine")}return{html:n,iterations:o}}applyCustomFixes(e,t,i){let s=e,n=0;for(const[o,l]of this.customRules.entries()){if(n>=i)break;const c=this.config.rules[o];if(!(!(!c||c.enabled)||!l.autofix))try{const{html:h,fixed:b}=this.applySingleFix(s,o);b&&(s=h,t.push(o),n++,console.log(`Applied custom auto-fix for rule: ${o}`,{},"AutofixEngine"))}catch(h){console.error(`Error applying custom auto-fix for rule ${o}`,h,"AutofixEngine")}}return{html:s,iterations:n}}isValidHTMLStructure(e){if(!e||typeof e!="string")return!1;try{const t=(e.match(/<[^/][^>]*>/g)||[]).length,i=(e.match(/<\/[^>]*>/g)||[]).length,s=(e.match(/<[^>]*\/>/g)||[]).length;return t+i+s===0?!0:!(e.includes("<<")||e.includes(">>")||e.includes("<//")||e.includes("//>"))}catch{return!1}}recordFixHistory(e,t,i,s){const n=`${e.length}_${t.join("_")}`;if(this.fixHistory.set(n,{timestamp:Date.now(),iterations:i,success:s}),this.fixHistory.size>this.maxFixHistorySize){const o=Array.from(this.fixHistory.entries()).sort((c,d)=>c[1].timestamp-d[1].timestamp),l=Math.floor(this.fixHistory.size*_.CACHE_CLEANUP_PERCENTAGE_REDUCED);for(let c=0;c<l&&c<o.length;c++)this.fixHistory.delete(o[c][0])}}autoFixSpecificIssue(e,t){if(!e||typeof e!="string"||!t)return{html:e,fixed:!1};try{const i=w[t]||this.customRules.get(t);if(!i)return console.warn(`Rule ${t} not found`,{},"AutofixEngine"),{html:e,fixed:!1};if(!i.autofix)return console.warn(`Rule ${t} has no autofix function`,{},"AutofixEngine"),{html:e,fixed:!1};const s=this.config.rules[t];if(!(s?s.enabled:i.enabled))return console.warn(`Rule ${t} is disabled`,{},"AutofixEngine"),{html:e,fixed:!1};let o=e,l=!1,c=0;const d=10;for(;c<d;){const h=o;try{const b=i.autofix(o);if(h!==b&&this.isValidHTMLStructure(b))o=b,l=!0,c++,console.log(`Applied fix for rule ${t}, iteration ${c}`,{iteration:c,changed:!0},"AutofixEngine");else break}catch(b){console.error(`Error in iteration ${c+1} for rule ${t}`,b,"AutofixEngine");break}if(o.length>e.length*_.MAX_HTML_SIZE_INCREASE_MULTIPLIER){console.warn(`HTML size increased too much for rule ${t}, stopping`,{originalSize:e.length,newSize:o.length},"AutofixEngine");break}}return l?(console.log(`Successfully fixed issue with rule ${t} in ${c} iterations`,{iterations:c,sizeBefore:e.length,sizeAfter:o.length},"AutofixEngine"),{html:o,fixed:!0}):(console.log(`No changes made for rule ${t}`,{},"AutofixEngine"),{html:e,fixed:!1})}catch(i){return console.error(`Error applying auto-fix for rule ${t}`,i,"AutofixEngine"),{html:e,fixed:!1}}}autoFixMultipleIssues(e,t){if(!e||typeof e!="string"||!Array.isArray(t))return{html:e,fixed:[]};let i=e;const s=[],n=3;try{for(let o=0;o<n;o++){let l=!1;const c=i;for(const d of t){const{html:h,fixed:b}=this.autoFixSpecificIssue(i,d);b&&(i=h,s.includes(d)||s.push(d),l=!0)}if(console.log(`Multiple fixes pass ${o+1}: ${l?"changes made":"no changes"}`,{pass:o+1,hasChanges:l},"AutofixEngine"),!l||i===c)break}return console.log(`Multiple auto-fixes completed. Fixed ${s.length} rule types: ${s.join(", ")}`,{fixedCount:s.length,rules:s},"AutofixEngine"),{html:i,fixed:s}}catch(o){return console.error("Error applying multiple auto-fixes",o,"AutofixEngine"),{html:e,fixed:[]}}}autoFixAllIssues(e,t){if(!e||typeof e!="string")return{html:e,fixed:[]};try{const i=this.getRulesBySeverity(t);return i.length===0?{html:e,fixed:[]}:this.autoFixMultipleIssues(e,i)}catch(i){return console.error(`Error fixing all ${t} issues`,i,"AutofixEngine"),{html:e,fixed:[]}}}autoFixCategory(e,t){if(!e||typeof e!="string"||!t)return{html:e,fixed:[]};try{const i=this.getRulesByCategory(t);return i.length===0?{html:e,fixed:[]}:this.autoFixMultipleIssues(e,i)}catch(i){return console.error(`Error fixing all ${t} issues`,i,"AutofixEngine"),{html:e,fixed:[]}}}getAutoFixableRules(){const e=[];return Object.entries(w).forEach(([t,i])=>{const s=this.config.rules[t],n=s?s.enabled:i.enabled;i.autofix&&n&&e.push(t)}),this.customRules.forEach((t,i)=>{const s=this.config.rules[i],n=s?s.enabled:!0;t.autofix&&n&&e.push(i)}),e}getRulesByCategory(e){const t=[];return Object.entries(w).forEach(([i,s])=>{const n=this.config.rules[i],o=n?n.enabled:s.enabled;s.category===e&&o&&t.push(i)}),this.customRules.forEach((i,s)=>{const n=this.config.rules[s],o=n?n.enabled:!0;i.category===e&&o&&t.push(s)}),t}getRulesBySeverity(e){const t=[];return Object.entries(w).forEach(([i,s])=>{const n=this.config.rules[i],o=n?n.enabled:s.enabled;s.severity===e&&o&&t.push(i)}),this.customRules.forEach((i,s)=>{const n=this.config.rules[s],o=n?n.enabled:!0;i.severity===e&&o&&t.push(s)}),t}addRule(e){if(!e||!e.name){console.warn("Invalid validation rule provided",e,"AutofixEngine");return}this.customRules.set(e.name,e)}removeRule(e){if(!e){console.warn("Invalid rule name provided for removal",e,"AutofixEngine");return}this.customRules.delete(e)}getConfig(){return{...this.config}}updateConfig(e){if(!e){console.warn("Invalid config provided for update",e,"AutofixEngine");return}this.config={...this.config,...e,rules:{...this.config.rules,...e.rules},targetClients:{...this.config.targetClients,...e.targetClients}}}setRuleEnabled(e,t){if(!e){console.warn("Invalid rule name provided for enable/disable",e,"AutofixEngine");return}this.config.rules[e]?this.config.rules[e].enabled=t:this.config.rules[e]={enabled:t}}setRuleSeverity(e,t){if(!e||!t){console.warn("Invalid rule name or severity provided",{ruleName:e,severity:t},"AutofixEngine");return}this.config.rules[e]?this.config.rules[e].severity=t:this.config.rules[e]={enabled:!0,severity:t}}getFixHistoryStats(){const e=Array.from(this.fixHistory.values()),t=e.length,i=e.filter(l=>l.success).length,s=e.reduce((l,c)=>l+c.iterations,0)/t||0,n=e.sort((l,c)=>c.timestamp-l.timestamp).slice(0,_.MAX_RECENT_FIXES_TRACKED),o=n.length>0?n.filter(l=>l.success).length/n.length:0;return{totalFixes:t,successfulFixes:i,averageIterations:Math.round(s*100)/100,recentSuccessRate:Math.round(o*100)/100}}dispose(){this.customRules.clear(),this.fixHistory.clear(),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0),console.log("AutofixEngine disposed and all caches cleared",{},"AutofixEngine")}}class st{constructor(e){E(this,"config");E(this,"customRules",new Map);E(this,"traversalCache",new Map);E(this,"maxTraversalCacheSize",A.TRAVERSAL_CACHE_SIZE);E(this,"cacheCleanupTimer");E(this,"cacheAccessCount",new Map);E(this,"cacheLastAccess",new Map);this.config=e,this.startCacheCleanupTimer()}startCacheCleanupTimer(){this.cacheCleanupTimer&&clearTimeout(this.cacheCleanupTimer),this.cacheCleanupTimer=setTimeout(()=>{this.performCacheCleanup(),this.startCacheCleanupTimer()},A.CACHE_CLEANUP_INTERVAL_MS)}performCacheCleanup(){const e=Date.now();let t=0;for(const[i]of this.traversalCache.entries()){const s=`traversal_${i}`,n=this.cacheLastAccess.get(s)||0,o=this.cacheAccessCount.get(s)||0;(e-n>A.CACHE_TTL_MS||o<2)&&(this.traversalCache.delete(i),this.cacheAccessCount.delete(s),this.cacheLastAccess.delete(s),t++)}if(this.customRules.size>_.MAX_CUSTOM_RULES_SIZE){const i=Array.from(this.customRules.entries()),s=Math.floor(this.customRules.size*_.CACHE_CLEANUP_PERCENTAGE_REDUCED);for(let n=0;n<s&&n<i.length;n++)this.customRules.delete(i[n][0]);t+=s}t>0&&console.log(`Cache cleanup completed. Cleared ${t} entries`,{},"ValidationEngine")}getParsedAST(e){if(!e||typeof e!="string")return null;try{let t=K.get(e);return t||(t=new Fe(e).parse(),K.set(e,t)),t}catch(t){return console.error("Error parsing HTML to AST",t,"ValidationEngine"),null}}getTraversalResult(e,t,i){const s=`traversal_${t}`;this.traversalCache.has(t)||this.traversalCache.set(t,new Map);const n=this.traversalCache.get(t);if(n.has(i))return this.cacheAccessCount.set(s,(this.cacheAccessCount.get(s)||0)+1),this.cacheLastAccess.set(s,Date.now()),n.get(i);let o=[];try{switch(t){case"findByTag":o=this.findNodesByTagName(e,i);break;case"findByAttribute":{const[l,c]=i.split("=");o=this.findNodesByAttribute(e,l,c);break}case"findByCategory":o=this.findNodesByCategory(e,i);break;default:o=[]}o.length<=_.MAX_TRAVERSAL_RESULTS&&(n.set(i,o),this.cacheAccessCount.set(s,1),this.cacheLastAccess.set(s,Date.now()),n.size>this.maxTraversalCacheSize&&this.cleanupOperationCache(t,n))}catch(l){console.error(`Error in traversal operation ${t}`,l,"ValidationEngine"),o=[]}return o}cleanupOperationCache(e,t){const i=Array.from(t.entries()).map(([n,o])=>({key:n,nodes:o,accessCount:this.cacheAccessCount.get(`traversal_${e}`)||0,lastAccess:this.cacheLastAccess.get(`traversal_${e}`)||0,size:o.length}));i.sort((n,o)=>{const l=n.accessCount*k.TRAVERSAL_ACCESS_COUNT_WEIGHT+(Date.now()-n.lastAccess)/1e3*k.TRAVERSAL_AGE_WEIGHT+n.size/100*k.TRAVERSAL_SIZE_WEIGHT,c=o.accessCount*k.TRAVERSAL_ACCESS_COUNT_WEIGHT+(Date.now()-o.lastAccess)/1e3*k.TRAVERSAL_AGE_WEIGHT+o.size/100*k.TRAVERSAL_SIZE_WEIGHT;return l-c});const s=Math.floor(t.size*_.CACHE_CLEANUP_PERCENTAGE_LARGE);for(let n=0;n<s&&n<i.length;n++)t.delete(i[n].key)}findNodesByTagName(e,t){const i=[],s=_.MAX_TRAVERSAL_RESULTS,n=o=>{for(const l of o){if(i.length>=s)break;l.type==="element"&&l.tagName===t.toLowerCase()&&i.push(l),l.children&&Array.isArray(l.children)&&n(l.children)}};return n(e),i}findNodesByAttribute(e,t,i){const s=[],n=_.MAX_TRAVERSAL_RESULTS,o=l=>{var c;for(const d of l){if(s.length>=n)break;d.type==="element"&&((c=d.attributes)!=null&&c[t])&&(!i||d.attributes[t]===i)&&s.push(d),d.children&&Array.isArray(d.children)&&o(d.children)}};return o(e),s}findNodesByCategory(e,t){const i=[],s=_.MAX_TRAVERSAL_RESULTS,n=o=>{for(const l of o){if(i.length>=s)break;if(l.type==="element")switch(t){case"tables":l.tagName==="table"&&i.push(l);break;case"images":l.tagName==="img"&&i.push(l);break;case"links":l.tagName==="a"&&i.push(l);break;case"headings":l.tagName&&/^h[1-6]$/.test(l.tagName)&&i.push(l);break;case"block-elements":l.tagName&&["div","p","section","article","nav","header","footer","main","aside"].includes(l.tagName)&&i.push(l);break;case"dangerous":l.tagName&&["script","style","iframe","embed","object"].includes(l.tagName)&&i.push(l);break}l.children&&Array.isArray(l.children)&&n(l.children)}};return n(e),i}clearTraversalCache(){const e=this.traversalCache.size;this.traversalCache.clear(),this.cacheAccessCount.clear(),this.cacheLastAccess.clear(),e>0&&console.log(`Cleared traversal cache with ${e} operations`,{},"ValidationEngine")}validate(e){if(!e||typeof e!="string")return this.createEmptyReport("Invalid HTML input provided");if(e.length>this.config.maxHtmlSize){const s=Math.round(this.config.maxHtmlSize/1024);return this.createEmptyReport(`${C.HTML_TOO_LARGE} (over ${s}KB)`,"html-too-large","performance")}const t=[],i=this.getParsedAST(e);try{t.push(...this.runBuiltInRules(e,i)),t.push(...this.runCustomRules(e,i));const s=t.filter(d=>d.severity==="error"),n=t.filter(d=>d.severity==="warning"),o=t.filter(d=>d.severity==="info"),l=this.calculateCategories(t),c=this.calculateValidationScore(t);return{isValid:s.length===0,errors:s,warnings:n,suggestions:o,autoFixAvailable:t.some(d=>d.autoFixAvailable),totalIssues:t.length,categories:l,score:c}}catch(s){return console.error("Critical validation error",s,"ValidationEngine"),this.createEmptyReport(`Validation system error: ${s instanceof Error?s.message:"Unknown error"}`,"validation-system-error","structure")}finally{this.clearTraversalCache()}}runBuiltInRules(e,t){const i=[];this.clearTraversalCache();for(const[s,n]of Object.entries(w)){const o=this.config.rules[s];if((o?o.enabled:n.enabled)&&!(n.category==="accessibility"&&!this.config.checkAccessibility)&&!(n.category==="performance"&&!this.config.checkPerformance)&&!(n.category==="best-practice"&&!this.config.checkBestPractices))try{let c=[];if(n.checkWithAST&&t){const d={ast:t,getTraversalResult:(h,b)=>this.getTraversalResult(t,h,b),findNodesByTag:h=>this.getTraversalResult(t,"findByTag",h),findNodesByAttribute:(h,b)=>this.getTraversalResult(t,"findByAttribute",`${h}=${b||""}`),findNodesByCategory:h=>this.getTraversalResult(t,"findByCategory",h)};c=n.checkWithAST(e,t,o==null?void 0:o.config,d)}else c=n.check(e,o==null?void 0:o.config);o!=null&&o.severity&&c.forEach(d=>{d.severity=o.severity}),i.push(...c)}catch(c){console.error(`Error running validation rule ${s}`,c,"ValidationEngine"),i.push({rule:s,severity:"error",message:`Validation rule error: ${c instanceof Error?c.message:"Unknown error"}`,category:n.category})}}return i}runCustomRules(e,t){const i=[];for(const[s,n]of this.customRules.entries()){const o=this.config.rules[s];if(!o||o.enabled)try{const c=n.checkWithAST&&t?n.checkWithAST(e,t,o==null?void 0:o.config):n.check(e,o==null?void 0:o.config);o!=null&&o.severity&&c.forEach(d=>{d.severity=o.severity}),i.push(...c)}catch(c){console.error(`Error running custom validation rule ${s}`,c,"ValidationEngine")}}return i}calculateCategories(e){return{structure:e.filter(t=>t.category==="structure").length,accessibility:e.filter(t=>t.category==="accessibility").length,compatibility:e.filter(t=>t.category==="compatibility").length,performance:e.filter(t=>t.category==="performance").length,"best-practice":e.filter(t=>t.category==="best-practice").length}}calculateValidationScore(e){if(e.length===0)return Q.MAX_SCORE;let t=0;const i=Q.MAX_PENALTY;e.forEach(n=>{switch(n.severity){case"error":t+=Q.ERROR_PENALTY;break;case"warning":t+=Q.WARNING_PENALTY;break;case"info":t+=Q.INFO_PENALTY;break}});const s=Math.max(0,Q.MAX_SCORE-Math.min(t,i));return Math.round(s)}createEmptyReport(e,t="invalid-input",i="structure"){return{isValid:!1,errors:[{rule:t,severity:"error",message:e,category:i}],warnings:[],suggestions:[],autoFixAvailable:!1,totalIssues:1,categories:{structure:i==="structure"?1:0,accessibility:0,compatibility:0,performance:i==="performance"?1:0,"best-practice":0},score:0}}addRule(e){if(!e||!e.name){console.warn("Invalid validation rule provided",e,"ValidationEngine");return}this.customRules.set(e.name,e)}removeRule(e){if(!e){console.warn("Invalid rule name provided for removal",e,"ValidationEngine");return}this.customRules.delete(e)}getAvailableRules(){const e={...w};return this.customRules.forEach((t,i)=>{e[i]=t}),e}testRule(e,t){if(!e||!t)return console.warn("Invalid parameters for testRule",{ruleName:e,html:typeof t},"ValidationEngine"),[];const i=w[e]||this.customRules.get(e);if(!i)throw new Error(`Rule "${e}" not found`);const s=this.config.rules[e];return i.check(t,s==null?void 0:s.config)}getCompatibilityReport(e){if(!e||typeof e!="string")return{};const t={};return Object.keys(this.config.targetClients).forEach(i=>{if(!this.config.targetClients[i])return;const s=[];switch(i){case"outlook":this.validateOutlookCompatibility(e,s);break;case"gmail":this.validateGmailCompatibility(e,s);break;case"mobile":this.validateMobileCompatibility(e,s);break}t[i]={compatible:s.length===0,issues:s}}),t}validateOutlookCompatibility(e,t){(e.includes("flexbox")||e.includes("display: flex"))&&t.push("Flexbox not supported in Outlook"),(e.includes("grid")||e.includes("display: grid"))&&t.push("CSS Grid not supported in Outlook"),(e.includes("position: absolute")||e.includes("position: fixed"))&&t.push("Absolute/fixed positioning not supported in Outlook"),(e.includes("linear-gradient")||e.includes("radial-gradient"))&&t.push("CSS gradients not supported in Outlook")}validateGmailCompatibility(e,t){e.includes("<style>")&&t.push("Gmail may strip <style> tags on mobile"),e.includes("background-image")&&t.push("Background images may not display consistently in Gmail")}validateMobileCompatibility(e,t){e.includes('width="')&&!e.includes("max-width")&&t.push("Fixed widths without max-width may cause horizontal scrolling on mobile"),e.includes("font-size:")&&e.includes("px")&&t.push("Consider using relative font sizes for better mobile experience")}getCacheStats(){return{traversalCacheSize:this.traversalCache.size,astCacheStats:K.getStats(),regexCacheStats:u.getStats()}}dispose(){this.clearTraversalCache(),this.customRules.clear(),this.cacheCleanupTimer&&(clearTimeout(this.cacheCleanupTimer),this.cacheCleanupTimer=void 0),console.log("ValidationEngine disposed and all caches cleared",{},"ValidationEngine")}}class at{constructor(e){E(this,"config");E(this,"validationEngine");E(this,"autofixEngine");E(this,"cleanupInterval");E(this,"isDisposed",!1);E(this,"validationStats",{totalValidations:0,successfulValidations:0,totalAutoFixes:0,successfulAutoFixes:0,lastValidationTime:0,lastAutoFixTime:0});this.config={rules:{},targetClients:{outlook:!0,gmail:!0,applemail:!0,thunderbird:!0,mobile:!0},strictMode:!1,allowModernCSS:!1,maxTableNesting:A.MAX_TABLE_NESTING,checkAccessibility:!0,checkPerformance:!0,checkBestPractices:!0,maxFileSize:A.MAX_FILE_SIZE_KB,maxHtmlSize:A.MAX_HTML_SIZE_BYTES,requireAltText:!0,requireFallbacks:!0,...e},this.initializeDefaultRules(),this.validationEngine=new st(this.config),this.autofixEngine=new tt(this.config),this.setupCleanupInterval()}setupCleanupInterval(){try{this.cleanupInterval=setInterval(()=>{this.performPeriodicCleanup()},A.CACHE_CLEANUP_INTERVAL_MS)}catch(e){console.error("Failed to setup cleanup interval",e,"EmailHTMLValidator")}}performPeriodicCleanup(){try{if(this.isDisposed)return;const e=this.validationEngine.getCacheStats(),t=this.autofixEngine.getFixHistoryStats();if(console.log(`${J.CACHE_CLEANUP_PREFIX}`,{validationCache:e,autofixHistory:t},"EmailHTMLValidator"),typeof global<"u"&&global.gc)try{global.gc(),console.log(`${J.GARBAGE_COLLECTION_PREFIX}`,{},"EmailHTMLValidator")}catch{}}catch(e){console.error("Error during periodic cleanup",e,"EmailHTMLValidator")}}initializeDefaultRules(){Object.entries(w).forEach(([t,i])=>{this.config.rules[t]||(this.config.rules[t]={enabled:i.enabled!==!1})}),["email-safe-tags","table-attributes","heading-tags","paragraph-tags","block-element-tags","dangerous-tags","email-safe-links","malformed-attributes"].forEach(t=>{w[t]&&(this.config.rules[t]={enabled:!0})})}validate(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);const t=Date.now();this.validationStats.totalValidations++;try{if(!e||typeof e!="string")throw new Error(C.INVALID_HTML_INPUT);if(e.length>this.config.maxHtmlSize){const n=Math.round(this.config.maxHtmlSize/1024),o=Math.round(e.length/1024);throw new Error(`${C.HTML_TOO_LARGE}: ${o}KB exceeds limit of ${n}KB`)}const i=this.validationEngine.validate(e);this.validationStats.successfulValidations++,this.validationStats.lastValidationTime=Date.now();const s=Date.now()-t;return s>_.SLOW_VALIDATION_THRESHOLD_MS&&console.warn(`${J.SLOW_OPERATION_PREFIX}: ${s}ms for ${e.length} bytes`,{duration:s,htmlSize:e.length,issues:i.totalIssues},"EmailHTMLValidator"),i}catch(i){this.validationStats.lastValidationTime=Date.now(),console.error(`${C.VALIDATION_FAILED}`,i,"EmailHTMLValidator");const s=i instanceof Error?i.message:"Unknown validation error";return{isValid:!1,errors:[{rule:"validation-error",severity:"error",message:`${C.VALIDATION_FAILED}: ${s}`,category:"structure"}],warnings:[],suggestions:[],autoFixAvailable:!1,totalIssues:1,categories:{structure:1,accessibility:0,compatibility:0,performance:0,"best-practice":0},score:0}}}autoFix(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);const t=Date.now();this.validationStats.totalAutoFixes++;try{if(!e||typeof e!="string")throw new Error(C.INVALID_HTML_INPUT);if(e.length>this.config.maxHtmlSize){const n=Math.round(this.config.maxHtmlSize/1024),o=Math.round(e.length/1024);throw new Error(`${C.HTML_TOO_LARGE_FOR_AUTOFIX}: ${o}KB exceeds limit of ${n}KB`)}const i=this.autofixEngine.autoFix(e);this.validationStats.successfulAutoFixes++,this.validationStats.lastAutoFixTime=Date.now();const s=Date.now()-t;return s>_.SLOW_AUTOFIX_THRESHOLD_MS&&console.warn(`${J.SLOW_OPERATION_PREFIX}: ${s}ms for ${e.length} bytes`,{duration:s,htmlSize:e.length,fixedRules:i.fixed.length},"EmailHTMLValidator"),i}catch(i){return this.validationStats.lastAutoFixTime=Date.now(),console.error(`${C.AUTOFIX_FAILED}`,i,"EmailHTMLValidator"),{html:e,fixed:[]}}}autoFixSpecificIssue(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixSpecificIssue(e,t)}catch(i){return console.error(`Error fixing specific issue with rule ${t}`,i,"EmailHTMLValidator"),{html:e,fixed:!1}}}autoFixMultipleIssues(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixMultipleIssues(e,t)}catch(i){return console.error("Error fixing multiple issues",i,"EmailHTMLValidator"),{html:e,fixed:[]}}}autoFixAllIssues(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixAllIssues(e,t)}catch(i){return console.error(`Error fixing all ${t} issues`,i,"EmailHTMLValidator"),{html:e,fixed:[]}}}autoFixCategory(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixCategory(e,t)}catch(i){return console.error(`Error fixing category ${t} issues`,i,"EmailHTMLValidator"),{html:e,fixed:[]}}}getAutoFixableRules(){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.getAutoFixableRules()}catch(e){return console.error("Error getting auto-fixable rules",e,"EmailHTMLValidator"),[]}}getRulesByCategory(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.getRulesByCategory(e)}catch(t){return console.error(`Error getting rules for category ${e}`,t,"EmailHTMLValidator"),[]}}addRule(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{this.validationEngine.addRule(e),this.autofixEngine.addRule(e),console.log(`Custom rule added: ${e.name}`,{},"EmailHTMLValidator")}catch(t){throw console.error(`Error adding custom rule ${e.name}`,t,"EmailHTMLValidator"),t}}removeRule(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{this.validationEngine.removeRule(e),this.autofixEngine.removeRule(e),console.log(`Custom rule removed: ${e}`,{},"EmailHTMLValidator")}catch(t){throw console.error(`Error removing custom rule ${e}`,t,"EmailHTMLValidator"),t}}updateConfig(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{if(e.maxHtmlSize&&e.maxHtmlSize<=0)throw new Error("maxHtmlSize must be positive");if(e.maxFileSize&&e.maxFileSize<=0)throw new Error("maxFileSize must be positive");this.config={...this.config,...e,rules:{...this.config.rules,...e.rules},targetClients:{...this.config.targetClients,...e.targetClients}},this.validationEngine.dispose(),this.autofixEngine.dispose(),this.validationEngine=new st(this.config),this.autofixEngine=new tt(this.config),console.log("Configuration updated successfully",{newConfig:e},"EmailHTMLValidator")}catch(t){throw console.error("Error updating configuration",t,"EmailHTMLValidator"),t}}setRuleEnabled(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);if(!e)throw new Error(C.INVALID_RULE_NAME);try{this.config.rules[e]?this.config.rules[e].enabled=t:this.config.rules[e]={enabled:t},console.log(`Rule ${e} ${t?"enabled":"disabled"}`,{},"EmailHTMLValidator")}catch(i){throw console.error(`Error setting rule ${e} enabled state`,i,"EmailHTMLValidator"),i}}setRuleSeverity(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);if(!e||!t)throw new Error("Rule name and severity are required");if(!["error","warning","info"].includes(t))throw new Error(C.INVALID_SEVERITY);try{this.config.rules[e]?this.config.rules[e].severity=t:this.config.rules[e]={enabled:!0,severity:t},console.log(`Rule ${e} severity set to ${t}`,{},"EmailHTMLValidator")}catch(i){throw console.error(`Error setting rule ${e} severity`,i,"EmailHTMLValidator"),i}}getConfig(){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);return{...this.config}}getAvailableRules(){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.validationEngine.getAvailableRules()}catch(e){return console.error("Error getting available rules",e,"EmailHTMLValidator"),{}}}testRule(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.validationEngine.testRule(e,t)}catch(i){return console.error(`Error testing rule ${e}`,i,"EmailHTMLValidator"),[]}}getCompatibilityReport(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.validationEngine.getCompatibilityReport(e)}catch(t){return console.error("Error generating compatibility report",t,"EmailHTMLValidator"),{}}}getStats(){try{return{validation:{...this.validationStats},cache:{validation:this.validationEngine.getCacheStats(),autofix:this.autofixEngine.getFixHistoryStats()},isDisposed:this.isDisposed}}catch(e){return console.error("Error getting statistics",e,"EmailHTMLValidator"),{validation:this.validationStats,cache:{validation:{},autofix:{}},isDisposed:this.isDisposed}}}resetStats(){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);this.validationStats={totalValidations:0,successfulValidations:0,totalAutoFixes:0,successfulAutoFixes:0,lastValidationTime:0,lastAutoFixTime:0},console.log(`${J.STATISTICS_RESET_PREFIX}`,{},"EmailHTMLValidator")}dispose(){if(!this.isDisposed)try{this.config.rules={},this.validationEngine.dispose(),this.autofixEngine.dispose(),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=void 0),this.isDisposed=!0,console.log(`EmailHTMLValidator ${J.DISPOSAL_PREFIX}`,{},"EmailHTMLValidator")}catch(e){console.error("Error during disposal",e,"EmailHTMLValidator"),this.isDisposed=!0}}isDisposedValidator(){return this.isDisposed}}new at({strictMode:!1,targetClients:{outlook:!0,gmail:!0,applemail:!0,thunderbird:!1,mobile:!0},checkAccessibility:!0,checkPerformance:!0,checkBestPractices:!0,maxFileSize:A.MAX_FILE_SIZE_KB,maxHtmlSize:A.MAX_HTML_SIZE_BYTES,requireAltText:!0,requireFallbacks:!0});const is=({html:r,onHtmlChange:e,validator:t,showCompactView:i=!1})=>{var q;const[s,n]=M.useState(null),[o,l]=M.useState(!1),[c,d]=M.useState(!1),[h,b]=M.useState(0),[S,R]=M.useState(!1),[I,y]=M.useState(!1),[v,$]=M.useState("all"),[D,F]=M.useState("all"),[N,W]=M.useState(""),O=M.useMemo(()=>t||new at,[t]),re=`
<!DOCTYPE html>
<html>
<head>
    <title>Comprehensive Email Validation Test</title>
    <style>
        .test-section {
            border: 1px solid #ccc;
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Comprehensive Email Validation Test Cases</h1>

    <!-- FORBIDDEN TAGS TEST CASES -->
    <div class="test-section">
        <div class="test-title">1. FORBIDDEN TAGS - All variants</div>

        <!-- Basic forbidden elements -->
        <div class="container">This is a div container</div>
        <p class="paragraph">This is a paragraph</p>

        <!-- Heading tags (all levels) -->
        <h1 style="color: red;">Main Heading H1</h1>
        <h2 class="subtitle">Subtitle H2</h2>
        <h3>Sub-subtitle H3</h3>
        <h4>Minor heading H4</h4>
        <h5>Smaller heading H5</h5>
        <h6>Smallest heading H6</h6>

        <!-- Semantic elements -->
        <section class="hero">
            <article>
                <header>
                    <nav>Navigation menu</nav>
                </header>
                <main>
                    <aside>Sidebar content</aside>
                    <figure>
                        <figcaption>Image caption</figcaption>
                    </figure>
                </main>
                <footer>Footer content</footer>
            </article>
        </section>

        <!-- Interactive elements -->
        <form action="/submit">
            <fieldset>
                <legend>Form Legend</legend>
                <label for="input1">Input Label:</label>
                <input type="text" id="input1" name="input1" />
                <textarea name="comments">Comments</textarea>
                <select name="options">
                    <option value="1">Option 1</option>
                </select>
                <button type="submit">Submit</button>
            </fieldset>
        </form>

        <!-- Media elements -->
        <video src="video.mp4">Video content</video>
        <audio src="audio.mp3">Audio content</audio>
        <canvas>Canvas content</canvas>
        <svg>SVG content</svg>
        <iframe src="frame.html">Frame content</iframe>
        <embed src="content.swf" />
        <object data="object.pdf">Object content</object>
        <script>alert('script');<\/script>
    </div>

    <!-- EMAIL-SAFE TAGS TEST CASES -->
    <div class="test-section">
        <div class="test-title">2. EMAIL-SAFE TAGS - All variants</div>

        <!-- Wrong BR tag formats -->
        <br></br>
        <br/>
        <br />
        <br class="break" />
        <br style="clear: both"></br>

        <!-- Wrong HR tag formats -->
        <hr></hr>
        <hr/>
        <hr />
        <hr class="divider" />
        <hr style="border: none"></hr>

        <!-- Wrong IMG tag formats -->
        <img src="image1.jpg"></img>
        <img src="image2.jpg" alt="Image 2"></img>
        <img src="image3.jpg" class="responsive"></img>
        <img src="image4.jpg" style="width: 100%"></img>

        <!-- Other self-closing tags -->
        <area shape="rect" coords="0,0,100,100"></area>
        <base href="http://example.com"></base>
        <col span="2"></col>
        <input type="text" name="test"></input>

        <!-- Correct formats (should not trigger errors) -->
        <br>
        <hr>
        <img src="correct.jpg" alt="Correct" />
        <area shape="rect" coords="0,0,50,50" />
        <base href="http://test.com" />
        <col span="1" />
        <input type="email" name="email" />
    </div>

    <!-- TABLE ATTRIBUTES TEST CASES -->
    <div class="test-section">
        <div class="test-title">3. TABLE ATTRIBUTES - All variants</div>

        <!-- Tables missing required attributes -->
        <table>
            <tr><td>Missing all attributes</td></tr>
        </table>

        <table cellpadding="5">
            <tr><td>Missing cellspacing and border</td></tr>
        </table>

        <table cellspacing="2">
            <tr><td>Missing cellpadding and border</td></tr>
        </table>

        <table border="1">
            <tr><td>Missing cellpadding and cellspacing</td></tr>
        </table>

        <table cellpadding="0" cellspacing="0">
            <tr><td>Missing border</td></tr>
        </table>

        <!-- TD elements missing valign -->
        <table cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td>Missing valign</td>
                <td valign="middle">Wrong valign value</td>
                <td valign="bottom">Another wrong valign</td>
            </tr>
        </table>

        <!-- Images missing attributes -->
        <img src="no-alt.jpg">
        <img src="has-alt.jpg" alt="">
        <img src="no-display-block.jpg" alt="No display block">
        <img src="wrong-style.jpg" alt="Wrong style" style="border: 1px solid;">
        <img src="missing-dimensions.jpg" alt="Missing dimensions" style="display:block">

        <!-- Links missing attributes -->
        <a>Link without href</a>
        <a href="http://example.com">Link without target</a>
        <a href="http://example.com" target="_self">Link with wrong target</a>

        <!-- Correct formats (should not trigger errors) -->
        <table cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td valign="top">Correct table</td>
                <td valign="top">All attributes present</td>
            </tr>
        </table>

        <img src="correct-image.jpg" alt="Correct image" style="display:block" />
        <a href="http://example.com" target="_blank">Correct link</a>
    </div>

    <!-- COMPLEX NESTED CASES -->
    <div class="test-section">
        <div class="test-title">4. COMPLEX NESTED CASES</div>

        <!-- Multiple nesting levels -->
        <div class="outer">
            <section class="middle">
                <article class="inner">
                    <header>
                        <h1>Nested heading</h1>
                        <nav>
                            <div class="menu">
                                <p>Menu item 1</p>
                                <p>Menu item 2</p>
                            </div>
                        </nav>
                    </header>
                    <main>
                        <div class="content">
                            <h2>Content heading</h2>
                            <p>Content paragraph with <br></br> wrong break</p>
                            <img src="nested.jpg"></img>
                            <table>
                                <tr><td>Nested table without attributes</td></tr>
                            </table>
                        </div>
                    </main>
                    <footer>
                        <div class="footer-content">
                            <h3>Footer heading</h3>
                            <p>Footer text</p>
                        </div>
                    </footer>
                </article>
            </section>
        </div>
    </div>

    <!-- EDGE CASES -->
    <div class="test-section">
        <div class="test-title">5. EDGE CASES</div>

        <!-- Empty elements -->
        <div></div>
        <p></p>
        <h1></h1>
        <table><tr><td></td></tr></table>

        <!-- Elements with only whitespace -->
        <div>   </div>
        <p>
        </p>
        <h2>	</h2>

        <!-- Malformed tags -->
        <br/ />
        <br / />
        <br////>
        <img src="malformed.jpg" / alt="test" / />
        <hr/ />
        <hr / />

        <!-- Mixed case tags -->
        <DIV>Mixed case div</DIV>
        <P>Mixed case paragraph</P>
        <BR></BR>
        <IMG SRC="mixed.jpg"></IMG>

        <!-- Tags with unusual attributes -->
        <div data-custom="value" onclick="alert()">Div with data and onclick</div>
        <p contenteditable="true" draggable="true">Editable paragraph</p>
        <h1 id="special" class="heading" style="color: blue; font-size: 24px;">Styled heading</h1>

        <!-- Self-closing variations -->
        <br/>
        <br />
        <br  />
        <br	/>
        <img src="test.jpg" />
        <img src="test.jpg"/>
        <img src="test.jpg"  />
        <img src="test.jpg"	/>
    </div>

    <!-- ATTRIBUTES STRESS TEST -->
    <div class="test-section">
        <div class="test-title">6. ATTRIBUTES STRESS TEST</div>

        <!-- Tables with partial attributes -->
        <table cellpadding="0">
            <tr><td>Only cellpadding</td></tr>
        </table>

        <table cellspacing="0">
            <tr><td>Only cellspacing</td></tr>
        </table>

        <table border="0">
            <tr><td>Only border</td></tr>
        </table>

        <table cellpadding="10" cellspacing="5" border="1">
            <tr><td>Wrong values</td></tr>
        </table>

        <!-- Images with partial attributes -->
        <img src="partial1.jpg" alt="">
        <img src="partial2.jpg" style="display:block">
        <img src="partial3.jpg" alt="Test" width="100">
        <img src="partial4.jpg" alt="Test" height="50">
        <img src="partial5.jpg" alt="Test" style="border: none;">

        <!-- Links with variations -->
        <a href="">Empty href</a>
        <a href="#anchor">Anchor link</a>
        <a href="mailto:test@example.com">Mailto link</a>
        <a href="tel:+1234567890">Tel link</a>
        <a href="http://example.com" target="_parent">Wrong target parent</a>
        <a href="http://example.com" target="_top">Wrong target top</a>
    </div>
</body>
</html>
  `;M.useEffect(()=>{if(!r||!r.trim()){n(null);return}R(!0);const p=setTimeout(()=>{try{const g=O.validate(r);n(g)}catch(g){console.error("Validation error",g);const f=g&&typeof g=="object"&&"message"in g?g.message:"Unknown error";n({isValid:!1,errors:[{rule:"validation-error",severity:"error",message:`Validation failed: ${f}`,category:"structure"}],warnings:[],suggestions:[],autoFixAvailable:!1,totalIssues:1,categories:{structure:1,accessibility:0,compatibility:0,performance:0,"best-practice":0},score:0})}finally{R(!1)}},300);return()=>clearTimeout(p)},[r,O]);const te=async()=>{if(!(s!=null&&s.autoFixAvailable)||!e){console.warn("Auto-fix not available or no onHtmlChange callback",{},"EmailValidationPanel");return}y(!0);try{const{html:p,fixed:g}=O.autoFix(r);g.length>0?(e(p),alert(`Successfully fixed ${g.length} issues:
${g.join(`
`)}`)):alert("No issues were auto-fixed. All issues may already be resolved or not auto-fixable.")}catch(p){alert(`Error during auto-fix: ${p&&typeof p=="object"&&"message"in p?p.message:"Unknown error"}`)}finally{y(!1)}},ye=async p=>{if(e){y(!0);try{const{html:g,fixed:f}=O.autoFixSpecificIssue(r,p);f?(e(g),alert(`Successfully fixed issue with rule: ${p}`)):alert(`No changes made for rule: ${p}. Issue may already be resolved.`)}catch(g){alert(`Error fixing issue: ${g&&typeof g=="object"&&"message"in g?g.message:"Unknown error"}`)}finally{y(!1)}}},ae=async p=>{if(e){y(!0);try{const{html:g,fixed:f}=O.autoFixAllIssues(r,p);f.length>0?(e(g),alert(`Successfully fixed ${f.length} ${p} issues:
${f.join(`
`)}`)):alert(`No ${p} issues were fixed. All issues may already be resolved or not auto-fixable.`)}catch(g){alert(`Error fixing ${p} issues: ${g&&typeof g=="object"&&"message"in g?g.message:"Unknown error"}`)}finally{y(!1)}}},Ee=async p=>{if(e){y(!0);try{const{html:g,fixed:f}=O.autoFixCategory(r,p);f.length>0?(e(g),alert(`Successfully fixed ${f.length} issues in category ${p}:
${f.join(`
`)}`)):alert(`No issues in category ${p} were fixed. All issues may already be resolved or not auto-fixable.`)}catch(g){alert(`Error fixing category ${p} issues: ${g&&typeof g=="object"&&"message"in g?g.message:"Unknown error"}`)}finally{y(!1)}}},oe=p=>{switch(p){case"error":return a.jsx(_e,{color:"error"});case"warning":return a.jsx(Ue,{color:"warning"});case"info":return a.jsx(je,{color:"info"});default:return a.jsx(je,{})}},Ae=p=>{switch(p){case"structure":return a.jsx(Ye,{color:"primary"});case"accessibility":return a.jsx(Qe,{color:"secondary"});case"compatibility":return a.jsx(ee,{color:"info"});case"performance":return a.jsx(ge,{color:"warning"});case"best-practice":return a.jsx(Ke,{color:"success"});default:return a.jsx(je,{})}},ve=p=>{switch(p){case"structure":return"primary";case"accessibility":return"secondary";case"compatibility":return"info";case"performance":return"warning";case"best-practice":return"success";default:return"default"}},ne=p=>{switch(p){case"structure":return"Structure";case"accessibility":return"Accessibility";case"compatibility":return"Compatibility";case"performance":return"Performance";case"best-practice":return"Best Practice";default:return p}},G=M.useMemo(()=>{if(!s)return{errors:[],warnings:[],suggestions:[]};let g=[...s.errors,...s.warnings,...s.suggestions];if(v!=="all"&&(g=g.filter(f=>f.severity===v)),D!=="all"&&(g=g.filter(f=>f.category===D)),N.trim()){const f=N.toLowerCase();g=g.filter(j=>{var T;return j.message.toLowerCase().includes(f)||((T=j.suggestion)==null?void 0:T.toLowerCase().includes(f))||j.rule.toLowerCase().includes(f)})}return{errors:g.filter(f=>f.severity==="error"),warnings:g.filter(f=>f.severity==="warning"),suggestions:g.filter(f=>f.severity==="info")}},[s,v,D,N]),se=(p,g,f)=>{if(!p||p.length===0)return null;const j=f==="error"?"error":f==="warning"?"warning":"info";return a.jsxs(vt,{defaultExpanded:f==="error",sx:{mb:2,"&:before":{display:"none"},boxShadow:"none",border:`1px solid ${j==="error"?"#ffcdd2":j==="warning"?"#fff3e0":"#e3f2fd"}`,borderRadius:2},children:[a.jsx(Tt,{expandIcon:a.jsx(Ie,{}),sx:{backgroundColor:j==="error"?"#ffebee":j==="warning"?"#fff8e1":"#f3e5f5",borderRadius:"8px 8px 0 0"},children:a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[oe(f),a.jsxs(x,{variant:"subtitle1",component:"div",fontWeight:"bold",children:[g," (",p.length,")"]}),a.jsx(m,{sx:{flexGrow:1}}),p.some(T=>T.autoFixAvailable)&&e&&a.jsx(z,{size:"small",variant:"contained",startIcon:a.jsx(ie,{}),onClick:T=>{T.stopPropagation(),ae(f)},disabled:S||I,color:j,sx:{minWidth:"auto"},children:I?"Fixing...":`Fix All (${p.filter(T=>T.autoFixAvailable).length})`})]})}),a.jsx(St,{sx:{p:0},children:a.jsx(_t,{dense:!0,sx:{p:0},children:p.map((T,Z)=>a.jsxs(Ct,{sx:{px:2,py:1,borderBottom:Z<p.length-1?"1px solid #f0f0f0":"none","&:last-child":{borderBottom:"none"}},children:[a.jsx(It,{sx:{minWidth:36},children:oe(T.severity)}),a.jsx(Rt,{primary:a.jsx(x,{variant:"body2",component:"div",fontWeight:"medium",children:T.message}),secondary:a.jsxs(m,{sx:{mt:1},children:[T.line&&a.jsxs(x,{variant:"caption",component:"div",color:"text.secondary",sx:{mb:.5},children:[" Line ",T.line,T.column&&`, Column ${T.column}`]}),T.suggestion&&a.jsxs(x,{variant:"caption",component:"div",display:"block",sx:{mt:.5,fontStyle:"italic",backgroundColor:"#f8f9fa",p:1,borderRadius:1,border:"1px solid #e9ecef"},children:[" ",T.suggestion]}),T.category&&a.jsx(P,{size:"small",icon:Ae(T.category),label:ne(T.category),color:ve(T.category),variant:"outlined",sx:{mt:1,mr:1}}),a.jsx(P,{size:"small",label:T.rule,variant:"outlined",sx:{mt:1,fontSize:"0.7rem"}})]}),primaryTypographyProps:{component:"div"},secondaryTypographyProps:{component:"div"}}),T.autoFixAvailable&&e&&a.jsx(ue,{title:"Fix this issue",children:a.jsx(Ce,{size:"small",onClick:()=>ye(T.rule),sx:{ml:1},color:"primary",children:a.jsx(ie,{fontSize:"small"})})})]},`${T.rule}-${Z}`))})})]})},Te=()=>{if(!s)return null;const p=[{key:"structure",label:"Structure",icon:a.jsx(Ye,{}),color:"primary"},{key:"accessibility",label:"Accessibility",icon:a.jsx(Qe,{}),color:"secondary"},{key:"compatibility",label:"Compatibility",icon:a.jsx(ee,{}),color:"info"},{key:"performance",label:"Performance",icon:a.jsx(ge,{}),color:"warning"},{key:"best-practice",label:"Best Practice",icon:a.jsx(Ke,{}),color:"success"}];return a.jsx(V,{container:!0,spacing:2,sx:{mb:3},children:p.map(g=>{const f=s.categories[g.key],j=f>0&&O.getRulesByCategory(g.key).some(T=>{var Z;return(Z=w[T])==null?void 0:Z.autofix});return a.jsx(V,{item:!0,xs:12,sm:6,md:4,children:a.jsx(Re,{className:"category-card",variant:"outlined",onClick:()=>F(g.key),sx:{borderColor:f>0?`${g.color}.main`:"divider",backgroundColor:f>0?`${g.color}.50`:"background.paper",transition:"all 0.3s ease-in-out",cursor:"pointer","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)"}},children:a.jsxs(yt,{sx:{p:2,"&:last-child":{pb:2}},children:[a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[a.jsx(m,{sx:{color:`${g.color}.main`},children:g.icon}),a.jsx(x,{variant:"body2",component:"div",fontWeight:"bold",children:g.label})]}),a.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx(qe,{badgeContent:f,color:g.color,children:a.jsx(P,{size:"small",label:f===0?"Perfect":`${f} issues`,color:f===0?"success":g.color,variant:f===0?"filled":"outlined"})}),j&&e&&f>0&&a.jsx(z,{size:"small",variant:"contained",startIcon:a.jsx(ie,{}),onClick:()=>Ee(g.key),disabled:S||I,color:g.color,sx:{borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"0 2px 4px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},children:I?"Fixing...":`Fix All (${f})`})]})]})})},g.key)})})},le=()=>s?a.jsxs(m,{sx:{mb:3,p:3,backgroundColor:"#f8f9fa",borderRadius:2,border:"1px solid #e9ecef",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[a.jsxs(x,{variant:"subtitle2",component:"div",sx:{mb:2,fontWeight:"bold",display:"flex",alignItems:"center",gap:1,color:"#495057"},children:[a.jsx(Je,{fontSize:"small"}),"Filters & Search"]}),a.jsxs(V,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(V,{item:!0,xs:12,sm:6,md:3,children:a.jsxs(Be,{fullWidth:!0,size:"small",children:[a.jsx(We,{children:"Severity"}),a.jsxs(Xe,{value:v,label:"Severity",onChange:p=>$(p.target.value),children:[a.jsx(B,{value:"all",children:"All Severities"}),a.jsx(B,{value:"error",children:"Errors"}),a.jsx(B,{value:"warning",children:"Warnings"}),a.jsx(B,{value:"info",children:"Suggestions"})]})]})}),a.jsx(V,{item:!0,xs:12,sm:6,md:3,children:a.jsxs(Be,{fullWidth:!0,size:"small",children:[a.jsx(We,{children:"Category"}),a.jsxs(Xe,{value:D,label:"Category",onChange:p=>F(p.target.value),children:[a.jsx(B,{value:"all",children:"All Categories"}),a.jsx(B,{value:"structure",children:"Structure"}),a.jsx(B,{value:"accessibility",children:"Accessibility"}),a.jsx(B,{value:"compatibility",children:"Compatibility"}),a.jsx(B,{value:"performance",children:"Performance"}),a.jsx(B,{value:"best-practice",children:"Best Practice"})]})]})}),a.jsx(V,{item:!0,xs:12,sm:12,md:6,children:a.jsx(Pe,{fullWidth:!0,size:"small",placeholder:"Search in messages, suggestions, or rules...",value:N,onChange:p=>W(p.target.value),InputProps:{startAdornment:a.jsx(Et,{position:"start",children:a.jsx(At,{fontSize:"small"})})}})})]}),a.jsxs(m,{sx:{mt:2,display:"flex",alignItems:"center",justifyContent:"space-between",p:1,backgroundColor:"#ffffff",borderRadius:1,border:"1px solid #dee2e6"},children:[a.jsxs(x,{variant:"caption",color:"text.secondary",children:["Showing"," ",G.errors.length+G.warnings.length+G.suggestions.length," ","of ",s.totalIssues," issues"]}),(v!=="all"||D!=="all"||N.trim())&&a.jsx(z,{size:"small",variant:"outlined",color:"secondary",onClick:()=>{$("all"),F("all"),W("")},sx:{borderRadius:2,textTransform:"none",fontWeight:500},children:"Clear Filters"})]})]}):null,ce=()=>{if(!r||!r.trim())return null;try{const p=O.getCompatibilityReport(r);return a.jsxs(m,{sx:{mt:2},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:"Email Client Compatibility"}),Object.entries(p).map(([g,f])=>a.jsxs(m,{sx:{mb:1},children:[a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[g==="outlook"&&a.jsx(ee,{fontSize:"small"}),g==="gmail"&&a.jsx(Lt,{fontSize:"small"}),g==="mobile"&&a.jsx(wt,{fontSize:"small"}),a.jsx(x,{variant:"body2",component:"div",sx:{textTransform:"capitalize",flexGrow:1},children:g}),a.jsx(P,{size:"small",label:f.compatible?"Compatible":"Issues",color:f.compatible?"success":"warning",variant:"outlined"})]}),!f.compatible&&f.issues&&f.issues.length>0&&a.jsx(m,{sx:{ml:3,mt:.5},children:f.issues.map((j,T)=>a.jsxs(x,{variant:"caption",component:"div",color:"warning.main",display:"block",children:[" ",j]},T))})]},g))]})}catch(p){return console.error("Error generating compatibility report",p,"EmailValidationPanel"),a.jsx(m,{sx:{mt:2},children:a.jsx(x,{variant:"subtitle2",component:"div",color:"error",children:"Error generating compatibility report"})})}};return!s&&!S?null:i?a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[S?a.jsx(P,{size:"small",label:"Validating...",color:"info"}):I?a.jsx(P,{size:"small",label:"Fixing...",color:"warning"}):s!=null&&s.isValid?a.jsx(P,{size:"small",icon:a.jsx(ze,{}),label:"Email Safe",color:"success"}):a.jsx(P,{size:"small",icon:a.jsx(_e,{}),label:`${(s==null?void 0:s.totalIssues)||0} Issues`,color:"error"}),s&&a.jsx(Ce,{size:"small",onClick:()=>l(!o),children:o?a.jsx(Ge,{}):a.jsx(Ie,{})})]}):a.jsxs(pt,{sx:{p:2,mb:2,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[a.jsx("style",{children:`
          @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
          }

          @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }

          .tab-content {
            animation: slideIn 0.3s ease-out;
          }

          .category-card:hover {
            transform: translateY(-4px);
            boxShadow: 0 8px 25px rgba(0,0,0,0.15);
          }
        `}),a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[S?a.jsx(P,{icon:a.jsx(me,{}),label:"Validating...",color:"info"}):s!=null&&s.isValid?a.jsx(P,{icon:a.jsx(ze,{}),label:"Email Safe",color:"success"}):a.jsx(P,{icon:a.jsx(_e,{}),label:`${((q=s==null?void 0:s.errors)==null?void 0:q.length)||0} Errors`,color:"error"}),s&&s.warnings&&s.warnings.length>0&&a.jsx(P,{icon:a.jsx(Ue,{}),label:`${s.warnings.length} Warnings`,color:"warning"})]}),a.jsx(m,{sx:{flexGrow:1}}),s&&a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(x,{variant:"body2",color:"text.secondary",children:"Score:"}),a.jsx(P,{label:`${s.score}/100`,color:s.score>=80?"success":s.score>=60?"warning":"error",variant:"outlined",size:"small"})]}),a.jsx(ue,{title:"Validation Settings",children:a.jsx(Ce,{size:"small",onClick:()=>d(!0),children:a.jsx(fe,{})})}),a.jsx(ue,{title:"Test Auto-fix with sample HTML",children:a.jsx(z,{size:"small",variant:"outlined",onClick:()=>{e&&(e(re),alert(" Test HTML loaded! Now try auto-fix to see it in action."))},sx:{ml:1},children:"Test HTML"})}),(s==null?void 0:s.autoFixAvailable)&&e&&a.jsx(ue,{title:"Auto-fix All Issues",children:a.jsx(z,{size:"small",variant:"contained",startIcon:a.jsx(ie,{}),onClick:te,disabled:S||I,color:"primary",sx:{borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"0 2px 4px rgba(25, 118, 210, 0.2)","&:hover":{boxShadow:"0 4px 8px rgba(25, 118, 210, 0.3)"}},children:I?"Fixing...":`Auto-fix All (${s.totalIssues})`})}),a.jsx(z,{size:"small",onClick:()=>l(!o),endIcon:o?a.jsx(Ge,{}):a.jsx(Ie,{}),variant:"outlined",sx:{borderRadius:2,textTransform:"none",fontWeight:500,borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#999",backgroundColor:"#f5f5f5"}},children:"Details"})]}),s&&a.jsxs(m,{sx:{mb:2},children:[a.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[a.jsx(x,{variant:"caption",color:"text.secondary",children:"Validation Progress"}),a.jsxs(x,{variant:"caption",color:"text.secondary",children:[s.score,"%"]})]}),a.jsx(ft,{variant:"determinate",value:s.score,color:s.score>=80?"success":s.score>=60?"warning":"error",sx:{height:6,borderRadius:3}})]}),a.jsxs(mt,{in:o,children:[a.jsx(bt,{sx:{mb:2}}),s&&Te(),a.jsx(m,{sx:{mb:2,borderBottom:"1px solid #e0e0e0",backgroundColor:"#fafafa",borderRadius:"8px 8px 0 0",p:1},children:a.jsxs(xt,{value:h,onChange:(p,g)=>b(g),sx:{"& .MuiTab-root":{minHeight:48,textTransform:"none",fontWeight:500,fontSize:"0.875rem",transition:"all 0.2s ease-in-out",borderRadius:"8px 8px 0 0",margin:"0 4px",color:"text.secondary"},"& .Mui-selected":{fontWeight:600,color:"primary.main",backgroundColor:"rgba(25, 118, 210, 0.08)"},"& .MuiTabs-indicator":{height:4,borderRadius:"4px 4px 0 0",backgroundColor:"primary.main",boxShadow:"0 2px 4px rgba(25, 118, 210, 0.3)"},"& .MuiTab-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.04)",transform:"translateY(-1px)"}},variant:"fullWidth",textColor:"primary",indicatorColor:"primary",children:[a.jsx(de,{label:a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(me,{fontSize:"small"}),"Issues",s&&s.totalIssues>0&&a.jsx(qe,{badgeContent:s.totalIssues,color:"error",sx:{ml:1},max:99})]})}),a.jsx(de,{label:a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(ee,{fontSize:"small"}),"Compatibility"]})}),a.jsx(de,{label:a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(ge,{fontSize:"small"}),"Performance"]})}),a.jsx(de,{label:a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(fe,{fontSize:"small"}),"Settings"]})})]})}),a.jsxs(m,{className:"tab-content",sx:{minHeight:200,position:"relative",p:2,backgroundColor:"#ffffff",borderRadius:"0 0 8px 8px",border:"1px solid #e0e0e0",borderTop:"none"},children:[h===0&&s&&a.jsxs(m,{children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#fce4ec",borderRadius:2,border:"1px solid #e91e63",color:"#ad1457",fontWeight:600,boxShadow:"0 2px 4px rgba(233, 30, 99, 0.1)"},children:[a.jsx(me,{color:"error"}),"Issues & Validation Results"]}),le(),G.errors.length===0&&G.warnings.length===0&&G.suggestions.length===0?a.jsx(be,{severity:"info",sx:{borderRadius:2},children:"No issues match the current filters. Try adjusting your search criteria."}):a.jsxs(a.Fragment,{children:[se(G.errors,"Errors","error"),se(G.warnings,"Warnings","warning"),se(G.suggestions,"Suggestions","info")]}),s.totalIssues===0&&a.jsx(be,{severity:"success",sx:{borderRadius:2},children:" Your HTML is email-safe! No issues found."})]}),h===1&&a.jsxs(m,{children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#e3f2fd",borderRadius:2,border:"1px solid #2196f3",color:"#1565c0"},children:[a.jsx(ee,{color:"info"}),"Email Client Compatibility"]}),ce(),a.jsxs(m,{sx:{mt:3,p:2,backgroundColor:"#e3f2fd",borderRadius:2,border:"1px solid #2196f3"},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" Compatibility Tips"}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:1},children:[" ",a.jsx("strong",{children:"Outlook:"})," Use table-based layout, avoid flexbox/grid"]}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:1},children:[" ",a.jsx("strong",{children:"Gmail:"})," Inline styles work best, external CSS may be stripped"]}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:1},children:[" ",a.jsx("strong",{children:"Mobile:"})," Use responsive design with max-width"]})]})]}),h===2&&a.jsxs(m,{children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800",color:"#e65100",fontWeight:600,boxShadow:"0 2px 4px rgba(255, 152, 0, 0.1)"},children:[a.jsx(ge,{color:"warning"}),"Performance Analysis"]}),s&&a.jsxs(V,{container:!0,spacing:2,sx:{mb:3},children:[a.jsx(V,{item:!0,xs:12,sm:6,children:a.jsxs(Re,{variant:"outlined",sx:{p:2},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" File Size"}),a.jsxs(x,{variant:"h4",component:"div",color:s.score>=80?"success.main":"warning.main",children:[(r.length/1024).toFixed(1)," KB"]}),a.jsx(x,{variant:"caption",component:"div",color:"text.secondary",children:s.score>=80?" Optimal size":" Consider optimization"})]})}),a.jsx(V,{item:!0,xs:12,sm:6,children:a.jsxs(Re,{variant:"outlined",sx:{p:2},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" Validation Score"}),a.jsxs(x,{variant:"h4",component:"div",color:s.score>=80?"success.main":s.score>=60?"warning.main":"error.main",children:[s.score,"/100"]}),a.jsx(x,{variant:"caption",component:"div",color:"text.secondary",children:s.score>=80?"Excellent":s.score>=60?"Good":"Needs improvement"})]})})]}),a.jsxs(m,{sx:{p:2,backgroundColor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800"},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" Performance Recommendations"}),a.jsx(x,{variant:"body2",component:"div",sx:{mb:1},children:" Keep HTML size under 102KB for optimal email delivery"}),a.jsx(x,{variant:"body2",component:"div",sx:{mb:1},children:" Use inline styles instead of external CSS"}),a.jsx(x,{variant:"body2",component:"div",sx:{mb:1},children:" Optimize images and use appropriate dimensions"}),a.jsx(x,{variant:"body2",component:"div",sx:{mb:1},children:" Minimize table nesting for better rendering"})]})]}),h===3&&a.jsxs(m,{children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#e8f5e8",borderRadius:2,border:"1px solid #4caf50",color:"#2e7d32",fontWeight:600,boxShadow:"0 2px 4px rgba(76, 175, 80, 0.1)"},children:[a.jsx(fe,{color:"primary"}),"Validation Settings"]}),a.jsxs(m,{sx:{mb:3},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:2,fontWeight:"bold"},children:"Quick Actions"}),a.jsxs(V,{container:!0,spacing:2,children:[a.jsx(V,{item:!0,xs:12,sm:6,children:a.jsx(z,{fullWidth:!0,variant:"contained",startIcon:a.jsx(ie,{}),onClick:()=>d(!0),sx:{mb:1,borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"0 2px 4px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},children:"Advanced Settings"})}),a.jsx(V,{item:!0,xs:12,sm:6,children:a.jsx(z,{fullWidth:!0,variant:"outlined",startIcon:a.jsx(Je,{}),onClick:()=>{$("all"),F("all"),W("")},sx:{borderRadius:2,textTransform:"none",fontWeight:500,borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#999",backgroundColor:"#f5f5f5"}},children:"Reset Filters"})})]})]}),a.jsxs(m,{sx:{p:2,backgroundColor:"#f5f5f5",borderRadius:2},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:"Current Configuration"}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:.5},children:[" Severity Filter: ",v==="all"?"All":v]}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:.5},children:[" Category Filter: ",D==="all"?"All":D]}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:.5},children:[" Search Query: ",N||"None"]}),a.jsxs(x,{variant:"body2",component:"div",children:[" Total Rules: ",Object.keys(w).length]})]})]})]})]}),a.jsx(rs,{open:c,onClose:()=>d(!1),validator:O})]})},rs=({open:r,onClose:e,validator:t})=>{const[i,s]=M.useState(t.getConfig()),n=t.getAvailableRules(),o=()=>{try{t.updateConfig(i),e()}catch(c){console.error("Error saving validation config",c,"ValidationSettingsDialog")}},l=(c,d)=>{s(h=>({...h,rules:{...h.rules,[c]:{...h.rules[c],enabled:d}}}))};return a.jsxs(jt,{open:r,onClose:e,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[a.jsx(Mt,{sx:{backgroundColor:"#f8f9fa",borderBottom:"1px solid #e9ecef",fontWeight:600},children:"Validation Settings"}),a.jsxs($t,{sx:{p:3},children:[a.jsxs(m,{sx:{mb:3},children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,p:2,backgroundColor:"#e3f2fd",borderRadius:2,border:"1px solid #2196f3",color:"#1565c0",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[a.jsx(me,{fontSize:"small"}),"Validation Rules"]}),a.jsx(Ze,{children:Object.entries(n).map(([c,d])=>{var h;return a.jsx(Le,{control:a.jsx(we,{checked:((h=i.rules[c])==null?void 0:h.enabled)??d.enabled,onChange:b=>l(c,b.target.checked),color:"primary"}),label:a.jsxs(m,{sx:{p:1,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef",flex:1},children:[a.jsx(x,{variant:"body2",component:"div",sx:{fontWeight:500},children:d.displayName}),a.jsx(x,{variant:"caption",component:"div",color:"text.secondary",children:d.description})]}),sx:{alignItems:"flex-start",mb:1,p:1,borderRadius:1,"&:hover":{backgroundColor:"#f8f9fa"}}},c)})})]}),a.jsxs(m,{sx:{mb:3},children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,p:2,backgroundColor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800",color:"#e65100",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[a.jsx(ee,{fontSize:"small"}),"Target Email Clients"]}),a.jsx(Ze,{children:Object.entries(i.targetClients).map(([c,d])=>a.jsx(Le,{control:a.jsx(we,{checked:d,onChange:h=>s(b=>({...b,targetClients:{...b.targetClients,[c]:h.target.checked}})),color:"primary"}),label:a.jsx(m,{sx:{p:1,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef",flex:1},children:a.jsx(x,{variant:"body2",component:"div",sx:{fontWeight:500},children:c.charAt(0).toUpperCase()+c.slice(1)})}),sx:{alignItems:"flex-start",mb:1,p:1,borderRadius:1,"&:hover":{backgroundColor:"#f8f9fa"}}},c))})]}),a.jsxs(m,{sx:{p:2,backgroundColor:"#f3e5f5",borderRadius:2,border:"1px solid #9c27b0"},children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,color:"#6a1b9a",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[a.jsx(fe,{fontSize:"small"}),"Advanced Options"]}),a.jsxs(m,{sx:{mb:2},children:[a.jsx(x,{variant:"body2",component:"div",sx:{mb:1,fontWeight:500},children:"Max HTML Size (KB)"}),a.jsx(Pe,{type:"number",size:"small",value:Math.round(i.maxHtmlSize/1024),onChange:c=>{const d=parseInt(c.target.value);!isNaN(d)&&d>0&&s(h=>({...h,maxHtmlSize:d*1024}))},inputProps:{min:1,max:1e3},sx:{width:120},helperText:`Current: ${Math.round(i.maxHtmlSize/1024)}KB`})]}),a.jsx(Le,{control:a.jsx(we,{checked:i.strictMode,onChange:c=>s(d=>({...d,strictMode:c.target.checked})),color:"secondary"}),label:a.jsx(m,{sx:{p:1,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef",flex:1},children:a.jsx(x,{variant:"body2",component:"div",sx:{fontWeight:500},children:"Strict Mode (treat warnings as errors)"})}),sx:{alignItems:"flex-start",p:1,borderRadius:1,"&:hover":{backgroundColor:"#f8f9fa"}}})]})]}),a.jsxs(Ht,{sx:{p:3,borderTop:"1px solid #e9ecef"},children:[a.jsx(z,{onClick:e,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3},children:"Cancel"}),a.jsx(z,{onClick:o,variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3,boxShadow:"0 2px 4px rgba(25, 118, 210, 0.2)","&:hover":{boxShadow:"0 4px 8px rgba(25, 118, 210, 0.3)"}},children:"Save"})]})]})},ns=()=>{const r=Ot(),{mode:e,style:t}=kt(),i=Ft(r,e,t),{editorHtml:s,setEditorHtml:n,subject:o,setSubject:l,loading:c,sendEmail:d,isReadyToSend:h,areCredentialsValid:b,serverStatus:S}=Nt(),R=()=>{d()},I=()=>{n("")},y=c||!h||!b||S==="offline";return a.jsxs(m,{sx:{height:"100%",display:"flex",flexDirection:"column",p:2},children:[a.jsxs(m,{sx:{flexGrow:1,overflow:"auto",pr:1},children:[a.jsxs(m,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[a.jsx(Pt,{}),a.jsx(x,{variant:"h6",children:"Email Template Editor"})]}),S==="offline"&&a.jsx(be,{severity:"error",sx:{mb:3},children:"Email server is offline. Please start the backend server."}),a.jsxs(Dt,{spacing:3,children:[a.jsx(Pe,{label:"Email Subject",value:o,onChange:v=>l(v.target.value),fullWidth:!0,placeholder:"Enter email subject...",helperText:"A descriptive subject line for your email",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"background.paper"}}}),a.jsx(m,{children:a.jsx(is,{html:s,onHtmlChange:n,showCompactView:!1})}),a.jsxs(m,{children:[a.jsx(x,{variant:"subtitle2",sx:{mb:2,color:"text.secondary",fontWeight:500},children:"HTML Content:"}),a.jsx(m,{sx:{border:"2px solid",borderColor:"divider",borderRadius:2,overflow:"hidden",boxShadow:r.shadows[2],"& .cm-selectionLayer .cm-selectionBackground":{backgroundColor:`${Me(r.palette.primary.main,.25)} !important`},"& .cm-selectionBackground":{backgroundColor:`${Me(r.palette.primary.main,.25)} !important`},"& .cm-content ::selection":{backgroundColor:`${Me(r.palette.primary.main,.25)} !important`}},children:a.jsx(Vt,{value:s,onChange:v=>n(v),height:"400px",extensions:[zt(),...i],theme:void 0,basicSetup:{lineNumbers:!0,foldGutter:!0,dropCursor:!0,allowMultipleSelections:!1,indentOnInput:!0,bracketMatching:!0,closeBrackets:!0,autocompletion:!0,highlightSelectionMatches:!0,searchKeymap:!0}})})]})]})]}),a.jsx(m,{sx:{position:"sticky",bottom:0,backgroundColor:"background.paper",borderTop:1,borderColor:"divider",p:2,mx:-2,mt:2,boxShadow:r.shadows[2],zIndex:10},children:a.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[a.jsx(m,{sx:{display:"flex",alignItems:"center",gap:2},children:a.jsx(z,{variant:"outlined",startIcon:a.jsx(Gt,{}),onClick:I,size:"medium",color:"warning",sx:{borderColor:"warning.main",color:"warning.main","&:hover":{borderColor:"warning.dark",backgroundColor:"warning.50"}},children:"Clear Editor"})}),a.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2},children:[!b&&a.jsx(be,{severity:"warning",sx:{py:.5,px:2,fontSize:"0.875rem"},children:"Configure credentials first"}),a.jsx(z,{variant:"contained",startIcon:a.jsx(Ut,{}),onClick:R,disabled:y,size:"large",sx:{minWidth:160,height:48,fontSize:"1rem",fontWeight:600,bgcolor:y?void 0:"success.main","&:hover":{bgcolor:y?void 0:"success.dark",transform:"translateY(-1px)",boxShadow:r.shadows[4]},"&:disabled":{opacity:.6},transition:"all 0.2s ease-in-out"},children:c?"Sending...":"Send Email"})]})]})})]})};export{ns as EmailHtmlEditor,ns as default};
