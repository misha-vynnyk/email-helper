var qe=Object.defineProperty;var Qe=(a,e,t)=>e in a?qe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var E=(a,e,t)=>Qe(a,typeof e!="symbol"?e+"":e,t);import{c as oe,j as r,r as $,B as p,n as k,o as ve,p as ce,I as ue,e as _e,f as de,P as Je,W as Ie,T as b,d as Q,q as ie,s as O,L as et,C as tt,D as st,t as it,v as J,w as Ce,x as Z,y as ee,A as ae,G as N,z as ge,H as rt,F as Re,k as Le,J as we,M as G,g as Ae,h as at,K as ot,N as nt,Q as lt,U as ct,X as ut,Y as dt,Z as gt,_ as ht,i as ft,$ as pt,a0 as mt,a1 as bt,a2 as xt,a3 as je,a4 as he,a5 as fe,a6 as Et,a7 as Me,m as He,a8 as pe,a9 as yt,aa as At,ab as Tt,u as St,ac as vt,ad as _t,ae as me,af as It,ag as Ct,ah as Rt,ai as Lt}from"./index-LZ-tBt-g.js";const ke=oe(r.jsx("path",{d:"M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m9 7h-6v13h-2v-6h-2v6H9V9H3V7h18z"}),"Accessibility"),q=oe(r.jsx("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"}),"AutoFixHigh"),re=oe(r.jsx("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z"}),"BugReport"),$e=oe(r.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList"),y={DEFAULT_IMAGE_WIDTH:600,DEFAULT_IMAGE_HEIGHT:400,DEFAULT_ALT_TEXT:"Image",MAX_TABLES:50,MAX_TABLE_NESTING:5,MAX_AUTOFIX_ITERATIONS:10,MAX_STYLE_MERGE_ITERATIONS:3,MAX_FILE_SIZE_KB:102,MAX_HTML_SIZE_KB:130,MAX_HTML_SIZE_BYTES:133120,REGEX_CACHE_SIZE:100,AST_CACHE_SIZE:50,TRAVERSAL_CACHE_SIZE:50,CACHE_TTL_MS:5*60*1e3,CACHE_CLEANUP_INTERVAL_MS:10*60*1e3,DEFAULT_LINK_STYLES:"color:#0000ff; text-decoration:none;",DEFAULT_IMAGE_STYLES:"display:block",HEADING_FONT_SIZES:{h1:32,h2:24,h3:20,h4:18,h5:16,h6:14},TARGET_CLIENTS:{outlook:!0,gmail:!0,applemail:!0,thunderbird:!1,mobile:!0}},S={MAX_PARSER_ITERATIONS:1e3,MAX_PARSER_DEPTH:100,MAX_PARSER_SAFETY_COUNTER:1e4,MAX_VALIDATION_RESULTS:1e3,MAX_TRAVERSAL_RESULTS:1e3,MAX_AUTOFIX_ITERATIONS:50,MAX_AUTOFIX_MULTIPLE_ITERATIONS:25,MAX_HTML_SIZE_INCREASE_MULTIPLIER:3,MAX_AUTOFIX_PASSES:3,CACHE_CLEANUP_PERCENTAGE:.3,CACHE_CLEANUP_PERCENTAGE_REDUCED:.2,CACHE_CLEANUP_THRESHOLD:.8,CACHE_CLEANUP_PERCENTAGE_LARGE:.4,MAX_FIX_HISTORY_SIZE:100,MAX_FIX_HISTORY_AGE_MS:30*60*1e3,MAX_CUSTOM_RULES_SIZE:100,MAX_STRING_BATCHER_OPERATIONS:50,SLOW_VALIDATION_THRESHOLD_MS:1e3,SLOW_AUTOFIX_THRESHOLD_MS:2e3,MAX_HEADING_LEVELS:6,MAX_RECENT_FIXES_TRACKED:10},X={MAX_SCORE:100,MAX_PENALTY:100,ERROR_PENALTY:20,WARNING_PENALTY:10,INFO_PENALTY:5},M={REGEX_ACCESS_COUNT_WEIGHT:.3,REGEX_AGE_WEIGHT:.7,AST_ACCESS_COUNT_WEIGHT:.4,AST_AGE_WEIGHT:.6,TRAVERSAL_ACCESS_COUNT_WEIGHT:.2,TRAVERSAL_AGE_WEIGHT:.5,TRAVERSAL_SIZE_WEIGHT:.3},Fe={STYLE_ATTRIBUTE:/style="([^"]*)"/gi,WIDTH_100_PERCENT:/width:\s*100%/gi,EMPTY_HREF:/href\s*=\s*["']?\s*["']?/gi,MALFORMED_SRC:/\bs\s+rc=/gi,MALFORMED_HREF_NO_EQUALS:/\s+href\s+([^"\s>]+)/gi,MALFORMED_HREF_WITH_QUOTES:/\s+href\s+"([^"]*)"([^>]*)/gi,DEFAULT_HREF_VALUE:"urlhere"},wt={TEN_MINUTES_MS:10*60*1e3},I={HTML_TOO_LARGE:"HTML is too large for validation",HTML_TOO_LARGE_FOR_AUTOFIX:"HTML too large for autofix",VALIDATION_FAILED:"Validation failed",AUTOFIX_FAILED:"Autofix failed",RULE_NOT_FOUND:"Rule not found",INVALID_HTML_INPUT:"Invalid HTML input: must be a non-empty string",INVALID_RULE_NAME:"Rule name is required",INVALID_SEVERITY:"Invalid severity level. Must be error, warning, or info",INVALID_CONFIG:"Invalid configuration provided",VALIDATOR_DISPOSED:"EmailHTMLValidator has been disposed and cannot be used"},Y={SLOW_OPERATION_PREFIX:"Slow operation detected",CACHE_CLEANUP_PREFIX:"Cache cleanup completed",STATISTICS_RESET_PREFIX:"Statistics reset",DISPOSAL_PREFIX:"disposed successfully",GARBAGE_COLLECTION_PREFIX:"Garbage collection triggered"};class u{static get(e,t="gi"){const i=`${e}|${t}`;if(this.cache.has(i)){const s=this.accessCount.get(i)||0;this.accessCount.set(i,s+1),this.lastAccess.set(i,Date.now())}else{this.cache.size>=this.maxSize&&this.performCleanup();try{const s=new RegExp(e,t);this.cache.set(i,s),this.accessCount.set(i,1),this.lastAccess.set(i,Date.now()),this.precompiledPatterns.has(e)||this.precompiledPatterns.add(e)}catch(s){console.warn(`Invalid regex pattern: ${e}`,s),this.cache.set(i,new RegExp("(?:)",t)),this.accessCount.set(i,1),this.lastAccess.set(i,Date.now())}}return this.cleanupTimer||(this.cleanupTimer=setTimeout(()=>{this.performCleanup(),this.cleanupTimer=void 0},y.CACHE_CLEANUP_INTERVAL_MS)),this.cache.get(i)}static performCleanup(){if(this.cache.size<=this.maxSize*S.CACHE_CLEANUP_THRESHOLD)return;const e=Array.from(this.cache.entries()).map(([i,s])=>({key:i,regex:s,accessCount:this.accessCount.get(i)||0,lastAccess:this.lastAccess.get(i)||0,age:Date.now()-(this.lastAccess.get(i)||0)}));e.sort((i,s)=>{const n=i.accessCount*M.REGEX_ACCESS_COUNT_WEIGHT+i.age/1e3*M.REGEX_AGE_WEIGHT,o=s.accessCount*M.REGEX_ACCESS_COUNT_WEIGHT+s.age/1e3*M.REGEX_AGE_WEIGHT;return n-o});const t=Math.floor(this.cache.size*S.CACHE_CLEANUP_PERCENTAGE);for(let i=0;i<t&&i<e.length;i++){const s=e[i];this.cache.delete(s.key),this.accessCount.delete(s.key),this.lastAccess.delete(s.key)}}static clear(){this.cache.clear(),this.accessCount.clear(),this.lastAccess.clear(),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0)}static size(){return this.cache.size}static getStats(){const e=Math.min(...Array.from(this.lastAccess.values()));return{size:this.cache.size,maxSize:this.maxSize,accessCount:Array.from(this.accessCount.values()).reduce((t,i)=>t+i,0),oldestEntry:e===1/0?0:e}}}E(u,"cache",new Map),E(u,"maxSize",y.REGEX_CACHE_SIZE),E(u,"precompiledPatterns",new Set),E(u,"accessCount",new Map),E(u,"lastAccess",new Map),E(u,"cleanupTimer");class B{static get(e){const t=this.hashCode(e),i=this.cache.get(t);if(i){if(Date.now()-i.timestamp>this.ttl){this.cache.delete(t);return}return i.accessCount++,this.cleanupTimer||(this.cleanupTimer=setTimeout(()=>{this.clearExpired(),this.cleanupTimer=void 0},y.CACHE_CLEANUP_INTERVAL_MS)),i.ast}}static set(e,t){const i=this.hashCode(e);this.cache.size>=this.maxSize&&this.performCleanup(),this.cache.set(i,{ast:t,timestamp:Date.now(),accessCount:1})}static clear(){this.cache.clear(),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0)}static size(){return this.cache.size}static clearExpired(){const e=Date.now();let t=0;const i=[];for(const[s,n]of this.cache.entries())e-n.timestamp>this.ttl&&i.push(s);for(const s of i)this.cache.delete(s),t++;return this.cache.size>this.maxSize*S.CACHE_CLEANUP_THRESHOLD&&this.performCleanup(),t}static performCleanup(){if(this.cache.size<=this.maxSize*S.CACHE_CLEANUP_THRESHOLD)return;const e=Array.from(this.cache.entries()).map(([i,s])=>({key:i,...s,age:Date.now()-s.timestamp}));e.sort((i,s)=>{const n=i.accessCount*M.AST_ACCESS_COUNT_WEIGHT+i.age/1e3*M.AST_AGE_WEIGHT,o=s.accessCount*M.AST_ACCESS_COUNT_WEIGHT+s.age/1e3*M.AST_AGE_WEIGHT;return n-o});const t=Math.floor(this.cache.size*S.CACHE_CLEANUP_PERCENTAGE);for(let i=0;i<t&&i<e.length;i++)this.cache.delete(e[i].key)}static hashCode(e){if(e.length===0)return"0";let t=0;for(let i=0;i<e.length;i++){const s=e.charCodeAt(i);t=(t<<5)-t+s,t=t&t}return`${Math.abs(t)}_${e.length}`}static getStats(){const e=Math.min(...Array.from(this.cache.values()).map(t=>t.timestamp));return{size:this.cache.size,maxSize:this.maxSize,ttl:this.ttl,oldestEntry:e===1/0?0:e}}}E(B,"cache",new Map),E(B,"maxSize",y.AST_CACHE_SIZE),E(B,"ttl",y.CACHE_TTL_MS),E(B,"cleanupTimer");class be{constructor(){E(this,"operations",[]);E(this,"maxOperations",S.MAX_STRING_BATCHER_OPERATIONS)}add(e,t){return this.operations.length>=this.maxOperations&&this.execute(""),this.operations.push({pattern:e,replacement:t}),this}execute(e){let t=e;try{for(const i of this.operations)t=t.replace(i.pattern,i.replacement)}catch(i){return console.warn("StringBatcher execution error:",i),e}finally{this.clear()}return t}clear(){this.operations=[]}getOperationCount(){return this.operations.length}}class Ee{constructor(e){E(this,"html");E(this,"position");E(this,"line");E(this,"column");this.html=e,this.position=0,this.line=1,this.column=1}parse(){const e=[],t=S.MAX_PARSER_ITERATIONS;let i=0;try{for(;this.position<this.html.length&&i<t;){i++;const s=this.parseNode();if(s&&e.push(s),this.position>=this.html.length)break;if(i>=t){console.warn("HTML parser reached max iterations, stopping to prevent infinite loop");break}}}catch(s){console.warn("HTML parser error:",s)}return e}parseNode(){return this.skipWhitespace(),this.position>=this.html.length?null:this.html[this.position]==="<"?this.html.substr(this.position,4)==="<!--"?this.parseComment():this.parseElement():this.parseText()}parseElement(){const e=this.line,t=this.column;if(this.html[this.position]!=="<")return null;if(this.advance(),this.html[this.position]==="/")return this.advance(),this.parseTagName()&&this.html[this.position]===">"&&this.advance(),null;const s=this.parseTagName();if(!s)return null;const n=this.parseAttributes(),o=this.html[this.position]==="/";o&&this.advance(),this.html[this.position]===">"&&this.advance();const l={type:"element",tagName:s.toLowerCase(),attributes:n,line:e,column:t,children:[]};return!o&&!this.isSelfClosingTag(s)&&(l.children=this.parseChildren(s)),l}parseTagName(){let e="";for(;this.position<this.html.length&&/[a-zA-Z0-9]/.test(this.html[this.position]);)e+=this.html[this.position],this.advance();return e}parseAttributes(){const e={};let t=0;for(;this.position<this.html.length&&this.html[this.position]!==">"&&this.html[this.position]!=="/";){const i=this.position;if(this.skipWhitespace(),this.position>=this.html.length||this.html[this.position]===">"||this.html[this.position]==="/")break;const s=this.parseAttribute();if(s&&(e[s.name]=s.value),this.position===i&&this.advance(),t++,t>S.MAX_PARSER_SAFETY_COUNTER)break}return e}parseAttribute(){const e=this.parseAttributeName();if(!e)return null;if(this.skipWhitespace(),this.position>=this.html.length)return{name:e,value:""};if(this.html[this.position]!=="=")return{name:e,value:""};this.advance(),this.skipWhitespace();const t=this.parseAttributeValue();return{name:e,value:t}}parseAttributeName(){let e="";for(;this.position<this.html.length&&/[a-zA-Z0-9\-_:]/.test(this.html[this.position]);)e+=this.html[this.position],this.advance();return e}parseAttributeValue(){if(this.position>=this.html.length)return"";const e=this.html[this.position];if(e==='"'||e==="'"){this.advance();let i="";for(;this.position<this.html.length&&this.html[this.position]!==e;)i+=this.html[this.position],this.advance();return this.position<this.html.length&&this.html[this.position]===e&&this.advance(),i}let t="";for(;this.position<this.html.length&&!/[\s>]/.test(this.html[this.position]);)t+=this.html[this.position],this.advance();return t}parseChildren(e){const t=[],i=S.MAX_PARSER_DEPTH;let s=0;const n=this.position;for(;this.position<this.html.length&&s<i;){if(s++,this.position===n&&s>1&&this.advance(),this.html.substr(this.position,2+e.length+1)===`</${e}>`){this.position+=2+e.length+1,this.updatePosition();break}const o=this.parseNode();if(o)t.push(o);else{this.position<this.html.length&&this.advance();break}if(this.position>=this.html.length)break}return t}parseText(){const e=this.line,t=this.column;let i="";for(;this.position<this.html.length&&this.html[this.position]!=="<";)i+=this.html[this.position],this.advance();return{type:"text",content:i.trim(),line:e,column:t}}parseComment(){const e=this.line,t=this.column;this.position+=4;let i="";for(;this.position<this.html.length&&this.html.substr(this.position,3)!=="-->";)i+=this.html[this.position],this.advance();return this.position<this.html.length&&this.html.substr(this.position,3)==="-->"&&(this.position+=3,this.updatePosition()),{type:"comment",content:i,line:e,column:t}}isSelfClosingTag(e){return["br","img","hr","area","base","col","input"].includes(e.toLowerCase())}skipWhitespace(){for(;this.position<this.html.length&&/\s/.test(this.html[this.position]);)this.advance()}advance(){this.position>=this.html.length||(this.html[this.position]===`
`?(this.line++,this.column=1):this.column++,this.position++)}updatePosition(){for(let e=0;e<3&&this.position-3+e>=0;e++)this.html[this.position-3+e]===`
`?(this.line++,this.column=1):this.column++}}function W(a,e){if(Array.isArray(a))for(const t of a)t&&(e(t),t.children&&Array.isArray(t.children)&&t.children.length>0&&W(t.children,e))}function te(a,e){if(!Array.isArray(a)||!e)return[];const t=[];return W(a,i=>{i.type==="element"&&i.tagName===e.toLowerCase()&&t.push(i)}),t}const j={TAG_OPENING:a=>`<${a}(?:\\s[^>]*)?>`,TAG_CLOSING:a=>`</${a}>`,TAG_SELF_CLOSING:a=>`<${a}(?:\\s[^>]*)?/>`,TAG_WITH_CONTENT:a=>`<${a}(?:\\s[^>]*)?>[\\s\\S]*?</${a}>`,ATTRIBUTE_STYLE_DUPLICATE:'style="([^"]*)"([^>]*?)style="([^"]*)"',ATTRIBUTE_EMPTY_HREF:`href\\s*=\\s*(?:"\\s*"|'\\s*'|\\s*)`,ATTRIBUTE_TARGET_WRONG:`target\\s*=\\s*(?:"(?:_self|_parent|_top)"|'(?:_self|_parent|_top)')`,ATTRIBUTE_MALFORMED_SRC:"\\bs\\s+rc=",ATTRIBUTE_MISSING_SPACE:'="([^"]*)"([a-zA-Z]+=)',IMG_MALFORMED_ATTR_SPACING:'(<img[^>]*?)([a-zA-Z0-9_.-]+")([a-zA-Z]+=)',IMG_SELF_CLOSING_WRONG:"<img\\s*([^>]*?)></img>",IMG_MISSING_ALT:"<img(?![^>]*\\salt=)[^>]*>",IMG_MISSING_WIDTH:"<img(?![^>]*\\swidth=)[^>]*>",IMG_MISSING_HEIGHT:"<img(?![^>]*\\sheight=)[^>]*>",LINK_EMPTY_HREF:`<a[^>]*href\\s*=\\s*(?:"\\s*"|'\\s*'|\\s*)[^>]*>`,LINK_NO_TARGET:`<a[^>]*href\\s*=\\s*(?:"[^"]+"|'[^']+')[^>]*(?!target\\s*=)[^>]*>`,LINK_NO_STYLE:`<a[^>]*href\\s*=\\s*(?:"[^"]+"|'[^']+')[^>]*(?!style\\s*=)[^>]*>`,TABLE_NESTED_EXCESSIVE:"<table([^>]*)><tr><td([^>]*)><table([^>]*)><tr><td([^>]*)>",TABLE_NESTED_CLOSING:"</td></tr></table></td></tr></table>",TABLE_EMPTY:"<table[^>]*><tr><td[^>]*>\\s*</td></tr></table>",TABLE_SINGLE_SPAN_WRAPPER:"<table[^>]*><tr><td[^>]*>(\\s*<span[^>]*>[^<]+</span>\\s*)</td></tr></table>",STYLE_WIDTH_PERCENTAGE:'style="([^"]*?)width:\\s*100%([^"]*?)"',EMPTY_SPAN:"<span[^>]*>\\s*</span>",EMPTY_SPAN_WHITESPACE:"<span[^>]*>[\\s\\t\\n\\r]*</span>",EXTRA_SPACES_IN_TAG:"\\s+>",EXTRA_SPACES_MULTIPLE:"\\s{2,}",UNSAFE_ATTRIBUTE:a=>`\\s${a}\\s*=\\s*(?:"[^"]*"|'[^']*')`},ye={GLOBAL_CASE_INSENSITIVE:"gi",GLOBAL_CASE_INSENSITIVE_MULTILINE:"gim",GLOBAL_CASE_INSENSITIVE_DOTALL:"gis",CASE_INSENSITIVE:"i",GLOBAL:"g"},jt=["table","tbody","thead","tfoot","tr","td","th","img","a","span","strong","b","em","i","u","br","center","font","big","small","sup","sub","ul","ol","li","blockquote","pre"],se=["div","p","h1","h2","h3","h4","h5","h6","section","article","aside","nav","header","footer","main","figure","figcaption","canvas","svg","video","audio","iframe","embed","object","script","form","input","button","textarea","select","option","fieldset","legend","label"],Mt={table:['cellpadding="0"','cellspacing="0"','border="0"'],img:["alt",'style="display:block"'],a:['target="_blank"'],td:['valign="top"']},R={isValidHtml:a=>!!(a&&typeof a=="string"),createValidationResult:(a,e,t,i,s,n,o)=>({rule:a,severity:e,message:t,suggestion:i,autoFixAvailable:!0,category:s,line:n,column:o}),hasPattern:(a,e,t=ye.GLOBAL_CASE_INSENSITIVE)=>{if(!R.isValidHtml(a))return!1;try{const i=t.replace("g","");return u.get(e,i).test(a)}catch{return!1}},findPatternMatches:(a,e,t=ye.GLOBAL_CASE_INSENSITIVE)=>{const i=[];if(!R.isValidHtml(a))return i;try{const s=t.includes("g")?t:`${t}g`,n=u.get(e,s);for(const o of a.matchAll(n))i.push(o)}catch{}return i},checkForbiddenTagsAST:(a,e,t,i)=>{if(!a||!Array.isArray(e))return;const s=n=>{for(const o of n)o.type==="element"&&o.tagName&&e.includes(o.tagName)&&i(o,o.tagName),o.children&&Array.isArray(o.children)&&s(o.children)};s(a)},checkForbiddenTagsRegex:(a,e,t,i)=>{!R.isValidHtml(a)||!Array.isArray(e)||e.forEach(s=>{const n=j.TAG_OPENING(s);R.findPatternMatches(a,n).length>0&&i(s)})}},Ht={replaceTagsWithSpans:(a,e)=>{if(!R.isValidHtml(a))return a;let t=a;try{Object.entries(e).forEach(([i,s])=>{const n=`<${i}((?:\\s[^>]*)?)>`,o=j.TAG_CLOSING(i),l=Object.entries(s).map(([c,d])=>{switch(c){case"fontSize":return`font-size: ${d}px`;case"fontWeight":return`font-weight: ${d}`;case"display":return`display: ${d}`;default:return`${c}: ${d}`}}).join("; ");t=t.replace(u.get(n,"gi"),(c,d)=>{const h=d.match(/style\s*=\s*["']([^"']*)["']/i);let x=l;if(h){const v=h[1].replace(/;\s*$/,""),L={};v.split(";").forEach(C=>{const[A,T]=C.split(":").map(F=>F.trim());A&&T&&(L[A]=T)}),l.split(";").forEach(C=>{const[A,T]=C.split(":").map(F=>F.trim());A&&T&&(L[A]=T)}),x=Object.entries(L).map(([C,A])=>`${C}: ${A}`).join("; "),d=d.replace(/\s*style\s*=\s*["'][^"']*["']/gi,"")}return`<span${d} style="${x};">`}),t=t.replace(u.get(o,"gi"),"</span>")})}catch{}return t},replaceBlockElementsWithTables:(a,e)=>{if(!R.isValidHtml(a))return a;let t=a;try{Array.isArray(e)&&e.forEach(i=>{const s=j.TAG_OPENING(i),n=j.TAG_CLOSING(i);t=t.replace(u.get(s),'<table cellpadding="0" cellspacing="0" border="0"$1><tr><td valign="top">'),t=t.replace(u.get(n),"</td></tr></table>")})}catch{}return t},removeDangerousTags:(a,e)=>{if(!R.isValidHtml(a))return a;let t=a;try{Array.isArray(e)&&e.forEach(i=>{const s=j.TAG_WITH_CONTENT(i),n=j.TAG_SELF_CLOSING(i);t=t.replace(u.get(s,ye.GLOBAL_CASE_INSENSITIVE_DOTALL),""),t=t.replace(u.get(n),"")})}catch{}return t},cleanupTableNesting:(a,e=10)=>{if(!R.isValidHtml(a))return a;let t=a;try{let i,s=0;do i=t,t=t.replace(u.get(j.TABLE_NESTED_EXCESSIVE),"<table$1><tr><td$2>"),t=t.replace(u.get(j.TABLE_NESTED_CLOSING),"</td></tr></table>"),s++;while(i!==t&&s<e);t=t.replace(u.get(j.TABLE_EMPTY),""),t=t.replace(u.get(j.TABLE_SINGLE_SPAN_WRAPPER),"$1")}catch{}return t},mergeDuplicateStyles:(a,e=3)=>{if(!R.isValidHtml(a))return a;let t=a;try{let i,s=0;do i=t,t=t.replace(u.get(j.ATTRIBUTE_STYLE_DUPLICATE),(n,o,l,c)=>{var A;const d=o.split(";").filter(T=>T.trim()),h=c.split(";").filter(T=>T.trim()),x=[...d,...h],v=[],L=new Set;for(const T of x.reverse()){const F=(A=T.split(":")[0])==null?void 0:A.trim();F&&!L.has(F)&&(L.add(F),v.unshift(T.trim()))}return`style="${v.join("; ")}"${l}`}),s++;while(i!==t&&s<e)}catch{}return t},removeEmptyElements:a=>{if(!R.isValidHtml(a))return a;let e=a;try{e=e.replace(u.get(j.EMPTY_SPAN),""),e=e.replace(u.get(j.EMPTY_SPAN_WHITESPACE),"")}catch{}return e}},kt={h1:32,h2:24,h3:20,h4:18,h5:16,h6:14},w={"forbidden-tags":{name:"forbidden-tags",displayName:"Forbidden HTML Tags (Legacy)",description:"Legacy rule - replaced by specific rules (heading-tags, paragraph-tags, etc.)",severity:"error",enabled:!1,configurable:!0,category:"structure",config:{allowedTags:jt,forbiddenTags:se},check:(a,e={})=>{const t=[];if(!a||typeof a!="string")return t;try{const s=new Ee(a).parse(),n=e.forbiddenTags||se;W(s,o=>{o.type==="element"&&o.tagName&&Array.isArray(n)&&n.includes(o.tagName)&&t.push({rule:"forbidden-tags",severity:"error",message:`Tag "${o.tagName}" is not email-safe`,line:o.line,column:o.column,suggestion:xe(o.tagName),autoFixAvailable:!0,category:"structure"})})}catch{const s=e.forbiddenTags||se;Array.isArray(s)&&s.forEach(n=>{const o=u.get(`<${n}(?:\\s[^>]*)?>`,"gi"),l=a.match(o);l&&l.forEach(()=>{t.push({rule:"forbidden-tags",severity:"error",message:`Tag "${n}" is not email-safe`,suggestion:xe(n),autoFixAvailable:!0,category:"structure"})})})}return t},checkWithAST:(a,e,t={})=>{const i=[];if(!a||typeof a!="string"||!e)return i;try{const s=t.forbiddenTags||se;W(e,n=>{n.type==="element"&&n.tagName&&Array.isArray(s)&&s.includes(n.tagName)&&i.push({rule:"forbidden-tags",severity:"error",message:`Tag "${n.tagName}" is not email-safe`,line:n.line,column:n.column,suggestion:xe(n.tagName),autoFixAvailable:!0,category:"structure"})})}catch{return w["forbidden-tags"].check(a,t)}return i},autofix:a=>{if(!a||typeof a!="string")return a;let e=a;try{for(let o=1;o<=S.MAX_HEADING_LEVELS;o++){const l=u.get(`<h${o}([^>]*)>`),c=u.get(`</h${o}>`);e=e.replace(l,`<span$1 style="font-weight: bold; font-size: ${$t(o)}px;">`),e=e.replace(c,"</span>")}e=e.replace(u.get("<p([^>]*)>"),"<span$1>"),e=e.replace(u.get("</p>"),"</span>");const t=["div","section","article","nav","header","footer","main","aside","figure","figcaption"],i=(e.match(/<table/g)||[]).length,s=y.MAX_TABLES;i<s&&t.forEach(o=>{const l=u.get(`<${o}((?:\\s[^>]*)?)>`),c=u.get(`</${o}>`);e=e.replace(l,'<table cellpadding="0" cellspacing="0" border="0"$1><tr><td valign="top">'),e=e.replace(c,"</td></tr></table>")}),["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"].forEach(o=>{const l=u.get(`<${o}(?:\\s[^>]*)?>(?:[\\s\\S]*?)</${o}>`,"gi");e=e.replace(l,"");const c=u.get(`<${o}(?:\\s[^>]*)?/>`,"gi");e=e.replace(c,"")});for(let o=0;o<y.MAX_STYLE_MERGE_ITERATIONS;o++){const l=e;if(e=e.replace(u.get('style="([^"]*?)"([^>]*?)style="([^"]*?)"'),(c,d,h,x)=>{var P;const v=d.split(";").filter(D=>D.trim()),L=x.split(";").filter(D=>D.trim()),C=[...v,...L],A=[],T=new Set;for(const D of C){const V=(P=D.split(":")[0])==null?void 0:P.trim();V&&!T.has(V)&&(T.add(V),A.push(D.trim()))}return`style="${A.join("; ")}"${h}`}),l===e)break}for(let o=0;o<y.MAX_AUTOFIX_ITERATIONS;o++){const l=e;if(e=e.replace(u.get("<table([^>]*?)><tr><td([^>]*?)><table([^>]*?)><tr><td([^>]*?)>"),"<table$1><tr><td$2>"),e=e.replace(u.get("<\\/td><\\/tr><\\/table><\\/td><\\/tr><\\/table>"),"</td></tr></table>"),l===e)break}e=e.replace(u.get("<table[^>]*><tr><td[^>]*>\\s*<\\/td><\\/tr><\\/table>"),""),e=e.replace(u.get("<table[^>]*><tr><td[^>]*>(\\s*<span[^>]*>[^<]+<\\/span>\\s*)<\\/td><\\/tr><\\/table>"),"$1"),e=e.replace(u.get("<span[^>]*>\\s*<\\/span>"),""),e=e.replace(u.get("<span[^>]*>[\\s\\t\\n\\r]*<\\/span>"),""),e=e.replace(u.get("\\bs\\s+rc="),"src="),e=e.replace(u.get("\\bS\\s+RC="),"src="),e=e.replace(u.get('="([^"]*)"([a-zA-Z]+=)'),'="$1" $2'),e=e.replace(u.get('(<img[^>]*?)([a-zA-Z0-9_.-]+")([a-zA-Z]+=)'),"$1$2 $3")}catch{}return e=e.replace(u.get("\\bs\\s+rc="),"src="),e=e.replace(u.get("\\bS\\s+RC="),"src="),e}},"email-safe-tags":{name:"email-safe-tags",displayName:"Email-Safe Tag Format",description:"Ensures tags are formatted correctly for email clients",severity:"error",enabled:!0,configurable:!1,category:"structure",check:a=>{const e=[];if(!a||typeof a!="string")return e;try{["br","hr"].forEach(s=>{const n=u.get(`<${s}\\s*[^>]*><\\/${s}>`),o=a.match(n);o&&o.forEach(()=>{e.push({rule:"email-safe-tags",severity:"error",message:`Tag "${s}" should not have closing tag in emails`,suggestion:`Replace <${s}></${s}> with <${s}>`,autoFixAvailable:!0,category:"structure"})});const l=u.get(`<${s}\\s*[^>]*\\/>`),c=a.match(l);c&&c.forEach(()=>{e.push({rule:"email-safe-tags",severity:"error",message:`Tag "${s}" should be open tag in emails, not self-closing`,suggestion:`Replace <${s}/> with <${s}>`,autoFixAvailable:!0,category:"structure"})})}),["img"].forEach(s=>{const n=u.get(`<${s}\\s*[^>]*><\\/${s}>`),o=a.match(n);o&&o.forEach(()=>{e.push({rule:"email-safe-tags",severity:"error",message:`Tag "${s}" should be self-closing`,suggestion:`Replace <${s}></${s}> with <${s} />`,autoFixAvailable:!0,category:"structure"})})})}catch{}return e},autofix:a=>{if(!a||typeof a!="string")return a;try{const e=new be;return e.add(u.get("<br\\s*[^>]*><\\/br>"),"<br>").add(u.get("<br\\s*[^>]*\\/>"),"<br>").add(u.get("<hr\\s*[^>]*><\\/hr>"),"<hr>").add(u.get("<hr\\s*[^>]*\\/>"),"<hr>").add(u.get("<img\\s*([^>]*?)><\\/img>"),"<img $1 />").add(u.get("<br\\/\\s*\\/>"),"<br>").add(u.get("<br\\s*\\/\\s*\\/>"),"<br>").add(u.get("<hr\\/\\s*\\/>"),"<hr>").add(u.get("<hr\\s*\\/\\s*\\/>"),"<hr>").add(u.get("(<img[^>]*?)\\s*\\/\\s*([^>]*?)>"),"$1$2 />").add(u.get(`(<img[^>]*?)([^"'])\\s*\\/\\s*([^>]*?)>`),"$1$2$3 />").add(u.get("<img([^>]*?)([^/])\\s*\\/\\s*\\/\\s*>"),"<img$1$2 />").add(u.get("(<img[^>]*?)\\s+\\/>","g"),"$1 />").add(u.get("(<img[^>]*?)([a-zA-Z])([a-zA-Z]+=)"),"$1$2 $3").add(u.get("\\s+(style|alt|src|class|width|height)=")," $1=").add(u.get(`=\\s*([^"'\\s>]+)`),'="$1"').add(u.get("\\s+>","gi"),">").add(u.get("<\\s+","gi"),"<").add(u.get("\\bs\\s+rc="),"src=").add(u.get("\\bS\\s+RC="),"src="),e.execute(a)}catch{return a}}},"table-attributes":{name:"table-attributes",displayName:"Required Table Attributes",description:"Ensures tables have required email-safe attributes",severity:"error",enabled:!0,configurable:!0,category:"structure",config:{requiredAttributes:Mt},check:a=>{const e=[];if(!a||typeof a!="string")return e;try{const i=new Ee(a).parse();te(i,"table").forEach(o=>{const l=o.attributes||{};(!l.cellpadding||l.cellpadding!=="0")&&e.push({rule:"table-attributes",severity:"error",message:'Table should have cellpadding="0"',line:o.line,column:o.column,suggestion:'Add cellpadding="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!l.cellspacing||l.cellspacing!=="0")&&e.push({rule:"table-attributes",severity:"error",message:'Table should have cellspacing="0"',line:o.line,column:o.column,suggestion:'Add cellspacing="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!l.border||l.border!=="0")&&e.push({rule:"table-attributes",severity:"error",message:'Table should have border="0"',line:o.line,column:o.column,suggestion:'Add border="0" to table tag',autoFixAvailable:!0,category:"structure"})}),te(i,"img").forEach(o=>{const l=o.attributes||{};l.alt||e.push({rule:"table-attributes",severity:"error",message:"Image must have alt attribute",line:o.line,column:o.column,suggestion:'Add alt="" to img tag',autoFixAvailable:!0,category:"accessibility"}),l.width||e.push({rule:"table-attributes",severity:"error",message:"Image must have width attribute",line:o.line,column:o.column,suggestion:`Add width="${y.DEFAULT_IMAGE_WIDTH}" to img tag`,autoFixAvailable:!0,category:"structure"}),l.height||e.push({rule:"table-attributes",severity:"error",message:"Image must have height attribute",line:o.line,column:o.column,suggestion:`Add height="${y.DEFAULT_IMAGE_HEIGHT}" to img tag`,autoFixAvailable:!0,category:"structure"}),(!l.style||!l.style.includes("display:block"))&&e.push({rule:"table-attributes",severity:"error",message:'Image must have style="display:block"',line:o.line,column:o.column,suggestion:'Add style="display:block" to img tag',autoFixAvailable:!0,category:"structure"})})}catch{e.push({rule:"table-attributes",severity:"warning",message:"Unable to parse HTML for detailed checking",suggestion:'Check table attributes manually: cellpadding="0" cellspacing="0" border="0"',autoFixAvailable:!1,category:"structure"})}return e},checkWithAST:(a,e,t,i)=>{const s=[];if(!a||typeof a!="string"||!e)return s;try{((i==null?void 0:i.findNodesByTag("table"))||te(e,"table")).forEach(l=>{const c=l.attributes||{};(!c.cellpadding||c.cellpadding!=="0")&&s.push({rule:"table-attributes",severity:"error",message:'Table should have cellpadding="0"',line:l.line,column:l.column,suggestion:'Add cellpadding="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!c.cellspacing||c.cellspacing!=="0")&&s.push({rule:"table-attributes",severity:"error",message:'Table should have cellspacing="0"',line:l.line,column:l.column,suggestion:'Add cellspacing="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!c.border||c.border!=="0")&&s.push({rule:"table-attributes",severity:"error",message:'Table should have border="0"',line:l.line,column:l.column,suggestion:'Add border="0" to table tag',autoFixAvailable:!0,category:"structure"})}),((i==null?void 0:i.findNodesByTag("img"))||te(e,"img")).forEach(l=>{const c=l.attributes||{};c.alt||s.push({rule:"table-attributes",severity:"error",message:"Image must have alt attribute",line:l.line,column:l.column,suggestion:'Add alt="" to img tag',autoFixAvailable:!0,category:"accessibility"}),c.width||s.push({rule:"table-attributes",severity:"error",message:"Image must have width attribute",line:l.line,column:l.column,suggestion:`Add width="${y.DEFAULT_IMAGE_WIDTH}" to img tag`,autoFixAvailable:!0,category:"structure"}),c.height||s.push({rule:"table-attributes",severity:"error",message:"Image must have height attribute",line:l.line,column:l.column,suggestion:`Add height="${y.DEFAULT_IMAGE_WIDTH}" to img tag`,autoFixAvailable:!0,category:"structure"}),(!c.style||!c.style.includes("display:block"))&&s.push({rule:"table-attributes",severity:"error",message:'Image must have style="display:block"',line:l.line,column:l.column,suggestion:'Add style="display:block" to img tag',autoFixAvailable:!0,category:"structure"})})}catch{return w["table-attributes"].check(a)}return s},autofix:a=>{if(!a||typeof a!="string")return a;let e=a;try{e=e.replace(/<table([^>]*?)>/gi,(t,i)=>{let s=i;return s=s.replace(/cellpadding="[^"]*"/gi,'cellpadding="0"'),s=s.replace(/cellspacing="[^"]*"/gi,'cellspacing="0"'),s=s.replace(/border="[^"]*"/gi,'border="0"'),s.includes("cellpadding=")||(s+=' cellpadding="0"'),s.includes("cellspacing=")||(s+=' cellspacing="0"'),s.includes("border=")||(s+=' border="0"'),`<table${s}>`}),e=e.replace(/<td([^>]*?)>/gi,(t,i)=>{let s=i;return s=s.replace(/valign="(middle|bottom|baseline)"/gi,'valign="top"'),s.includes("valign=")||(s+=' valign="top"'),`<td${s}>`}),e=e.replace(/<img([^>]*?)(\s*\/?\s*)>/gi,(t,i)=>{let s=i;return s.includes("width=")||(s+=` width="${y.DEFAULT_IMAGE_WIDTH}"`),s.includes("height=")||(s+=` height="${y.DEFAULT_IMAGE_HEIGHT}"`),s.includes("width: 100%")&&!s.includes("max-width:")&&(s=s.replace(/style="([^"]*?)width:\s*100%([^"]*?)"/gi,(n,o,l)=>{const c=o.trim(),d=l.trim(),h=c&&!c.endsWith(";")?"; ":"",x=d&&!d.startsWith(";")?"; ":"";return`style="${c}${h}max-width:100%${x}${d}"`})),s.includes("style=")?s.includes("display:block")||(s=s.replace(/style="([^"]*?)"/gi,(n,o)=>{const l=o.trim(),c=l&&!l.endsWith(";")?"; ":"";return`style="${l}${c}display:block"`})):s+=' style="display:block"',`<img${s} />`})}catch{}return e}},"email-safe-links":{name:"email-safe-links",displayName:"Email-Safe Links",description:"Ensures links are formatted correctly for email clients",severity:"error",enabled:!0,configurable:!1,category:"structure",check:a=>{const e=[];if(!a||typeof a!="string")return e;try{const t=/<a[^>]*href\s*=\s*["']?\s*["']?[^>]*>/gi;for(const o of a.matchAll(t))(o[0].includes('href=""')||o[0].includes("href=''"))&&e.push({rule:"email-safe-links",severity:"error",message:"Link has empty href attribute",suggestion:"Remove empty links or provide valid href",autoFixAvailable:!0,category:"structure"});const i=/<a[^>]*target\s*=\s*["'](_self|_parent|_top)["'][^>]*>/gi;for(const o of a.matchAll(i))e.push({rule:"email-safe-links",severity:"warning",message:`Link target "${o[1]}" doesn't work in most email clients`,suggestion:'Use target="_blank" for all email links',autoFixAvailable:!0,category:"compatibility"});const s=/<a[^>]*href\s*=\s*["'][^"']*["'][^>]*(?!target\s*=)[^>]*>/gi;for(const o of a.matchAll(s))o[0].includes("target=")||e.push({rule:"email-safe-links",severity:"warning",message:'Link should have target="_blank" in emails',suggestion:'Add target="_blank" to all email links',autoFixAvailable:!0,category:"best-practice"});const n=/<a[^>]*href\s*=\s*["'][^"']*["'][^>]*(?!style\s*=)[^>]*>/gi;for(const o of a.matchAll(n))o[0].includes("style=")||e.push({rule:"email-safe-links",severity:"warning",message:"Link should have inline styles for email compatibility",suggestion:'Add style="color:#0000ff; text-decoration:none;" to links',autoFixAvailable:!0,category:"best-practice"})}catch{}return e},autofix:a=>{if(!a||typeof a!="string")return a;let e=a;try{e=e.replace(/<a\b([^>]*?)href\s*=\s*["']?\s*["']?([^>]*?)>/gi,(t,i,s)=>t.includes('href=""')||t.includes("href=''")||t.includes("href= ")?`<a${i} href="${Fe.DEFAULT_HREF_VALUE}"${s}>`:t),e=e.replace(/<a\b([^>]*?)target\s*=\s*["'](_self|_parent|_top)["']([^>]*?)>/gi,'<a$1target="_blank"$3>'),e=e.replace(/<a\b([^>]*)>/gi,(t,i)=>{let s=i;return s=s.replace(/\s+href\s+([^"\s>]+)/gi,' href="$1"'),s=s.replace(/\s+href\s+"([^"]*)"([^>]*)/gi,' href="$1"$2'),s.includes("href=")||(s+=` href="${Fe.DEFAULT_HREF_VALUE}"`),s.includes("target=")||(s+=' target="_blank"'),s.includes("style=")?s.includes("text-decoration:")||(s=s.replace(/style="([^"]*?)"/gi,(n,o)=>{const l=o.trim(),c=l&&!l.endsWith(";")?"; ":"";return`style="${l}${c}text-decoration:none"`})):s+=' style="color:#0000ff; text-decoration:none;"',`<a${s}>`})}catch{}return e}},"email-unsafe-attributes":{name:"email-unsafe-attributes",displayName:"Email-Unsafe Attributes",description:"Removes attributes that don't work or are dangerous in emails",severity:"warning",enabled:!0,configurable:!1,category:"compatibility",check:a=>{const e=[];if(!a||typeof a!="string")return e;try{["id","class","onclick","onload","onmouseover","contenteditable","draggable","data-\\w+"].forEach(i=>{u.get(`\\s${i}\\s*=\\s*["'][^"']*["']`).test(a)&&e.push({rule:"email-unsafe-attributes",severity:"warning",message:`Attribute "${i}" may not work in email clients`,suggestion:"Remove or replace with inline styles",autoFixAvailable:!0,category:"compatibility"})})}catch{}return e},autofix:a=>{if(!a||typeof a!="string")return a;try{const e=new be;return["id","class","onclick","onload","onmouseover","onmouseout","onfocus","onblur","contenteditable","draggable","spellcheck","tabindex","accesskey","data-[\\w-]+","aria-[\\w-]+"].forEach(i=>{e.add(u.get(`\\s${i}\\s*=\\s*["'][^"']*["']`),"")}),e.add(u.get("\\s+>","g"),">").add(u.get("\\s{2,}","g")," "),e.execute(a)}catch{return a}}},"heading-tags":{name:"heading-tags",displayName:"Heading Tags Replacement",description:"Replaces h1-h6 tags with styled spans for email compatibility",severity:"error",enabled:!0,configurable:!1,category:"structure",check:a=>{const e=[];if(!R.isValidHtml(a))return e;try{for(let t=1;t<=S.MAX_HEADING_LEVELS;t++){const i=j.TAG_OPENING(`h${t}`);R.findPatternMatches(a,i).forEach(()=>{e.push(R.createValidationResult("heading-tags","error",`Heading tag h${t} is not email-safe`,`Replace h${t} with styled span`,"structure"))})}}catch{}return e},checkWithAST:(a,e)=>{const t=[];if(!R.isValidHtml(a)||!e)return t;try{const i=["h1","h2","h3","h4","h5","h6"];R.checkForbiddenTagsAST(e,i,"heading-tags",s=>{t.push(R.createValidationResult("heading-tags","error",`Heading tag ${s.tagName} is not email-safe`,`Replace ${s.tagName} with styled span`,"structure",s.line,s.column))})}catch{return w["heading-tags"].check(a)}return t},autofix:a=>{if(!R.isValidHtml(a))return a;try{const e=Object.fromEntries(Object.entries(kt).map(([t,i])=>[t,{fontSize:i,fontWeight:"bold"}]));return Ht.replaceTagsWithSpans(a,e)}catch{return a}}},"paragraph-tags":{name:"paragraph-tags",displayName:"Paragraph Tags Replacement",description:"Replaces p tags with spans for email compatibility",severity:"error",enabled:!0,configurable:!1,category:"structure",check:a=>{const e=[];if(!R.isValidHtml(a))return e;try{const t=j.TAG_OPENING("p");R.findPatternMatches(a,t).forEach(()=>{e.push(R.createValidationResult("paragraph-tags","error","Paragraph tag is not email-safe","Replace p with span","structure"))})}catch{}return e},checkWithAST:(a,e)=>{const t=[];if(!a||typeof a!="string"||!e)return t;try{W(e,i=>{i.type==="element"&&i.tagName==="p"&&t.push({rule:"paragraph-tags",severity:"error",message:"Paragraph tag is not email-safe",line:i.line,column:i.column,suggestion:"Replace p with span",autoFixAvailable:!0,category:"structure"})})}catch{return w["paragraph-tags"].check(a)}return t},autofix:a=>{if(!a||typeof a!="string")return a;let e=a;try{e=e.replace(u.get("<p([^>]*)>"),"<span$1>"),e=e.replace(u.get("</p>"),"</span>")}catch{}return e}},"block-element-tags":{name:"block-element-tags",displayName:"Block Element Tags Replacement",description:"Replaces block elements (div, section, etc.) with table structure for email compatibility",severity:"error",enabled:!0,configurable:!0,category:"structure",config:{blockTags:["div","section","article","nav","header","footer","main","aside","figure","figcaption"]},check:(a,e={})=>{const t=[];if(!a||typeof a!="string")return t;try{const i=e.blockTags||["div","section","article","nav","header","footer","main","aside","figure","figcaption"];Array.isArray(i)&&i.forEach(s=>{const n=u.get(`<${s}(?:\\s[^>]*)?>`,"gi"),o=a.match(n);o&&o.forEach(()=>{t.push({rule:"block-element-tags",severity:"error",message:`Block element "${s}" is not email-safe`,suggestion:`Replace ${s} with table structure`,autoFixAvailable:!0,category:"structure"})})})}catch{}return t},checkWithAST:(a,e,t={})=>{const i=[];if(!a||typeof a!="string"||!e)return i;try{const s=t.blockTags||["div","section","article","nav","header","footer","main","aside","figure","figcaption"];W(e,n=>{n.type==="element"&&n.tagName&&Array.isArray(s)&&s.includes(n.tagName)&&i.push({rule:"block-element-tags",severity:"error",message:`Block element "${n.tagName}" is not email-safe`,line:n.line,column:n.column,suggestion:`Replace ${n.tagName} with table structure`,autoFixAvailable:!0,category:"structure"})})}catch{return w["block-element-tags"].check(a,t)}return i},autofix:(a,e={})=>{if(!a||typeof a!="string")return a;let t=a;try{const i=e.blockTags||["div","section","article","nav","header","footer","main","aside","figure","figcaption"];if(Array.isArray(i)){const s=(t.match(/<table/g)||[]).length,n=y.MAX_TABLES;s<n&&i.forEach(o=>{const l=u.get(`<${o}([^>]*)>`),c=u.get(`</${o}>`);t=t.replace(l,'<table cellpadding="0" cellspacing="0" border="0"$1><tr><td valign="top">'),t=t.replace(c,"</td></tr></table>")})}}catch{}return t}},"dangerous-tags":{name:"dangerous-tags",displayName:"Dangerous Tags Removal",description:"Removes dangerous/unsupported tags (script, style, form, etc.) completely",severity:"error",enabled:!0,configurable:!0,category:"structure",config:{dangerousTags:["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"]},check:(a,e={})=>{const t=[];if(!a||typeof a!="string")return t;try{const i=e.dangerousTags||["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"];Array.isArray(i)&&i.forEach(s=>{const n=u.get(`<${s}(?:\\s[^>]*)?>`,"gi"),o=a.match(n);o&&o.forEach(()=>{t.push({rule:"dangerous-tags",severity:"error",message:`Dangerous tag "${s}" should be removed`,suggestion:`Remove ${s} tag completely`,autoFixAvailable:!0,category:"structure"})})})}catch{}return t},checkWithAST:(a,e,t={})=>{const i=[];if(!a||typeof a!="string"||!e)return i;try{const s=t.dangerousTags||["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"];W(e,n=>{n.type==="element"&&n.tagName&&Array.isArray(s)&&s.includes(n.tagName)&&i.push({rule:"dangerous-tags",severity:"error",message:`Dangerous tag "${n.tagName}" should be removed`,line:n.line,column:n.column,suggestion:`Remove ${n.tagName} tag completely`,autoFixAvailable:!0,category:"structure"})})}catch{return w["dangerous-tags"].check(a,t)}return i},autofix:(a,e={})=>{if(!a||typeof a!="string")return a;let t=a;try{const i=e.dangerousTags||["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"];Array.isArray(i)&&i.forEach(s=>{const n=u.get(`<${s}(?:\\s[^>]*)?>(?:[\\s\\S]*?)</${s}>`,"gi");t=t.replace(n,"");const o=u.get(`<${s}(?:\\s[^>]*)?/>`,"gi");t=t.replace(o,"")})}catch{}return t}},"duplicate-styles":{name:"duplicate-styles",displayName:"Duplicate Style Attributes Cleanup",description:"Merges duplicate style attributes in HTML elements",severity:"warning",enabled:!0,configurable:!1,category:"best-practice",check:a=>{const e=[];if(!a||typeof a!="string")return e;try{u.get('style="([^"]*?)"([^>]*?)style="([^"]*?)"').test(a)&&e.push({rule:"duplicate-styles",severity:"warning",message:"Duplicate style attributes found",suggestion:"Merge duplicate style attributes",autoFixAvailable:!0,category:"best-practice"})}catch{}return e},autofix:a=>{if(!a||typeof a!="string")return a;let e=a;try{for(let t=0;t<y.MAX_STYLE_MERGE_ITERATIONS;t++){const i=e;if(e=e.replace(u.get('style="([^"]*?)"([^>]*?)style="([^"]*?)"'),(s,n,o,l)=>{var C;const c=n.split(";").filter(A=>A.trim()),d=l.split(";").filter(A=>A.trim()),h=[...c,...d],x=[],v=new Set;for(const A of h.reverse()){const T=(C=A.split(":")[0])==null?void 0:C.trim();T&&!v.has(T)&&(v.add(T),x.unshift(A.trim()))}return`style="${x.join("; ")}"${o}`}),i===e)break}}catch{}return e}},"table-nesting-cleanup":{name:"table-nesting-cleanup",displayName:"Table Nesting Cleanup",description:"Reduces excessive table nesting for better email rendering",severity:"warning",enabled:!0,configurable:!0,category:"structure",config:{maxIterations:y.MAX_AUTOFIX_ITERATIONS},check:a=>{const e=[];if(!a||typeof a!="string")return e;try{u.get("<table([^>]*?)><tr><td([^>]*?)><table([^>]*?)><tr><td([^>]*?)>").test(a)&&e.push({rule:"table-nesting-cleanup",severity:"warning",message:"Excessive table nesting detected",suggestion:"Reduce table nesting for better email compatibility",autoFixAvailable:!0,category:"structure"})}catch{}return e},autofix:(a,e={})=>{if(!a||typeof a!="string")return a;let t=a;try{const i=typeof e.maxIterations=="number"?e.maxIterations:y.MAX_AUTOFIX_ITERATIONS;for(let s=0;s<i;s++){const n=t;if(t=t.replace(u.get("<table([^>]*?)><tr><td([^>]*?)><table([^>]*?)><tr><td([^>]*?)>"),"<table$1><tr><td$2>"),t=t.replace(u.get("<\\/td><\\/tr><\\/table><\\/td><\\/tr><\\/table>"),"</td></tr></table>"),n===t)break}t=t.replace(u.get("<table[^>]*><tr><td[^>]*>\\s*<\\/td><\\/tr><\\/table>"),""),t=t.replace(u.get("<table[^>]*><tr><td[^>]*>(\\s*<span[^>]*>[^<]+<\\/span>\\s*)<\\/td><\\/tr><\\/table>"),"$1")}catch{}return t}},"empty-elements-cleanup":{name:"empty-elements-cleanup",displayName:"Empty Elements Cleanup",description:"Removes empty and whitespace-only elements",severity:"info",enabled:!0,configurable:!1,category:"best-practice",check:a=>{const e=[];if(!a||typeof a!="string")return e;try{u.get("<span[^>]*>\\s*<\\/span>").test(a)&&e.push({rule:"empty-elements-cleanup",severity:"info",message:"Empty elements found",suggestion:"Remove empty and whitespace-only elements",autoFixAvailable:!0,category:"best-practice"})}catch{}return e},autofix:a=>{if(!a||typeof a!="string")return a;let e=a;try{e=e.replace(u.get("<span[^>]*>\\s*<\\/span>"),""),e=e.replace(u.get("<span[^>]*>[\\s\\t\\n\\r]*<\\/span>"),"")}catch{}return e}},"malformed-attributes":{name:"malformed-attributes",displayName:"Malformed Attributes Fix",description:'Fixes malformed attributes like "s rc" to "src"',severity:"error",enabled:!0,configurable:!1,category:"structure",check:a=>{const e=[];if(!a||typeof a!="string")return e;try{u.get("\\bs\\s+rc=").test(a)&&e.push({rule:"malformed-attributes",severity:"error",message:'Malformed "s rc" attribute found',suggestion:'Fix "s rc" to "src"',autoFixAvailable:!0,category:"structure"}),u.get('="([^"]*)"([a-zA-Z]+=)').test(a)&&e.push({rule:"malformed-attributes",severity:"error",message:"Missing spaces between attributes",suggestion:"Add spaces between attributes",autoFixAvailable:!0,category:"structure"})}catch{}return e},autofix:a=>{if(!a||typeof a!="string")return a;let e=a;try{const t=new be;t.add(u.get("\\bs\\s+rc="),"src=").add(u.get("\\bS\\s+RC="),"src=").add(u.get('="([^"]*)"([a-zA-Z]+=)'),'="$1" $2').add(u.get('(<img[^>]*?)([a-zA-Z0-9_.-]+")([a-zA-Z]+=)'),"$1$2 $3"),e=t.execute(e)}catch{}return e}},"image-alt-attributes":{name:"image-alt-attributes",displayName:"Image Alt Attributes",description:"Ensures all images have meaningful alt attributes for accessibility",severity:"warning",enabled:!0,configurable:!1,category:"accessibility",check:a=>{const e=[],t=a.match(/<img(?![^>]*\salt\s*=\s*["'][^"']+["'])[^>]*>/gi);t&&t.forEach(()=>{e.push({rule:"image-alt-attributes",severity:"error",message:"Image missing meaningful alt attribute for accessibility",line:0,column:0})});const i=a.match(/<img[^>]*alt\s*=\s*["']?\s*["'][^>]*>/gi);return i&&i.forEach(()=>{e.push({rule:"image-alt-attributes",severity:"warning",message:"Image has empty alt attribute - should be descriptive",line:0,column:0})}),e},autofix:a=>{if(!a||typeof a!="string")return a;let e=a;try{e=e.replace(/<img([^>]*?)(\s*\/?\s*)>/gi,(t,i)=>{var l;let s=i;const n=i.match(/src\s*=\s*["']([^"']+)["']/i);let o=y.DEFAULT_ALT_TEXT;if(n){const c=(l=n[1].split("/").pop())==null?void 0:l.split(".")[0];c&&(o=c.replace(/[_-]/g," ").replace(/\b\w/g,d=>d.toUpperCase()))}return s=s.replace(/\s*alt\s*=\s*["'][^"']*["']/gi,""),s+=` alt="${o}"`,`<img${s} />`})}catch{}return e}}};function xe(a){return{div:"Use <table><tr><td>content</td></tr></table>",p:"Use <span>content</span>",h1:`Use <span style="font-weight:bold; font-size:${y.HEADING_FONT_SIZES.h1}px;">content</span>`,h2:`Use <span style="font-weight:bold; font-size:${y.HEADING_FONT_SIZES.h2}px;">content</span>`,h3:`Use <span style="font-weight:bold; font-size:${y.HEADING_FONT_SIZES.h3}px;">content</span>`,h4:`Use <span style="font-weight:bold; font-size:${y.HEADING_FONT_SIZES.h4}px;">content</span>`,h5:`Use <span style="font-weight:bold; font-size:${y.HEADING_FONT_SIZES.h5}px;">content</span>`,h6:`Use <span style="font-weight:bold; font-size:${y.HEADING_FONT_SIZES.h6}px;">content</span>`,section:"Use <table><tr><td>content</td></tr></table>",article:"Use <table><tr><td>content</td></tr></table>",nav:"Use <table><tr><td>content</td></tr></table>",header:"Use <table><tr><td>content</td></tr></table>",footer:"Use <table><tr><td>content</td></tr></table>",main:"Use <table><tr><td>content</td></tr></table>",aside:"Use <table><tr><td>content</td></tr></table>",figure:"Use <table><tr><td>content</td></tr></table>",figcaption:"Use <table><tr><td>content</td></tr></table>",script:"Remove - not supported in emails",style:"Use inline styles instead",form:"Remove - forms not supported in emails",input:"Remove - interactive elements not supported",button:"Use <a> link styled as button",textarea:"Remove - not supported in emails",select:"Remove - not supported in emails",option:"Remove - not supported in emails",fieldset:"Remove - not supported in emails",legend:"Remove - not supported in emails",label:"Remove - not supported in emails",video:"Use static image or GIF instead",audio:"Remove - not supported in emails",canvas:"Use static image instead",svg:"Use PNG/JPG image instead",iframe:"Remove - not supported in emails",embed:"Remove - not supported in emails",object:"Remove - not supported in emails"}[a]||"Replace with email-safe alternative"}function $t(a){return y.HEADING_FONT_SIZES[`h${a}`]||16}class Ne{constructor(e){E(this,"config");E(this,"customRules",new Map);E(this,"fixHistory",new Map);E(this,"maxFixHistorySize",S.MAX_FIX_HISTORY_SIZE);E(this,"cleanupTimer");this.config=e,this.startCleanupTimer()}startCleanupTimer(){this.cleanupTimer&&clearTimeout(this.cleanupTimer),this.cleanupTimer=setTimeout(()=>{this.performCleanup(),this.startCleanupTimer()},wt.TEN_MINUTES_MS)}performCleanup(){const e=Date.now(),t=S.MAX_FIX_HISTORY_AGE_MS;let i=0;for(const[s,n]of this.fixHistory.entries())e-n.timestamp>t&&(this.fixHistory.delete(s),i++);if(this.fixHistory.size>this.maxFixHistorySize){const s=Array.from(this.fixHistory.entries()).sort((o,l)=>o[1].timestamp-l[1].timestamp),n=Math.floor(this.fixHistory.size*S.CACHE_CLEANUP_PERCENTAGE);for(let o=0;o<n&&o<s.length;o++)this.fixHistory.delete(s[o][0]),i++}i>0&&console.log(`AutofixEngine cleanup completed. Cleared ${i} history entries`,{},"AutofixEngine")}autoFix(e){if(!e||typeof e!="string")return{html:"",fixed:[]};if(e.length>this.config.maxHtmlSize){const o=Math.round(this.config.maxHtmlSize/1024),l=Math.round(e.length/1024);return console.warn(`${I.HTML_TOO_LARGE_FOR_AUTOFIX} (${l}KB > ${o}KB), skipping to prevent freezing`,{size:e.length,limit:this.config.maxHtmlSize},"AutofixEngine"),{html:e,fixed:[]}}let t=e;const i=[],s=S.MAX_AUTOFIX_PASSES;let n=0;try{const o=["dangerous-tags","heading-tags","paragraph-tags","block-element-tags","email-safe-tags","malformed-attributes","email-safe-links","image-alt-attributes","table-attributes","email-unsafe-attributes","duplicate-styles","table-nesting-cleanup","empty-elements-cleanup"];for(let l=0;l<s;l++){let c=0;const d=t;for(const v of o){const{html:L,fixed:C}=this.applySingleFix(t,v);if(C&&(t=L,i.includes(v)||i.push(v),c++,n++,t.length>e.length*S.MAX_HTML_SIZE_INCREASE_MULTIPLIER)){console.warn(`HTML size increased too much during autofix, stopping pass ${l+1}`,{originalSize:e.length,newSize:t.length,pass:l+1},"AutofixEngine");break}}const h=this.applyRemainingFixes(t,o,i,S.MAX_AUTOFIX_ITERATIONS);h.iterations>0&&(t=h.html,c+=h.iterations,n+=h.iterations);const x=this.applyCustomFixes(t,i,S.MAX_AUTOFIX_ITERATIONS);if(x.iterations>0&&(t=x.html,c+=x.iterations,n+=x.iterations),console.log(`Pass ${l+1}: Applied ${c} fixes`,{pass:l+1,changes:c},"AutofixEngine"),c===0||t===d){console.log(`No more changes after pass ${l+1}, stopping`,{totalPasses:l+1},"AutofixEngine");break}}return this.recordFixHistory(e,i,n,!0),i.length>0?console.log(`Auto-fix completed with ${n} total changes. Fixed ${i.length} rule types: ${i.join(", ")}`,{totalChanges:n,fixedRules:i},"AutofixEngine"):console.log("No auto-fixes were applied",{},"AutofixEngine"),{html:t,fixed:i}}catch(o){return console.error("Critical auto-fix error",o,"AutofixEngine"),this.recordFixHistory(e,i,n,!1),{html:e,fixed:[]}}}applySingleFix(e,t){const i=w[t],s=this.config.rules[t];if(!(s?s.enabled:i.enabled)||!i.autofix)return{html:e,fixed:!1};try{const o=e,l=i.autofix(e);return o!==l?this.isValidHTMLStructure(l)?{html:l,fixed:!0}:(console.warn(`Fix for rule ${t} produced invalid HTML, reverting`,{},"AutofixEngine"),{html:e,fixed:!1}):{html:e,fixed:!1}}catch(o){return console.error(`Error applying auto-fix for rule ${t}`,o,"AutofixEngine"),{html:e,fixed:!1}}}applyOrderedFixes(e,t,i,s){let n=e,o=0;for(const l of t){if(o>=s)break;const{html:c,fixed:d}=this.applySingleFix(n,l);d&&(n=c,i.push(l),o++,console.log(`Applied auto-fix for rule: ${l}`,{},"AutofixEngine"))}return{html:n,iterations:o}}applyRemainingFixes(e,t,i,s){let n=e,o=0;const l=[];for(const[h,x]of Object.entries(w))if(!t.includes(h)&&x.autofix){const v=this.config.rules[h];(v?v.enabled:x.enabled)&&l.push(h)}let c=!0,d=0;for(;c&&d<3&&o<s;){c=!1,d++;for(const h of l){if(o>=s)break;try{const x=n,{html:v,fixed:L}=this.applySingleFix(n,h);L&&x!==v&&(n=v,i.includes(h)||i.push(h),o++,c=!0,console.log(`Applied remaining auto-fix for rule: ${h} (pass ${d})`,{pass:d,rule:h},"AutofixEngine"))}catch(x){console.error(`Error applying remaining auto-fix for rule ${h}`,x,"AutofixEngine")}}c&&console.log(`Remaining fixes pass ${d} completed with changes`,{pass:d,iterations:o},"AutofixEngine")}return{html:n,iterations:o}}applyCustomFixes(e,t,i){let s=e,n=0;for(const[o,l]of this.customRules.entries()){if(n>=i)break;const c=this.config.rules[o];if(!(!(!c||c.enabled)||!l.autofix))try{const{html:h,fixed:x}=this.applySingleFix(s,o);x&&(s=h,t.push(o),n++,console.log(`Applied custom auto-fix for rule: ${o}`,{},"AutofixEngine"))}catch(h){console.error(`Error applying custom auto-fix for rule ${o}`,h,"AutofixEngine")}}return{html:s,iterations:n}}isValidHTMLStructure(e){if(!e||typeof e!="string")return!1;try{const t=(e.match(/<[^/][^>]*>/g)||[]).length,i=(e.match(/<\/[^>]*>/g)||[]).length,s=(e.match(/<[^>]*\/>/g)||[]).length;return t+i+s===0?!0:!(e.includes("<<")||e.includes(">>")||e.includes("<//")||e.includes("//>"))}catch{return!1}}recordFixHistory(e,t,i,s){const n=`${e.length}_${t.join("_")}`;if(this.fixHistory.set(n,{timestamp:Date.now(),iterations:i,success:s}),this.fixHistory.size>this.maxFixHistorySize){const o=Array.from(this.fixHistory.entries()).sort((c,d)=>c[1].timestamp-d[1].timestamp),l=Math.floor(this.fixHistory.size*S.CACHE_CLEANUP_PERCENTAGE_REDUCED);for(let c=0;c<l&&c<o.length;c++)this.fixHistory.delete(o[c][0])}}autoFixSpecificIssue(e,t){if(!e||typeof e!="string"||!t)return{html:e,fixed:!1};try{const i=w[t]||this.customRules.get(t);if(!i)return console.warn(`Rule ${t} not found`,{},"AutofixEngine"),{html:e,fixed:!1};if(!i.autofix)return console.warn(`Rule ${t} has no autofix function`,{},"AutofixEngine"),{html:e,fixed:!1};const s=this.config.rules[t];if(!(s?s.enabled:i.enabled))return console.warn(`Rule ${t} is disabled`,{},"AutofixEngine"),{html:e,fixed:!1};let o=e,l=!1,c=0;const d=10;for(;c<d;){const h=o;try{const x=i.autofix(o);if(h!==x&&this.isValidHTMLStructure(x))o=x,l=!0,c++,console.log(`Applied fix for rule ${t}, iteration ${c}`,{iteration:c,changed:!0},"AutofixEngine");else break}catch(x){console.error(`Error in iteration ${c+1} for rule ${t}`,x,"AutofixEngine");break}if(o.length>e.length*S.MAX_HTML_SIZE_INCREASE_MULTIPLIER){console.warn(`HTML size increased too much for rule ${t}, stopping`,{originalSize:e.length,newSize:o.length},"AutofixEngine");break}}return l?(console.log(`Successfully fixed issue with rule ${t} in ${c} iterations`,{iterations:c,sizeBefore:e.length,sizeAfter:o.length},"AutofixEngine"),{html:o,fixed:!0}):(console.log(`No changes made for rule ${t}`,{},"AutofixEngine"),{html:e,fixed:!1})}catch(i){return console.error(`Error applying auto-fix for rule ${t}`,i,"AutofixEngine"),{html:e,fixed:!1}}}autoFixMultipleIssues(e,t){if(!e||typeof e!="string"||!Array.isArray(t))return{html:e,fixed:[]};let i=e;const s=[],n=3;try{for(let o=0;o<n;o++){let l=!1;const c=i;for(const d of t){const{html:h,fixed:x}=this.autoFixSpecificIssue(i,d);x&&(i=h,s.includes(d)||s.push(d),l=!0)}if(console.log(`Multiple fixes pass ${o+1}: ${l?"changes made":"no changes"}`,{pass:o+1,hasChanges:l},"AutofixEngine"),!l||i===c)break}return console.log(`Multiple auto-fixes completed. Fixed ${s.length} rule types: ${s.join(", ")}`,{fixedCount:s.length,rules:s},"AutofixEngine"),{html:i,fixed:s}}catch(o){return console.error("Error applying multiple auto-fixes",o,"AutofixEngine"),{html:e,fixed:[]}}}autoFixAllIssues(e,t){if(!e||typeof e!="string")return{html:e,fixed:[]};try{const i=this.getRulesBySeverity(t);return i.length===0?{html:e,fixed:[]}:this.autoFixMultipleIssues(e,i)}catch(i){return console.error(`Error fixing all ${t} issues`,i,"AutofixEngine"),{html:e,fixed:[]}}}autoFixCategory(e,t){if(!e||typeof e!="string"||!t)return{html:e,fixed:[]};try{const i=this.getRulesByCategory(t);return i.length===0?{html:e,fixed:[]}:this.autoFixMultipleIssues(e,i)}catch(i){return console.error(`Error fixing all ${t} issues`,i,"AutofixEngine"),{html:e,fixed:[]}}}getAutoFixableRules(){const e=[];return Object.entries(w).forEach(([t,i])=>{const s=this.config.rules[t],n=s?s.enabled:i.enabled;i.autofix&&n&&e.push(t)}),this.customRules.forEach((t,i)=>{const s=this.config.rules[i],n=s?s.enabled:!0;t.autofix&&n&&e.push(i)}),e}getRulesByCategory(e){const t=[];return Object.entries(w).forEach(([i,s])=>{const n=this.config.rules[i],o=n?n.enabled:s.enabled;s.category===e&&o&&t.push(i)}),this.customRules.forEach((i,s)=>{const n=this.config.rules[s],o=n?n.enabled:!0;i.category===e&&o&&t.push(s)}),t}getRulesBySeverity(e){const t=[];return Object.entries(w).forEach(([i,s])=>{const n=this.config.rules[i],o=n?n.enabled:s.enabled;s.severity===e&&o&&t.push(i)}),this.customRules.forEach((i,s)=>{const n=this.config.rules[s],o=n?n.enabled:!0;i.severity===e&&o&&t.push(s)}),t}addRule(e){if(!e||!e.name){console.warn("Invalid validation rule provided",e,"AutofixEngine");return}this.customRules.set(e.name,e)}removeRule(e){if(!e){console.warn("Invalid rule name provided for removal",e,"AutofixEngine");return}this.customRules.delete(e)}getConfig(){return{...this.config}}updateConfig(e){if(!e){console.warn("Invalid config provided for update",e,"AutofixEngine");return}this.config={...this.config,...e,rules:{...this.config.rules,...e.rules},targetClients:{...this.config.targetClients,...e.targetClients}}}setRuleEnabled(e,t){if(!e){console.warn("Invalid rule name provided for enable/disable",e,"AutofixEngine");return}this.config.rules[e]?this.config.rules[e].enabled=t:this.config.rules[e]={enabled:t}}setRuleSeverity(e,t){if(!e||!t){console.warn("Invalid rule name or severity provided",{ruleName:e,severity:t},"AutofixEngine");return}this.config.rules[e]?this.config.rules[e].severity=t:this.config.rules[e]={enabled:!0,severity:t}}getFixHistoryStats(){const e=Array.from(this.fixHistory.values()),t=e.length,i=e.filter(l=>l.success).length,s=e.reduce((l,c)=>l+c.iterations,0)/t||0,n=e.sort((l,c)=>c.timestamp-l.timestamp).slice(0,S.MAX_RECENT_FIXES_TRACKED),o=n.length>0?n.filter(l=>l.success).length/n.length:0;return{totalFixes:t,successfulFixes:i,averageIterations:Math.round(s*100)/100,recentSuccessRate:Math.round(o*100)/100}}dispose(){this.customRules.clear(),this.fixHistory.clear(),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0),console.log("AutofixEngine disposed and all caches cleared",{},"AutofixEngine")}}class Oe{constructor(e){E(this,"config");E(this,"customRules",new Map);E(this,"traversalCache",new Map);E(this,"maxTraversalCacheSize",y.TRAVERSAL_CACHE_SIZE);E(this,"cacheCleanupTimer");E(this,"cacheAccessCount",new Map);E(this,"cacheLastAccess",new Map);this.config=e,this.startCacheCleanupTimer()}startCacheCleanupTimer(){this.cacheCleanupTimer&&clearTimeout(this.cacheCleanupTimer),this.cacheCleanupTimer=setTimeout(()=>{this.performCacheCleanup(),this.startCacheCleanupTimer()},y.CACHE_CLEANUP_INTERVAL_MS)}performCacheCleanup(){const e=Date.now();let t=0;for(const[i]of this.traversalCache.entries()){const s=`traversal_${i}`,n=this.cacheLastAccess.get(s)||0,o=this.cacheAccessCount.get(s)||0;(e-n>y.CACHE_TTL_MS||o<2)&&(this.traversalCache.delete(i),this.cacheAccessCount.delete(s),this.cacheLastAccess.delete(s),t++)}if(this.customRules.size>S.MAX_CUSTOM_RULES_SIZE){const i=Array.from(this.customRules.entries()),s=Math.floor(this.customRules.size*S.CACHE_CLEANUP_PERCENTAGE_REDUCED);for(let n=0;n<s&&n<i.length;n++)this.customRules.delete(i[n][0]);t+=s}t>0&&console.log(`Cache cleanup completed. Cleared ${t} entries`,{},"ValidationEngine")}getParsedAST(e){if(!e||typeof e!="string")return null;try{let t=B.get(e);return t||(t=new Ee(e).parse(),B.set(e,t)),t}catch(t){return console.error("Error parsing HTML to AST",t,"ValidationEngine"),null}}getTraversalResult(e,t,i){const s=`traversal_${t}`;this.traversalCache.has(t)||this.traversalCache.set(t,new Map);const n=this.traversalCache.get(t);if(n.has(i))return this.cacheAccessCount.set(s,(this.cacheAccessCount.get(s)||0)+1),this.cacheLastAccess.set(s,Date.now()),n.get(i);let o=[];try{switch(t){case"findByTag":o=this.findNodesByTagName(e,i);break;case"findByAttribute":{const[l,c]=i.split("=");o=this.findNodesByAttribute(e,l,c);break}case"findByCategory":o=this.findNodesByCategory(e,i);break;default:o=[]}o.length<=S.MAX_TRAVERSAL_RESULTS&&(n.set(i,o),this.cacheAccessCount.set(s,1),this.cacheLastAccess.set(s,Date.now()),n.size>this.maxTraversalCacheSize&&this.cleanupOperationCache(t,n))}catch(l){console.error(`Error in traversal operation ${t}`,l,"ValidationEngine"),o=[]}return o}cleanupOperationCache(e,t){const i=Array.from(t.entries()).map(([n,o])=>({key:n,nodes:o,accessCount:this.cacheAccessCount.get(`traversal_${e}`)||0,lastAccess:this.cacheLastAccess.get(`traversal_${e}`)||0,size:o.length}));i.sort((n,o)=>{const l=n.accessCount*M.TRAVERSAL_ACCESS_COUNT_WEIGHT+(Date.now()-n.lastAccess)/1e3*M.TRAVERSAL_AGE_WEIGHT+n.size/100*M.TRAVERSAL_SIZE_WEIGHT,c=o.accessCount*M.TRAVERSAL_ACCESS_COUNT_WEIGHT+(Date.now()-o.lastAccess)/1e3*M.TRAVERSAL_AGE_WEIGHT+o.size/100*M.TRAVERSAL_SIZE_WEIGHT;return l-c});const s=Math.floor(t.size*S.CACHE_CLEANUP_PERCENTAGE_LARGE);for(let n=0;n<s&&n<i.length;n++)t.delete(i[n].key)}findNodesByTagName(e,t){const i=[],s=S.MAX_TRAVERSAL_RESULTS,n=o=>{for(const l of o){if(i.length>=s)break;l.type==="element"&&l.tagName===t.toLowerCase()&&i.push(l),l.children&&Array.isArray(l.children)&&n(l.children)}};return n(e),i}findNodesByAttribute(e,t,i){const s=[],n=S.MAX_TRAVERSAL_RESULTS,o=l=>{var c;for(const d of l){if(s.length>=n)break;d.type==="element"&&((c=d.attributes)!=null&&c[t])&&(!i||d.attributes[t]===i)&&s.push(d),d.children&&Array.isArray(d.children)&&o(d.children)}};return o(e),s}findNodesByCategory(e,t){const i=[],s=S.MAX_TRAVERSAL_RESULTS,n=o=>{for(const l of o){if(i.length>=s)break;if(l.type==="element")switch(t){case"tables":l.tagName==="table"&&i.push(l);break;case"images":l.tagName==="img"&&i.push(l);break;case"links":l.tagName==="a"&&i.push(l);break;case"headings":l.tagName&&/^h[1-6]$/.test(l.tagName)&&i.push(l);break;case"block-elements":l.tagName&&["div","p","section","article","nav","header","footer","main","aside"].includes(l.tagName)&&i.push(l);break;case"dangerous":l.tagName&&["script","style","iframe","embed","object"].includes(l.tagName)&&i.push(l);break}l.children&&Array.isArray(l.children)&&n(l.children)}};return n(e),i}clearTraversalCache(){const e=this.traversalCache.size;this.traversalCache.clear(),this.cacheAccessCount.clear(),this.cacheLastAccess.clear(),e>0&&console.log(`Cleared traversal cache with ${e} operations`,{},"ValidationEngine")}validate(e){if(!e||typeof e!="string")return this.createEmptyReport("Invalid HTML input provided");if(e.length>this.config.maxHtmlSize){const s=Math.round(this.config.maxHtmlSize/1024);return this.createEmptyReport(`${I.HTML_TOO_LARGE} (over ${s}KB)`,"html-too-large","performance")}const t=[],i=this.getParsedAST(e);try{t.push(...this.runBuiltInRules(e,i)),t.push(...this.runCustomRules(e,i));const s=t.filter(d=>d.severity==="error"),n=t.filter(d=>d.severity==="warning"),o=t.filter(d=>d.severity==="info"),l=this.calculateCategories(t),c=this.calculateValidationScore(t);return{isValid:s.length===0,errors:s,warnings:n,suggestions:o,autoFixAvailable:t.some(d=>d.autoFixAvailable),totalIssues:t.length,categories:l,score:c}}catch(s){return console.error("Critical validation error",s,"ValidationEngine"),this.createEmptyReport(`Validation system error: ${s instanceof Error?s.message:"Unknown error"}`,"validation-system-error","structure")}finally{this.clearTraversalCache()}}runBuiltInRules(e,t){const i=[];this.clearTraversalCache();for(const[s,n]of Object.entries(w)){const o=this.config.rules[s];if((o?o.enabled:n.enabled)&&!(n.category==="accessibility"&&!this.config.checkAccessibility)&&!(n.category==="performance"&&!this.config.checkPerformance)&&!(n.category==="best-practice"&&!this.config.checkBestPractices))try{let c=[];if(n.checkWithAST&&t){const d={ast:t,getTraversalResult:(h,x)=>this.getTraversalResult(t,h,x),findNodesByTag:h=>this.getTraversalResult(t,"findByTag",h),findNodesByAttribute:(h,x)=>this.getTraversalResult(t,"findByAttribute",`${h}=${x||""}`),findNodesByCategory:h=>this.getTraversalResult(t,"findByCategory",h)};c=n.checkWithAST(e,t,o==null?void 0:o.config,d)}else c=n.check(e,o==null?void 0:o.config);o!=null&&o.severity&&c.forEach(d=>{d.severity=o.severity}),i.push(...c)}catch(c){console.error(`Error running validation rule ${s}`,c,"ValidationEngine"),i.push({rule:s,severity:"error",message:`Validation rule error: ${c instanceof Error?c.message:"Unknown error"}`,category:n.category})}}return i}runCustomRules(e,t){const i=[];for(const[s,n]of this.customRules.entries()){const o=this.config.rules[s];if(!o||o.enabled)try{const c=n.checkWithAST&&t?n.checkWithAST(e,t,o==null?void 0:o.config):n.check(e,o==null?void 0:o.config);o!=null&&o.severity&&c.forEach(d=>{d.severity=o.severity}),i.push(...c)}catch(c){console.error(`Error running custom validation rule ${s}`,c,"ValidationEngine")}}return i}calculateCategories(e){return{structure:e.filter(t=>t.category==="structure").length,accessibility:e.filter(t=>t.category==="accessibility").length,compatibility:e.filter(t=>t.category==="compatibility").length,performance:e.filter(t=>t.category==="performance").length,"best-practice":e.filter(t=>t.category==="best-practice").length}}calculateValidationScore(e){if(e.length===0)return X.MAX_SCORE;let t=0;const i=X.MAX_PENALTY;e.forEach(n=>{switch(n.severity){case"error":t+=X.ERROR_PENALTY;break;case"warning":t+=X.WARNING_PENALTY;break;case"info":t+=X.INFO_PENALTY;break}});const s=Math.max(0,X.MAX_SCORE-Math.min(t,i));return Math.round(s)}createEmptyReport(e,t="invalid-input",i="structure"){return{isValid:!1,errors:[{rule:t,severity:"error",message:e,category:i}],warnings:[],suggestions:[],autoFixAvailable:!1,totalIssues:1,categories:{structure:i==="structure"?1:0,accessibility:0,compatibility:0,performance:i==="performance"?1:0,"best-practice":0},score:0}}addRule(e){if(!e||!e.name){console.warn("Invalid validation rule provided",e,"ValidationEngine");return}this.customRules.set(e.name,e)}removeRule(e){if(!e){console.warn("Invalid rule name provided for removal",e,"ValidationEngine");return}this.customRules.delete(e)}getAvailableRules(){const e={...w};return this.customRules.forEach((t,i)=>{e[i]=t}),e}testRule(e,t){if(!e||!t)return console.warn("Invalid parameters for testRule",{ruleName:e,html:typeof t},"ValidationEngine"),[];const i=w[e]||this.customRules.get(e);if(!i)throw new Error(`Rule "${e}" not found`);const s=this.config.rules[e];return i.check(t,s==null?void 0:s.config)}getCompatibilityReport(e){if(!e||typeof e!="string")return{};const t={};return Object.keys(this.config.targetClients).forEach(i=>{if(!this.config.targetClients[i])return;const s=[];switch(i){case"outlook":this.validateOutlookCompatibility(e,s);break;case"gmail":this.validateGmailCompatibility(e,s);break;case"mobile":this.validateMobileCompatibility(e,s);break}t[i]={compatible:s.length===0,issues:s}}),t}validateOutlookCompatibility(e,t){(e.includes("flexbox")||e.includes("display: flex"))&&t.push("Flexbox not supported in Outlook"),(e.includes("grid")||e.includes("display: grid"))&&t.push("CSS Grid not supported in Outlook"),(e.includes("position: absolute")||e.includes("position: fixed"))&&t.push("Absolute/fixed positioning not supported in Outlook"),(e.includes("linear-gradient")||e.includes("radial-gradient"))&&t.push("CSS gradients not supported in Outlook")}validateGmailCompatibility(e,t){e.includes("<style>")&&t.push("Gmail may strip <style> tags on mobile"),e.includes("background-image")&&t.push("Background images may not display consistently in Gmail")}validateMobileCompatibility(e,t){e.includes('width="')&&!e.includes("max-width")&&t.push("Fixed widths without max-width may cause horizontal scrolling on mobile"),e.includes("font-size:")&&e.includes("px")&&t.push("Consider using relative font sizes for better mobile experience")}getCacheStats(){return{traversalCacheSize:this.traversalCache.size,astCacheStats:B.getStats(),regexCacheStats:u.getStats()}}dispose(){this.clearTraversalCache(),this.customRules.clear(),this.cacheCleanupTimer&&(clearTimeout(this.cacheCleanupTimer),this.cacheCleanupTimer=void 0),console.log("ValidationEngine disposed and all caches cleared",{},"ValidationEngine")}}class De{constructor(e){E(this,"config");E(this,"validationEngine");E(this,"autofixEngine");E(this,"cleanupInterval");E(this,"isDisposed",!1);E(this,"validationStats",{totalValidations:0,successfulValidations:0,totalAutoFixes:0,successfulAutoFixes:0,lastValidationTime:0,lastAutoFixTime:0});this.config={rules:{},targetClients:{outlook:!0,gmail:!0,applemail:!0,thunderbird:!0,mobile:!0},strictMode:!1,allowModernCSS:!1,maxTableNesting:y.MAX_TABLE_NESTING,checkAccessibility:!0,checkPerformance:!0,checkBestPractices:!0,maxFileSize:y.MAX_FILE_SIZE_KB,maxHtmlSize:y.MAX_HTML_SIZE_BYTES,requireAltText:!0,requireFallbacks:!0,...e},this.initializeDefaultRules(),this.validationEngine=new Oe(this.config),this.autofixEngine=new Ne(this.config),this.setupCleanupInterval()}setupCleanupInterval(){try{this.cleanupInterval=setInterval(()=>{this.performPeriodicCleanup()},y.CACHE_CLEANUP_INTERVAL_MS)}catch(e){console.error("Failed to setup cleanup interval",e,"EmailHTMLValidator")}}performPeriodicCleanup(){try{if(this.isDisposed)return;const e=this.validationEngine.getCacheStats(),t=this.autofixEngine.getFixHistoryStats();if(console.log(`${Y.CACHE_CLEANUP_PREFIX}`,{validationCache:e,autofixHistory:t},"EmailHTMLValidator"),typeof global<"u"&&global.gc)try{global.gc(),console.log(`${Y.GARBAGE_COLLECTION_PREFIX}`,{},"EmailHTMLValidator")}catch{}}catch(e){console.error("Error during periodic cleanup",e,"EmailHTMLValidator")}}initializeDefaultRules(){Object.entries(w).forEach(([t,i])=>{this.config.rules[t]||(this.config.rules[t]={enabled:i.enabled!==!1})}),["email-safe-tags","table-attributes","heading-tags","paragraph-tags","block-element-tags","dangerous-tags","email-safe-links","malformed-attributes"].forEach(t=>{w[t]&&(this.config.rules[t]={enabled:!0})})}validate(e){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);const t=Date.now();this.validationStats.totalValidations++;try{if(!e||typeof e!="string")throw new Error(I.INVALID_HTML_INPUT);if(e.length>this.config.maxHtmlSize){const n=Math.round(this.config.maxHtmlSize/1024),o=Math.round(e.length/1024);throw new Error(`${I.HTML_TOO_LARGE}: ${o}KB exceeds limit of ${n}KB`)}const i=this.validationEngine.validate(e);this.validationStats.successfulValidations++,this.validationStats.lastValidationTime=Date.now();const s=Date.now()-t;return s>S.SLOW_VALIDATION_THRESHOLD_MS&&console.warn(`${Y.SLOW_OPERATION_PREFIX}: ${s}ms for ${e.length} bytes`,{duration:s,htmlSize:e.length,issues:i.totalIssues},"EmailHTMLValidator"),i}catch(i){this.validationStats.lastValidationTime=Date.now(),console.error(`${I.VALIDATION_FAILED}`,i,"EmailHTMLValidator");const s=i instanceof Error?i.message:"Unknown validation error";return{isValid:!1,errors:[{rule:"validation-error",severity:"error",message:`${I.VALIDATION_FAILED}: ${s}`,category:"structure"}],warnings:[],suggestions:[],autoFixAvailable:!1,totalIssues:1,categories:{structure:1,accessibility:0,compatibility:0,performance:0,"best-practice":0},score:0}}}autoFix(e){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);const t=Date.now();this.validationStats.totalAutoFixes++;try{if(!e||typeof e!="string")throw new Error(I.INVALID_HTML_INPUT);if(e.length>this.config.maxHtmlSize){const n=Math.round(this.config.maxHtmlSize/1024),o=Math.round(e.length/1024);throw new Error(`${I.HTML_TOO_LARGE_FOR_AUTOFIX}: ${o}KB exceeds limit of ${n}KB`)}const i=this.autofixEngine.autoFix(e);this.validationStats.successfulAutoFixes++,this.validationStats.lastAutoFixTime=Date.now();const s=Date.now()-t;return s>S.SLOW_AUTOFIX_THRESHOLD_MS&&console.warn(`${Y.SLOW_OPERATION_PREFIX}: ${s}ms for ${e.length} bytes`,{duration:s,htmlSize:e.length,fixedRules:i.fixed.length},"EmailHTMLValidator"),i}catch(i){return this.validationStats.lastAutoFixTime=Date.now(),console.error(`${I.AUTOFIX_FAILED}`,i,"EmailHTMLValidator"),{html:e,fixed:[]}}}autoFixSpecificIssue(e,t){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixSpecificIssue(e,t)}catch(i){return console.error(`Error fixing specific issue with rule ${t}`,i,"EmailHTMLValidator"),{html:e,fixed:!1}}}autoFixMultipleIssues(e,t){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixMultipleIssues(e,t)}catch(i){return console.error("Error fixing multiple issues",i,"EmailHTMLValidator"),{html:e,fixed:[]}}}autoFixAllIssues(e,t){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixAllIssues(e,t)}catch(i){return console.error(`Error fixing all ${t} issues`,i,"EmailHTMLValidator"),{html:e,fixed:[]}}}autoFixCategory(e,t){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixCategory(e,t)}catch(i){return console.error(`Error fixing category ${t} issues`,i,"EmailHTMLValidator"),{html:e,fixed:[]}}}getAutoFixableRules(){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{return this.autofixEngine.getAutoFixableRules()}catch(e){return console.error("Error getting auto-fixable rules",e,"EmailHTMLValidator"),[]}}getRulesByCategory(e){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{return this.autofixEngine.getRulesByCategory(e)}catch(t){return console.error(`Error getting rules for category ${e}`,t,"EmailHTMLValidator"),[]}}addRule(e){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{this.validationEngine.addRule(e),this.autofixEngine.addRule(e),console.log(`Custom rule added: ${e.name}`,{},"EmailHTMLValidator")}catch(t){throw console.error(`Error adding custom rule ${e.name}`,t,"EmailHTMLValidator"),t}}removeRule(e){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{this.validationEngine.removeRule(e),this.autofixEngine.removeRule(e),console.log(`Custom rule removed: ${e}`,{},"EmailHTMLValidator")}catch(t){throw console.error(`Error removing custom rule ${e}`,t,"EmailHTMLValidator"),t}}updateConfig(e){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{if(e.maxHtmlSize&&e.maxHtmlSize<=0)throw new Error("maxHtmlSize must be positive");if(e.maxFileSize&&e.maxFileSize<=0)throw new Error("maxFileSize must be positive");this.config={...this.config,...e,rules:{...this.config.rules,...e.rules},targetClients:{...this.config.targetClients,...e.targetClients}},this.validationEngine.dispose(),this.autofixEngine.dispose(),this.validationEngine=new Oe(this.config),this.autofixEngine=new Ne(this.config),console.log("Configuration updated successfully",{newConfig:e},"EmailHTMLValidator")}catch(t){throw console.error("Error updating configuration",t,"EmailHTMLValidator"),t}}setRuleEnabled(e,t){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);if(!e)throw new Error(I.INVALID_RULE_NAME);try{this.config.rules[e]?this.config.rules[e].enabled=t:this.config.rules[e]={enabled:t},console.log(`Rule ${e} ${t?"enabled":"disabled"}`,{},"EmailHTMLValidator")}catch(i){throw console.error(`Error setting rule ${e} enabled state`,i,"EmailHTMLValidator"),i}}setRuleSeverity(e,t){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);if(!e||!t)throw new Error("Rule name and severity are required");if(!["error","warning","info"].includes(t))throw new Error(I.INVALID_SEVERITY);try{this.config.rules[e]?this.config.rules[e].severity=t:this.config.rules[e]={enabled:!0,severity:t},console.log(`Rule ${e} severity set to ${t}`,{},"EmailHTMLValidator")}catch(i){throw console.error(`Error setting rule ${e} severity`,i,"EmailHTMLValidator"),i}}getConfig(){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);return{...this.config}}getAvailableRules(){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{return this.validationEngine.getAvailableRules()}catch(e){return console.error("Error getting available rules",e,"EmailHTMLValidator"),{}}}testRule(e,t){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{return this.validationEngine.testRule(e,t)}catch(i){return console.error(`Error testing rule ${e}`,i,"EmailHTMLValidator"),[]}}getCompatibilityReport(e){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);try{return this.validationEngine.getCompatibilityReport(e)}catch(t){return console.error("Error generating compatibility report",t,"EmailHTMLValidator"),{}}}getStats(){try{return{validation:{...this.validationStats},cache:{validation:this.validationEngine.getCacheStats(),autofix:this.autofixEngine.getFixHistoryStats()},isDisposed:this.isDisposed}}catch(e){return console.error("Error getting statistics",e,"EmailHTMLValidator"),{validation:this.validationStats,cache:{validation:{},autofix:{}},isDisposed:this.isDisposed}}}resetStats(){if(this.isDisposed)throw new Error(I.VALIDATOR_DISPOSED);this.validationStats={totalValidations:0,successfulValidations:0,totalAutoFixes:0,successfulAutoFixes:0,lastValidationTime:0,lastAutoFixTime:0},console.log(`${Y.STATISTICS_RESET_PREFIX}`,{},"EmailHTMLValidator")}dispose(){if(!this.isDisposed)try{this.config.rules={},this.validationEngine.dispose(),this.autofixEngine.dispose(),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=void 0),this.isDisposed=!0,console.log(`EmailHTMLValidator ${Y.DISPOSAL_PREFIX}`,{},"EmailHTMLValidator")}catch(e){console.error("Error during disposal",e,"EmailHTMLValidator"),this.isDisposed=!0}}isDisposedValidator(){return this.isDisposed}}new De({strictMode:!1,targetClients:{outlook:!0,gmail:!0,applemail:!0,thunderbird:!1,mobile:!0},checkAccessibility:!0,checkPerformance:!0,checkBestPractices:!0,maxFileSize:y.MAX_FILE_SIZE_KB,maxHtmlSize:y.MAX_HTML_SIZE_BYTES,requireAltText:!0,requireFallbacks:!0});const Ft=({html:a,onHtmlChange:e,validator:t,showCompactView:i=!1})=>{var Se;const[s,n]=$.useState(null),[o,l]=$.useState(!1),[c,d]=$.useState(!1),[h,x]=$.useState(0),[v,L]=$.useState(!1),[C,A]=$.useState(!1),[T,F]=$.useState("all"),[P,D]=$.useState("all"),[V,ne]=$.useState(""),z=$.useMemo(()=>t||new De,[t]),Pe=`
<!DOCTYPE html>
<html>
<head>
    <title>Comprehensive Email Validation Test</title>
    <style>
        .test-section {
            border: 1px solid #ccc;
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Comprehensive Email Validation Test Cases</h1>

    <!-- FORBIDDEN TAGS TEST CASES -->
    <div class="test-section">
        <div class="test-title">1. FORBIDDEN TAGS - All variants</div>

        <!-- Basic forbidden elements -->
        <div class="container">This is a div container</div>
        <p class="paragraph">This is a paragraph</p>

        <!-- Heading tags (all levels) -->
        <h1 style="color: red;">Main Heading H1</h1>
        <h2 class="subtitle">Subtitle H2</h2>
        <h3>Sub-subtitle H3</h3>
        <h4>Minor heading H4</h4>
        <h5>Smaller heading H5</h5>
        <h6>Smallest heading H6</h6>

        <!-- Semantic elements -->
        <section class="hero">
            <article>
                <header>
                    <nav>Navigation menu</nav>
                </header>
                <main>
                    <aside>Sidebar content</aside>
                    <figure>
                        <figcaption>Image caption</figcaption>
                    </figure>
                </main>
                <footer>Footer content</footer>
            </article>
        </section>

        <!-- Interactive elements -->
        <form action="/submit">
            <fieldset>
                <legend>Form Legend</legend>
                <label for="input1">Input Label:</label>
                <input type="text" id="input1" name="input1" />
                <textarea name="comments">Comments</textarea>
                <select name="options">
                    <option value="1">Option 1</option>
                </select>
                <button type="submit">Submit</button>
            </fieldset>
        </form>

        <!-- Media elements -->
        <video src="video.mp4">Video content</video>
        <audio src="audio.mp3">Audio content</audio>
        <canvas>Canvas content</canvas>
        <svg>SVG content</svg>
        <iframe src="frame.html">Frame content</iframe>
        <embed src="content.swf" />
        <object data="object.pdf">Object content</object>
        <script>alert('script');<\/script>
    </div>

    <!-- EMAIL-SAFE TAGS TEST CASES -->
    <div class="test-section">
        <div class="test-title">2. EMAIL-SAFE TAGS - All variants</div>

        <!-- Wrong BR tag formats -->
        <br></br>
        <br/>
        <br />
        <br class="break" />
        <br style="clear: both"></br>

        <!-- Wrong HR tag formats -->
        <hr></hr>
        <hr/>
        <hr />
        <hr class="divider" />
        <hr style="border: none"></hr>

        <!-- Wrong IMG tag formats -->
        <img src="image1.jpg"></img>
        <img src="image2.jpg" alt="Image 2"></img>
        <img src="image3.jpg" class="responsive"></img>
        <img src="image4.jpg" style="width: 100%"></img>

        <!-- Other self-closing tags -->
        <area shape="rect" coords="0,0,100,100"></area>
        <base href="http://example.com"></base>
        <col span="2"></col>
        <input type="text" name="test"></input>

        <!-- Correct formats (should not trigger errors) -->
        <br>
        <hr>
        <img src="correct.jpg" alt="Correct" />
        <area shape="rect" coords="0,0,50,50" />
        <base href="http://test.com" />
        <col span="1" />
        <input type="email" name="email" />
    </div>

    <!-- TABLE ATTRIBUTES TEST CASES -->
    <div class="test-section">
        <div class="test-title">3. TABLE ATTRIBUTES - All variants</div>

        <!-- Tables missing required attributes -->
        <table>
            <tr><td>Missing all attributes</td></tr>
        </table>

        <table cellpadding="5">
            <tr><td>Missing cellspacing and border</td></tr>
        </table>

        <table cellspacing="2">
            <tr><td>Missing cellpadding and border</td></tr>
        </table>

        <table border="1">
            <tr><td>Missing cellpadding and cellspacing</td></tr>
        </table>

        <table cellpadding="0" cellspacing="0">
            <tr><td>Missing border</td></tr>
        </table>

        <!-- TD elements missing valign -->
        <table cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td>Missing valign</td>
                <td valign="middle">Wrong valign value</td>
                <td valign="bottom">Another wrong valign</td>
            </tr>
        </table>

        <!-- Images missing attributes -->
        <img src="no-alt.jpg">
        <img src="has-alt.jpg" alt="">
        <img src="no-display-block.jpg" alt="No display block">
        <img src="wrong-style.jpg" alt="Wrong style" style="border: 1px solid;">
        <img src="missing-dimensions.jpg" alt="Missing dimensions" style="display:block">

        <!-- Links missing attributes -->
        <a>Link without href</a>
        <a href="http://example.com">Link without target</a>
        <a href="http://example.com" target="_self">Link with wrong target</a>

        <!-- Correct formats (should not trigger errors) -->
        <table cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td valign="top">Correct table</td>
                <td valign="top">All attributes present</td>
            </tr>
        </table>

        <img src="correct-image.jpg" alt="Correct image" style="display:block" />
        <a href="http://example.com" target="_blank">Correct link</a>
    </div>

    <!-- COMPLEX NESTED CASES -->
    <div class="test-section">
        <div class="test-title">4. COMPLEX NESTED CASES</div>

        <!-- Multiple nesting levels -->
        <div class="outer">
            <section class="middle">
                <article class="inner">
                    <header>
                        <h1>Nested heading</h1>
                        <nav>
                            <div class="menu">
                                <p>Menu item 1</p>
                                <p>Menu item 2</p>
                            </div>
                        </nav>
                    </header>
                    <main>
                        <div class="content">
                            <h2>Content heading</h2>
                            <p>Content paragraph with <br></br> wrong break</p>
                            <img src="nested.jpg"></img>
                            <table>
                                <tr><td>Nested table without attributes</td></tr>
                            </table>
                        </div>
                    </main>
                    <footer>
                        <div class="footer-content">
                            <h3>Footer heading</h3>
                            <p>Footer text</p>
                        </div>
                    </footer>
                </article>
            </section>
        </div>
    </div>

    <!-- EDGE CASES -->
    <div class="test-section">
        <div class="test-title">5. EDGE CASES</div>

        <!-- Empty elements -->
        <div></div>
        <p></p>
        <h1></h1>
        <table><tr><td></td></tr></table>

        <!-- Elements with only whitespace -->
        <div>   </div>
        <p>
        </p>
        <h2>	</h2>

        <!-- Malformed tags -->
        <br/ />
        <br / />
        <br////>
        <img src="malformed.jpg" / alt="test" / />
        <hr/ />
        <hr / />

        <!-- Mixed case tags -->
        <DIV>Mixed case div</DIV>
        <P>Mixed case paragraph</P>
        <BR></BR>
        <IMG SRC="mixed.jpg"></IMG>

        <!-- Tags with unusual attributes -->
        <div data-custom="value" onclick="alert()">Div with data and onclick</div>
        <p contenteditable="true" draggable="true">Editable paragraph</p>
        <h1 id="special" class="heading" style="color: blue; font-size: 24px;">Styled heading</h1>

        <!-- Self-closing variations -->
        <br/>
        <br />
        <br  />
        <br	/>
        <img src="test.jpg" />
        <img src="test.jpg"/>
        <img src="test.jpg"  />
        <img src="test.jpg"	/>
    </div>

    <!-- ATTRIBUTES STRESS TEST -->
    <div class="test-section">
        <div class="test-title">6. ATTRIBUTES STRESS TEST</div>

        <!-- Tables with partial attributes -->
        <table cellpadding="0">
            <tr><td>Only cellpadding</td></tr>
        </table>

        <table cellspacing="0">
            <tr><td>Only cellspacing</td></tr>
        </table>

        <table border="0">
            <tr><td>Only border</td></tr>
        </table>

        <table cellpadding="10" cellspacing="5" border="1">
            <tr><td>Wrong values</td></tr>
        </table>

        <!-- Images with partial attributes -->
        <img src="partial1.jpg" alt="">
        <img src="partial2.jpg" style="display:block">
        <img src="partial3.jpg" alt="Test" width="100">
        <img src="partial4.jpg" alt="Test" height="50">
        <img src="partial5.jpg" alt="Test" style="border: none;">

        <!-- Links with variations -->
        <a href="">Empty href</a>
        <a href="#anchor">Anchor link</a>
        <a href="mailto:test@example.com">Mailto link</a>
        <a href="tel:+1234567890">Tel link</a>
        <a href="http://example.com" target="_parent">Wrong target parent</a>
        <a href="http://example.com" target="_top">Wrong target top</a>
    </div>
</body>
</html>
  `;$.useEffect(()=>{if(!a||!a.trim()){n(null);return}L(!0);const f=setTimeout(()=>{try{const g=z.validate(a);n(g)}catch(g){console.error("Validation error",g);const m=g&&typeof g=="object"&&"message"in g?g.message:"Unknown error";n({isValid:!1,errors:[{rule:"validation-error",severity:"error",message:`Validation failed: ${m}`,category:"structure"}],warnings:[],suggestions:[],autoFixAvailable:!1,totalIssues:1,categories:{structure:1,accessibility:0,compatibility:0,performance:0,"best-practice":0},score:0})}finally{L(!1)}},300);return()=>clearTimeout(f)},[a,z]);const Ve=async()=>{if(!(s!=null&&s.autoFixAvailable)||!e){console.warn("Auto-fix not available or no onHtmlChange callback",{},"EmailValidationPanel");return}A(!0);try{const{html:f,fixed:g}=z.autoFix(a);g.length>0?(e(f),alert(`Successfully fixed ${g.length} issues:
${g.join(`
`)}`)):alert("No issues were auto-fixed. All issues may already be resolved or not auto-fixable.")}catch(f){alert(`Error during auto-fix: ${f&&typeof f=="object"&&"message"in f?f.message:"Unknown error"}`)}finally{A(!1)}},Ge=async f=>{if(e){A(!0);try{const{html:g,fixed:m}=z.autoFixSpecificIssue(a,f);m?(e(g),alert(`Successfully fixed issue with rule: ${f}`)):alert(`No changes made for rule: ${f}. Issue may already be resolved.`)}catch(g){alert(`Error fixing issue: ${g&&typeof g=="object"&&"message"in g?g.message:"Unknown error"}`)}finally{A(!1)}}},ze=async f=>{if(e){A(!0);try{const{html:g,fixed:m}=z.autoFixAllIssues(a,f);m.length>0?(e(g),alert(`Successfully fixed ${m.length} ${f} issues:
${m.join(`
`)}`)):alert(`No ${f} issues were fixed. All issues may already be resolved or not auto-fixable.`)}catch(g){alert(`Error fixing ${f} issues: ${g&&typeof g=="object"&&"message"in g?g.message:"Unknown error"}`)}finally{A(!1)}}},Ue=async f=>{if(e){A(!0);try{const{html:g,fixed:m}=z.autoFixCategory(a,f);m.length>0?(e(g),alert(`Successfully fixed ${m.length} issues in category ${f}:
${m.join(`
`)}`)):alert(`No issues in category ${f} were fixed. All issues may already be resolved or not auto-fixable.`)}catch(g){alert(`Error fixing category ${f} issues: ${g&&typeof g=="object"&&"message"in g?g.message:"Unknown error"}`)}finally{A(!1)}}},Te=f=>{switch(f){case"error":return r.jsx(ce,{color:"error"});case"warning":return r.jsx(Ie,{color:"warning"});case"info":return r.jsx(pe,{color:"info"});default:return r.jsx(pe,{})}},We=f=>{switch(f){case"structure":return r.jsx(Me,{color:"primary"});case"accessibility":return r.jsx(ke,{color:"secondary"});case"compatibility":return r.jsx(Z,{color:"info"});case"performance":return r.jsx(ee,{color:"warning"});case"best-practice":return r.jsx(He,{color:"success"});default:return r.jsx(pe,{})}},Be=f=>{switch(f){case"structure":return"primary";case"accessibility":return"secondary";case"compatibility":return"info";case"performance":return"warning";case"best-practice":return"success";default:return"default"}},Xe=f=>{switch(f){case"structure":return"Structure";case"accessibility":return"Accessibility";case"compatibility":return"Compatibility";case"performance":return"Performance";case"best-practice":return"Best Practice";default:return f}},U=$.useMemo(()=>{if(!s)return{errors:[],warnings:[],suggestions:[]};let g=[...s.errors,...s.warnings,...s.suggestions];if(T!=="all"&&(g=g.filter(m=>m.severity===T)),P!=="all"&&(g=g.filter(m=>m.category===P)),V.trim()){const m=V.toLowerCase();g=g.filter(H=>{var _;return H.message.toLowerCase().includes(m)||((_=H.suggestion)==null?void 0:_.toLowerCase().includes(m))||H.rule.toLowerCase().includes(m)})}return{errors:g.filter(m=>m.severity==="error"),warnings:g.filter(m=>m.severity==="warning"),suggestions:g.filter(m=>m.severity==="info")}},[s,T,P,V]),le=(f,g,m)=>{if(!f||f.length===0)return null;const H=m==="error"?"error":m==="warning"?"warning":"info";return r.jsxs(nt,{defaultExpanded:m==="error",sx:{mb:2,"&:before":{display:"none"},boxShadow:"none",border:`1px solid ${H==="error"?"#ffcdd2":H==="warning"?"#fff3e0":"#e3f2fd"}`,borderRadius:2},children:[r.jsx(lt,{expandIcon:r.jsx(de,{}),sx:{backgroundColor:H==="error"?"#ffebee":H==="warning"?"#fff8e1":"#f3e5f5",borderRadius:"8px 8px 0 0"},children:r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[Te(m),r.jsxs(b,{variant:"subtitle1",component:"div",fontWeight:"bold",children:[g," (",f.length,")"]}),r.jsx(p,{sx:{flexGrow:1}}),f.some(_=>_.autoFixAvailable)&&e&&r.jsx(O,{size:"small",variant:"contained",startIcon:r.jsx(q,{}),onClick:_=>{_.stopPropagation(),ze(m)},disabled:v||C,color:H,sx:{minWidth:"auto"},children:C?"Fixing...":`Fix All (${f.filter(_=>_.autoFixAvailable).length})`})]})}),r.jsx(ct,{sx:{p:0},children:r.jsx(ut,{dense:!0,sx:{p:0},children:f.map((_,K)=>r.jsxs(dt,{sx:{px:2,py:1,borderBottom:K<f.length-1?"1px solid #f0f0f0":"none","&:last-child":{borderBottom:"none"}},children:[r.jsx(gt,{sx:{minWidth:36},children:Te(_.severity)}),r.jsx(ht,{primary:r.jsx(b,{variant:"body2",component:"div",fontWeight:"medium",children:_.message}),secondary:r.jsxs(p,{sx:{mt:1},children:[_.line&&r.jsxs(b,{variant:"caption",component:"div",color:"text.secondary",sx:{mb:.5},children:[" Line ",_.line,_.column&&`, Column ${_.column}`]}),_.suggestion&&r.jsxs(b,{variant:"caption",component:"div",display:"block",sx:{mt:.5,fontStyle:"italic",backgroundColor:"#f8f9fa",p:1,borderRadius:1,border:"1px solid #e9ecef"},children:[" ",_.suggestion]}),_.category&&r.jsx(k,{size:"small",icon:We(_.category),label:Xe(_.category),color:Be(_.category),variant:"outlined",sx:{mt:1,mr:1}}),r.jsx(k,{size:"small",label:_.rule,variant:"outlined",sx:{mt:1,fontSize:"0.7rem"}})]}),primaryTypographyProps:{component:"div"},secondaryTypographyProps:{component:"div"}}),_.autoFixAvailable&&e&&r.jsx(Q,{title:"Fix this issue",children:r.jsx(ue,{size:"small",onClick:()=>Ge(_.rule),sx:{ml:1},color:"primary",children:r.jsx(q,{fontSize:"small"})})})]},`${_.rule}-${K}`))})})]})},Ye=()=>{if(!s)return null;const f=[{key:"structure",label:"Structure",icon:r.jsx(Me,{}),color:"primary"},{key:"accessibility",label:"Accessibility",icon:r.jsx(ke,{}),color:"secondary"},{key:"compatibility",label:"Compatibility",icon:r.jsx(Z,{}),color:"info"},{key:"performance",label:"Performance",icon:r.jsx(ee,{}),color:"warning"},{key:"best-practice",label:"Best Practice",icon:r.jsx(He,{}),color:"success"}];return r.jsx(N,{container:!0,spacing:2,sx:{mb:3},children:f.map(g=>{const m=s.categories[g.key],H=m>0&&z.getRulesByCategory(g.key).some(_=>{var K;return(K=w[_])==null?void 0:K.autofix});return r.jsx(N,{item:!0,xs:12,sm:6,md:4,children:r.jsx(ge,{className:"category-card",variant:"outlined",onClick:()=>D(g.key),sx:{borderColor:m>0?`${g.color}.main`:"divider",backgroundColor:m>0?`${g.color}.50`:"background.paper",transition:"all 0.3s ease-in-out",cursor:"pointer","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)"}},children:r.jsxs(rt,{sx:{p:2,"&:last-child":{pb:2}},children:[r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[r.jsx(p,{sx:{color:`${g.color}.main`},children:g.icon}),r.jsx(b,{variant:"body2",component:"div",fontWeight:"bold",children:g.label})]}),r.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx(Ce,{badgeContent:m,color:g.color,children:r.jsx(k,{size:"small",label:m===0?"Perfect":`${m} issues`,color:m===0?"success":g.color,variant:m===0?"filled":"outlined"})}),H&&e&&m>0&&r.jsx(O,{size:"small",variant:"contained",startIcon:r.jsx(q,{}),onClick:()=>Ue(g.key),disabled:v||C,color:g.color,sx:{borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"0 2px 4px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},children:C?"Fixing...":`Fix All (${m})`})]})]})})},g.key)})})},Ze=()=>s?r.jsxs(p,{sx:{mb:3,p:3,backgroundColor:"#f8f9fa",borderRadius:2,border:"1px solid #e9ecef",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[r.jsxs(b,{variant:"subtitle2",component:"div",sx:{mb:2,fontWeight:"bold",display:"flex",alignItems:"center",gap:1,color:"#495057"},children:[r.jsx($e,{fontSize:"small"}),"Filters & Search"]}),r.jsxs(N,{container:!0,spacing:2,alignItems:"center",children:[r.jsx(N,{item:!0,xs:12,sm:6,md:3,children:r.jsxs(Re,{fullWidth:!0,size:"small",children:[r.jsx(Le,{children:"Severity"}),r.jsxs(we,{value:T,label:"Severity",onChange:f=>F(f.target.value),children:[r.jsx(G,{value:"all",children:"All Severities"}),r.jsx(G,{value:"error",children:"Errors"}),r.jsx(G,{value:"warning",children:"Warnings"}),r.jsx(G,{value:"info",children:"Suggestions"})]})]})}),r.jsx(N,{item:!0,xs:12,sm:6,md:3,children:r.jsxs(Re,{fullWidth:!0,size:"small",children:[r.jsx(Le,{children:"Category"}),r.jsxs(we,{value:P,label:"Category",onChange:f=>D(f.target.value),children:[r.jsx(G,{value:"all",children:"All Categories"}),r.jsx(G,{value:"structure",children:"Structure"}),r.jsx(G,{value:"accessibility",children:"Accessibility"}),r.jsx(G,{value:"compatibility",children:"Compatibility"}),r.jsx(G,{value:"performance",children:"Performance"}),r.jsx(G,{value:"best-practice",children:"Best Practice"})]})]})}),r.jsx(N,{item:!0,xs:12,sm:12,md:6,children:r.jsx(Ae,{fullWidth:!0,size:"small",placeholder:"Search in messages, suggestions, or rules...",value:V,onChange:f=>ne(f.target.value),InputProps:{startAdornment:r.jsx(at,{position:"start",children:r.jsx(ot,{fontSize:"small"})})}})})]}),r.jsxs(p,{sx:{mt:2,display:"flex",alignItems:"center",justifyContent:"space-between",p:1,backgroundColor:"#ffffff",borderRadius:1,border:"1px solid #dee2e6"},children:[r.jsxs(b,{variant:"caption",color:"text.secondary",children:["Showing"," ",U.errors.length+U.warnings.length+U.suggestions.length," ","of ",s.totalIssues," issues"]}),(T!=="all"||P!=="all"||V.trim())&&r.jsx(O,{size:"small",variant:"outlined",color:"secondary",onClick:()=>{F("all"),D("all"),ne("")},sx:{borderRadius:2,textTransform:"none",fontWeight:500},children:"Clear Filters"})]})]}):null,Ke=()=>{if(!a||!a.trim())return null;try{const f=z.getCompatibilityReport(a);return r.jsxs(p,{sx:{mt:2},children:[r.jsx(b,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:"Email Client Compatibility"}),Object.entries(f).map(([g,m])=>r.jsxs(p,{sx:{mb:1},children:[r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[g==="outlook"&&r.jsx(Z,{fontSize:"small"}),g==="gmail"&&r.jsx(ft,{fontSize:"small"}),g==="mobile"&&r.jsx(pt,{fontSize:"small"}),r.jsx(b,{variant:"body2",component:"div",sx:{textTransform:"capitalize",flexGrow:1},children:g}),r.jsx(k,{size:"small",label:m.compatible?"Compatible":"Issues",color:m.compatible?"success":"warning",variant:"outlined"})]}),!m.compatible&&m.issues&&m.issues.length>0&&r.jsx(p,{sx:{ml:3,mt:.5},children:m.issues.map((H,_)=>r.jsxs(b,{variant:"caption",component:"div",color:"warning.main",display:"block",children:[" ",H]},_))})]},g))]})}catch(f){return console.error("Error generating compatibility report",f,"EmailValidationPanel"),r.jsx(p,{sx:{mt:2},children:r.jsx(b,{variant:"subtitle2",component:"div",color:"error",children:"Error generating compatibility report"})})}};return!s&&!v?null:i?r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[v?r.jsx(k,{size:"small",label:"Validating...",color:"info"}):C?r.jsx(k,{size:"small",label:"Fixing...",color:"warning"}):s!=null&&s.isValid?r.jsx(k,{size:"small",icon:r.jsx(ve,{}),label:"Email Safe",color:"success"}):r.jsx(k,{size:"small",icon:r.jsx(ce,{}),label:`${(s==null?void 0:s.totalIssues)||0} Issues`,color:"error"}),s&&r.jsx(ue,{size:"small",onClick:()=>l(!o),children:o?r.jsx(_e,{}):r.jsx(de,{})})]}):r.jsxs(Je,{sx:{p:2,mb:2,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[r.jsx("style",{children:`
          @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
          }

          @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }

          .tab-content {
            animation: slideIn 0.3s ease-out;
          }

          .category-card:hover {
            transform: translateY(-4px);
            boxShadow: 0 8px 25px rgba(0,0,0,0.15);
          }
        `}),r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[v?r.jsx(k,{icon:r.jsx(re,{}),label:"Validating...",color:"info"}):s!=null&&s.isValid?r.jsx(k,{icon:r.jsx(ve,{}),label:"Email Safe",color:"success"}):r.jsx(k,{icon:r.jsx(ce,{}),label:`${((Se=s==null?void 0:s.errors)==null?void 0:Se.length)||0} Errors`,color:"error"}),s&&s.warnings&&s.warnings.length>0&&r.jsx(k,{icon:r.jsx(Ie,{}),label:`${s.warnings.length} Warnings`,color:"warning"})]}),r.jsx(p,{sx:{flexGrow:1}}),s&&r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(b,{variant:"body2",color:"text.secondary",children:"Score:"}),r.jsx(k,{label:`${s.score}/100`,color:s.score>=80?"success":s.score>=60?"warning":"error",variant:"outlined",size:"small"})]}),r.jsx(Q,{title:"Validation Settings",children:r.jsx(ue,{size:"small",onClick:()=>d(!0),children:r.jsx(ie,{})})}),r.jsx(Q,{title:"Test Auto-fix with sample HTML",children:r.jsx(O,{size:"small",variant:"outlined",onClick:()=>{e&&(e(Pe),alert(" Test HTML loaded! Now try auto-fix to see it in action."))},sx:{ml:1},children:"Test HTML"})}),(s==null?void 0:s.autoFixAvailable)&&e&&r.jsx(Q,{title:"Auto-fix All Issues",children:r.jsx(O,{size:"small",variant:"contained",startIcon:r.jsx(q,{}),onClick:Ve,disabled:v||C,color:"primary",sx:{borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"0 2px 4px rgba(25, 118, 210, 0.2)","&:hover":{boxShadow:"0 4px 8px rgba(25, 118, 210, 0.3)"}},children:C?"Fixing...":`Auto-fix All (${s.totalIssues})`})}),r.jsx(O,{size:"small",onClick:()=>l(!o),endIcon:o?r.jsx(_e,{}):r.jsx(de,{}),variant:"outlined",sx:{borderRadius:2,textTransform:"none",fontWeight:500,borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#999",backgroundColor:"#f5f5f5"}},children:"Details"})]}),s&&r.jsxs(p,{sx:{mb:2},children:[r.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[r.jsx(b,{variant:"caption",color:"text.secondary",children:"Validation Progress"}),r.jsxs(b,{variant:"caption",color:"text.secondary",children:[s.score,"%"]})]}),r.jsx(et,{variant:"determinate",value:s.score,color:s.score>=80?"success":s.score>=60?"warning":"error",sx:{height:6,borderRadius:3}})]}),r.jsxs(tt,{in:o,children:[r.jsx(st,{sx:{mb:2}}),s&&Ye(),r.jsx(p,{sx:{mb:2,borderBottom:"1px solid #e0e0e0",backgroundColor:"#fafafa",borderRadius:"8px 8px 0 0",p:1},children:r.jsxs(it,{value:h,onChange:(f,g)=>x(g),sx:{"& .MuiTab-root":{minHeight:48,textTransform:"none",fontWeight:500,fontSize:"0.875rem",transition:"all 0.2s ease-in-out",borderRadius:"8px 8px 0 0",margin:"0 4px",color:"text.secondary"},"& .Mui-selected":{fontWeight:600,color:"primary.main",backgroundColor:"rgba(25, 118, 210, 0.08)"},"& .MuiTabs-indicator":{height:4,borderRadius:"4px 4px 0 0",backgroundColor:"primary.main",boxShadow:"0 2px 4px rgba(25, 118, 210, 0.3)"},"& .MuiTab-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.04)",transform:"translateY(-1px)"}},variant:"fullWidth",textColor:"primary",indicatorColor:"primary",children:[r.jsx(J,{label:r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(re,{fontSize:"small"}),"Issues",s&&s.totalIssues>0&&r.jsx(Ce,{badgeContent:s.totalIssues,color:"error",sx:{ml:1},max:99})]})}),r.jsx(J,{label:r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(Z,{fontSize:"small"}),"Compatibility"]})}),r.jsx(J,{label:r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(ee,{fontSize:"small"}),"Performance"]})}),r.jsx(J,{label:r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(ie,{fontSize:"small"}),"Settings"]})})]})}),r.jsxs(p,{className:"tab-content",sx:{minHeight:200,position:"relative",p:2,backgroundColor:"#ffffff",borderRadius:"0 0 8px 8px",border:"1px solid #e0e0e0",borderTop:"none"},children:[h===0&&s&&r.jsxs(p,{children:[r.jsxs(b,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#fce4ec",borderRadius:2,border:"1px solid #e91e63",color:"#ad1457",fontWeight:600,boxShadow:"0 2px 4px rgba(233, 30, 99, 0.1)"},children:[r.jsx(re,{color:"error"}),"Issues & Validation Results"]}),Ze(),U.errors.length===0&&U.warnings.length===0&&U.suggestions.length===0?r.jsx(ae,{severity:"info",sx:{borderRadius:2},children:"No issues match the current filters. Try adjusting your search criteria."}):r.jsxs(r.Fragment,{children:[le(U.errors,"Errors","error"),le(U.warnings,"Warnings","warning"),le(U.suggestions,"Suggestions","info")]}),s.totalIssues===0&&r.jsx(ae,{severity:"success",sx:{borderRadius:2},children:" Your HTML is email-safe! No issues found."})]}),h===1&&r.jsxs(p,{children:[r.jsxs(b,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#e3f2fd",borderRadius:2,border:"1px solid #2196f3",color:"#1565c0"},children:[r.jsx(Z,{color:"info"}),"Email Client Compatibility"]}),Ke(),r.jsxs(p,{sx:{mt:3,p:2,backgroundColor:"#e3f2fd",borderRadius:2,border:"1px solid #2196f3"},children:[r.jsx(b,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" Compatibility Tips"}),r.jsxs(b,{variant:"body2",component:"div",sx:{mb:1},children:[" ",r.jsx("strong",{children:"Outlook:"})," Use table-based layout, avoid flexbox/grid"]}),r.jsxs(b,{variant:"body2",component:"div",sx:{mb:1},children:[" ",r.jsx("strong",{children:"Gmail:"})," Inline styles work best, external CSS may be stripped"]}),r.jsxs(b,{variant:"body2",component:"div",sx:{mb:1},children:[" ",r.jsx("strong",{children:"Mobile:"})," Use responsive design with max-width"]})]})]}),h===2&&r.jsxs(p,{children:[r.jsxs(b,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800",color:"#e65100",fontWeight:600,boxShadow:"0 2px 4px rgba(255, 152, 0, 0.1)"},children:[r.jsx(ee,{color:"warning"}),"Performance Analysis"]}),s&&r.jsxs(N,{container:!0,spacing:2,sx:{mb:3},children:[r.jsx(N,{item:!0,xs:12,sm:6,children:r.jsxs(ge,{variant:"outlined",sx:{p:2},children:[r.jsx(b,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" File Size"}),r.jsxs(b,{variant:"h4",component:"div",color:s.score>=80?"success.main":"warning.main",children:[(a.length/1024).toFixed(1)," KB"]}),r.jsx(b,{variant:"caption",component:"div",color:"text.secondary",children:s.score>=80?" Optimal size":" Consider optimization"})]})}),r.jsx(N,{item:!0,xs:12,sm:6,children:r.jsxs(ge,{variant:"outlined",sx:{p:2},children:[r.jsx(b,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" Validation Score"}),r.jsxs(b,{variant:"h4",component:"div",color:s.score>=80?"success.main":s.score>=60?"warning.main":"error.main",children:[s.score,"/100"]}),r.jsx(b,{variant:"caption",component:"div",color:"text.secondary",children:s.score>=80?"Excellent":s.score>=60?"Good":"Needs improvement"})]})})]}),r.jsxs(p,{sx:{p:2,backgroundColor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800"},children:[r.jsx(b,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" Performance Recommendations"}),r.jsx(b,{variant:"body2",component:"div",sx:{mb:1},children:" Keep HTML size under 102KB for optimal email delivery"}),r.jsx(b,{variant:"body2",component:"div",sx:{mb:1},children:" Use inline styles instead of external CSS"}),r.jsx(b,{variant:"body2",component:"div",sx:{mb:1},children:" Optimize images and use appropriate dimensions"}),r.jsx(b,{variant:"body2",component:"div",sx:{mb:1},children:" Minimize table nesting for better rendering"})]})]}),h===3&&r.jsxs(p,{children:[r.jsxs(b,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#e8f5e8",borderRadius:2,border:"1px solid #4caf50",color:"#2e7d32",fontWeight:600,boxShadow:"0 2px 4px rgba(76, 175, 80, 0.1)"},children:[r.jsx(ie,{color:"primary"}),"Validation Settings"]}),r.jsxs(p,{sx:{mb:3},children:[r.jsx(b,{variant:"subtitle2",component:"div",sx:{mb:2,fontWeight:"bold"},children:"Quick Actions"}),r.jsxs(N,{container:!0,spacing:2,children:[r.jsx(N,{item:!0,xs:12,sm:6,children:r.jsx(O,{fullWidth:!0,variant:"contained",startIcon:r.jsx(q,{}),onClick:()=>d(!0),sx:{mb:1,borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"0 2px 4px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},children:"Advanced Settings"})}),r.jsx(N,{item:!0,xs:12,sm:6,children:r.jsx(O,{fullWidth:!0,variant:"outlined",startIcon:r.jsx($e,{}),onClick:()=>{F("all"),D("all"),ne("")},sx:{borderRadius:2,textTransform:"none",fontWeight:500,borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#999",backgroundColor:"#f5f5f5"}},children:"Reset Filters"})})]})]}),r.jsxs(p,{sx:{p:2,backgroundColor:"#f5f5f5",borderRadius:2},children:[r.jsx(b,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:"Current Configuration"}),r.jsxs(b,{variant:"body2",component:"div",sx:{mb:.5},children:[" Severity Filter: ",T==="all"?"All":T]}),r.jsxs(b,{variant:"body2",component:"div",sx:{mb:.5},children:[" Category Filter: ",P==="all"?"All":P]}),r.jsxs(b,{variant:"body2",component:"div",sx:{mb:.5},children:[" Search Query: ",V||"None"]}),r.jsxs(b,{variant:"body2",component:"div",children:[" Total Rules: ",Object.keys(w).length]})]})]})]})]}),r.jsx(Nt,{open:c,onClose:()=>d(!1),validator:z})]})},Nt=({open:a,onClose:e,validator:t})=>{const[i,s]=$.useState(t.getConfig()),n=t.getAvailableRules(),o=()=>{try{t.updateConfig(i),e()}catch(c){console.error("Error saving validation config",c,"ValidationSettingsDialog")}},l=(c,d)=>{s(h=>({...h,rules:{...h.rules,[c]:{...h.rules[c],enabled:d}}}))};return r.jsxs(mt,{open:a,onClose:e,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[r.jsx(bt,{sx:{backgroundColor:"#f8f9fa",borderBottom:"1px solid #e9ecef",fontWeight:600},children:"Validation Settings"}),r.jsxs(xt,{sx:{p:3},children:[r.jsxs(p,{sx:{mb:3},children:[r.jsxs(b,{variant:"h6",component:"div",sx:{mb:2,p:2,backgroundColor:"#e3f2fd",borderRadius:2,border:"1px solid #2196f3",color:"#1565c0",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[r.jsx(re,{fontSize:"small"}),"Validation Rules"]}),r.jsx(je,{children:Object.entries(n).map(([c,d])=>{var h;return r.jsx(he,{control:r.jsx(fe,{checked:((h=i.rules[c])==null?void 0:h.enabled)??d.enabled,onChange:x=>l(c,x.target.checked),color:"primary"}),label:r.jsxs(p,{sx:{p:1,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef",flex:1},children:[r.jsx(b,{variant:"body2",component:"div",sx:{fontWeight:500},children:d.displayName}),r.jsx(b,{variant:"caption",component:"div",color:"text.secondary",children:d.description})]}),sx:{alignItems:"flex-start",mb:1,p:1,borderRadius:1,"&:hover":{backgroundColor:"#f8f9fa"}}},c)})})]}),r.jsxs(p,{sx:{mb:3},children:[r.jsxs(b,{variant:"h6",component:"div",sx:{mb:2,p:2,backgroundColor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800",color:"#e65100",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[r.jsx(Z,{fontSize:"small"}),"Target Email Clients"]}),r.jsx(je,{children:Object.entries(i.targetClients).map(([c,d])=>r.jsx(he,{control:r.jsx(fe,{checked:d,onChange:h=>s(x=>({...x,targetClients:{...x.targetClients,[c]:h.target.checked}})),color:"primary"}),label:r.jsx(p,{sx:{p:1,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef",flex:1},children:r.jsx(b,{variant:"body2",component:"div",sx:{fontWeight:500},children:c.charAt(0).toUpperCase()+c.slice(1)})}),sx:{alignItems:"flex-start",mb:1,p:1,borderRadius:1,"&:hover":{backgroundColor:"#f8f9fa"}}},c))})]}),r.jsxs(p,{sx:{p:2,backgroundColor:"#f3e5f5",borderRadius:2,border:"1px solid #9c27b0"},children:[r.jsxs(b,{variant:"h6",component:"div",sx:{mb:2,color:"#6a1b9a",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[r.jsx(ie,{fontSize:"small"}),"Advanced Options"]}),r.jsxs(p,{sx:{mb:2},children:[r.jsx(b,{variant:"body2",component:"div",sx:{mb:1,fontWeight:500},children:"Max HTML Size (KB)"}),r.jsx(Ae,{type:"number",size:"small",value:Math.round(i.maxHtmlSize/1024),onChange:c=>{const d=parseInt(c.target.value);!isNaN(d)&&d>0&&s(h=>({...h,maxHtmlSize:d*1024}))},inputProps:{min:1,max:1e3},sx:{width:120},helperText:`Current: ${Math.round(i.maxHtmlSize/1024)}KB`})]}),r.jsx(he,{control:r.jsx(fe,{checked:i.strictMode,onChange:c=>s(d=>({...d,strictMode:c.target.checked})),color:"secondary"}),label:r.jsx(p,{sx:{p:1,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef",flex:1},children:r.jsx(b,{variant:"body2",component:"div",sx:{fontWeight:500},children:"Strict Mode (treat warnings as errors)"})}),sx:{alignItems:"flex-start",p:1,borderRadius:1,"&:hover":{backgroundColor:"#f8f9fa"}}})]})]}),r.jsxs(Et,{sx:{p:3,borderTop:"1px solid #e9ecef"},children:[r.jsx(O,{onClick:e,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3},children:"Cancel"}),r.jsx(O,{onClick:o,variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3,boxShadow:"0 2px 4px rgba(25, 118, 210, 0.2)","&:hover":{boxShadow:"0 4px 8px rgba(25, 118, 210, 0.3)"}},children:"Save"})]})]})},Pt=()=>{const a=yt(),{mode:e,style:t}=At(),i=Tt(a,e,t),{editorHtml:s,setEditorHtml:n,subject:o,setSubject:l,loading:c,sendEmail:d,isReadyToSend:h,areCredentialsValid:x,serverStatus:v}=St(),L=()=>{d()},C=()=>{n("")},A=c||!h||!x||v==="offline";return r.jsxs(p,{sx:{height:"100%",display:"flex",flexDirection:"column",p:2},children:[r.jsxs(p,{sx:{flexGrow:1,overflow:"auto",pr:1},children:[r.jsxs(p,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[r.jsx(vt,{}),r.jsx(b,{variant:"h6",children:"Email Template Editor"})]}),v==="offline"&&r.jsx(ae,{severity:"error",sx:{mb:3},children:"Email server is offline. Please start the backend server."}),r.jsxs(_t,{spacing:3,children:[r.jsx(Ae,{label:"Email Subject",value:o,onChange:T=>l(T.target.value),fullWidth:!0,placeholder:"Enter email subject...",helperText:"A descriptive subject line for your email",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"background.paper"}}}),r.jsx(p,{children:r.jsx(Ft,{html:s,onHtmlChange:n,showCompactView:!1})}),r.jsxs(p,{children:[r.jsx(b,{variant:"subtitle2",sx:{mb:2,color:"text.secondary",fontWeight:500},children:"HTML Content:"}),r.jsx(p,{sx:{border:"2px solid",borderColor:"divider",borderRadius:2,overflow:"hidden",boxShadow:a.shadows[2],"& .cm-selectionLayer .cm-selectionBackground":{backgroundColor:`${me(a.palette.primary.main,.25)} !important`},"& .cm-selectionBackground":{backgroundColor:`${me(a.palette.primary.main,.25)} !important`},"& .cm-content ::selection":{backgroundColor:`${me(a.palette.primary.main,.25)} !important`}},children:r.jsx(It,{value:s,onChange:T=>n(T),height:"400px",extensions:[Ct(),...i],theme:void 0,basicSetup:{lineNumbers:!0,foldGutter:!0,dropCursor:!0,allowMultipleSelections:!1,indentOnInput:!0,bracketMatching:!0,closeBrackets:!0,autocompletion:!0,highlightSelectionMatches:!0,searchKeymap:!0}})})]})]})]}),r.jsx(p,{sx:{position:"sticky",bottom:0,backgroundColor:"background.paper",borderTop:1,borderColor:"divider",p:2,mx:-2,mt:2,boxShadow:a.shadows[2],zIndex:10},children:r.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[r.jsx(p,{sx:{display:"flex",alignItems:"center",gap:2},children:r.jsx(O,{variant:"outlined",startIcon:r.jsx(Rt,{}),onClick:C,size:"medium",color:"warning",sx:{borderColor:"warning.main",color:"warning.main","&:hover":{borderColor:"warning.dark",backgroundColor:"warning.50"}},children:"Clear Editor"})}),r.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2},children:[!x&&r.jsx(ae,{severity:"warning",sx:{py:.5,px:2,fontSize:"0.875rem"},children:"Configure credentials first"}),r.jsx(O,{variant:"contained",startIcon:r.jsx(Lt,{}),onClick:L,disabled:A,size:"large",sx:{minWidth:160,height:48,fontSize:"1rem",fontWeight:600,bgcolor:A?void 0:"success.main","&:hover":{bgcolor:A?void 0:"success.dark",transform:"translateY(-1px)",boxShadow:a.shadows[4]},"&:disabled":{opacity:.6},transition:"all 0.2s ease-in-out"},children:c?"Sending...":"Send Email"})]})]})})]})};export{Pt as EmailHtmlEditor,Pt as default};
