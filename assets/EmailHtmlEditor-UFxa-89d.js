var mt=Object.defineProperty;var bt=(i,e,t)=>e in i?mt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var v=(i,e,t)=>bt(i,typeof e!="symbol"?e+"":e,t);import{r as w,o as Ce,p as Ie,q as Re,_ as Le,s as xt,t as B,v as yt,C as dt,j as a,w as ee,x as le,y as we,P as ut,z as Et,D as Ze,G as U,c as je,B as b,n as D,H as Ye,J as ke,I as He,e as Ke,f as Oe,W as qe,T as x,d as be,K as Te,L as G,M as At,N as vt,Q as Tt,U as xe,X as oe,Y as ye,A as _e,Z as V,$ as Ne,a0 as St,F as Qe,k as Je,a1 as et,a2 as X,g as Xe,h as _t,a3 as Ct,a4 as It,a5 as Rt,a6 as Lt,a7 as wt,i as jt,a8 as Mt,a9 as $t,aa as kt,ab as Ht,ac as tt,ad as Fe,ae as Pe,af as Ot,ag as st,m as rt,ah as De,u as Nt,ai as Ft,aj as Pt,ak as Dt,al as Vt,am as Gt,an as zt}from"./index-nFIeaVC0.js";const gt=i=>{const e=w.useRef({});return w.useEffect(()=>{e.current=i}),e.current},pt=w.createContext({});function Ut(i){return Ie("MuiAccordion",i)}const Ee=Ce("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),Bt=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Wt=i=>{const{classes:e,square:t,expanded:r,disabled:s,disableGutters:n}=i;return we({root:["root",!t&&"rounded",r&&"expanded",s&&"disabled",!n&&"gutters"],region:["region"]},Ut,e)},Xt=ee(ut,{name:"MuiAccordion",slot:"Root",overridesResolver:(i,e)=>{const{ownerState:t}=i;return[{[`& .${Ee.region}`]:e.region},e.root,!t.square&&e.rounded,!t.disableGutters&&e.gutters]}})(({theme:i})=>{const e={duration:i.transitions.duration.shortest};return{position:"relative",transition:i.transitions.create(["margin"],e),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(i.vars||i).palette.divider,transition:i.transitions.create(["opacity","background-color"],e)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${Ee.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${Ee.disabled}`]:{backgroundColor:(i.vars||i).palette.action.disabledBackground}}},({theme:i})=>({variants:[{props:e=>!e.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(i.vars||i).shape.borderRadius,borderTopRightRadius:(i.vars||i).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(i.vars||i).shape.borderRadius,borderBottomRightRadius:(i.vars||i).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:e=>!e.disableGutters,style:{[`&.${Ee.expanded}`]:{margin:"16px 0"}}}]})),Zt=w.forwardRef(function(e,t){const r=Re({props:e,name:"MuiAccordion"}),{children:s,className:n,defaultExpanded:o=!1,disabled:l=!1,disableGutters:c=!1,expanded:u,onChange:g,square:f=!1,slots:E={},slotProps:L={},TransitionComponent:I,TransitionProps:y}=r,A=Le(r,Bt),[R,N]=xt({controlled:u,default:o,name:"Accordion",state:"expanded"}),H=w.useCallback(ue=>{N(!R),g&&g(ue,!R)},[R,g,N]),[$,...W]=w.Children.toArray(s),O=w.useMemo(()=>({expanded:R,disabled:l,disableGutters:c,toggle:H}),[R,l,c,H]),Z=B({},r,{square:f,disabled:l,disableGutters:c,expanded:R}),Y=Wt(Z),ce=B({transition:I},E),te=B({transition:y},L),[de,se]=yt("transition",{elementType:dt,externalForwardedProps:{slots:ce,slotProps:te},ownerState:Z});return a.jsxs(Xt,B({className:le(Y.root,n),ref:t,ownerState:Z,square:f},A,{children:[a.jsx(pt.Provider,{value:O,children:$}),a.jsx(de,B({in:R,timeout:"auto"},se,{children:a.jsx("div",{"aria-labelledby":$.props.id,id:$.props["aria-controls"],role:"region",className:Y.region,children:W})}))]}))});function Yt(i){return Ie("MuiAccordionDetails",i)}Ce("MuiAccordionDetails",["root"]);const Kt=["className"],qt=i=>{const{classes:e}=i;return we({root:["root"]},Yt,e)},Qt=ee("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(i,e)=>e.root})(({theme:i})=>({padding:i.spacing(1,2,2)})),Jt=w.forwardRef(function(e,t){const r=Re({props:e,name:"MuiAccordionDetails"}),{className:s}=r,n=Le(r,Kt),o=r,l=qt(o);return a.jsx(Qt,B({className:le(l.root,s),ref:t,ownerState:o},n))});function es(i){return Ie("MuiAccordionSummary",i)}const ne=Ce("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),ts=["children","className","expandIcon","focusVisibleClassName","onClick"],ss=i=>{const{classes:e,expanded:t,disabled:r,disableGutters:s}=i;return we({root:["root",t&&"expanded",r&&"disabled",!s&&"gutters"],focusVisible:["focusVisible"],content:["content",t&&"expanded",!s&&"contentGutters"],expandIconWrapper:["expandIconWrapper",t&&"expanded"]},es,e)},rs=ee(Et,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(i,e)=>e.root})(({theme:i})=>{const e={duration:i.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:i.spacing(0,2),transition:i.transitions.create(["min-height","background-color"],e),[`&.${ne.focusVisible}`]:{backgroundColor:(i.vars||i).palette.action.focus},[`&.${ne.disabled}`]:{opacity:(i.vars||i).palette.action.disabledOpacity},[`&:hover:not(.${ne.disabled})`]:{cursor:"pointer"},variants:[{props:t=>!t.disableGutters,style:{[`&.${ne.expanded}`]:{minHeight:64}}}]}}),is=ee("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(i,e)=>e.content})(({theme:i})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:e=>!e.disableGutters,style:{transition:i.transitions.create(["margin"],{duration:i.transitions.duration.shortest}),[`&.${ne.expanded}`]:{margin:"20px 0"}}}]})),as=ee("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(i,e)=>e.expandIconWrapper})(({theme:i})=>({display:"flex",color:(i.vars||i).palette.action.active,transform:"rotate(0deg)",transition:i.transitions.create("transform",{duration:i.transitions.duration.shortest}),[`&.${ne.expanded}`]:{transform:"rotate(180deg)"}})),os=w.forwardRef(function(e,t){const r=Re({props:e,name:"MuiAccordionSummary"}),{children:s,className:n,expandIcon:o,focusVisibleClassName:l,onClick:c}=r,u=Le(r,ts),{disabled:g=!1,disableGutters:f,expanded:E,toggle:L}=w.useContext(pt),I=R=>{L&&L(R),c&&c(R)},y=B({},r,{expanded:E,disabled:g,disableGutters:f}),A=ss(y);return a.jsxs(rs,B({focusRipple:!1,disableRipple:!0,disabled:g,component:"div","aria-expanded":E,className:le(A.root,n),focusVisibleClassName:le(A.focusVisible,l),onClick:I,ref:t,ownerState:y},u,{children:[a.jsx(is,{className:A.content,ownerState:y,children:s}),o&&a.jsx(as,{className:A.expandIconWrapper,ownerState:y,children:o})]}))});function ns(i){const{badgeContent:e,invisible:t=!1,max:r=99,showZero:s=!1}=i,n=gt({badgeContent:e,max:r});let o=t;t===!1&&e===0&&!s&&(o=!0);const{badgeContent:l,max:c=r}=o?n:i,u=l&&Number(l)>c?`${c}+`:l;return{badgeContent:l,invisible:o,max:c,displayValue:u}}function ls(i){return Ie("MuiBadge",i)}const K=Ce("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),cs=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],Ve=10,Ge=4,ds=i=>{const{color:e,anchorOrigin:t,invisible:r,overlap:s,variant:n,classes:o={}}=i,l={root:["root"],badge:["badge",n,r&&"invisible",`anchorOrigin${U(t.vertical)}${U(t.horizontal)}`,`anchorOrigin${U(t.vertical)}${U(t.horizontal)}${U(s)}`,`overlap${U(s)}`,e!=="default"&&`color${U(e)}`]};return we(l,ls,o)},us=ee("span",{name:"MuiBadge",slot:"Root",overridesResolver:(i,e)=>e.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),gs=ee("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(i,e)=>{const{ownerState:t}=i;return[e.badge,e[t.variant],e[`anchorOrigin${U(t.anchorOrigin.vertical)}${U(t.anchorOrigin.horizontal)}${U(t.overlap)}`],t.color!=="default"&&e[`color${U(t.color)}`],t.invisible&&e.invisible]}})(({theme:i})=>{var e;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:i.typography.fontFamily,fontWeight:i.typography.fontWeightMedium,fontSize:i.typography.pxToRem(12),minWidth:Ve*2,lineHeight:1,padding:"0 6px",height:Ve*2,borderRadius:Ve,zIndex:1,transition:i.transitions.create("transform",{easing:i.transitions.easing.easeInOut,duration:i.transitions.duration.enteringScreen}),variants:[...Object.keys(((e=i.vars)!=null?e:i).palette).filter(t=>{var r,s;return((r=i.vars)!=null?r:i).palette[t].main&&((s=i.vars)!=null?s:i).palette[t].contrastText}).map(t=>({props:{color:t},style:{backgroundColor:(i.vars||i).palette[t].main,color:(i.vars||i).palette[t].contrastText}})),{props:{variant:"dot"},style:{borderRadius:Ge,height:Ge*2,minWidth:Ge*2,padding:0}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${K.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${K.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${K.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${K.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${K.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${K.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${K.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${K.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:i.transitions.create("transform",{easing:i.transitions.easing.easeInOut,duration:i.transitions.duration.leavingScreen})}}]}}),it=w.forwardRef(function(e,t){var r,s,n,o,l,c;const u=Re({props:e,name:"MuiBadge"}),{anchorOrigin:g={vertical:"top",horizontal:"right"},className:f,component:E,components:L={},componentsProps:I={},children:y,overlap:A="rectangular",color:R="default",invisible:N=!1,max:H=99,badgeContent:$,slots:W,slotProps:O,showZero:Z=!1,variant:Y="standard"}=u,ce=Le(u,cs),{badgeContent:te,invisible:de,max:se,displayValue:ue}=ns({max:H,invisible:N,badgeContent:$,showZero:Z}),Me=gt({anchorOrigin:g,color:R,overlap:A,variant:Y,badgeContent:$}),he=de||te==null&&Y!=="dot",{color:z=R,overlap:ge=A,anchorOrigin:$e=g,variant:fe=Y}=he?Me:u,me=fe!=="dot"?ue:void 0,re=B({},u,{badgeContent:te,invisible:he,max:se,displayValue:me,showZero:Z,anchorOrigin:$e,color:z,overlap:ge,variant:fe}),h=ds(re),p=(r=(s=W==null?void 0:W.root)!=null?s:L.Root)!=null?r:us,m=(n=(o=W==null?void 0:W.badge)!=null?o:L.Badge)!=null?n:gs,k=(l=O==null?void 0:O.root)!=null?l:I.root,S=(c=O==null?void 0:O.badge)!=null?c:I.badge,q=Ze({elementType:p,externalSlotProps:k,externalForwardedProps:ce,additionalProps:{ref:t,as:E},ownerState:re,className:le(k==null?void 0:k.className,h.root,f)}),ft=Ze({elementType:m,externalSlotProps:S,ownerState:re,className:le(h.badge,S==null?void 0:S.className)});return a.jsxs(p,B({},q,{children:[y,a.jsx(m,B({},ft,{children:me}))]}))}),at=je(a.jsx("path",{d:"M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m9 7h-6v13h-2v-6h-2v6H9V9H3V7h18z"}),"Accessibility"),pe=je(a.jsx("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"}),"AutoFixHigh"),Se=je(a.jsx("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20zm-6 8h-4v-2h4zm0-4h-4v-2h4z"}),"BugReport"),ot=je(a.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList"),T={DEFAULT_IMAGE_WIDTH:600,DEFAULT_IMAGE_HEIGHT:400,DEFAULT_ALT_TEXT:"Image",MAX_TABLES:50,MAX_TABLE_NESTING:5,MAX_AUTOFIX_ITERATIONS:10,MAX_STYLE_MERGE_ITERATIONS:3,MAX_FILE_SIZE_KB:102,MAX_HTML_SIZE_KB:130,MAX_HTML_SIZE_BYTES:133120,REGEX_CACHE_SIZE:100,AST_CACHE_SIZE:50,TRAVERSAL_CACHE_SIZE:50,CACHE_TTL_MS:5*60*1e3,CACHE_CLEANUP_INTERVAL_MS:10*60*1e3,DEFAULT_LINK_STYLES:"color:#0000ff; text-decoration:none;",DEFAULT_IMAGE_STYLES:"display:block",HEADING_FONT_SIZES:{h1:32,h2:24,h3:20,h4:18,h5:16,h6:14},TARGET_CLIENTS:{outlook:!0,gmail:!0,applemail:!0,thunderbird:!1,mobile:!0}},_={MAX_PARSER_ITERATIONS:1e3,MAX_PARSER_DEPTH:100,MAX_PARSER_SAFETY_COUNTER:1e4,MAX_VALIDATION_RESULTS:1e3,MAX_TRAVERSAL_RESULTS:1e3,MAX_AUTOFIX_ITERATIONS:50,MAX_AUTOFIX_MULTIPLE_ITERATIONS:25,MAX_HTML_SIZE_INCREASE_MULTIPLIER:3,MAX_AUTOFIX_PASSES:3,CACHE_CLEANUP_PERCENTAGE:.3,CACHE_CLEANUP_PERCENTAGE_REDUCED:.2,CACHE_CLEANUP_THRESHOLD:.8,CACHE_CLEANUP_PERCENTAGE_LARGE:.4,MAX_FIX_HISTORY_SIZE:100,MAX_FIX_HISTORY_AGE_MS:30*60*1e3,MAX_CUSTOM_RULES_SIZE:100,MAX_STRING_BATCHER_OPERATIONS:50,SLOW_VALIDATION_THRESHOLD_MS:1e3,SLOW_AUTOFIX_THRESHOLD_MS:2e3,MAX_HEADING_LEVELS:6,MAX_RECENT_FIXES_TRACKED:10},ie={MAX_SCORE:100,MAX_PENALTY:100,ERROR_PENALTY:20,WARNING_PENALTY:10,INFO_PENALTY:5},P={REGEX_ACCESS_COUNT_WEIGHT:.3,REGEX_AGE_WEIGHT:.7,AST_ACCESS_COUNT_WEIGHT:.4,AST_AGE_WEIGHT:.6,TRAVERSAL_ACCESS_COUNT_WEIGHT:.2,TRAVERSAL_AGE_WEIGHT:.5,TRAVERSAL_SIZE_WEIGHT:.3},nt={STYLE_ATTRIBUTE:/style="([^"]*)"/gi,WIDTH_100_PERCENT:/width:\s*100%/gi,EMPTY_HREF:/href\s*=\s*["']?\s*["']?/gi,MALFORMED_SRC:/\bs\s+rc=/gi,MALFORMED_HREF_NO_EQUALS:/\s+href\s+([^"\s>]+)/gi,MALFORMED_HREF_WITH_QUOTES:/\s+href\s+"([^"]*)"([^>]*)/gi,DEFAULT_HREF_VALUE:"urlhere"},ps={TEN_MINUTES_MS:10*60*1e3},C={HTML_TOO_LARGE:"HTML is too large for validation",HTML_TOO_LARGE_FOR_AUTOFIX:"HTML too large for autofix",VALIDATION_FAILED:"Validation failed",AUTOFIX_FAILED:"Autofix failed",RULE_NOT_FOUND:"Rule not found",INVALID_HTML_INPUT:"Invalid HTML input: must be a non-empty string",INVALID_RULE_NAME:"Rule name is required",INVALID_SEVERITY:"Invalid severity level. Must be error, warning, or info",INVALID_CONFIG:"Invalid configuration provided",VALIDATOR_DISPOSED:"EmailHTMLValidator has been disposed and cannot be used"},ae={SLOW_OPERATION_PREFIX:"Slow operation detected",CACHE_CLEANUP_PREFIX:"Cache cleanup completed",STATISTICS_RESET_PREFIX:"Statistics reset",DISPOSAL_PREFIX:"disposed successfully",GARBAGE_COLLECTION_PREFIX:"Garbage collection triggered"};class d{static get(e,t="gi"){const r=`${e}|${t}`;if(this.cache.has(r)){const s=this.accessCount.get(r)||0;this.accessCount.set(r,s+1),this.lastAccess.set(r,Date.now())}else{this.cache.size>=this.maxSize&&this.performCleanup();try{const s=new RegExp(e,t);this.cache.set(r,s),this.accessCount.set(r,1),this.lastAccess.set(r,Date.now()),this.precompiledPatterns.has(e)||this.precompiledPatterns.add(e)}catch(s){console.warn(`Invalid regex pattern: ${e}`,s),this.cache.set(r,new RegExp("(?:)",t)),this.accessCount.set(r,1),this.lastAccess.set(r,Date.now())}}return this.cleanupTimer||(this.cleanupTimer=setTimeout(()=>{this.performCleanup(),this.cleanupTimer=void 0},T.CACHE_CLEANUP_INTERVAL_MS)),this.cache.get(r)}static performCleanup(){if(this.cache.size<=this.maxSize*_.CACHE_CLEANUP_THRESHOLD)return;const e=Array.from(this.cache.entries()).map(([r,s])=>({key:r,regex:s,accessCount:this.accessCount.get(r)||0,lastAccess:this.lastAccess.get(r)||0,age:Date.now()-(this.lastAccess.get(r)||0)}));e.sort((r,s)=>{const n=r.accessCount*P.REGEX_ACCESS_COUNT_WEIGHT+r.age/1e3*P.REGEX_AGE_WEIGHT,o=s.accessCount*P.REGEX_ACCESS_COUNT_WEIGHT+s.age/1e3*P.REGEX_AGE_WEIGHT;return n-o});const t=Math.floor(this.cache.size*_.CACHE_CLEANUP_PERCENTAGE);for(let r=0;r<t&&r<e.length;r++){const s=e[r];this.cache.delete(s.key),this.accessCount.delete(s.key),this.lastAccess.delete(s.key)}}static clear(){this.cache.clear(),this.accessCount.clear(),this.lastAccess.clear(),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0)}static size(){return this.cache.size}static getStats(){const e=Math.min(...Array.from(this.lastAccess.values()));return{size:this.cache.size,maxSize:this.maxSize,accessCount:Array.from(this.accessCount.values()).reduce((t,r)=>t+r,0),oldestEntry:e===1/0?0:e}}}v(d,"cache",new Map),v(d,"maxSize",T.REGEX_CACHE_SIZE),v(d,"precompiledPatterns",new Set),v(d,"accessCount",new Map),v(d,"lastAccess",new Map),v(d,"cleanupTimer");class J{static get(e){const t=this.hashCode(e),r=this.cache.get(t);if(r){if(Date.now()-r.timestamp>this.ttl){this.cache.delete(t);return}return r.accessCount++,this.cleanupTimer||(this.cleanupTimer=setTimeout(()=>{this.clearExpired(),this.cleanupTimer=void 0},T.CACHE_CLEANUP_INTERVAL_MS)),r.ast}}static set(e,t){const r=this.hashCode(e);this.cache.size>=this.maxSize&&this.performCleanup(),this.cache.set(r,{ast:t,timestamp:Date.now(),accessCount:1})}static clear(){this.cache.clear(),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0)}static size(){return this.cache.size}static clearExpired(){const e=Date.now();let t=0;const r=[];for(const[s,n]of this.cache.entries())e-n.timestamp>this.ttl&&r.push(s);for(const s of r)this.cache.delete(s),t++;return this.cache.size>this.maxSize*_.CACHE_CLEANUP_THRESHOLD&&this.performCleanup(),t}static performCleanup(){if(this.cache.size<=this.maxSize*_.CACHE_CLEANUP_THRESHOLD)return;const e=Array.from(this.cache.entries()).map(([r,s])=>({key:r,...s,age:Date.now()-s.timestamp}));e.sort((r,s)=>{const n=r.accessCount*P.AST_ACCESS_COUNT_WEIGHT+r.age/1e3*P.AST_AGE_WEIGHT,o=s.accessCount*P.AST_ACCESS_COUNT_WEIGHT+s.age/1e3*P.AST_AGE_WEIGHT;return n-o});const t=Math.floor(this.cache.size*_.CACHE_CLEANUP_PERCENTAGE);for(let r=0;r<t&&r<e.length;r++)this.cache.delete(e[r].key)}static hashCode(e){if(e.length===0)return"0";let t=0;for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);t=(t<<5)-t+s,t=t&t}return`${Math.abs(t)}_${e.length}`}static getStats(){const e=Math.min(...Array.from(this.cache.values()).map(t=>t.timestamp));return{size:this.cache.size,maxSize:this.maxSize,ttl:this.ttl,oldestEntry:e===1/0?0:e}}}v(J,"cache",new Map),v(J,"maxSize",T.AST_CACHE_SIZE),v(J,"ttl",T.CACHE_TTL_MS),v(J,"cleanupTimer");class ze{constructor(){v(this,"operations",[]);v(this,"maxOperations",_.MAX_STRING_BATCHER_OPERATIONS)}add(e,t){return this.operations.length>=this.maxOperations&&this.execute(""),this.operations.push({pattern:e,replacement:t}),this}execute(e){let t=e;try{for(const r of this.operations)t=t.replace(r.pattern,r.replacement)}catch(r){return console.warn("StringBatcher execution error:",r),e}finally{this.clear()}return t}clear(){this.operations=[]}getOperationCount(){return this.operations.length}}class Be{constructor(e){v(this,"html");v(this,"position");v(this,"line");v(this,"column");this.html=e,this.position=0,this.line=1,this.column=1}parse(){const e=[],t=_.MAX_PARSER_ITERATIONS;let r=0;try{for(;this.position<this.html.length&&r<t;){r++;const s=this.parseNode();if(s&&e.push(s),this.position>=this.html.length)break;if(r>=t){console.warn("HTML parser reached max iterations, stopping to prevent infinite loop");break}}}catch(s){console.warn("HTML parser error:",s)}return e}parseNode(){return this.skipWhitespace(),this.position>=this.html.length?null:this.html[this.position]==="<"?this.html.substr(this.position,4)==="<!--"?this.parseComment():this.parseElement():this.parseText()}parseElement(){const e=this.line,t=this.column;if(this.html[this.position]!=="<")return null;if(this.advance(),this.html[this.position]==="/")return this.advance(),this.parseTagName()&&this.html[this.position]===">"&&this.advance(),null;const s=this.parseTagName();if(!s)return null;const n=this.parseAttributes(),o=this.html[this.position]==="/";o&&this.advance(),this.html[this.position]===">"&&this.advance();const l={type:"element",tagName:s.toLowerCase(),attributes:n,line:e,column:t,children:[]};return!o&&!this.isSelfClosingTag(s)&&(l.children=this.parseChildren(s)),l}parseTagName(){let e="";for(;this.position<this.html.length&&/[a-zA-Z0-9]/.test(this.html[this.position]);)e+=this.html[this.position],this.advance();return e}parseAttributes(){const e={};let t=0;for(;this.position<this.html.length&&this.html[this.position]!==">"&&this.html[this.position]!=="/";){const r=this.position;if(this.skipWhitespace(),this.position>=this.html.length||this.html[this.position]===">"||this.html[this.position]==="/")break;const s=this.parseAttribute();if(s&&(e[s.name]=s.value),this.position===r&&this.advance(),t++,t>_.MAX_PARSER_SAFETY_COUNTER)break}return e}parseAttribute(){const e=this.parseAttributeName();if(!e)return null;if(this.skipWhitespace(),this.position>=this.html.length)return{name:e,value:""};if(this.html[this.position]!=="=")return{name:e,value:""};this.advance(),this.skipWhitespace();const t=this.parseAttributeValue();return{name:e,value:t}}parseAttributeName(){let e="";for(;this.position<this.html.length&&/[a-zA-Z0-9\-_:]/.test(this.html[this.position]);)e+=this.html[this.position],this.advance();return e}parseAttributeValue(){if(this.position>=this.html.length)return"";const e=this.html[this.position];if(e==='"'||e==="'"){this.advance();let r="";for(;this.position<this.html.length&&this.html[this.position]!==e;)r+=this.html[this.position],this.advance();return this.position<this.html.length&&this.html[this.position]===e&&this.advance(),r}let t="";for(;this.position<this.html.length&&!/[\s>]/.test(this.html[this.position]);)t+=this.html[this.position],this.advance();return t}parseChildren(e){const t=[],r=_.MAX_PARSER_DEPTH;let s=0;const n=this.position;for(;this.position<this.html.length&&s<r;){if(s++,this.position===n&&s>1&&this.advance(),this.html.substr(this.position,2+e.length+1)===`</${e}>`){this.position+=2+e.length+1,this.updatePosition();break}const o=this.parseNode();if(o)t.push(o);else{this.position<this.html.length&&this.advance();break}if(this.position>=this.html.length)break}return t}parseText(){const e=this.line,t=this.column;let r="";for(;this.position<this.html.length&&this.html[this.position]!=="<";)r+=this.html[this.position],this.advance();return{type:"text",content:r.trim(),line:e,column:t}}parseComment(){const e=this.line,t=this.column;this.position+=4;let r="";for(;this.position<this.html.length&&this.html.substr(this.position,3)!=="-->";)r+=this.html[this.position],this.advance();return this.position<this.html.length&&this.html.substr(this.position,3)==="-->"&&(this.position+=3,this.updatePosition()),{type:"comment",content:r,line:e,column:t}}isSelfClosingTag(e){return["br","img","hr","area","base","col","input"].includes(e.toLowerCase())}skipWhitespace(){for(;this.position<this.html.length&&/\s/.test(this.html[this.position]);)this.advance()}advance(){this.position>=this.html.length||(this.html[this.position]===`
`?(this.line++,this.column=1):this.column++,this.position++)}updatePosition(){for(let e=0;e<3&&this.position-3+e>=0;e++)this.html[this.position-3+e]===`
`?(this.line++,this.column=1):this.column++}}function Q(i,e){if(Array.isArray(i))for(const t of i)t&&(e(t),t.children&&Array.isArray(t.children)&&t.children.length>0&&Q(t.children,e))}function Ae(i,e){if(!Array.isArray(i)||!e)return[];const t=[];return Q(i,r=>{r.type==="element"&&r.tagName===e.toLowerCase()&&t.push(r)}),t}const F={TAG_OPENING:i=>`<${i}(?:\\s[^>]*)?>`,TAG_CLOSING:i=>`</${i}>`,TAG_SELF_CLOSING:i=>`<${i}(?:\\s[^>]*)?/>`,TAG_WITH_CONTENT:i=>`<${i}(?:\\s[^>]*)?>[\\s\\S]*?</${i}>`,ATTRIBUTE_STYLE_DUPLICATE:'style="([^"]*)"([^>]*?)style="([^"]*)"',ATTRIBUTE_EMPTY_HREF:`href\\s*=\\s*(?:"\\s*"|'\\s*'|\\s*)`,ATTRIBUTE_TARGET_WRONG:`target\\s*=\\s*(?:"(?:_self|_parent|_top)"|'(?:_self|_parent|_top)')`,ATTRIBUTE_MALFORMED_SRC:"\\bs\\s+rc=",ATTRIBUTE_MISSING_SPACE:'="([^"]*)"([a-zA-Z]+=)',IMG_MALFORMED_ATTR_SPACING:'(<img[^>]*?)([a-zA-Z0-9_.-]+")([a-zA-Z]+=)',IMG_SELF_CLOSING_WRONG:"<img\\s*([^>]*?)></img>",IMG_MISSING_ALT:"<img(?![^>]*\\salt=)[^>]*>",IMG_MISSING_WIDTH:"<img(?![^>]*\\swidth=)[^>]*>",IMG_MISSING_HEIGHT:"<img(?![^>]*\\sheight=)[^>]*>",LINK_EMPTY_HREF:`<a[^>]*href\\s*=\\s*(?:"\\s*"|'\\s*'|\\s*)[^>]*>`,LINK_NO_TARGET:`<a[^>]*href\\s*=\\s*(?:"[^"]+"|'[^']+')[^>]*(?!target\\s*=)[^>]*>`,LINK_NO_STYLE:`<a[^>]*href\\s*=\\s*(?:"[^"]+"|'[^']+')[^>]*(?!style\\s*=)[^>]*>`,TABLE_NESTED_EXCESSIVE:"<table([^>]*)><tr><td([^>]*)><table([^>]*)><tr><td([^>]*)>",TABLE_NESTED_CLOSING:"</td></tr></table></td></tr></table>",TABLE_EMPTY:"<table[^>]*><tr><td[^>]*>\\s*</td></tr></table>",TABLE_SINGLE_SPAN_WRAPPER:"<table[^>]*><tr><td[^>]*>(\\s*<span[^>]*>[^<]+</span>\\s*)</td></tr></table>",STYLE_WIDTH_PERCENTAGE:'style="([^"]*?)width:\\s*100%([^"]*?)"',EMPTY_SPAN:"<span[^>]*>\\s*</span>",EMPTY_SPAN_WHITESPACE:"<span[^>]*>[\\s\\t\\n\\r]*</span>",EXTRA_SPACES_IN_TAG:"\\s+>",EXTRA_SPACES_MULTIPLE:"\\s{2,}",UNSAFE_ATTRIBUTE:i=>`\\s${i}\\s*=\\s*(?:"[^"]*"|'[^']*')`},We={GLOBAL_CASE_INSENSITIVE:"gi",GLOBAL_CASE_INSENSITIVE_MULTILINE:"gim",GLOBAL_CASE_INSENSITIVE_DOTALL:"gis",CASE_INSENSITIVE:"i",GLOBAL:"g"},hs=["table","tbody","thead","tfoot","tr","td","th","img","a","span","strong","b","em","i","u","br","center","font","big","small","sup","sub","ul","ol","li","blockquote","pre"],ve=["div","p","h1","h2","h3","h4","h5","h6","section","article","aside","nav","header","footer","main","figure","figcaption","canvas","svg","video","audio","iframe","embed","object","script","form","input","button","textarea","select","option","fieldset","legend","label"],fs={table:['cellpadding="0"','cellspacing="0"','border="0"'],img:["alt",'style="display:block"'],a:['target="_blank"'],td:['valign="top"']},j={isValidHtml:i=>!!(i&&typeof i=="string"),createValidationResult:(i,e,t,r,s,n,o)=>({rule:i,severity:e,message:t,suggestion:r,autoFixAvailable:!0,category:s,line:n,column:o}),hasPattern:(i,e,t=We.GLOBAL_CASE_INSENSITIVE)=>{if(!j.isValidHtml(i))return!1;try{const r=t.replace("g","");return d.get(e,r).test(i)}catch{return!1}},findPatternMatches:(i,e,t=We.GLOBAL_CASE_INSENSITIVE)=>{const r=[];if(!j.isValidHtml(i))return r;try{const s=t.includes("g")?t:`${t}g`,n=d.get(e,s);for(const o of i.matchAll(n))r.push(o)}catch{}return r},checkForbiddenTagsAST:(i,e,t,r)=>{if(!i||!Array.isArray(e))return;const s=n=>{for(const o of n)o.type==="element"&&o.tagName&&e.includes(o.tagName)&&r(o,o.tagName),o.children&&Array.isArray(o.children)&&s(o.children)};s(i)},checkForbiddenTagsRegex:(i,e,t,r)=>{!j.isValidHtml(i)||!Array.isArray(e)||e.forEach(s=>{const n=F.TAG_OPENING(s);j.findPatternMatches(i,n).length>0&&r(s)})}},ms={replaceTagsWithSpans:(i,e)=>{if(!j.isValidHtml(i))return i;let t=i;try{Object.entries(e).forEach(([r,s])=>{const n=`<${r}((?:\\s[^>]*)?)>`,o=F.TAG_CLOSING(r),l=Object.entries(s).map(([c,u])=>{switch(c){case"fontSize":return`font-size: ${u}px`;case"fontWeight":return`font-weight: ${u}`;case"display":return`display: ${u}`;default:return`${c}: ${u}`}}).join("; ");t=t.replace(d.get(n,"gi"),(c,u)=>{const g=u.match(/style\s*=\s*["']([^"']*)["']/i);let f=l;if(g){const E=g[1].replace(/;\s*$/,""),L={};E.split(";").forEach(I=>{const[y,A]=I.split(":").map(R=>R.trim());y&&A&&(L[y]=A)}),l.split(";").forEach(I=>{const[y,A]=I.split(":").map(R=>R.trim());y&&A&&(L[y]=A)}),f=Object.entries(L).map(([I,y])=>`${I}: ${y}`).join("; "),u=u.replace(/\s*style\s*=\s*["'][^"']*["']/gi,"")}return`<span${u} style="${f};">`}),t=t.replace(d.get(o,"gi"),"</span>")})}catch{}return t},replaceBlockElementsWithTables:(i,e)=>{if(!j.isValidHtml(i))return i;let t=i;try{Array.isArray(e)&&e.forEach(r=>{const s=F.TAG_OPENING(r),n=F.TAG_CLOSING(r);t=t.replace(d.get(s),'<table cellpadding="0" cellspacing="0" border="0"$1><tr><td valign="top">'),t=t.replace(d.get(n),"</td></tr></table>")})}catch{}return t},removeDangerousTags:(i,e)=>{if(!j.isValidHtml(i))return i;let t=i;try{Array.isArray(e)&&e.forEach(r=>{const s=F.TAG_WITH_CONTENT(r),n=F.TAG_SELF_CLOSING(r);t=t.replace(d.get(s,We.GLOBAL_CASE_INSENSITIVE_DOTALL),""),t=t.replace(d.get(n),"")})}catch{}return t},cleanupTableNesting:(i,e=10)=>{if(!j.isValidHtml(i))return i;let t=i;try{let r,s=0;do r=t,t=t.replace(d.get(F.TABLE_NESTED_EXCESSIVE),"<table$1><tr><td$2>"),t=t.replace(d.get(F.TABLE_NESTED_CLOSING),"</td></tr></table>"),s++;while(r!==t&&s<e);t=t.replace(d.get(F.TABLE_EMPTY),""),t=t.replace(d.get(F.TABLE_SINGLE_SPAN_WRAPPER),"$1")}catch{}return t},mergeDuplicateStyles:(i,e=3)=>{if(!j.isValidHtml(i))return i;let t=i;try{let r,s=0;do r=t,t=t.replace(d.get(F.ATTRIBUTE_STYLE_DUPLICATE),(n,o,l,c)=>{var y;const u=o.split(";").filter(A=>A.trim()),g=c.split(";").filter(A=>A.trim()),f=[...u,...g],E=[],L=new Set;for(const A of f.reverse()){const R=(y=A.split(":")[0])==null?void 0:y.trim();R&&!L.has(R)&&(L.add(R),E.unshift(A.trim()))}return`style="${E.join("; ")}"${l}`}),s++;while(r!==t&&s<e)}catch{}return t},removeEmptyElements:i=>{if(!j.isValidHtml(i))return i;let e=i;try{e=e.replace(d.get(F.EMPTY_SPAN),""),e=e.replace(d.get(F.EMPTY_SPAN_WHITESPACE),"")}catch{}return e}},bs={h1:32,h2:24,h3:20,h4:18,h5:16,h6:14},M={"forbidden-tags":{name:"forbidden-tags",displayName:"Forbidden HTML Tags (Legacy)",description:"Legacy rule - replaced by specific rules (heading-tags, paragraph-tags, etc.)",severity:"error",enabled:!1,configurable:!0,category:"structure",config:{allowedTags:hs,forbiddenTags:ve},check:(i,e={})=>{const t=[];if(!i||typeof i!="string")return t;try{const s=new Be(i).parse(),n=e.forbiddenTags||ve;Q(s,o=>{o.type==="element"&&o.tagName&&Array.isArray(n)&&n.includes(o.tagName)&&t.push({rule:"forbidden-tags",severity:"error",message:`Tag "${o.tagName}" is not email-safe`,line:o.line,column:o.column,suggestion:Ue(o.tagName),autoFixAvailable:!0,category:"structure"})})}catch{const s=e.forbiddenTags||ve;Array.isArray(s)&&s.forEach(n=>{const o=d.get(`<${n}(?:\\s[^>]*)?>`,"gi"),l=i.match(o);l&&l.forEach(()=>{t.push({rule:"forbidden-tags",severity:"error",message:`Tag "${n}" is not email-safe`,suggestion:Ue(n),autoFixAvailable:!0,category:"structure"})})})}return t},checkWithAST:(i,e,t={})=>{const r=[];if(!i||typeof i!="string"||!e)return r;try{const s=t.forbiddenTags||ve;Q(e,n=>{n.type==="element"&&n.tagName&&Array.isArray(s)&&s.includes(n.tagName)&&r.push({rule:"forbidden-tags",severity:"error",message:`Tag "${n.tagName}" is not email-safe`,line:n.line,column:n.column,suggestion:Ue(n.tagName),autoFixAvailable:!0,category:"structure"})})}catch{return M["forbidden-tags"].check(i,t)}return r},autofix:i=>{if(!i||typeof i!="string")return i;let e=i;try{for(let o=1;o<=_.MAX_HEADING_LEVELS;o++){const l=d.get(`<h${o}([^>]*)>`),c=d.get(`</h${o}>`);e=e.replace(l,`<span$1 style="font-weight: bold; font-size: ${xs(o)}px;">`),e=e.replace(c,"</span>")}e=e.replace(d.get("<p([^>]*)>"),"<span$1>"),e=e.replace(d.get("</p>"),"</span>");const t=["div","section","article","nav","header","footer","main","aside","figure","figcaption"],r=(e.match(/<table/g)||[]).length,s=T.MAX_TABLES;r<s&&t.forEach(o=>{const l=d.get(`<${o}((?:\\s[^>]*)?)>`),c=d.get(`</${o}>`);e=e.replace(l,'<table cellpadding="0" cellspacing="0" border="0"$1><tr><td valign="top">'),e=e.replace(c,"</td></tr></table>")}),["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"].forEach(o=>{const l=d.get(`<${o}(?:\\s[^>]*)?>(?:[\\s\\S]*?)</${o}>`,"gi");e=e.replace(l,"");const c=d.get(`<${o}(?:\\s[^>]*)?/>`,"gi");e=e.replace(c,"")});for(let o=0;o<T.MAX_STYLE_MERGE_ITERATIONS;o++){const l=e;if(e=e.replace(d.get('style="([^"]*?)"([^>]*?)style="([^"]*?)"'),(c,u,g,f)=>{var N;const E=u.split(";").filter(H=>H.trim()),L=f.split(";").filter(H=>H.trim()),I=[...E,...L],y=[],A=new Set;for(const H of I){const $=(N=H.split(":")[0])==null?void 0:N.trim();$&&!A.has($)&&(A.add($),y.push(H.trim()))}return`style="${y.join("; ")}"${g}`}),l===e)break}for(let o=0;o<T.MAX_AUTOFIX_ITERATIONS;o++){const l=e;if(e=e.replace(d.get("<table([^>]*?)><tr><td([^>]*?)><table([^>]*?)><tr><td([^>]*?)>"),"<table$1><tr><td$2>"),e=e.replace(d.get("<\\/td><\\/tr><\\/table><\\/td><\\/tr><\\/table>"),"</td></tr></table>"),l===e)break}e=e.replace(d.get("<table[^>]*><tr><td[^>]*>\\s*<\\/td><\\/tr><\\/table>"),""),e=e.replace(d.get("<table[^>]*><tr><td[^>]*>(\\s*<span[^>]*>[^<]+<\\/span>\\s*)<\\/td><\\/tr><\\/table>"),"$1"),e=e.replace(d.get("<span[^>]*>\\s*<\\/span>"),""),e=e.replace(d.get("<span[^>]*>[\\s\\t\\n\\r]*<\\/span>"),""),e=e.replace(d.get("\\bs\\s+rc="),"src="),e=e.replace(d.get("\\bS\\s+RC="),"src="),e=e.replace(d.get('="([^"]*)"([a-zA-Z]+=)'),'="$1" $2'),e=e.replace(d.get('(<img[^>]*?)([a-zA-Z0-9_.-]+")([a-zA-Z]+=)'),"$1$2 $3")}catch{}return e=e.replace(d.get("\\bs\\s+rc="),"src="),e=e.replace(d.get("\\bS\\s+RC="),"src="),e}},"email-safe-tags":{name:"email-safe-tags",displayName:"Email-Safe Tag Format",description:"Ensures tags are formatted correctly for email clients",severity:"error",enabled:!0,configurable:!1,category:"structure",check:i=>{const e=[];if(!i||typeof i!="string")return e;try{["br","hr"].forEach(s=>{const n=d.get(`<${s}\\s*[^>]*><\\/${s}>`),o=i.match(n);o&&o.forEach(()=>{e.push({rule:"email-safe-tags",severity:"error",message:`Tag "${s}" should not have closing tag in emails`,suggestion:`Replace <${s}></${s}> with <${s}>`,autoFixAvailable:!0,category:"structure"})});const l=d.get(`<${s}\\s*[^>]*\\/>`),c=i.match(l);c&&c.forEach(()=>{e.push({rule:"email-safe-tags",severity:"error",message:`Tag "${s}" should be open tag in emails, not self-closing`,suggestion:`Replace <${s}/> with <${s}>`,autoFixAvailable:!0,category:"structure"})})}),["img"].forEach(s=>{const n=d.get(`<${s}\\s*[^>]*><\\/${s}>`),o=i.match(n);o&&o.forEach(()=>{e.push({rule:"email-safe-tags",severity:"error",message:`Tag "${s}" should be self-closing`,suggestion:`Replace <${s}></${s}> with <${s} />`,autoFixAvailable:!0,category:"structure"})})})}catch{}return e},autofix:i=>{if(!i||typeof i!="string")return i;try{const e=new ze;return e.add(d.get("<br\\s*[^>]*><\\/br>"),"<br>").add(d.get("<br\\s*[^>]*\\/>"),"<br>").add(d.get("<hr\\s*[^>]*><\\/hr>"),"<hr>").add(d.get("<hr\\s*[^>]*\\/>"),"<hr>").add(d.get("<img\\s*([^>]*?)><\\/img>"),"<img $1 />").add(d.get("<br\\/\\s*\\/>"),"<br>").add(d.get("<br\\s*\\/\\s*\\/>"),"<br>").add(d.get("<hr\\/\\s*\\/>"),"<hr>").add(d.get("<hr\\s*\\/\\s*\\/>"),"<hr>").add(d.get("(<img[^>]*?)\\s*\\/\\s*([^>]*?)>"),"$1$2 />").add(d.get(`(<img[^>]*?)([^"'])\\s*\\/\\s*([^>]*?)>`),"$1$2$3 />").add(d.get("<img([^>]*?)([^/])\\s*\\/\\s*\\/\\s*>"),"<img$1$2 />").add(d.get("(<img[^>]*?)\\s+\\/>","g"),"$1 />").add(d.get("(<img[^>]*?)([a-zA-Z])([a-zA-Z]+=)"),"$1$2 $3").add(d.get("\\s+(style|alt|src|class|width|height)=")," $1=").add(d.get(`=\\s*([^"'\\s>]+)`),'="$1"').add(d.get("\\s+>","gi"),">").add(d.get("<\\s+","gi"),"<").add(d.get("\\bs\\s+rc="),"src=").add(d.get("\\bS\\s+RC="),"src="),e.execute(i)}catch{return i}}},"table-attributes":{name:"table-attributes",displayName:"Required Table Attributes",description:"Ensures tables have required email-safe attributes",severity:"error",enabled:!0,configurable:!0,category:"structure",config:{requiredAttributes:fs},check:i=>{const e=[];if(!i||typeof i!="string")return e;try{const r=new Be(i).parse();Ae(r,"table").forEach(o=>{const l=o.attributes||{};(!l.cellpadding||l.cellpadding!=="0")&&e.push({rule:"table-attributes",severity:"error",message:'Table should have cellpadding="0"',line:o.line,column:o.column,suggestion:'Add cellpadding="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!l.cellspacing||l.cellspacing!=="0")&&e.push({rule:"table-attributes",severity:"error",message:'Table should have cellspacing="0"',line:o.line,column:o.column,suggestion:'Add cellspacing="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!l.border||l.border!=="0")&&e.push({rule:"table-attributes",severity:"error",message:'Table should have border="0"',line:o.line,column:o.column,suggestion:'Add border="0" to table tag',autoFixAvailable:!0,category:"structure"})}),Ae(r,"img").forEach(o=>{const l=o.attributes||{};l.alt||e.push({rule:"table-attributes",severity:"error",message:"Image must have alt attribute",line:o.line,column:o.column,suggestion:'Add alt="" to img tag',autoFixAvailable:!0,category:"accessibility"}),l.width||e.push({rule:"table-attributes",severity:"error",message:"Image must have width attribute",line:o.line,column:o.column,suggestion:`Add width="${T.DEFAULT_IMAGE_WIDTH}" to img tag`,autoFixAvailable:!0,category:"structure"}),l.height||e.push({rule:"table-attributes",severity:"error",message:"Image must have height attribute",line:o.line,column:o.column,suggestion:`Add height="${T.DEFAULT_IMAGE_HEIGHT}" to img tag`,autoFixAvailable:!0,category:"structure"}),(!l.style||!l.style.includes("display:block"))&&e.push({rule:"table-attributes",severity:"error",message:'Image must have style="display:block"',line:o.line,column:o.column,suggestion:'Add style="display:block" to img tag',autoFixAvailable:!0,category:"structure"})})}catch{e.push({rule:"table-attributes",severity:"warning",message:"Unable to parse HTML for detailed checking",suggestion:'Check table attributes manually: cellpadding="0" cellspacing="0" border="0"',autoFixAvailable:!1,category:"structure"})}return e},checkWithAST:(i,e,t,r)=>{const s=[];if(!i||typeof i!="string"||!e)return s;try{((r==null?void 0:r.findNodesByTag("table"))||Ae(e,"table")).forEach(l=>{const c=l.attributes||{};(!c.cellpadding||c.cellpadding!=="0")&&s.push({rule:"table-attributes",severity:"error",message:'Table should have cellpadding="0"',line:l.line,column:l.column,suggestion:'Add cellpadding="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!c.cellspacing||c.cellspacing!=="0")&&s.push({rule:"table-attributes",severity:"error",message:'Table should have cellspacing="0"',line:l.line,column:l.column,suggestion:'Add cellspacing="0" to table tag',autoFixAvailable:!0,category:"structure"}),(!c.border||c.border!=="0")&&s.push({rule:"table-attributes",severity:"error",message:'Table should have border="0"',line:l.line,column:l.column,suggestion:'Add border="0" to table tag',autoFixAvailable:!0,category:"structure"})}),((r==null?void 0:r.findNodesByTag("img"))||Ae(e,"img")).forEach(l=>{const c=l.attributes||{};c.alt||s.push({rule:"table-attributes",severity:"error",message:"Image must have alt attribute",line:l.line,column:l.column,suggestion:'Add alt="" to img tag',autoFixAvailable:!0,category:"accessibility"}),c.width||s.push({rule:"table-attributes",severity:"error",message:"Image must have width attribute",line:l.line,column:l.column,suggestion:`Add width="${T.DEFAULT_IMAGE_WIDTH}" to img tag`,autoFixAvailable:!0,category:"structure"}),c.height||s.push({rule:"table-attributes",severity:"error",message:"Image must have height attribute",line:l.line,column:l.column,suggestion:`Add height="${T.DEFAULT_IMAGE_WIDTH}" to img tag`,autoFixAvailable:!0,category:"structure"}),(!c.style||!c.style.includes("display:block"))&&s.push({rule:"table-attributes",severity:"error",message:'Image must have style="display:block"',line:l.line,column:l.column,suggestion:'Add style="display:block" to img tag',autoFixAvailable:!0,category:"structure"})})}catch{return M["table-attributes"].check(i)}return s},autofix:i=>{if(!i||typeof i!="string")return i;let e=i;try{e=e.replace(/<table([^>]*?)>/gi,(t,r)=>{let s=r;return s=s.replace(/cellpadding="[^"]*"/gi,'cellpadding="0"'),s=s.replace(/cellspacing="[^"]*"/gi,'cellspacing="0"'),s=s.replace(/border="[^"]*"/gi,'border="0"'),s.includes("cellpadding=")||(s+=' cellpadding="0"'),s.includes("cellspacing=")||(s+=' cellspacing="0"'),s.includes("border=")||(s+=' border="0"'),`<table${s}>`}),e=e.replace(/<td([^>]*?)>/gi,(t,r)=>{let s=r;return s=s.replace(/valign="(middle|bottom|baseline)"/gi,'valign="top"'),s.includes("valign=")||(s+=' valign="top"'),`<td${s}>`}),e=e.replace(/<img([^>]*?)(\s*\/?\s*)>/gi,(t,r)=>{let s=r;return s.includes("width=")||(s+=` width="${T.DEFAULT_IMAGE_WIDTH}"`),s.includes("height=")||(s+=` height="${T.DEFAULT_IMAGE_HEIGHT}"`),s.includes("width: 100%")&&!s.includes("max-width:")&&(s=s.replace(/style="([^"]*?)width:\s*100%([^"]*?)"/gi,(n,o,l)=>{const c=o.trim(),u=l.trim(),g=c&&!c.endsWith(";")?"; ":"",f=u&&!u.startsWith(";")?"; ":"";return`style="${c}${g}max-width:100%${f}${u}"`})),s.includes("style=")?s.includes("display:block")||(s=s.replace(/style="([^"]*?)"/gi,(n,o)=>{const l=o.trim(),c=l&&!l.endsWith(";")?"; ":"";return`style="${l}${c}display:block"`})):s+=' style="display:block"',`<img${s} />`})}catch{}return e}},"email-safe-links":{name:"email-safe-links",displayName:"Email-Safe Links",description:"Ensures links are formatted correctly for email clients",severity:"error",enabled:!0,configurable:!1,category:"structure",check:i=>{const e=[];if(!i||typeof i!="string")return e;try{const t=/<a[^>]*href\s*=\s*["']?\s*["']?[^>]*>/gi;for(const o of i.matchAll(t))(o[0].includes('href=""')||o[0].includes("href=''"))&&e.push({rule:"email-safe-links",severity:"error",message:"Link has empty href attribute",suggestion:"Remove empty links or provide valid href",autoFixAvailable:!0,category:"structure"});const r=/<a[^>]*target\s*=\s*["'](_self|_parent|_top)["'][^>]*>/gi;for(const o of i.matchAll(r))e.push({rule:"email-safe-links",severity:"warning",message:`Link target "${o[1]}" doesn't work in most email clients`,suggestion:'Use target="_blank" for all email links',autoFixAvailable:!0,category:"compatibility"});const s=/<a[^>]*href\s*=\s*["'][^"']*["'][^>]*(?!target\s*=)[^>]*>/gi;for(const o of i.matchAll(s))o[0].includes("target=")||e.push({rule:"email-safe-links",severity:"warning",message:'Link should have target="_blank" in emails',suggestion:'Add target="_blank" to all email links',autoFixAvailable:!0,category:"best-practice"});const n=/<a[^>]*href\s*=\s*["'][^"']*["'][^>]*(?!style\s*=)[^>]*>/gi;for(const o of i.matchAll(n))o[0].includes("style=")||e.push({rule:"email-safe-links",severity:"warning",message:"Link should have inline styles for email compatibility",suggestion:'Add style="color:#0000ff; text-decoration:none;" to links',autoFixAvailable:!0,category:"best-practice"})}catch{}return e},autofix:i=>{if(!i||typeof i!="string")return i;let e=i;try{e=e.replace(/<a\b([^>]*?)href\s*=\s*["']?\s*["']?([^>]*?)>/gi,(t,r,s)=>t.includes('href=""')||t.includes("href=''")||t.includes("href= ")?`<a${r} href="${nt.DEFAULT_HREF_VALUE}"${s}>`:t),e=e.replace(/<a\b([^>]*?)target\s*=\s*["'](_self|_parent|_top)["']([^>]*?)>/gi,'<a$1target="_blank"$3>'),e=e.replace(/<a\b([^>]*)>/gi,(t,r)=>{let s=r;return s=s.replace(/\s+href\s+([^"\s>]+)/gi,' href="$1"'),s=s.replace(/\s+href\s+"([^"]*)"([^>]*)/gi,' href="$1"$2'),s.includes("href=")||(s+=` href="${nt.DEFAULT_HREF_VALUE}"`),s.includes("target=")||(s+=' target="_blank"'),s.includes("style=")?s.includes("text-decoration:")||(s=s.replace(/style="([^"]*?)"/gi,(n,o)=>{const l=o.trim(),c=l&&!l.endsWith(";")?"; ":"";return`style="${l}${c}text-decoration:none"`})):s+=' style="color:#0000ff; text-decoration:none;"',`<a${s}>`})}catch{}return e}},"email-unsafe-attributes":{name:"email-unsafe-attributes",displayName:"Email-Unsafe Attributes",description:"Removes attributes that don't work or are dangerous in emails",severity:"warning",enabled:!0,configurable:!1,category:"compatibility",check:i=>{const e=[];if(!i||typeof i!="string")return e;try{["id","class","onclick","onload","onmouseover","contenteditable","draggable","data-\\w+"].forEach(r=>{d.get(`\\s${r}\\s*=\\s*["'][^"']*["']`).test(i)&&e.push({rule:"email-unsafe-attributes",severity:"warning",message:`Attribute "${r}" may not work in email clients`,suggestion:"Remove or replace with inline styles",autoFixAvailable:!0,category:"compatibility"})})}catch{}return e},autofix:i=>{if(!i||typeof i!="string")return i;try{const e=new ze;return["id","class","onclick","onload","onmouseover","onmouseout","onfocus","onblur","contenteditable","draggable","spellcheck","tabindex","accesskey","data-[\\w-]+","aria-[\\w-]+"].forEach(r=>{e.add(d.get(`\\s${r}\\s*=\\s*["'][^"']*["']`),"")}),e.add(d.get("\\s+>","g"),">").add(d.get("\\s{2,}","g")," "),e.execute(i)}catch{return i}}},"heading-tags":{name:"heading-tags",displayName:"Heading Tags Replacement",description:"Replaces h1-h6 tags with styled spans for email compatibility",severity:"error",enabled:!0,configurable:!1,category:"structure",check:i=>{const e=[];if(!j.isValidHtml(i))return e;try{for(let t=1;t<=_.MAX_HEADING_LEVELS;t++){const r=F.TAG_OPENING(`h${t}`);j.findPatternMatches(i,r).forEach(()=>{e.push(j.createValidationResult("heading-tags","error",`Heading tag h${t} is not email-safe`,`Replace h${t} with styled span`,"structure"))})}}catch{}return e},checkWithAST:(i,e)=>{const t=[];if(!j.isValidHtml(i)||!e)return t;try{const r=["h1","h2","h3","h4","h5","h6"];j.checkForbiddenTagsAST(e,r,"heading-tags",s=>{t.push(j.createValidationResult("heading-tags","error",`Heading tag ${s.tagName} is not email-safe`,`Replace ${s.tagName} with styled span`,"structure",s.line,s.column))})}catch{return M["heading-tags"].check(i)}return t},autofix:i=>{if(!j.isValidHtml(i))return i;try{const e=Object.fromEntries(Object.entries(bs).map(([t,r])=>[t,{fontSize:r,fontWeight:"bold"}]));return ms.replaceTagsWithSpans(i,e)}catch{return i}}},"paragraph-tags":{name:"paragraph-tags",displayName:"Paragraph Tags Replacement",description:"Replaces p tags with spans for email compatibility",severity:"error",enabled:!0,configurable:!1,category:"structure",check:i=>{const e=[];if(!j.isValidHtml(i))return e;try{const t=F.TAG_OPENING("p");j.findPatternMatches(i,t).forEach(()=>{e.push(j.createValidationResult("paragraph-tags","error","Paragraph tag is not email-safe","Replace p with span","structure"))})}catch{}return e},checkWithAST:(i,e)=>{const t=[];if(!i||typeof i!="string"||!e)return t;try{Q(e,r=>{r.type==="element"&&r.tagName==="p"&&t.push({rule:"paragraph-tags",severity:"error",message:"Paragraph tag is not email-safe",line:r.line,column:r.column,suggestion:"Replace p with span",autoFixAvailable:!0,category:"structure"})})}catch{return M["paragraph-tags"].check(i)}return t},autofix:i=>{if(!i||typeof i!="string")return i;let e=i;try{e=e.replace(d.get("<p([^>]*)>"),"<span$1>"),e=e.replace(d.get("</p>"),"</span>")}catch{}return e}},"block-element-tags":{name:"block-element-tags",displayName:"Block Element Tags Replacement",description:"Replaces block elements (div, section, etc.) with table structure for email compatibility",severity:"error",enabled:!0,configurable:!0,category:"structure",config:{blockTags:["div","section","article","nav","header","footer","main","aside","figure","figcaption"]},check:(i,e={})=>{const t=[];if(!i||typeof i!="string")return t;try{const r=e.blockTags||["div","section","article","nav","header","footer","main","aside","figure","figcaption"];Array.isArray(r)&&r.forEach(s=>{const n=d.get(`<${s}(?:\\s[^>]*)?>`,"gi"),o=i.match(n);o&&o.forEach(()=>{t.push({rule:"block-element-tags",severity:"error",message:`Block element "${s}" is not email-safe`,suggestion:`Replace ${s} with table structure`,autoFixAvailable:!0,category:"structure"})})})}catch{}return t},checkWithAST:(i,e,t={})=>{const r=[];if(!i||typeof i!="string"||!e)return r;try{const s=t.blockTags||["div","section","article","nav","header","footer","main","aside","figure","figcaption"];Q(e,n=>{n.type==="element"&&n.tagName&&Array.isArray(s)&&s.includes(n.tagName)&&r.push({rule:"block-element-tags",severity:"error",message:`Block element "${n.tagName}" is not email-safe`,line:n.line,column:n.column,suggestion:`Replace ${n.tagName} with table structure`,autoFixAvailable:!0,category:"structure"})})}catch{return M["block-element-tags"].check(i,t)}return r},autofix:(i,e={})=>{if(!i||typeof i!="string")return i;let t=i;try{const r=e.blockTags||["div","section","article","nav","header","footer","main","aside","figure","figcaption"];if(Array.isArray(r)){const s=(t.match(/<table/g)||[]).length,n=T.MAX_TABLES;s<n&&r.forEach(o=>{const l=d.get(`<${o}([^>]*)>`),c=d.get(`</${o}>`);t=t.replace(l,'<table cellpadding="0" cellspacing="0" border="0"$1><tr><td valign="top">'),t=t.replace(c,"</td></tr></table>")})}}catch{}return t}},"dangerous-tags":{name:"dangerous-tags",displayName:"Dangerous Tags Removal",description:"Removes dangerous/unsupported tags (script, style, form, etc.) completely",severity:"error",enabled:!0,configurable:!0,category:"structure",config:{dangerousTags:["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"]},check:(i,e={})=>{const t=[];if(!i||typeof i!="string")return t;try{const r=e.dangerousTags||["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"];Array.isArray(r)&&r.forEach(s=>{const n=d.get(`<${s}(?:\\s[^>]*)?>`,"gi"),o=i.match(n);o&&o.forEach(()=>{t.push({rule:"dangerous-tags",severity:"error",message:`Dangerous tag "${s}" should be removed`,suggestion:`Remove ${s} tag completely`,autoFixAvailable:!0,category:"structure"})})})}catch{}return t},checkWithAST:(i,e,t={})=>{const r=[];if(!i||typeof i!="string"||!e)return r;try{const s=t.dangerousTags||["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"];Q(e,n=>{n.type==="element"&&n.tagName&&Array.isArray(s)&&s.includes(n.tagName)&&r.push({rule:"dangerous-tags",severity:"error",message:`Dangerous tag "${n.tagName}" should be removed`,line:n.line,column:n.column,suggestion:`Remove ${n.tagName} tag completely`,autoFixAvailable:!0,category:"structure"})})}catch{return M["dangerous-tags"].check(i,t)}return r},autofix:(i,e={})=>{if(!i||typeof i!="string")return i;let t=i;try{const r=e.dangerousTags||["script","style","form","input","button","textarea","select","option","fieldset","legend","label","video","audio","canvas","svg","iframe","embed","object","base","col","area"];Array.isArray(r)&&r.forEach(s=>{const n=d.get(`<${s}(?:\\s[^>]*)?>(?:[\\s\\S]*?)</${s}>`,"gi");t=t.replace(n,"");const o=d.get(`<${s}(?:\\s[^>]*)?/>`,"gi");t=t.replace(o,"")})}catch{}return t}},"duplicate-styles":{name:"duplicate-styles",displayName:"Duplicate Style Attributes Cleanup",description:"Merges duplicate style attributes in HTML elements",severity:"warning",enabled:!0,configurable:!1,category:"best-practice",check:i=>{const e=[];if(!i||typeof i!="string")return e;try{d.get('style="([^"]*?)"([^>]*?)style="([^"]*?)"').test(i)&&e.push({rule:"duplicate-styles",severity:"warning",message:"Duplicate style attributes found",suggestion:"Merge duplicate style attributes",autoFixAvailable:!0,category:"best-practice"})}catch{}return e},autofix:i=>{if(!i||typeof i!="string")return i;let e=i;try{for(let t=0;t<T.MAX_STYLE_MERGE_ITERATIONS;t++){const r=e;if(e=e.replace(d.get('style="([^"]*?)"([^>]*?)style="([^"]*?)"'),(s,n,o,l)=>{var I;const c=n.split(";").filter(y=>y.trim()),u=l.split(";").filter(y=>y.trim()),g=[...c,...u],f=[],E=new Set;for(const y of g.reverse()){const A=(I=y.split(":")[0])==null?void 0:I.trim();A&&!E.has(A)&&(E.add(A),f.unshift(y.trim()))}return`style="${f.join("; ")}"${o}`}),r===e)break}}catch{}return e}},"table-nesting-cleanup":{name:"table-nesting-cleanup",displayName:"Table Nesting Cleanup",description:"Reduces excessive table nesting for better email rendering",severity:"warning",enabled:!0,configurable:!0,category:"structure",config:{maxIterations:T.MAX_AUTOFIX_ITERATIONS},check:i=>{const e=[];if(!i||typeof i!="string")return e;try{d.get("<table([^>]*?)><tr><td([^>]*?)><table([^>]*?)><tr><td([^>]*?)>").test(i)&&e.push({rule:"table-nesting-cleanup",severity:"warning",message:"Excessive table nesting detected",suggestion:"Reduce table nesting for better email compatibility",autoFixAvailable:!0,category:"structure"})}catch{}return e},autofix:(i,e={})=>{if(!i||typeof i!="string")return i;let t=i;try{const r=typeof e.maxIterations=="number"?e.maxIterations:T.MAX_AUTOFIX_ITERATIONS;for(let s=0;s<r;s++){const n=t;if(t=t.replace(d.get("<table([^>]*?)><tr><td([^>]*?)><table([^>]*?)><tr><td([^>]*?)>"),"<table$1><tr><td$2>"),t=t.replace(d.get("<\\/td><\\/tr><\\/table><\\/td><\\/tr><\\/table>"),"</td></tr></table>"),n===t)break}t=t.replace(d.get("<table[^>]*><tr><td[^>]*>\\s*<\\/td><\\/tr><\\/table>"),""),t=t.replace(d.get("<table[^>]*><tr><td[^>]*>(\\s*<span[^>]*>[^<]+<\\/span>\\s*)<\\/td><\\/tr><\\/table>"),"$1")}catch{}return t}},"empty-elements-cleanup":{name:"empty-elements-cleanup",displayName:"Empty Elements Cleanup",description:"Removes empty and whitespace-only elements",severity:"info",enabled:!0,configurable:!1,category:"best-practice",check:i=>{const e=[];if(!i||typeof i!="string")return e;try{d.get("<span[^>]*>\\s*<\\/span>").test(i)&&e.push({rule:"empty-elements-cleanup",severity:"info",message:"Empty elements found",suggestion:"Remove empty and whitespace-only elements",autoFixAvailable:!0,category:"best-practice"})}catch{}return e},autofix:i=>{if(!i||typeof i!="string")return i;let e=i;try{e=e.replace(d.get("<span[^>]*>\\s*<\\/span>"),""),e=e.replace(d.get("<span[^>]*>[\\s\\t\\n\\r]*<\\/span>"),"")}catch{}return e}},"malformed-attributes":{name:"malformed-attributes",displayName:"Malformed Attributes Fix",description:'Fixes malformed attributes like "s rc" to "src"',severity:"error",enabled:!0,configurable:!1,category:"structure",check:i=>{const e=[];if(!i||typeof i!="string")return e;try{d.get("\\bs\\s+rc=").test(i)&&e.push({rule:"malformed-attributes",severity:"error",message:'Malformed "s rc" attribute found',suggestion:'Fix "s rc" to "src"',autoFixAvailable:!0,category:"structure"}),d.get('="([^"]*)"([a-zA-Z]+=)').test(i)&&e.push({rule:"malformed-attributes",severity:"error",message:"Missing spaces between attributes",suggestion:"Add spaces between attributes",autoFixAvailable:!0,category:"structure"})}catch{}return e},autofix:i=>{if(!i||typeof i!="string")return i;let e=i;try{const t=new ze;t.add(d.get("\\bs\\s+rc="),"src=").add(d.get("\\bS\\s+RC="),"src=").add(d.get('="([^"]*)"([a-zA-Z]+=)'),'="$1" $2').add(d.get('(<img[^>]*?)([a-zA-Z0-9_.-]+")([a-zA-Z]+=)'),"$1$2 $3"),e=t.execute(e)}catch{}return e}},"image-alt-attributes":{name:"image-alt-attributes",displayName:"Image Alt Attributes",description:"Ensures all images have meaningful alt attributes for accessibility",severity:"warning",enabled:!0,configurable:!1,category:"accessibility",check:i=>{const e=[],t=i.match(/<img(?![^>]*\salt\s*=\s*["'][^"']+["'])[^>]*>/gi);t&&t.forEach(()=>{e.push({rule:"image-alt-attributes",severity:"error",message:"Image missing meaningful alt attribute for accessibility",line:0,column:0})});const r=i.match(/<img[^>]*alt\s*=\s*["']?\s*["'][^>]*>/gi);return r&&r.forEach(()=>{e.push({rule:"image-alt-attributes",severity:"warning",message:"Image has empty alt attribute - should be descriptive",line:0,column:0})}),e},autofix:i=>{if(!i||typeof i!="string")return i;let e=i;try{e=e.replace(/<img([^>]*?)(\s*\/?\s*)>/gi,(t,r)=>{var l;let s=r;const n=r.match(/src\s*=\s*["']([^"']+)["']/i);let o=T.DEFAULT_ALT_TEXT;if(n){const c=(l=n[1].split("/").pop())==null?void 0:l.split(".")[0];c&&(o=c.replace(/[_-]/g," ").replace(/\b\w/g,u=>u.toUpperCase()))}return s=s.replace(/\s*alt\s*=\s*["'][^"']*["']/gi,""),s+=` alt="${o}"`,`<img${s} />`})}catch{}return e}}};function Ue(i){return{div:"Use <table><tr><td>content</td></tr></table>",p:"Use <span>content</span>",h1:`Use <span style="font-weight:bold; font-size:${T.HEADING_FONT_SIZES.h1}px;">content</span>`,h2:`Use <span style="font-weight:bold; font-size:${T.HEADING_FONT_SIZES.h2}px;">content</span>`,h3:`Use <span style="font-weight:bold; font-size:${T.HEADING_FONT_SIZES.h3}px;">content</span>`,h4:`Use <span style="font-weight:bold; font-size:${T.HEADING_FONT_SIZES.h4}px;">content</span>`,h5:`Use <span style="font-weight:bold; font-size:${T.HEADING_FONT_SIZES.h5}px;">content</span>`,h6:`Use <span style="font-weight:bold; font-size:${T.HEADING_FONT_SIZES.h6}px;">content</span>`,section:"Use <table><tr><td>content</td></tr></table>",article:"Use <table><tr><td>content</td></tr></table>",nav:"Use <table><tr><td>content</td></tr></table>",header:"Use <table><tr><td>content</td></tr></table>",footer:"Use <table><tr><td>content</td></tr></table>",main:"Use <table><tr><td>content</td></tr></table>",aside:"Use <table><tr><td>content</td></tr></table>",figure:"Use <table><tr><td>content</td></tr></table>",figcaption:"Use <table><tr><td>content</td></tr></table>",script:"Remove - not supported in emails",style:"Use inline styles instead",form:"Remove - forms not supported in emails",input:"Remove - interactive elements not supported",button:"Use <a> link styled as button",textarea:"Remove - not supported in emails",select:"Remove - not supported in emails",option:"Remove - not supported in emails",fieldset:"Remove - not supported in emails",legend:"Remove - not supported in emails",label:"Remove - not supported in emails",video:"Use static image or GIF instead",audio:"Remove - not supported in emails",canvas:"Use static image instead",svg:"Use PNG/JPG image instead",iframe:"Remove - not supported in emails",embed:"Remove - not supported in emails",object:"Remove - not supported in emails"}[i]||"Replace with email-safe alternative"}function xs(i){return T.HEADING_FONT_SIZES[`h${i}`]||16}class lt{constructor(e){v(this,"config");v(this,"customRules",new Map);v(this,"fixHistory",new Map);v(this,"maxFixHistorySize",_.MAX_FIX_HISTORY_SIZE);v(this,"cleanupTimer");this.config=e,this.startCleanupTimer()}startCleanupTimer(){this.cleanupTimer&&clearTimeout(this.cleanupTimer),this.cleanupTimer=setTimeout(()=>{this.performCleanup(),this.startCleanupTimer()},ps.TEN_MINUTES_MS)}performCleanup(){const e=Date.now(),t=_.MAX_FIX_HISTORY_AGE_MS;let r=0;for(const[s,n]of this.fixHistory.entries())e-n.timestamp>t&&(this.fixHistory.delete(s),r++);if(this.fixHistory.size>this.maxFixHistorySize){const s=Array.from(this.fixHistory.entries()).sort((o,l)=>o[1].timestamp-l[1].timestamp),n=Math.floor(this.fixHistory.size*_.CACHE_CLEANUP_PERCENTAGE);for(let o=0;o<n&&o<s.length;o++)this.fixHistory.delete(s[o][0]),r++}r>0&&console.log(`AutofixEngine cleanup completed. Cleared ${r} history entries`,{},"AutofixEngine")}autoFix(e){if(!e||typeof e!="string")return{html:"",fixed:[]};if(e.length>this.config.maxHtmlSize){const o=Math.round(this.config.maxHtmlSize/1024),l=Math.round(e.length/1024);return console.warn(`${C.HTML_TOO_LARGE_FOR_AUTOFIX} (${l}KB > ${o}KB), skipping to prevent freezing`,{size:e.length,limit:this.config.maxHtmlSize},"AutofixEngine"),{html:e,fixed:[]}}let t=e;const r=[],s=_.MAX_AUTOFIX_PASSES;let n=0;try{const o=["dangerous-tags","heading-tags","paragraph-tags","block-element-tags","email-safe-tags","malformed-attributes","email-safe-links","image-alt-attributes","table-attributes","email-unsafe-attributes","duplicate-styles","table-nesting-cleanup","empty-elements-cleanup"];for(let l=0;l<s;l++){let c=0;const u=t;for(const E of o){const{html:L,fixed:I}=this.applySingleFix(t,E);if(I&&(t=L,r.includes(E)||r.push(E),c++,n++,t.length>e.length*_.MAX_HTML_SIZE_INCREASE_MULTIPLIER)){console.warn(`HTML size increased too much during autofix, stopping pass ${l+1}`,{originalSize:e.length,newSize:t.length,pass:l+1},"AutofixEngine");break}}const g=this.applyRemainingFixes(t,o,r,_.MAX_AUTOFIX_ITERATIONS);g.iterations>0&&(t=g.html,c+=g.iterations,n+=g.iterations);const f=this.applyCustomFixes(t,r,_.MAX_AUTOFIX_ITERATIONS);if(f.iterations>0&&(t=f.html,c+=f.iterations,n+=f.iterations),console.log(`Pass ${l+1}: Applied ${c} fixes`,{pass:l+1,changes:c},"AutofixEngine"),c===0||t===u){console.log(`No more changes after pass ${l+1}, stopping`,{totalPasses:l+1},"AutofixEngine");break}}return this.recordFixHistory(e,r,n,!0),r.length>0?console.log(`Auto-fix completed with ${n} total changes. Fixed ${r.length} rule types: ${r.join(", ")}`,{totalChanges:n,fixedRules:r},"AutofixEngine"):console.log("No auto-fixes were applied",{},"AutofixEngine"),{html:t,fixed:r}}catch(o){return console.error("Critical auto-fix error",o,"AutofixEngine"),this.recordFixHistory(e,r,n,!1),{html:e,fixed:[]}}}applySingleFix(e,t){const r=M[t],s=this.config.rules[t];if(!(s?s.enabled:r.enabled)||!r.autofix)return{html:e,fixed:!1};try{const o=e,l=r.autofix(e);return o!==l?this.isValidHTMLStructure(l)?{html:l,fixed:!0}:(console.warn(`Fix for rule ${t} produced invalid HTML, reverting`,{},"AutofixEngine"),{html:e,fixed:!1}):{html:e,fixed:!1}}catch(o){return console.error(`Error applying auto-fix for rule ${t}`,o,"AutofixEngine"),{html:e,fixed:!1}}}applyOrderedFixes(e,t,r,s){let n=e,o=0;for(const l of t){if(o>=s)break;const{html:c,fixed:u}=this.applySingleFix(n,l);u&&(n=c,r.push(l),o++,console.log(`Applied auto-fix for rule: ${l}`,{},"AutofixEngine"))}return{html:n,iterations:o}}applyRemainingFixes(e,t,r,s){let n=e,o=0;const l=[];for(const[g,f]of Object.entries(M))if(!t.includes(g)&&f.autofix){const E=this.config.rules[g];(E?E.enabled:f.enabled)&&l.push(g)}let c=!0,u=0;for(;c&&u<3&&o<s;){c=!1,u++;for(const g of l){if(o>=s)break;try{const f=n,{html:E,fixed:L}=this.applySingleFix(n,g);L&&f!==E&&(n=E,r.includes(g)||r.push(g),o++,c=!0,console.log(`Applied remaining auto-fix for rule: ${g} (pass ${u})`,{pass:u,rule:g},"AutofixEngine"))}catch(f){console.error(`Error applying remaining auto-fix for rule ${g}`,f,"AutofixEngine")}}c&&console.log(`Remaining fixes pass ${u} completed with changes`,{pass:u,iterations:o},"AutofixEngine")}return{html:n,iterations:o}}applyCustomFixes(e,t,r){let s=e,n=0;for(const[o,l]of this.customRules.entries()){if(n>=r)break;const c=this.config.rules[o];if(!(!(!c||c.enabled)||!l.autofix))try{const{html:g,fixed:f}=this.applySingleFix(s,o);f&&(s=g,t.push(o),n++,console.log(`Applied custom auto-fix for rule: ${o}`,{},"AutofixEngine"))}catch(g){console.error(`Error applying custom auto-fix for rule ${o}`,g,"AutofixEngine")}}return{html:s,iterations:n}}isValidHTMLStructure(e){if(!e||typeof e!="string")return!1;try{const t=(e.match(/<[^/][^>]*>/g)||[]).length,r=(e.match(/<\/[^>]*>/g)||[]).length,s=(e.match(/<[^>]*\/>/g)||[]).length;return t+r+s===0?!0:!(e.includes("<<")||e.includes(">>")||e.includes("<//")||e.includes("//>"))}catch{return!1}}recordFixHistory(e,t,r,s){const n=`${e.length}_${t.join("_")}`;if(this.fixHistory.set(n,{timestamp:Date.now(),iterations:r,success:s}),this.fixHistory.size>this.maxFixHistorySize){const o=Array.from(this.fixHistory.entries()).sort((c,u)=>c[1].timestamp-u[1].timestamp),l=Math.floor(this.fixHistory.size*_.CACHE_CLEANUP_PERCENTAGE_REDUCED);for(let c=0;c<l&&c<o.length;c++)this.fixHistory.delete(o[c][0])}}autoFixSpecificIssue(e,t){if(!e||typeof e!="string"||!t)return{html:e,fixed:!1};try{const r=M[t]||this.customRules.get(t);if(!r)return console.warn(`Rule ${t} not found`,{},"AutofixEngine"),{html:e,fixed:!1};if(!r.autofix)return console.warn(`Rule ${t} has no autofix function`,{},"AutofixEngine"),{html:e,fixed:!1};const s=this.config.rules[t];if(!(s?s.enabled:r.enabled))return console.warn(`Rule ${t} is disabled`,{},"AutofixEngine"),{html:e,fixed:!1};let o=e,l=!1,c=0;const u=10;for(;c<u;){const g=o;try{const f=r.autofix(o);if(g!==f&&this.isValidHTMLStructure(f))o=f,l=!0,c++,console.log(`Applied fix for rule ${t}, iteration ${c}`,{iteration:c,changed:!0},"AutofixEngine");else break}catch(f){console.error(`Error in iteration ${c+1} for rule ${t}`,f,"AutofixEngine");break}if(o.length>e.length*_.MAX_HTML_SIZE_INCREASE_MULTIPLIER){console.warn(`HTML size increased too much for rule ${t}, stopping`,{originalSize:e.length,newSize:o.length},"AutofixEngine");break}}return l?(console.log(`Successfully fixed issue with rule ${t} in ${c} iterations`,{iterations:c,sizeBefore:e.length,sizeAfter:o.length},"AutofixEngine"),{html:o,fixed:!0}):(console.log(`No changes made for rule ${t}`,{},"AutofixEngine"),{html:e,fixed:!1})}catch(r){return console.error(`Error applying auto-fix for rule ${t}`,r,"AutofixEngine"),{html:e,fixed:!1}}}autoFixMultipleIssues(e,t){if(!e||typeof e!="string"||!Array.isArray(t))return{html:e,fixed:[]};let r=e;const s=[],n=3;try{for(let o=0;o<n;o++){let l=!1;const c=r;for(const u of t){const{html:g,fixed:f}=this.autoFixSpecificIssue(r,u);f&&(r=g,s.includes(u)||s.push(u),l=!0)}if(console.log(`Multiple fixes pass ${o+1}: ${l?"changes made":"no changes"}`,{pass:o+1,hasChanges:l},"AutofixEngine"),!l||r===c)break}return console.log(`Multiple auto-fixes completed. Fixed ${s.length} rule types: ${s.join(", ")}`,{fixedCount:s.length,rules:s},"AutofixEngine"),{html:r,fixed:s}}catch(o){return console.error("Error applying multiple auto-fixes",o,"AutofixEngine"),{html:e,fixed:[]}}}autoFixAllIssues(e,t){if(!e||typeof e!="string")return{html:e,fixed:[]};try{const r=this.getRulesBySeverity(t);return r.length===0?{html:e,fixed:[]}:this.autoFixMultipleIssues(e,r)}catch(r){return console.error(`Error fixing all ${t} issues`,r,"AutofixEngine"),{html:e,fixed:[]}}}autoFixCategory(e,t){if(!e||typeof e!="string"||!t)return{html:e,fixed:[]};try{const r=this.getRulesByCategory(t);return r.length===0?{html:e,fixed:[]}:this.autoFixMultipleIssues(e,r)}catch(r){return console.error(`Error fixing all ${t} issues`,r,"AutofixEngine"),{html:e,fixed:[]}}}getAutoFixableRules(){const e=[];return Object.entries(M).forEach(([t,r])=>{const s=this.config.rules[t],n=s?s.enabled:r.enabled;r.autofix&&n&&e.push(t)}),this.customRules.forEach((t,r)=>{const s=this.config.rules[r],n=s?s.enabled:!0;t.autofix&&n&&e.push(r)}),e}getRulesByCategory(e){const t=[];return Object.entries(M).forEach(([r,s])=>{const n=this.config.rules[r],o=n?n.enabled:s.enabled;s.category===e&&o&&t.push(r)}),this.customRules.forEach((r,s)=>{const n=this.config.rules[s],o=n?n.enabled:!0;r.category===e&&o&&t.push(s)}),t}getRulesBySeverity(e){const t=[];return Object.entries(M).forEach(([r,s])=>{const n=this.config.rules[r],o=n?n.enabled:s.enabled;s.severity===e&&o&&t.push(r)}),this.customRules.forEach((r,s)=>{const n=this.config.rules[s],o=n?n.enabled:!0;r.severity===e&&o&&t.push(s)}),t}addRule(e){if(!e||!e.name){console.warn("Invalid validation rule provided",e,"AutofixEngine");return}this.customRules.set(e.name,e)}removeRule(e){if(!e){console.warn("Invalid rule name provided for removal",e,"AutofixEngine");return}this.customRules.delete(e)}getConfig(){return{...this.config}}updateConfig(e){if(!e){console.warn("Invalid config provided for update",e,"AutofixEngine");return}this.config={...this.config,...e,rules:{...this.config.rules,...e.rules},targetClients:{...this.config.targetClients,...e.targetClients}}}setRuleEnabled(e,t){if(!e){console.warn("Invalid rule name provided for enable/disable",e,"AutofixEngine");return}this.config.rules[e]?this.config.rules[e].enabled=t:this.config.rules[e]={enabled:t}}setRuleSeverity(e,t){if(!e||!t){console.warn("Invalid rule name or severity provided",{ruleName:e,severity:t},"AutofixEngine");return}this.config.rules[e]?this.config.rules[e].severity=t:this.config.rules[e]={enabled:!0,severity:t}}getFixHistoryStats(){const e=Array.from(this.fixHistory.values()),t=e.length,r=e.filter(l=>l.success).length,s=e.reduce((l,c)=>l+c.iterations,0)/t||0,n=e.sort((l,c)=>c.timestamp-l.timestamp).slice(0,_.MAX_RECENT_FIXES_TRACKED),o=n.length>0?n.filter(l=>l.success).length/n.length:0;return{totalFixes:t,successfulFixes:r,averageIterations:Math.round(s*100)/100,recentSuccessRate:Math.round(o*100)/100}}dispose(){this.customRules.clear(),this.fixHistory.clear(),this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0),console.log("AutofixEngine disposed and all caches cleared",{},"AutofixEngine")}}class ct{constructor(e){v(this,"config");v(this,"customRules",new Map);v(this,"traversalCache",new Map);v(this,"maxTraversalCacheSize",T.TRAVERSAL_CACHE_SIZE);v(this,"cacheCleanupTimer");v(this,"cacheAccessCount",new Map);v(this,"cacheLastAccess",new Map);this.config=e,this.startCacheCleanupTimer()}startCacheCleanupTimer(){this.cacheCleanupTimer&&clearTimeout(this.cacheCleanupTimer),this.cacheCleanupTimer=setTimeout(()=>{this.performCacheCleanup(),this.startCacheCleanupTimer()},T.CACHE_CLEANUP_INTERVAL_MS)}performCacheCleanup(){const e=Date.now();let t=0;for(const[r]of this.traversalCache.entries()){const s=`traversal_${r}`,n=this.cacheLastAccess.get(s)||0,o=this.cacheAccessCount.get(s)||0;(e-n>T.CACHE_TTL_MS||o<2)&&(this.traversalCache.delete(r),this.cacheAccessCount.delete(s),this.cacheLastAccess.delete(s),t++)}if(this.customRules.size>_.MAX_CUSTOM_RULES_SIZE){const r=Array.from(this.customRules.entries()),s=Math.floor(this.customRules.size*_.CACHE_CLEANUP_PERCENTAGE_REDUCED);for(let n=0;n<s&&n<r.length;n++)this.customRules.delete(r[n][0]);t+=s}t>0&&console.log(`Cache cleanup completed. Cleared ${t} entries`,{},"ValidationEngine")}getParsedAST(e){if(!e||typeof e!="string")return null;try{let t=J.get(e);return t||(t=new Be(e).parse(),J.set(e,t)),t}catch(t){return console.error("Error parsing HTML to AST",t,"ValidationEngine"),null}}getTraversalResult(e,t,r){const s=`traversal_${t}`;this.traversalCache.has(t)||this.traversalCache.set(t,new Map);const n=this.traversalCache.get(t);if(n.has(r))return this.cacheAccessCount.set(s,(this.cacheAccessCount.get(s)||0)+1),this.cacheLastAccess.set(s,Date.now()),n.get(r);let o=[];try{switch(t){case"findByTag":o=this.findNodesByTagName(e,r);break;case"findByAttribute":{const[l,c]=r.split("=");o=this.findNodesByAttribute(e,l,c);break}case"findByCategory":o=this.findNodesByCategory(e,r);break;default:o=[]}o.length<=_.MAX_TRAVERSAL_RESULTS&&(n.set(r,o),this.cacheAccessCount.set(s,1),this.cacheLastAccess.set(s,Date.now()),n.size>this.maxTraversalCacheSize&&this.cleanupOperationCache(t,n))}catch(l){console.error(`Error in traversal operation ${t}`,l,"ValidationEngine"),o=[]}return o}cleanupOperationCache(e,t){const r=Array.from(t.entries()).map(([n,o])=>({key:n,nodes:o,accessCount:this.cacheAccessCount.get(`traversal_${e}`)||0,lastAccess:this.cacheLastAccess.get(`traversal_${e}`)||0,size:o.length}));r.sort((n,o)=>{const l=n.accessCount*P.TRAVERSAL_ACCESS_COUNT_WEIGHT+(Date.now()-n.lastAccess)/1e3*P.TRAVERSAL_AGE_WEIGHT+n.size/100*P.TRAVERSAL_SIZE_WEIGHT,c=o.accessCount*P.TRAVERSAL_ACCESS_COUNT_WEIGHT+(Date.now()-o.lastAccess)/1e3*P.TRAVERSAL_AGE_WEIGHT+o.size/100*P.TRAVERSAL_SIZE_WEIGHT;return l-c});const s=Math.floor(t.size*_.CACHE_CLEANUP_PERCENTAGE_LARGE);for(let n=0;n<s&&n<r.length;n++)t.delete(r[n].key)}findNodesByTagName(e,t){const r=[],s=_.MAX_TRAVERSAL_RESULTS,n=o=>{for(const l of o){if(r.length>=s)break;l.type==="element"&&l.tagName===t.toLowerCase()&&r.push(l),l.children&&Array.isArray(l.children)&&n(l.children)}};return n(e),r}findNodesByAttribute(e,t,r){const s=[],n=_.MAX_TRAVERSAL_RESULTS,o=l=>{var c;for(const u of l){if(s.length>=n)break;u.type==="element"&&((c=u.attributes)!=null&&c[t])&&(!r||u.attributes[t]===r)&&s.push(u),u.children&&Array.isArray(u.children)&&o(u.children)}};return o(e),s}findNodesByCategory(e,t){const r=[],s=_.MAX_TRAVERSAL_RESULTS,n=o=>{for(const l of o){if(r.length>=s)break;if(l.type==="element")switch(t){case"tables":l.tagName==="table"&&r.push(l);break;case"images":l.tagName==="img"&&r.push(l);break;case"links":l.tagName==="a"&&r.push(l);break;case"headings":l.tagName&&/^h[1-6]$/.test(l.tagName)&&r.push(l);break;case"block-elements":l.tagName&&["div","p","section","article","nav","header","footer","main","aside"].includes(l.tagName)&&r.push(l);break;case"dangerous":l.tagName&&["script","style","iframe","embed","object"].includes(l.tagName)&&r.push(l);break}l.children&&Array.isArray(l.children)&&n(l.children)}};return n(e),r}clearTraversalCache(){const e=this.traversalCache.size;this.traversalCache.clear(),this.cacheAccessCount.clear(),this.cacheLastAccess.clear(),e>0&&console.log(`Cleared traversal cache with ${e} operations`,{},"ValidationEngine")}validate(e){if(!e||typeof e!="string")return this.createEmptyReport("Invalid HTML input provided");if(e.length>this.config.maxHtmlSize){const s=Math.round(this.config.maxHtmlSize/1024);return this.createEmptyReport(`${C.HTML_TOO_LARGE} (over ${s}KB)`,"html-too-large","performance")}const t=[],r=this.getParsedAST(e);try{t.push(...this.runBuiltInRules(e,r)),t.push(...this.runCustomRules(e,r));const s=t.filter(u=>u.severity==="error"),n=t.filter(u=>u.severity==="warning"),o=t.filter(u=>u.severity==="info"),l=this.calculateCategories(t),c=this.calculateValidationScore(t);return{isValid:s.length===0,errors:s,warnings:n,suggestions:o,autoFixAvailable:t.some(u=>u.autoFixAvailable),totalIssues:t.length,categories:l,score:c}}catch(s){return console.error("Critical validation error",s,"ValidationEngine"),this.createEmptyReport(`Validation system error: ${s instanceof Error?s.message:"Unknown error"}`,"validation-system-error","structure")}finally{this.clearTraversalCache()}}runBuiltInRules(e,t){const r=[];this.clearTraversalCache();for(const[s,n]of Object.entries(M)){const o=this.config.rules[s];if((o?o.enabled:n.enabled)&&!(n.category==="accessibility"&&!this.config.checkAccessibility)&&!(n.category==="performance"&&!this.config.checkPerformance)&&!(n.category==="best-practice"&&!this.config.checkBestPractices))try{let c=[];if(n.checkWithAST&&t){const u={ast:t,getTraversalResult:(g,f)=>this.getTraversalResult(t,g,f),findNodesByTag:g=>this.getTraversalResult(t,"findByTag",g),findNodesByAttribute:(g,f)=>this.getTraversalResult(t,"findByAttribute",`${g}=${f||""}`),findNodesByCategory:g=>this.getTraversalResult(t,"findByCategory",g)};c=n.checkWithAST(e,t,o==null?void 0:o.config,u)}else c=n.check(e,o==null?void 0:o.config);o!=null&&o.severity&&c.forEach(u=>{u.severity=o.severity}),r.push(...c)}catch(c){console.error(`Error running validation rule ${s}`,c,"ValidationEngine"),r.push({rule:s,severity:"error",message:`Validation rule error: ${c instanceof Error?c.message:"Unknown error"}`,category:n.category})}}return r}runCustomRules(e,t){const r=[];for(const[s,n]of this.customRules.entries()){const o=this.config.rules[s];if(!o||o.enabled)try{const c=n.checkWithAST&&t?n.checkWithAST(e,t,o==null?void 0:o.config):n.check(e,o==null?void 0:o.config);o!=null&&o.severity&&c.forEach(u=>{u.severity=o.severity}),r.push(...c)}catch(c){console.error(`Error running custom validation rule ${s}`,c,"ValidationEngine")}}return r}calculateCategories(e){return{structure:e.filter(t=>t.category==="structure").length,accessibility:e.filter(t=>t.category==="accessibility").length,compatibility:e.filter(t=>t.category==="compatibility").length,performance:e.filter(t=>t.category==="performance").length,"best-practice":e.filter(t=>t.category==="best-practice").length}}calculateValidationScore(e){if(e.length===0)return ie.MAX_SCORE;let t=0;const r=ie.MAX_PENALTY;e.forEach(n=>{switch(n.severity){case"error":t+=ie.ERROR_PENALTY;break;case"warning":t+=ie.WARNING_PENALTY;break;case"info":t+=ie.INFO_PENALTY;break}});const s=Math.max(0,ie.MAX_SCORE-Math.min(t,r));return Math.round(s)}createEmptyReport(e,t="invalid-input",r="structure"){return{isValid:!1,errors:[{rule:t,severity:"error",message:e,category:r}],warnings:[],suggestions:[],autoFixAvailable:!1,totalIssues:1,categories:{structure:r==="structure"?1:0,accessibility:0,compatibility:0,performance:r==="performance"?1:0,"best-practice":0},score:0}}addRule(e){if(!e||!e.name){console.warn("Invalid validation rule provided",e,"ValidationEngine");return}this.customRules.set(e.name,e)}removeRule(e){if(!e){console.warn("Invalid rule name provided for removal",e,"ValidationEngine");return}this.customRules.delete(e)}getAvailableRules(){const e={...M};return this.customRules.forEach((t,r)=>{e[r]=t}),e}testRule(e,t){if(!e||!t)return console.warn("Invalid parameters for testRule",{ruleName:e,html:typeof t},"ValidationEngine"),[];const r=M[e]||this.customRules.get(e);if(!r)throw new Error(`Rule "${e}" not found`);const s=this.config.rules[e];return r.check(t,s==null?void 0:s.config)}getCompatibilityReport(e){if(!e||typeof e!="string")return{};const t={};return Object.keys(this.config.targetClients).forEach(r=>{if(!this.config.targetClients[r])return;const s=[];switch(r){case"outlook":this.validateOutlookCompatibility(e,s);break;case"gmail":this.validateGmailCompatibility(e,s);break;case"mobile":this.validateMobileCompatibility(e,s);break}t[r]={compatible:s.length===0,issues:s}}),t}validateOutlookCompatibility(e,t){(e.includes("flexbox")||e.includes("display: flex"))&&t.push("Flexbox not supported in Outlook"),(e.includes("grid")||e.includes("display: grid"))&&t.push("CSS Grid not supported in Outlook"),(e.includes("position: absolute")||e.includes("position: fixed"))&&t.push("Absolute/fixed positioning not supported in Outlook"),(e.includes("linear-gradient")||e.includes("radial-gradient"))&&t.push("CSS gradients not supported in Outlook")}validateGmailCompatibility(e,t){e.includes("<style>")&&t.push("Gmail may strip <style> tags on mobile"),e.includes("background-image")&&t.push("Background images may not display consistently in Gmail")}validateMobileCompatibility(e,t){e.includes('width="')&&!e.includes("max-width")&&t.push("Fixed widths without max-width may cause horizontal scrolling on mobile"),e.includes("font-size:")&&e.includes("px")&&t.push("Consider using relative font sizes for better mobile experience")}getCacheStats(){return{traversalCacheSize:this.traversalCache.size,astCacheStats:J.getStats(),regexCacheStats:d.getStats()}}dispose(){this.clearTraversalCache(),this.customRules.clear(),this.cacheCleanupTimer&&(clearTimeout(this.cacheCleanupTimer),this.cacheCleanupTimer=void 0),console.log("ValidationEngine disposed and all caches cleared",{},"ValidationEngine")}}class ht{constructor(e){v(this,"config");v(this,"validationEngine");v(this,"autofixEngine");v(this,"cleanupInterval");v(this,"isDisposed",!1);v(this,"validationStats",{totalValidations:0,successfulValidations:0,totalAutoFixes:0,successfulAutoFixes:0,lastValidationTime:0,lastAutoFixTime:0});this.config={rules:{},targetClients:{outlook:!0,gmail:!0,applemail:!0,thunderbird:!0,mobile:!0},strictMode:!1,allowModernCSS:!1,maxTableNesting:T.MAX_TABLE_NESTING,checkAccessibility:!0,checkPerformance:!0,checkBestPractices:!0,maxFileSize:T.MAX_FILE_SIZE_KB,maxHtmlSize:T.MAX_HTML_SIZE_BYTES,requireAltText:!0,requireFallbacks:!0,...e},this.initializeDefaultRules(),this.validationEngine=new ct(this.config),this.autofixEngine=new lt(this.config),this.setupCleanupInterval()}setupCleanupInterval(){try{this.cleanupInterval=setInterval(()=>{this.performPeriodicCleanup()},T.CACHE_CLEANUP_INTERVAL_MS)}catch(e){console.error("Failed to setup cleanup interval",e,"EmailHTMLValidator")}}performPeriodicCleanup(){try{if(this.isDisposed)return;const e=this.validationEngine.getCacheStats(),t=this.autofixEngine.getFixHistoryStats();if(console.log(`${ae.CACHE_CLEANUP_PREFIX}`,{validationCache:e,autofixHistory:t},"EmailHTMLValidator"),typeof global<"u"&&global.gc)try{global.gc(),console.log(`${ae.GARBAGE_COLLECTION_PREFIX}`,{},"EmailHTMLValidator")}catch{}}catch(e){console.error("Error during periodic cleanup",e,"EmailHTMLValidator")}}initializeDefaultRules(){Object.entries(M).forEach(([t,r])=>{this.config.rules[t]||(this.config.rules[t]={enabled:r.enabled!==!1})}),["email-safe-tags","table-attributes","heading-tags","paragraph-tags","block-element-tags","dangerous-tags","email-safe-links","malformed-attributes"].forEach(t=>{M[t]&&(this.config.rules[t]={enabled:!0})})}validate(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);const t=Date.now();this.validationStats.totalValidations++;try{if(!e||typeof e!="string")throw new Error(C.INVALID_HTML_INPUT);if(e.length>this.config.maxHtmlSize){const n=Math.round(this.config.maxHtmlSize/1024),o=Math.round(e.length/1024);throw new Error(`${C.HTML_TOO_LARGE}: ${o}KB exceeds limit of ${n}KB`)}const r=this.validationEngine.validate(e);this.validationStats.successfulValidations++,this.validationStats.lastValidationTime=Date.now();const s=Date.now()-t;return s>_.SLOW_VALIDATION_THRESHOLD_MS&&console.warn(`${ae.SLOW_OPERATION_PREFIX}: ${s}ms for ${e.length} bytes`,{duration:s,htmlSize:e.length,issues:r.totalIssues},"EmailHTMLValidator"),r}catch(r){this.validationStats.lastValidationTime=Date.now(),console.error(`${C.VALIDATION_FAILED}`,r,"EmailHTMLValidator");const s=r instanceof Error?r.message:"Unknown validation error";return{isValid:!1,errors:[{rule:"validation-error",severity:"error",message:`${C.VALIDATION_FAILED}: ${s}`,category:"structure"}],warnings:[],suggestions:[],autoFixAvailable:!1,totalIssues:1,categories:{structure:1,accessibility:0,compatibility:0,performance:0,"best-practice":0},score:0}}}autoFix(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);const t=Date.now();this.validationStats.totalAutoFixes++;try{if(!e||typeof e!="string")throw new Error(C.INVALID_HTML_INPUT);if(e.length>this.config.maxHtmlSize){const n=Math.round(this.config.maxHtmlSize/1024),o=Math.round(e.length/1024);throw new Error(`${C.HTML_TOO_LARGE_FOR_AUTOFIX}: ${o}KB exceeds limit of ${n}KB`)}const r=this.autofixEngine.autoFix(e);this.validationStats.successfulAutoFixes++,this.validationStats.lastAutoFixTime=Date.now();const s=Date.now()-t;return s>_.SLOW_AUTOFIX_THRESHOLD_MS&&console.warn(`${ae.SLOW_OPERATION_PREFIX}: ${s}ms for ${e.length} bytes`,{duration:s,htmlSize:e.length,fixedRules:r.fixed.length},"EmailHTMLValidator"),r}catch(r){return this.validationStats.lastAutoFixTime=Date.now(),console.error(`${C.AUTOFIX_FAILED}`,r,"EmailHTMLValidator"),{html:e,fixed:[]}}}autoFixSpecificIssue(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixSpecificIssue(e,t)}catch(r){return console.error(`Error fixing specific issue with rule ${t}`,r,"EmailHTMLValidator"),{html:e,fixed:!1}}}autoFixMultipleIssues(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixMultipleIssues(e,t)}catch(r){return console.error("Error fixing multiple issues",r,"EmailHTMLValidator"),{html:e,fixed:[]}}}autoFixAllIssues(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixAllIssues(e,t)}catch(r){return console.error(`Error fixing all ${t} issues`,r,"EmailHTMLValidator"),{html:e,fixed:[]}}}autoFixCategory(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.autoFixCategory(e,t)}catch(r){return console.error(`Error fixing category ${t} issues`,r,"EmailHTMLValidator"),{html:e,fixed:[]}}}getAutoFixableRules(){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.getAutoFixableRules()}catch(e){return console.error("Error getting auto-fixable rules",e,"EmailHTMLValidator"),[]}}getRulesByCategory(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.autofixEngine.getRulesByCategory(e)}catch(t){return console.error(`Error getting rules for category ${e}`,t,"EmailHTMLValidator"),[]}}addRule(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{this.validationEngine.addRule(e),this.autofixEngine.addRule(e),console.log(`Custom rule added: ${e.name}`,{},"EmailHTMLValidator")}catch(t){throw console.error(`Error adding custom rule ${e.name}`,t,"EmailHTMLValidator"),t}}removeRule(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{this.validationEngine.removeRule(e),this.autofixEngine.removeRule(e),console.log(`Custom rule removed: ${e}`,{},"EmailHTMLValidator")}catch(t){throw console.error(`Error removing custom rule ${e}`,t,"EmailHTMLValidator"),t}}updateConfig(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{if(e.maxHtmlSize&&e.maxHtmlSize<=0)throw new Error("maxHtmlSize must be positive");if(e.maxFileSize&&e.maxFileSize<=0)throw new Error("maxFileSize must be positive");this.config={...this.config,...e,rules:{...this.config.rules,...e.rules},targetClients:{...this.config.targetClients,...e.targetClients}},this.validationEngine.dispose(),this.autofixEngine.dispose(),this.validationEngine=new ct(this.config),this.autofixEngine=new lt(this.config),console.log("Configuration updated successfully",{newConfig:e},"EmailHTMLValidator")}catch(t){throw console.error("Error updating configuration",t,"EmailHTMLValidator"),t}}setRuleEnabled(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);if(!e)throw new Error(C.INVALID_RULE_NAME);try{this.config.rules[e]?this.config.rules[e].enabled=t:this.config.rules[e]={enabled:t},console.log(`Rule ${e} ${t?"enabled":"disabled"}`,{},"EmailHTMLValidator")}catch(r){throw console.error(`Error setting rule ${e} enabled state`,r,"EmailHTMLValidator"),r}}setRuleSeverity(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);if(!e||!t)throw new Error("Rule name and severity are required");if(!["error","warning","info"].includes(t))throw new Error(C.INVALID_SEVERITY);try{this.config.rules[e]?this.config.rules[e].severity=t:this.config.rules[e]={enabled:!0,severity:t},console.log(`Rule ${e} severity set to ${t}`,{},"EmailHTMLValidator")}catch(r){throw console.error(`Error setting rule ${e} severity`,r,"EmailHTMLValidator"),r}}getConfig(){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);return{...this.config}}getAvailableRules(){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.validationEngine.getAvailableRules()}catch(e){return console.error("Error getting available rules",e,"EmailHTMLValidator"),{}}}testRule(e,t){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.validationEngine.testRule(e,t)}catch(r){return console.error(`Error testing rule ${e}`,r,"EmailHTMLValidator"),[]}}getCompatibilityReport(e){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);try{return this.validationEngine.getCompatibilityReport(e)}catch(t){return console.error("Error generating compatibility report",t,"EmailHTMLValidator"),{}}}getStats(){try{return{validation:{...this.validationStats},cache:{validation:this.validationEngine.getCacheStats(),autofix:this.autofixEngine.getFixHistoryStats()},isDisposed:this.isDisposed}}catch(e){return console.error("Error getting statistics",e,"EmailHTMLValidator"),{validation:this.validationStats,cache:{validation:{},autofix:{}},isDisposed:this.isDisposed}}}resetStats(){if(this.isDisposed)throw new Error(C.VALIDATOR_DISPOSED);this.validationStats={totalValidations:0,successfulValidations:0,totalAutoFixes:0,successfulAutoFixes:0,lastValidationTime:0,lastAutoFixTime:0},console.log(`${ae.STATISTICS_RESET_PREFIX}`,{},"EmailHTMLValidator")}dispose(){if(!this.isDisposed)try{this.config.rules={},this.validationEngine.dispose(),this.autofixEngine.dispose(),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=void 0),this.isDisposed=!0,console.log(`EmailHTMLValidator ${ae.DISPOSAL_PREFIX}`,{},"EmailHTMLValidator")}catch(e){console.error("Error during disposal",e,"EmailHTMLValidator"),this.isDisposed=!0}}isDisposedValidator(){return this.isDisposed}}new ht({strictMode:!1,targetClients:{outlook:!0,gmail:!0,applemail:!0,thunderbird:!1,mobile:!0},checkAccessibility:!0,checkPerformance:!0,checkBestPractices:!0,maxFileSize:T.MAX_FILE_SIZE_KB,maxHtmlSize:T.MAX_HTML_SIZE_BYTES,requireAltText:!0,requireFallbacks:!0});const ys=({html:i,onHtmlChange:e,validator:t,showCompactView:r=!1})=>{var re;const[s,n]=w.useState(null),[o,l]=w.useState(!1),[c,u]=w.useState(!1),[g,f]=w.useState(0),[E,L]=w.useState(!1),[I,y]=w.useState(!1),[A,R]=w.useState("all"),[N,H]=w.useState("all"),[$,W]=w.useState(""),O=w.useMemo(()=>t||new ht,[t]),Z=`
<!DOCTYPE html>
<html>
<head>
    <title>Comprehensive Email Validation Test</title>
    <style>
        .test-section {
            border: 1px solid #ccc;
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Comprehensive Email Validation Test Cases</h1>

    <!-- FORBIDDEN TAGS TEST CASES -->
    <div class="test-section">
        <div class="test-title">1. FORBIDDEN TAGS - All variants</div>

        <!-- Basic forbidden elements -->
        <div class="container">This is a div container</div>
        <p class="paragraph">This is a paragraph</p>

        <!-- Heading tags (all levels) -->
        <h1 style="color: red;">Main Heading H1</h1>
        <h2 class="subtitle">Subtitle H2</h2>
        <h3>Sub-subtitle H3</h3>
        <h4>Minor heading H4</h4>
        <h5>Smaller heading H5</h5>
        <h6>Smallest heading H6</h6>

        <!-- Semantic elements -->
        <section class="hero">
            <article>
                <header>
                    <nav>Navigation menu</nav>
                </header>
                <main>
                    <aside>Sidebar content</aside>
                    <figure>
                        <figcaption>Image caption</figcaption>
                    </figure>
                </main>
                <footer>Footer content</footer>
            </article>
        </section>

        <!-- Interactive elements -->
        <form action="/submit">
            <fieldset>
                <legend>Form Legend</legend>
                <label for="input1">Input Label:</label>
                <input type="text" id="input1" name="input1" />
                <textarea name="comments">Comments</textarea>
                <select name="options">
                    <option value="1">Option 1</option>
                </select>
                <button type="submit">Submit</button>
            </fieldset>
        </form>

        <!-- Media elements -->
        <video src="video.mp4">Video content</video>
        <audio src="audio.mp3">Audio content</audio>
        <canvas>Canvas content</canvas>
        <svg>SVG content</svg>
        <iframe src="frame.html">Frame content</iframe>
        <embed src="content.swf" />
        <object data="object.pdf">Object content</object>
        <script>alert('script');<\/script>
    </div>

    <!-- EMAIL-SAFE TAGS TEST CASES -->
    <div class="test-section">
        <div class="test-title">2. EMAIL-SAFE TAGS - All variants</div>

        <!-- Wrong BR tag formats -->
        <br></br>
        <br/>
        <br />
        <br class="break" />
        <br style="clear: both"></br>

        <!-- Wrong HR tag formats -->
        <hr></hr>
        <hr/>
        <hr />
        <hr class="divider" />
        <hr style="border: none"></hr>

        <!-- Wrong IMG tag formats -->
        <img src="image1.jpg"></img>
        <img src="image2.jpg" alt="Image 2"></img>
        <img src="image3.jpg" class="responsive"></img>
        <img src="image4.jpg" style="width: 100%"></img>

        <!-- Other self-closing tags -->
        <area shape="rect" coords="0,0,100,100"></area>
        <base href="http://example.com"></base>
        <col span="2"></col>
        <input type="text" name="test"></input>

        <!-- Correct formats (should not trigger errors) -->
        <br>
        <hr>
        <img src="correct.jpg" alt="Correct" />
        <area shape="rect" coords="0,0,50,50" />
        <base href="http://test.com" />
        <col span="1" />
        <input type="email" name="email" />
    </div>

    <!-- TABLE ATTRIBUTES TEST CASES -->
    <div class="test-section">
        <div class="test-title">3. TABLE ATTRIBUTES - All variants</div>

        <!-- Tables missing required attributes -->
        <table>
            <tr><td>Missing all attributes</td></tr>
        </table>

        <table cellpadding="5">
            <tr><td>Missing cellspacing and border</td></tr>
        </table>

        <table cellspacing="2">
            <tr><td>Missing cellpadding and border</td></tr>
        </table>

        <table border="1">
            <tr><td>Missing cellpadding and cellspacing</td></tr>
        </table>

        <table cellpadding="0" cellspacing="0">
            <tr><td>Missing border</td></tr>
        </table>

        <!-- TD elements missing valign -->
        <table cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td>Missing valign</td>
                <td valign="middle">Wrong valign value</td>
                <td valign="bottom">Another wrong valign</td>
            </tr>
        </table>

        <!-- Images missing attributes -->
        <img src="no-alt.jpg">
        <img src="has-alt.jpg" alt="">
        <img src="no-display-block.jpg" alt="No display block">
        <img src="wrong-style.jpg" alt="Wrong style" style="border: 1px solid;">
        <img src="missing-dimensions.jpg" alt="Missing dimensions" style="display:block">

        <!-- Links missing attributes -->
        <a>Link without href</a>
        <a href="http://example.com">Link without target</a>
        <a href="http://example.com" target="_self">Link with wrong target</a>

        <!-- Correct formats (should not trigger errors) -->
        <table cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td valign="top">Correct table</td>
                <td valign="top">All attributes present</td>
            </tr>
        </table>

        <img src="correct-image.jpg" alt="Correct image" style="display:block" />
        <a href="http://example.com" target="_blank">Correct link</a>
    </div>

    <!-- COMPLEX NESTED CASES -->
    <div class="test-section">
        <div class="test-title">4. COMPLEX NESTED CASES</div>

        <!-- Multiple nesting levels -->
        <div class="outer">
            <section class="middle">
                <article class="inner">
                    <header>
                        <h1>Nested heading</h1>
                        <nav>
                            <div class="menu">
                                <p>Menu item 1</p>
                                <p>Menu item 2</p>
                            </div>
                        </nav>
                    </header>
                    <main>
                        <div class="content">
                            <h2>Content heading</h2>
                            <p>Content paragraph with <br></br> wrong break</p>
                            <img src="nested.jpg"></img>
                            <table>
                                <tr><td>Nested table without attributes</td></tr>
                            </table>
                        </div>
                    </main>
                    <footer>
                        <div class="footer-content">
                            <h3>Footer heading</h3>
                            <p>Footer text</p>
                        </div>
                    </footer>
                </article>
            </section>
        </div>
    </div>

    <!-- EDGE CASES -->
    <div class="test-section">
        <div class="test-title">5. EDGE CASES</div>

        <!-- Empty elements -->
        <div></div>
        <p></p>
        <h1></h1>
        <table><tr><td></td></tr></table>

        <!-- Elements with only whitespace -->
        <div>   </div>
        <p>
        </p>
        <h2>	</h2>

        <!-- Malformed tags -->
        <br/ />
        <br / />
        <br////>
        <img src="malformed.jpg" / alt="test" / />
        <hr/ />
        <hr / />

        <!-- Mixed case tags -->
        <DIV>Mixed case div</DIV>
        <P>Mixed case paragraph</P>
        <BR></BR>
        <IMG SRC="mixed.jpg"></IMG>

        <!-- Tags with unusual attributes -->
        <div data-custom="value" onclick="alert()">Div with data and onclick</div>
        <p contenteditable="true" draggable="true">Editable paragraph</p>
        <h1 id="special" class="heading" style="color: blue; font-size: 24px;">Styled heading</h1>

        <!-- Self-closing variations -->
        <br/>
        <br />
        <br  />
        <br	/>
        <img src="test.jpg" />
        <img src="test.jpg"/>
        <img src="test.jpg"  />
        <img src="test.jpg"	/>
    </div>

    <!-- ATTRIBUTES STRESS TEST -->
    <div class="test-section">
        <div class="test-title">6. ATTRIBUTES STRESS TEST</div>

        <!-- Tables with partial attributes -->
        <table cellpadding="0">
            <tr><td>Only cellpadding</td></tr>
        </table>

        <table cellspacing="0">
            <tr><td>Only cellspacing</td></tr>
        </table>

        <table border="0">
            <tr><td>Only border</td></tr>
        </table>

        <table cellpadding="10" cellspacing="5" border="1">
            <tr><td>Wrong values</td></tr>
        </table>

        <!-- Images with partial attributes -->
        <img src="partial1.jpg" alt="">
        <img src="partial2.jpg" style="display:block">
        <img src="partial3.jpg" alt="Test" width="100">
        <img src="partial4.jpg" alt="Test" height="50">
        <img src="partial5.jpg" alt="Test" style="border: none;">

        <!-- Links with variations -->
        <a href="">Empty href</a>
        <a href="#anchor">Anchor link</a>
        <a href="mailto:test@example.com">Mailto link</a>
        <a href="tel:+1234567890">Tel link</a>
        <a href="http://example.com" target="_parent">Wrong target parent</a>
        <a href="http://example.com" target="_top">Wrong target top</a>
    </div>
</body>
</html>
  `;w.useEffect(()=>{if(!i||!i.trim()){n(null);return}L(!0);const h=setTimeout(()=>{try{const p=O.validate(i);n(p)}catch(p){console.error("Validation error",p);const m=p&&typeof p=="object"&&"message"in p?p.message:"Unknown error";n({isValid:!1,errors:[{rule:"validation-error",severity:"error",message:`Validation failed: ${m}`,category:"structure"}],warnings:[],suggestions:[],autoFixAvailable:!1,totalIssues:1,categories:{structure:1,accessibility:0,compatibility:0,performance:0,"best-practice":0},score:0})}finally{L(!1)}},300);return()=>clearTimeout(h)},[i,O]);const Y=async()=>{if(!(s!=null&&s.autoFixAvailable)||!e){console.warn("Auto-fix not available or no onHtmlChange callback",{},"EmailValidationPanel");return}y(!0);try{const{html:h,fixed:p}=O.autoFix(i);p.length>0?(e(h),alert(`Successfully fixed ${p.length} issues:
${p.join(`
`)}`)):alert("No issues were auto-fixed. All issues may already be resolved or not auto-fixable.")}catch(h){alert(`Error during auto-fix: ${h&&typeof h=="object"&&"message"in h?h.message:"Unknown error"}`)}finally{y(!1)}},ce=async h=>{if(e){y(!0);try{const{html:p,fixed:m}=O.autoFixSpecificIssue(i,h);m?(e(p),alert(`Successfully fixed issue with rule: ${h}`)):alert(`No changes made for rule: ${h}. Issue may already be resolved.`)}catch(p){alert(`Error fixing issue: ${p&&typeof p=="object"&&"message"in p?p.message:"Unknown error"}`)}finally{y(!1)}}},te=async h=>{if(e){y(!0);try{const{html:p,fixed:m}=O.autoFixAllIssues(i,h);m.length>0?(e(p),alert(`Successfully fixed ${m.length} ${h} issues:
${m.join(`
`)}`)):alert(`No ${h} issues were fixed. All issues may already be resolved or not auto-fixable.`)}catch(p){alert(`Error fixing ${h} issues: ${p&&typeof p=="object"&&"message"in p?p.message:"Unknown error"}`)}finally{y(!1)}}},de=async h=>{if(e){y(!0);try{const{html:p,fixed:m}=O.autoFixCategory(i,h);m.length>0?(e(p),alert(`Successfully fixed ${m.length} issues in category ${h}:
${m.join(`
`)}`)):alert(`No issues in category ${h} were fixed. All issues may already be resolved or not auto-fixable.`)}catch(p){alert(`Error fixing category ${h} issues: ${p&&typeof p=="object"&&"message"in p?p.message:"Unknown error"}`)}finally{y(!1)}}},se=h=>{switch(h){case"error":return a.jsx(ke,{color:"error"});case"warning":return a.jsx(qe,{color:"warning"});case"info":return a.jsx(De,{color:"info"});default:return a.jsx(De,{})}},ue=h=>{switch(h){case"structure":return a.jsx(st,{color:"primary"});case"accessibility":return a.jsx(at,{color:"secondary"});case"compatibility":return a.jsx(oe,{color:"info"});case"performance":return a.jsx(ye,{color:"warning"});case"best-practice":return a.jsx(rt,{color:"success"});default:return a.jsx(De,{})}},Me=h=>{switch(h){case"structure":return"primary";case"accessibility":return"secondary";case"compatibility":return"info";case"performance":return"warning";case"best-practice":return"success";default:return"default"}},he=h=>{switch(h){case"structure":return"Structure";case"accessibility":return"Accessibility";case"compatibility":return"Compatibility";case"performance":return"Performance";case"best-practice":return"Best Practice";default:return h}},z=w.useMemo(()=>{if(!s)return{errors:[],warnings:[],suggestions:[]};let p=[...s.errors,...s.warnings,...s.suggestions];if(A!=="all"&&(p=p.filter(m=>m.severity===A)),N!=="all"&&(p=p.filter(m=>m.category===N)),$.trim()){const m=$.toLowerCase();p=p.filter(k=>{var S;return k.message.toLowerCase().includes(m)||((S=k.suggestion)==null?void 0:S.toLowerCase().includes(m))||k.rule.toLowerCase().includes(m)})}return{errors:p.filter(m=>m.severity==="error"),warnings:p.filter(m=>m.severity==="warning"),suggestions:p.filter(m=>m.severity==="info")}},[s,A,N,$]),ge=(h,p,m)=>{if(!h||h.length===0)return null;const k=m==="error"?"error":m==="warning"?"warning":"info";return a.jsxs(Zt,{defaultExpanded:m==="error",sx:{mb:2,"&:before":{display:"none"},boxShadow:"none",border:`1px solid ${k==="error"?"#ffcdd2":k==="warning"?"#fff3e0":"#e3f2fd"}`,borderRadius:2},children:[a.jsx(os,{expandIcon:a.jsx(Oe,{}),sx:{backgroundColor:k==="error"?"#ffebee":k==="warning"?"#fff8e1":"#f3e5f5",borderRadius:"8px 8px 0 0"},children:a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[se(m),a.jsxs(x,{variant:"subtitle1",component:"div",fontWeight:"bold",children:[p," (",h.length,")"]}),a.jsx(b,{sx:{flexGrow:1}}),h.some(S=>S.autoFixAvailable)&&e&&a.jsx(G,{size:"small",variant:"contained",startIcon:a.jsx(pe,{}),onClick:S=>{S.stopPropagation(),te(m)},disabled:E||I,color:k,sx:{minWidth:"auto"},children:I?"Fixing...":`Fix All (${h.filter(S=>S.autoFixAvailable).length})`})]})}),a.jsx(Jt,{sx:{p:0},children:a.jsx(It,{dense:!0,sx:{p:0},children:h.map((S,q)=>a.jsxs(Rt,{sx:{px:2,py:1,borderBottom:q<h.length-1?"1px solid #f0f0f0":"none","&:last-child":{borderBottom:"none"}},children:[a.jsx(Lt,{sx:{minWidth:36},children:se(S.severity)}),a.jsx(wt,{primary:a.jsx(x,{variant:"body2",component:"div",fontWeight:"medium",children:S.message}),secondary:a.jsxs(b,{sx:{mt:1},children:[S.line&&a.jsxs(x,{variant:"caption",component:"div",color:"text.secondary",sx:{mb:.5},children:[" Line ",S.line,S.column&&`, Column ${S.column}`]}),S.suggestion&&a.jsxs(x,{variant:"caption",component:"div",display:"block",sx:{mt:.5,fontStyle:"italic",backgroundColor:"#f8f9fa",p:1,borderRadius:1,border:"1px solid #e9ecef"},children:[" ",S.suggestion]}),S.category&&a.jsx(D,{size:"small",icon:ue(S.category),label:he(S.category),color:Me(S.category),variant:"outlined",sx:{mt:1,mr:1}}),a.jsx(D,{size:"small",label:S.rule,variant:"outlined",sx:{mt:1,fontSize:"0.7rem"}})]}),primaryTypographyProps:{component:"div"},secondaryTypographyProps:{component:"div"}}),S.autoFixAvailable&&e&&a.jsx(be,{title:"Fix this issue",children:a.jsx(He,{size:"small",onClick:()=>ce(S.rule),sx:{ml:1},color:"primary",children:a.jsx(pe,{fontSize:"small"})})})]},`${S.rule}-${q}`))})})]})},$e=()=>{if(!s)return null;const h=[{key:"structure",label:"Structure",icon:a.jsx(st,{}),color:"primary"},{key:"accessibility",label:"Accessibility",icon:a.jsx(at,{}),color:"secondary"},{key:"compatibility",label:"Compatibility",icon:a.jsx(oe,{}),color:"info"},{key:"performance",label:"Performance",icon:a.jsx(ye,{}),color:"warning"},{key:"best-practice",label:"Best Practice",icon:a.jsx(rt,{}),color:"success"}];return a.jsx(V,{container:!0,spacing:2,sx:{mb:3},children:h.map(p=>{const m=s.categories[p.key],k=m>0&&O.getRulesByCategory(p.key).some(S=>{var q;return(q=M[S])==null?void 0:q.autofix});return a.jsx(V,{item:!0,xs:12,sm:6,md:4,children:a.jsx(Ne,{className:"category-card",variant:"outlined",onClick:()=>H(p.key),sx:{borderColor:m>0?`${p.color}.main`:"divider",backgroundColor:m>0?`${p.color}.50`:"background.paper",transition:"all 0.3s ease-in-out",cursor:"pointer","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)"}},children:a.jsxs(St,{sx:{p:2,"&:last-child":{pb:2}},children:[a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[a.jsx(b,{sx:{color:`${p.color}.main`},children:p.icon}),a.jsx(x,{variant:"body2",component:"div",fontWeight:"bold",children:p.label})]}),a.jsxs(b,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx(it,{badgeContent:m,color:p.color,children:a.jsx(D,{size:"small",label:m===0?"Perfect":`${m} issues`,color:m===0?"success":p.color,variant:m===0?"filled":"outlined"})}),k&&e&&m>0&&a.jsx(G,{size:"small",variant:"contained",startIcon:a.jsx(pe,{}),onClick:()=>de(p.key),disabled:E||I,color:p.color,sx:{borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"0 2px 4px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},children:I?"Fixing...":`Fix All (${m})`})]})]})})},p.key)})})},fe=()=>s?a.jsxs(b,{sx:{mb:3,p:3,backgroundColor:"#f8f9fa",borderRadius:2,border:"1px solid #e9ecef",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[a.jsxs(x,{variant:"subtitle2",component:"div",sx:{mb:2,fontWeight:"bold",display:"flex",alignItems:"center",gap:1,color:"#495057"},children:[a.jsx(ot,{fontSize:"small"}),"Filters & Search"]}),a.jsxs(V,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(V,{item:!0,xs:12,sm:6,md:3,children:a.jsxs(Qe,{fullWidth:!0,size:"small",children:[a.jsx(Je,{children:"Severity"}),a.jsxs(et,{value:A,label:"Severity",onChange:h=>R(h.target.value),children:[a.jsx(X,{value:"all",children:"All Severities"}),a.jsx(X,{value:"error",children:"Errors"}),a.jsx(X,{value:"warning",children:"Warnings"}),a.jsx(X,{value:"info",children:"Suggestions"})]})]})}),a.jsx(V,{item:!0,xs:12,sm:6,md:3,children:a.jsxs(Qe,{fullWidth:!0,size:"small",children:[a.jsx(Je,{children:"Category"}),a.jsxs(et,{value:N,label:"Category",onChange:h=>H(h.target.value),children:[a.jsx(X,{value:"all",children:"All Categories"}),a.jsx(X,{value:"structure",children:"Structure"}),a.jsx(X,{value:"accessibility",children:"Accessibility"}),a.jsx(X,{value:"compatibility",children:"Compatibility"}),a.jsx(X,{value:"performance",children:"Performance"}),a.jsx(X,{value:"best-practice",children:"Best Practice"})]})]})}),a.jsx(V,{item:!0,xs:12,sm:12,md:6,children:a.jsx(Xe,{fullWidth:!0,size:"small",placeholder:"Search in messages, suggestions, or rules...",value:$,onChange:h=>W(h.target.value),InputProps:{startAdornment:a.jsx(_t,{position:"start",children:a.jsx(Ct,{fontSize:"small"})})}})})]}),a.jsxs(b,{sx:{mt:2,display:"flex",alignItems:"center",justifyContent:"space-between",p:1,backgroundColor:"#ffffff",borderRadius:1,border:"1px solid #dee2e6"},children:[a.jsxs(x,{variant:"caption",color:"text.secondary",children:["Showing"," ",z.errors.length+z.warnings.length+z.suggestions.length," ","of ",s.totalIssues," issues"]}),(A!=="all"||N!=="all"||$.trim())&&a.jsx(G,{size:"small",variant:"outlined",color:"secondary",onClick:()=>{R("all"),H("all"),W("")},sx:{borderRadius:2,textTransform:"none",fontWeight:500},children:"Clear Filters"})]})]}):null,me=()=>{if(!i||!i.trim())return null;try{const h=O.getCompatibilityReport(i);return a.jsxs(b,{sx:{mt:2},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:"Email Client Compatibility"}),Object.entries(h).map(([p,m])=>a.jsxs(b,{sx:{mb:1},children:[a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[p==="outlook"&&a.jsx(oe,{fontSize:"small"}),p==="gmail"&&a.jsx(jt,{fontSize:"small"}),p==="mobile"&&a.jsx(Mt,{fontSize:"small"}),a.jsx(x,{variant:"body2",component:"div",sx:{textTransform:"capitalize",flexGrow:1},children:p}),a.jsx(D,{size:"small",label:m.compatible?"Compatible":"Issues",color:m.compatible?"success":"warning",variant:"outlined"})]}),!m.compatible&&m.issues&&m.issues.length>0&&a.jsx(b,{sx:{ml:3,mt:.5},children:m.issues.map((k,S)=>a.jsxs(x,{variant:"caption",component:"div",color:"warning.main",display:"block",children:[" ",k]},S))})]},p))]})}catch(h){return console.error("Error generating compatibility report",h,"EmailValidationPanel"),a.jsx(b,{sx:{mt:2},children:a.jsx(x,{variant:"subtitle2",component:"div",color:"error",children:"Error generating compatibility report"})})}};return!s&&!E?null:r?a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[E?a.jsx(D,{size:"small",label:"Validating...",color:"info"}):I?a.jsx(D,{size:"small",label:"Fixing...",color:"warning"}):s!=null&&s.isValid?a.jsx(D,{size:"small",icon:a.jsx(Ye,{}),label:"Email Safe",color:"success"}):a.jsx(D,{size:"small",icon:a.jsx(ke,{}),label:`${(s==null?void 0:s.totalIssues)||0} Issues`,color:"error"}),s&&a.jsx(He,{size:"small",onClick:()=>l(!o),children:o?a.jsx(Ke,{}):a.jsx(Oe,{})})]}):a.jsxs(ut,{sx:{p:2,mb:2,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[a.jsx("style",{children:`
          @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
          }

          @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }

          .tab-content {
            animation: slideIn 0.3s ease-out;
          }

          .category-card:hover {
            transform: translateY(-4px);
            boxShadow: 0 8px 25px rgba(0,0,0,0.15);
          }
        `}),a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[E?a.jsx(D,{icon:a.jsx(Se,{}),label:"Validating...",color:"info"}):s!=null&&s.isValid?a.jsx(D,{icon:a.jsx(Ye,{}),label:"Email Safe",color:"success"}):a.jsx(D,{icon:a.jsx(ke,{}),label:`${((re=s==null?void 0:s.errors)==null?void 0:re.length)||0} Errors`,color:"error"}),s&&s.warnings&&s.warnings.length>0&&a.jsx(D,{icon:a.jsx(qe,{}),label:`${s.warnings.length} Warnings`,color:"warning"})]}),a.jsx(b,{sx:{flexGrow:1}}),s&&a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(x,{variant:"body2",color:"text.secondary",children:"Score:"}),a.jsx(D,{label:`${s.score}/100`,color:s.score>=80?"success":s.score>=60?"warning":"error",variant:"outlined",size:"small"})]}),a.jsx(be,{title:"Validation Settings",children:a.jsx(He,{size:"small",onClick:()=>u(!0),children:a.jsx(Te,{})})}),a.jsx(be,{title:"Test Auto-fix with sample HTML",children:a.jsx(G,{size:"small",variant:"outlined",onClick:()=>{e&&(e(Z),alert(" Test HTML loaded! Now try auto-fix to see it in action."))},sx:{ml:1},children:"Test HTML"})}),(s==null?void 0:s.autoFixAvailable)&&e&&a.jsx(be,{title:"Auto-fix All Issues",children:a.jsx(G,{size:"small",variant:"contained",startIcon:a.jsx(pe,{}),onClick:Y,disabled:E||I,color:"primary",sx:{borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"0 2px 4px rgba(25, 118, 210, 0.2)","&:hover":{boxShadow:"0 4px 8px rgba(25, 118, 210, 0.3)"}},children:I?"Fixing...":`Auto-fix All (${s.totalIssues})`})}),a.jsx(G,{size:"small",onClick:()=>l(!o),endIcon:o?a.jsx(Ke,{}):a.jsx(Oe,{}),variant:"outlined",sx:{borderRadius:2,textTransform:"none",fontWeight:500,borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#999",backgroundColor:"#f5f5f5"}},children:"Details"})]}),s&&a.jsxs(b,{sx:{mb:2},children:[a.jsxs(b,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[a.jsx(x,{variant:"caption",color:"text.secondary",children:"Validation Progress"}),a.jsxs(x,{variant:"caption",color:"text.secondary",children:[s.score,"%"]})]}),a.jsx(At,{variant:"determinate",value:s.score,color:s.score>=80?"success":s.score>=60?"warning":"error",sx:{height:6,borderRadius:3}})]}),a.jsxs(dt,{in:o,children:[a.jsx(vt,{sx:{mb:2}}),s&&$e(),a.jsx(b,{sx:{mb:2,borderBottom:"1px solid #e0e0e0",backgroundColor:"#fafafa",borderRadius:"8px 8px 0 0",p:1},children:a.jsxs(Tt,{value:g,onChange:(h,p)=>f(p),sx:{"& .MuiTab-root":{minHeight:48,textTransform:"none",fontWeight:500,fontSize:"0.875rem",transition:"all 0.2s ease-in-out",borderRadius:"8px 8px 0 0",margin:"0 4px",color:"text.secondary"},"& .Mui-selected":{fontWeight:600,color:"primary.main",backgroundColor:"rgba(25, 118, 210, 0.08)"},"& .MuiTabs-indicator":{height:4,borderRadius:"4px 4px 0 0",backgroundColor:"primary.main",boxShadow:"0 2px 4px rgba(25, 118, 210, 0.3)"},"& .MuiTab-root:hover":{backgroundColor:"rgba(25, 118, 210, 0.04)",transform:"translateY(-1px)"}},variant:"fullWidth",textColor:"primary",indicatorColor:"primary",children:[a.jsx(xe,{label:a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(Se,{fontSize:"small"}),"Issues",s&&s.totalIssues>0&&a.jsx(it,{badgeContent:s.totalIssues,color:"error",sx:{ml:1},max:99})]})}),a.jsx(xe,{label:a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(oe,{fontSize:"small"}),"Compatibility"]})}),a.jsx(xe,{label:a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(ye,{fontSize:"small"}),"Performance"]})}),a.jsx(xe,{label:a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(Te,{fontSize:"small"}),"Settings"]})})]})}),a.jsxs(b,{className:"tab-content",sx:{minHeight:200,position:"relative",p:2,backgroundColor:"#ffffff",borderRadius:"0 0 8px 8px",border:"1px solid #e0e0e0",borderTop:"none"},children:[g===0&&s&&a.jsxs(b,{children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#fce4ec",borderRadius:2,border:"1px solid #e91e63",color:"#ad1457",fontWeight:600,boxShadow:"0 2px 4px rgba(233, 30, 99, 0.1)"},children:[a.jsx(Se,{color:"error"}),"Issues & Validation Results"]}),fe(),z.errors.length===0&&z.warnings.length===0&&z.suggestions.length===0?a.jsx(_e,{severity:"info",sx:{borderRadius:2},children:"No issues match the current filters. Try adjusting your search criteria."}):a.jsxs(a.Fragment,{children:[ge(z.errors,"Errors","error"),ge(z.warnings,"Warnings","warning"),ge(z.suggestions,"Suggestions","info")]}),s.totalIssues===0&&a.jsx(_e,{severity:"success",sx:{borderRadius:2},children:" Your HTML is email-safe! No issues found."})]}),g===1&&a.jsxs(b,{children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#e3f2fd",borderRadius:2,border:"1px solid #2196f3",color:"#1565c0"},children:[a.jsx(oe,{color:"info"}),"Email Client Compatibility"]}),me(),a.jsxs(b,{sx:{mt:3,p:2,backgroundColor:"#e3f2fd",borderRadius:2,border:"1px solid #2196f3"},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" Compatibility Tips"}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:1},children:[" ",a.jsx("strong",{children:"Outlook:"})," Use table-based layout, avoid flexbox/grid"]}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:1},children:[" ",a.jsx("strong",{children:"Gmail:"})," Inline styles work best, external CSS may be stripped"]}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:1},children:[" ",a.jsx("strong",{children:"Mobile:"})," Use responsive design with max-width"]})]})]}),g===2&&a.jsxs(b,{children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800",color:"#e65100",fontWeight:600,boxShadow:"0 2px 4px rgba(255, 152, 0, 0.1)"},children:[a.jsx(ye,{color:"warning"}),"Performance Analysis"]}),s&&a.jsxs(V,{container:!0,spacing:2,sx:{mb:3},children:[a.jsx(V,{item:!0,xs:12,sm:6,children:a.jsxs(Ne,{variant:"outlined",sx:{p:2},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" File Size"}),a.jsxs(x,{variant:"h4",component:"div",color:s.score>=80?"success.main":"warning.main",children:[(i.length/1024).toFixed(1)," KB"]}),a.jsx(x,{variant:"caption",component:"div",color:"text.secondary",children:s.score>=80?" Optimal size":" Consider optimization"})]})}),a.jsx(V,{item:!0,xs:12,sm:6,children:a.jsxs(Ne,{variant:"outlined",sx:{p:2},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" Validation Score"}),a.jsxs(x,{variant:"h4",component:"div",color:s.score>=80?"success.main":s.score>=60?"warning.main":"error.main",children:[s.score,"/100"]}),a.jsx(x,{variant:"caption",component:"div",color:"text.secondary",children:s.score>=80?"Excellent":s.score>=60?"Good":"Needs improvement"})]})})]}),a.jsxs(b,{sx:{p:2,backgroundColor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800"},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:" Performance Recommendations"}),a.jsx(x,{variant:"body2",component:"div",sx:{mb:1},children:" Keep HTML size under 102KB for optimal email delivery"}),a.jsx(x,{variant:"body2",component:"div",sx:{mb:1},children:" Use inline styles instead of external CSS"}),a.jsx(x,{variant:"body2",component:"div",sx:{mb:1},children:" Optimize images and use appropriate dimensions"}),a.jsx(x,{variant:"body2",component:"div",sx:{mb:1},children:" Minimize table nesting for better rendering"})]})]}),g===3&&a.jsxs(b,{children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,display:"flex",alignItems:"center",gap:1,p:2,backgroundColor:"#e8f5e8",borderRadius:2,border:"1px solid #4caf50",color:"#2e7d32",fontWeight:600,boxShadow:"0 2px 4px rgba(76, 175, 80, 0.1)"},children:[a.jsx(Te,{color:"primary"}),"Validation Settings"]}),a.jsxs(b,{sx:{mb:3},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:2,fontWeight:"bold"},children:"Quick Actions"}),a.jsxs(V,{container:!0,spacing:2,children:[a.jsx(V,{item:!0,xs:12,sm:6,children:a.jsx(G,{fullWidth:!0,variant:"contained",startIcon:a.jsx(pe,{}),onClick:()=>u(!0),sx:{mb:1,borderRadius:2,textTransform:"none",fontWeight:500,boxShadow:"0 2px 4px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.15)"}},children:"Advanced Settings"})}),a.jsx(V,{item:!0,xs:12,sm:6,children:a.jsx(G,{fullWidth:!0,variant:"outlined",startIcon:a.jsx(ot,{}),onClick:()=>{R("all"),H("all"),W("")},sx:{borderRadius:2,textTransform:"none",fontWeight:500,borderColor:"#e0e0e0",color:"#666","&:hover":{borderColor:"#999",backgroundColor:"#f5f5f5"}},children:"Reset Filters"})})]})]}),a.jsxs(b,{sx:{p:2,backgroundColor:"#f5f5f5",borderRadius:2},children:[a.jsx(x,{variant:"subtitle2",component:"div",sx:{mb:1,fontWeight:"bold"},children:"Current Configuration"}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:.5},children:[" Severity Filter: ",A==="all"?"All":A]}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:.5},children:[" Category Filter: ",N==="all"?"All":N]}),a.jsxs(x,{variant:"body2",component:"div",sx:{mb:.5},children:[" Search Query: ",$||"None"]}),a.jsxs(x,{variant:"body2",component:"div",children:[" Total Rules: ",Object.keys(M).length]})]})]})]})]}),a.jsx(Es,{open:c,onClose:()=>u(!1),validator:O})]})},Es=({open:i,onClose:e,validator:t})=>{const[r,s]=w.useState(t.getConfig()),n=t.getAvailableRules(),o=()=>{try{t.updateConfig(r),e()}catch(c){console.error("Error saving validation config",c,"ValidationSettingsDialog")}},l=(c,u)=>{s(g=>({...g,rules:{...g.rules,[c]:{...g.rules[c],enabled:u}}}))};return a.jsxs($t,{open:i,onClose:e,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[a.jsx(kt,{sx:{backgroundColor:"#f8f9fa",borderBottom:"1px solid #e9ecef",fontWeight:600},children:"Validation Settings"}),a.jsxs(Ht,{sx:{p:3},children:[a.jsxs(b,{sx:{mb:3},children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,p:2,backgroundColor:"#e3f2fd",borderRadius:2,border:"1px solid #2196f3",color:"#1565c0",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[a.jsx(Se,{fontSize:"small"}),"Validation Rules"]}),a.jsx(tt,{children:Object.entries(n).map(([c,u])=>{var g;return a.jsx(Fe,{control:a.jsx(Pe,{checked:((g=r.rules[c])==null?void 0:g.enabled)??u.enabled,onChange:f=>l(c,f.target.checked),color:"primary"}),label:a.jsxs(b,{sx:{p:1,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef",flex:1},children:[a.jsx(x,{variant:"body2",component:"div",sx:{fontWeight:500},children:u.displayName}),a.jsx(x,{variant:"caption",component:"div",color:"text.secondary",children:u.description})]}),sx:{alignItems:"flex-start",mb:1,p:1,borderRadius:1,"&:hover":{backgroundColor:"#f8f9fa"}}},c)})})]}),a.jsxs(b,{sx:{mb:3},children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,p:2,backgroundColor:"#fff3e0",borderRadius:2,border:"1px solid #ff9800",color:"#e65100",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[a.jsx(oe,{fontSize:"small"}),"Target Email Clients"]}),a.jsx(tt,{children:Object.entries(r.targetClients).map(([c,u])=>a.jsx(Fe,{control:a.jsx(Pe,{checked:u,onChange:g=>s(f=>({...f,targetClients:{...f.targetClients,[c]:g.target.checked}})),color:"primary"}),label:a.jsx(b,{sx:{p:1,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef",flex:1},children:a.jsx(x,{variant:"body2",component:"div",sx:{fontWeight:500},children:c.charAt(0).toUpperCase()+c.slice(1)})}),sx:{alignItems:"flex-start",mb:1,p:1,borderRadius:1,"&:hover":{backgroundColor:"#f8f9fa"}}},c))})]}),a.jsxs(b,{sx:{p:2,backgroundColor:"#f3e5f5",borderRadius:2,border:"1px solid #9c27b0"},children:[a.jsxs(x,{variant:"h6",component:"div",sx:{mb:2,color:"#6a1b9a",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[a.jsx(Te,{fontSize:"small"}),"Advanced Options"]}),a.jsxs(b,{sx:{mb:2},children:[a.jsx(x,{variant:"body2",component:"div",sx:{mb:1,fontWeight:500},children:"Max HTML Size (KB)"}),a.jsx(Xe,{type:"number",size:"small",value:Math.round(r.maxHtmlSize/1024),onChange:c=>{const u=parseInt(c.target.value);!isNaN(u)&&u>0&&s(g=>({...g,maxHtmlSize:u*1024}))},inputProps:{min:1,max:1e3},sx:{width:120},helperText:`Current: ${Math.round(r.maxHtmlSize/1024)}KB`})]}),a.jsx(Fe,{control:a.jsx(Pe,{checked:r.strictMode,onChange:c=>s(u=>({...u,strictMode:c.target.checked})),color:"secondary"}),label:a.jsx(b,{sx:{p:1,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef",flex:1},children:a.jsx(x,{variant:"body2",component:"div",sx:{fontWeight:500},children:"Strict Mode (treat warnings as errors)"})}),sx:{alignItems:"flex-start",p:1,borderRadius:1,"&:hover":{backgroundColor:"#f8f9fa"}}})]})]}),a.jsxs(Ot,{sx:{p:3,borderTop:"1px solid #e9ecef"},children:[a.jsx(G,{onClick:e,sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3},children:"Cancel"}),a.jsx(G,{onClick:o,variant:"contained",sx:{borderRadius:2,textTransform:"none",fontWeight:500,px:3,boxShadow:"0 2px 4px rgba(25, 118, 210, 0.2)","&:hover":{boxShadow:"0 4px 8px rgba(25, 118, 210, 0.3)"}},children:"Save"})]})]})},Ts=()=>{const{editorHtml:i,setEditorHtml:e,subject:t,setSubject:r,loading:s,sendEmail:n,isReadyToSend:o,areCredentialsValid:l,serverStatus:c}=Nt(),u=()=>{n()},g=()=>{e("")},f=s||!o||!l||c==="offline";return a.jsxs(b,{sx:{height:"100%",display:"flex",flexDirection:"column",p:2},children:[a.jsxs(b,{sx:{flexGrow:1,overflow:"auto",pr:1},children:[a.jsxs(b,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[a.jsx(Ft,{}),a.jsx(x,{variant:"h6",children:"Email Template Editor"})]}),c==="offline"&&a.jsx(_e,{severity:"error",sx:{mb:3},children:"Email server is offline. Please start the backend server."}),a.jsxs(Pt,{spacing:3,children:[a.jsx(Xe,{label:"Email Subject",value:t,onChange:E=>r(E.target.value),fullWidth:!0,placeholder:"Enter email subject...",helperText:"A descriptive subject line for your email",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"background.paper"}}}),a.jsx(b,{children:a.jsx(ys,{html:i,onHtmlChange:e,showCompactView:!1})}),a.jsxs(b,{children:[a.jsx(x,{variant:"subtitle2",sx:{mb:2,color:"text.secondary",fontWeight:500},children:"HTML Content:"}),a.jsx(b,{sx:{border:"2px solid",borderColor:"divider",borderRadius:2,overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)","& .cm-editor":{fontSize:"14px"},"& .cm-focused":{outline:"none"},"& .cm-editor .cm-scroller":{fontFamily:"monospace"}},children:a.jsx(Dt,{value:i,onChange:E=>e(E),height:"400px",extensions:[Vt()],theme:void 0,basicSetup:{lineNumbers:!0,foldGutter:!0,dropCursor:!1,allowMultipleSelections:!1,indentOnInput:!0,bracketMatching:!0,closeBrackets:!0,autocompletion:!0,highlightSelectionMatches:!1}})})]})]})]}),a.jsx(b,{sx:{position:"sticky",bottom:0,backgroundColor:"background.paper",borderTop:1,borderColor:"divider",p:2,mx:-2,mt:2,boxShadow:"0px -2px 8px rgba(0, 0, 0, 0.1)",zIndex:10},children:a.jsxs(b,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[a.jsx(b,{sx:{display:"flex",alignItems:"center",gap:2},children:a.jsx(G,{variant:"outlined",startIcon:a.jsx(Gt,{}),onClick:g,size:"medium",color:"warning",sx:{borderColor:"warning.main",color:"warning.main","&:hover":{borderColor:"warning.dark",backgroundColor:"warning.50"}},children:"Clear Editor"})}),a.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:2},children:[!l&&a.jsx(_e,{severity:"warning",sx:{py:.5,px:2,fontSize:"0.875rem"},children:"Configure credentials first"}),a.jsx(G,{variant:"contained",startIcon:a.jsx(zt,{}),onClick:u,disabled:f,size:"large",sx:{minWidth:160,height:48,fontSize:"1rem",fontWeight:600,bgcolor:f?void 0:"success.main","&:hover":{bgcolor:f?void 0:"success.dark",transform:"translateY(-1px)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},"&:disabled":{opacity:.6},transition:"all 0.2s ease-in-out"},children:s?"Sending...":"Send Email"})]})]})})]})};export{Ts as EmailHtmlEditor,Ts as default};
