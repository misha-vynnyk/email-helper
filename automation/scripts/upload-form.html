<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>üöÄ Storage Upload</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
        max-width: 500px;
        width: 100%;
        animation: slideIn 0.4s ease-out;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        font-size: 28px;
        color: #333;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .file-info {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 25px;
        border-left: 4px solid #667eea;
      }

      .file-info strong {
        color: #667eea;
        display: block;
        margin-bottom: 5px;
      }

      .file-info .filename {
        color: #333;
        font-size: 16px;
        word-break: break-all;
      }

      .form-group {
        margin-bottom: 25px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
        font-size: 14px;
      }

      .hint {
        font-size: 12px;
        color: #999;
        margin-top: 5px;
      }

      input,
      select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      select {
        cursor: pointer;
        background-color: white;
      }

      .button-group {
        display: flex;
        gap: 12px;
        margin-top: 30px;
      }

      button {
        flex: 1;
        padding: 14px 24px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: #e0e0e0;
        color: #666;
      }

      .btn-secondary:hover {
        background: #d0d0d0;
      }

      .error {
        background: #fee;
        border: 2px solid #fcc;
        color: #c33;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        display: none;
      }

      .category-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .category-finance {
        background: #e8f5e9;
        color: #2e7d32;
      }

      .category-health {
        background: #e3f2fd;
        color: #1565c0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üöÄ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h1>
      <p class="subtitle">–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∞–Ω—ñ —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ EPC Network Storage</p>

      <div class="file-info">
        <strong>üìÑ –§–∞–π–ª –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:</strong>
        <div
          class="filename"
          id="fileName"
        >
          –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...
        </div>
        <div style="margin-top: 10px; font-size: 13px; color: #666">
          <div id="fileSize"></div>
          <div
            id="filePath"
            style="margin-top: 5px; word-break: break-all; font-size: 11px; color: #999"
          ></div>
        </div>
      </div>

      <div
        class="error"
        id="error"
      ></div>

      <form id="uploadForm">
        <div class="form-group">
          <label for="folderName">üìÅ –ù–∞–∑–≤–∞ –ø–∞–ø–∫–∏</label>
          <input
            type="text"
            id="folderName"
            name="folderName"
            placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: ABCD123 –∞–±–æ Finance-456"
            autocomplete="off"
            autofocus
            required
          />
          <div class="hint">–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –ø–∞–ø–∫–∏ (–ª—ñ—Ç–µ—Ä–∏ + —Ü–∏—Ñ—Ä–∏)</div>
        </div>

        <div class="form-group">
          <label for="category">üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
          <select
            id="category"
            name="category"
            required
          >
            <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é...</option>
            <option value="finance">üí∞ Finance</option>
            <option value="health">üè• Health</option>
          </select>
        </div>

        <div class="button-group">
          <button
            type="button"
            class="btn-secondary"
            onclick="cancel()"
          >
            –°–∫–∞—Å—É–≤–∞—Ç–∏
          </button>
          <button
            type="submit"
            class="btn-primary"
          >
            ‚úì –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
          </button>
        </div>
      </form>
    </div>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const fileName = urlParams.get("file") || "–ù–µ–≤—ñ–¥–æ–º–∏–π —Ñ–∞–π–ª";
      const fileSize = urlParams.get("size");
      const filePath = urlParams.get("path");
      const presetCategory = urlParams.get("category");
      const presetFolder = urlParams.get("folder");

      // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ñ–∞–π–ª
      document.getElementById("fileName").textContent = fileName;

      if (fileSize) {
        document.getElementById("fileSize").textContent = "üìä –†–æ–∑–º—ñ—Ä: " + fileSize;
      }

      if (filePath) {
        document.getElementById("filePath").textContent = "üìç –®–ª—è—Ö: " + filePath;
      }

      // –ü–µ—Ä–µ–¥–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
      if (presetCategory) {
        document.getElementById("category").value = presetCategory;
      }

      // –ü–µ—Ä–µ–¥–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–∞–ø–∫–∏ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∞–±–æ clipboard
      if (presetFolder) {
        document.getElementById("folderName").value = presetFolder;
      } else if (navigator.clipboard && navigator.clipboard.readText) {
        navigator.clipboard
          .readText()
          .then((text) => {
            if (text && text.trim()) {
              document.getElementById("folderName").value = text.trim();
            }
          })
          .catch(() => {
            // Clipboard –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∞–±–æ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ
          });
      }

      document.getElementById("uploadForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const folderName = document.getElementById("folderName").value.trim();
        const category = document.getElementById("category").value;

        if (!folderName || !category) {
          showError("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!");
          return;
        }

        // –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–æ—Ä–º–∞—Ç—É
        const letters = folderName.replace(/[^a-zA-Z]/g, "");
        const digits = folderName.replace(/[^0-9]/g, "");

        if (!letters || !digits) {
          showError("–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç! –ü–æ—Ç—Ä—ñ–±–Ω—ñ —ñ –ª—ñ—Ç–µ—Ä–∏, —ñ —Ü–∏—Ñ—Ä–∏ (–Ω–∞–ø—Ä. ABCD123)");
          return;
        }

        // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –¥–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        try {
          const response = await fetch("/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ folderName, category }),
          });

          if (response.ok) {
            document.body.innerHTML = `
            <div class="container" style="text-align: center;">
              <h1 style="color: #4CAF50; justify-content: center;">‚úì –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!</h1>
              <p style="margin-top: 20px; color: #666; font-size: 18px;">–†–æ–∑–ø–æ—á–∞—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
              <div style="margin-top: 20px; color: #999; font-size: 14px;">
                <p>üîÑ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±—Ä–∞—É–∑–µ—Ä–∞</p>
                <p>üìÇ –í—ñ–¥–∫—Ä–∏—Ç—Ç—è storage</p>
                <p>‚¨ÜÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É</p>
              </div>
              <div style="margin-top: 30px; color: #999; font-size: 13px;">
                –°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å–æ–º –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ.<br>–¶–µ –≤—ñ–∫–Ω–æ –º–æ–∂–Ω–∞ –∑–∞–∫—Ä–∏—Ç–∏.
              </div>
            </div>
          `;
          }
        } catch (err) {
          showError("–ü–æ–º–∏–ª–∫–∞ –∑–≤'—è–∑–∫—É –∑ —Å–µ—Ä–≤–µ—Ä–æ–º");
        }
      });

      function showError(message) {
        const errorEl = document.getElementById("error");
        errorEl.textContent = "‚ö†Ô∏è " + message;
        errorEl.style.display = "block";
        setTimeout(() => {
          errorEl.style.display = "none";
        }, 5000);
      }

      async function cancel() {
        // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –∑ —Ç–∞–π–º–µ—Ä–æ–º
        let seconds = 3;
        const updateMessage = () => {
          document.body.innerHTML = `
            <div class="container" style="text-align: center;">
              <h1 style="color: #ff9800; justify-content: center;">‚ö†Ô∏è –°–∫–∞—Å–æ–≤–∞–Ω–æ</h1>
              <p style="margin-top: 20px; color: #666; font-size: 18px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º</p>
              <div style="margin-top: 30px; color: #999; font-size: 13px;">
                –ó–∞–∫—Ä–∏—Ç—Ç—è —á–µ—Ä–µ–∑ ${seconds} —Å–µ–∫—É–Ω–¥...
              </div>
            </div>
          `;
        };

        updateMessage();

        // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        try {
          await fetch("/cancel", { method: "POST" });
        } catch (err) {
          console.log("–°–µ—Ä–≤–µ—Ä –≤–∂–µ –∑–∞–∫—Ä–∏—Ç–æ");
        }

        // –í—ñ–¥–ª—ñ–∫
        const interval = setInterval(() => {
          seconds--;
          if (seconds > 0) {
            updateMessage();
          } else {
            clearInterval(interval);
          }
        }, 1000);
      }

      // Hotkeys
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          cancel();
        }
      });
    </script>
  </body>
</html>
